import{g as Ys,j as Te,m as Js,f as Xs,u as Zs,a as eu,r as Ae,c as En,l as tu,V as At,L as ru}from"./index-DpNFJqVI.js";var bn={exports:{}},Fe={},Qe={},Je={},Pn,Vi;function nu(){return Vi||(Vi=1,Pn=function(k){var p=k.location,_=k.URL;return[p,_].some(function(o){return!o})?function(i){return Promise.reject(new Error("Failed to import: "+i+": dynamicImport is not supported"))}:(k.__twilioVideoImportedModules={},function(i){return i in k.__twilioVideoImportedModules?Promise.resolve(k.__twilioVideoImportedModules[i]):new Function("scope","return import('"+new _(i,p)+"').then(m => scope.__twilioVideoImportedModules['"+i+"'] = m);")(k)})}(globalThis)),Pn}var Cn,Fi;function es(){if(Fi)return Cn;Fi=1;var k=function(){},p="undefined",_=typeof window!==p&&typeof window.navigator!==p&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function i(u,g){var h=u[g];if(typeof h.bind=="function")return h.bind(u);try{return Function.prototype.bind.call(h,u)}catch{return function(){return Function.prototype.apply.apply(h,[u,arguments])}}}function e(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(u){return u==="debug"&&(u="log"),typeof console===p?!1:u==="trace"&&_?e:console[u]!==void 0?i(console,u):console.log!==void 0?i(console,"log"):k}function t(u,g){for(var h=0;h<o.length;h++){var S=o[h];this[S]=h<u?k:this.methodFactory(S,u,g)}this.log=this.debug}function n(u,g,h){return function(){typeof console!==p&&(t.call(this,g,h),this[u].apply(this,arguments))}}function a(u,g,h){return r(u)||n.apply(this,arguments)}function c(u,g,h){var S=this,R,T="loglevel";typeof u=="string"?T+=":"+u:typeof u=="symbol"&&(T=void 0);function b(f){var m=(o[f]||"silent").toUpperCase();if(!(typeof window===p||!T)){try{window.localStorage[T]=m;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+m+";"}catch{}}}function y(){var f;if(!(typeof window===p||!T)){try{f=window.localStorage[T]}catch{}if(typeof f===p)try{var m=window.document.cookie,C=m.indexOf(encodeURIComponent(T)+"=");C!==-1&&(f=/^([^;]+)/.exec(m.slice(C))[1])}catch{}return S.levels[f]===void 0&&(f=void 0),f}}S.name=u,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=h||a,S.getLevel=function(){return R},S.setLevel=function(f,m){if(typeof f=="string"&&S.levels[f.toUpperCase()]!==void 0&&(f=S.levels[f.toUpperCase()]),typeof f=="number"&&f>=0&&f<=S.levels.SILENT){if(R=f,m!==!1&&b(f),t.call(S,f,u),typeof console===p&&f<S.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+f},S.setDefaultLevel=function(f){y()||S.setLevel(f,!1)},S.enableAll=function(f){S.setLevel(S.levels.TRACE,f)},S.disableAll=function(f){S.setLevel(S.levels.SILENT,f)};var l=y();l==null&&(l=g??"WARN"),S.setLevel(l,!1)}var s=new c,d={};s.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var h=d[g];return h||(h=d[g]=new c(g,s.getLevel(),s.methodFactory)),h};var v=typeof window!==p?window.log:void 0;return s.noConflict=function(){return typeof window!==p&&window.log===s&&(window.log=v),s},s.getLoggers=function(){return d},s.default=s,Cn=s,Cn}var kn={exports:{}};const iu="twilio-video",au="2.31.0",ts={name:iu,version:au};kn.exports;var Bi;function Ce(){return Bi||(Bi=1,function(k){var p=ts;k.exports.SDK_NAME=p.name+".js",k.exports.SDK_VERSION=p.version,k.exports.SDP_FORMAT="unified",k.exports.hardwareDevicePublisheriPad={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPad",hwDeviceType:"tablet",platformName:"iOS"},k.exports.hardwareDevicePublisheriPhone={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPhone",hwDeviceType:"mobile",platformName:"iOS"},k.exports.DEFAULT_ENVIRONMENT="prod",k.exports.DEFAULT_REALM="us1",k.exports.DEFAULT_REGION="gll",k.exports.DEFAULT_LOG_LEVEL="warn",k.exports.DEFAULT_LOGGER_NAME="twilio-video",k.exports.WS_SERVER=function(o,i){return i=i==="gll"?"global":encodeURIComponent(i),o==="prod"?"wss://"+i+".vss.twilio.com/signaling":"wss://"+i+".vss."+o+".twilio.com/signaling"},k.exports.PUBLISH_MAX_ATTEMPTS=5,k.exports.PUBLISH_BACKOFF_JITTER=10,k.exports.PUBLISH_BACKOFF_MS=20;function _(o){return["a","e","i","o","u"].includes(o.toLowerCase()[0])?"an":"a"}k.exports.typeErrors={ILLEGAL_INVOKE:function(o,i){return new TypeError("Illegal call to "+o+": "+i)},INVALID_TYPE:function(o,i){return new TypeError(o+" must be "+_(i)+" "+i)},INVALID_VALUE:function(o,i){return new RangeError(o+" must be one of "+i.join(", "))},REQUIRED_ARGUMENT:function(o){return new TypeError(o+" must be specified")}},k.exports.DEFAULT_FRAME_RATE=24,k.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,k.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,k.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,k.exports.DEFAULT_NQ_LEVEL_LOCAL=1,k.exports.DEFAULT_NQ_LEVEL_REMOTE=0,k.exports.MAX_NQ_LEVEL=3,k.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,k.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,k.exports.iceRestartBackoffConfig={factor:1.1,min:1,max:k.exports.DEFAULT_SESSION_TIMEOUT_SEC*1e3,jitter:1},k.exports.reconnectBackoffConfig={factor:1.5,min:80,jitter:1},k.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},k.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},k.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},k.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},k.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}}(kn)),kn.exports}var _t,Ui;function ze(){if(Ui)return _t;Ui=1;var k=_t&&_t.__read||function(g,h){var S=typeof Symbol=="function"&&g[Symbol.iterator];if(!S)return g;var R=S.call(g),T,b=[],y;try{for(;(h===void 0||h-- >0)&&!(T=R.next()).done;)b.push(T.value)}catch(l){y={error:l}}finally{try{T&&!T.done&&(S=R.return)&&S.call(R)}finally{if(y)throw y.error}}return b},p=_t&&_t.__spreadArray||function(g,h){for(var S=0,R=h.length,T=g.length;S<R;S++,T++)g[T]=h[S];return g},_=es().getLogger,o=Ce(),i=o.DEFAULT_LOG_LEVEL,e=o.DEFAULT_LOGGER_NAME,r=Ce().typeErrors,t;function n(g){if(t=t||new Map,t.has(g))return t.get(g);var h=new Set;return t.set(g,h),h}var a=function(){function g(h,S,R,T,b){if(typeof h!="string")throw r.INVALID_TYPE("moduleName","string");if(!S)throw r.REQUIRED_ARGUMENT("component");typeof R!="object"&&(R={}),b=b||_,u(R),Object.defineProperties(this,{_component:{value:S},_logLevels:{value:R},_warnings:{value:new Set},_loggerName:{get:function(){var l=T&&typeof T=="string"?T:e;return this._logLevelsEqual||(l=l+"-"+h),l}},_logger:{get:function(){var l=b(this._loggerName),f=this._logLevels[h]||i;return f=f==="off"?"silent":f,l.setDefaultLevel(f),l}},_logLevelsEqual:{get:function(){return new Set(Object.values(this._logLevels)).size===1}},logLevel:{get:function(){return g.getLevelByName(R[h]||i)}},name:{get:S.toString.bind(S)}})}return g.getLevelByName=function(h){return isNaN(h)?(h=h.toUpperCase(),v(h),g[h]):parseInt(h,10)},g.prototype.createLog=function(h,S){var R=this._loggerName;return this._logLevelsEqual||(R=R.substring(0,R.lastIndexOf("-"))),new g(h,S,this._logLevels,R)},g.prototype.setLevels=function(h){return u(h),Object.assign(this._logLevels,h),this},g.prototype.log=function(h,S){var R=g._levels[h];if(!R)throw r.INVALID_VALUE("logLevel",s);R=R.toLowerCase();var T=[new Date().toISOString(),R,this.name];return(this._logger[R]||function(){}).apply(void 0,p([],k(T.concat(S)))),this},g.prototype.debug=function(){return this.log(g.DEBUG,[].slice.call(arguments))},g.prototype.deprecated=function(h){var S=n(this._component.constructor);return S.has(h)?this:(S.add(h),this.warn(h))},g.prototype.info=function(){return this.log(g.INFO,[].slice.call(arguments))},g.prototype.warn=function(){return this.log(g.WARN,[].slice.call(arguments))},g.prototype.warnOnce=function(h){return this._warnings.has(h)?this:(this._warnings.add(h),this.warn(h))},g.prototype.error=function(){return this.log(g.ERROR,[].slice.call(arguments))},g.prototype.throw=function(h,S){throw h.clone&&(h=h.clone(S)),this.log(g.ERROR,h),h},g}();Object.defineProperties(a,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var c={},s=[],d=a._levels.map(function(g,h){return c[g]=!0,s.push(h),g});function v(g){if(!(g in c))throw r.INVALID_VALUE("level",d)}function u(g){Object.keys(g).forEach(function(h){v(g[h].toUpperCase())})}return _t=a,_t}var Wi;function ou(){if(Wi)return Je;Wi=1;var k=Je&&Je.__awaiter||function(t,n,a,c){function s(d){return d instanceof a?d:new a(function(v){v(d)})}return new(a||(a=Promise))(function(d,v){function u(S){try{h(c.next(S))}catch(R){v(R)}}function g(S){try{h(c.throw(S))}catch(R){v(R)}}function h(S){S.done?d(S.value):s(S.value).then(u,g)}h((c=c.apply(t,n||[])).next())})},p=Je&&Je.__generator||function(t,n){var a={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},c,s,d,v;return v={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function u(h){return function(S){return g([h,S])}}function g(h){if(c)throw new TypeError("Generator is already executing.");for(;a;)try{if(c=1,s&&(d=h[0]&2?s.return:h[0]?s.throw||((d=s.return)&&d.call(s),0):s.next)&&!(d=d.call(s,h[1])).done)return d;switch(s=0,d&&(h=[h[0]&2,d.value]),h[0]){case 0:case 1:d=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,s=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(d=a.trys,!(d=d.length>0&&d[d.length-1])&&(h[0]===6||h[0]===2)){a=0;continue}if(h[0]===3&&(!d||h[1]>d[0]&&h[1]<d[3])){a.label=h[1];break}if(h[0]===6&&a.label<d[1]){a.label=d[1],d=h;break}if(d&&a.label<d[2]){a.label=d[2],a.ops.push(h);break}d[2]&&a.ops.pop(),a.trys.pop();continue}h=n.call(t,a)}catch(S){h=[6,S],s=0}finally{c=d=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}};Object.defineProperty(Je,"__esModule",{value:!0}),Je.createNoiseCancellationAudioProcessor=void 0;var _=nu();ze();var o={krisp:{supportedVersion:"1.0.0",pluginFile:"krispsdk.mjs"},rnnoise:{supportedVersion:"0.6.0",pluginFile:"rnnoise_sdk.mjs"}},i=function(t){var n=t.supportedVersion,a=t.plugin,c=t.log;if(!a.getVersion||!a.isSupported)throw new Error("Plugin does not export getVersion/isSupported api. Are you using old version of the plugin ?");var s=a.getVersion();c.debug("Plugin Version = "+s);var d=n.split(".").map(function(h){return Number(h)}),v=s.split(".").map(function(h){return Number(h)});if(d.length!==3||v.length!==3)throw new Error("Unsupported Plugin version format: "+n+", "+s);if(d[0]!==v[0])throw new Error("Major version mismatch: [Plugin version "+s+"],  [Supported Version "+n+"]");if(v[1]<d[1])throw new Error("Minor version mismatch: [Plugin version "+s+"] < [Supported Version "+n+"]");var u=new AudioContext,g=a.isSupported(u);if(u.close(),!g)throw new Error("Noise Cancellation plugin is not supported on your browser")},e=new Map;function r(t,n){return k(this,void 0,void 0,function(){var a,c,s,d,v,u,g,h,S;return p(this,function(R){switch(R.label){case 0:if(a=e.get(t.vendor),a)return[3,6];if(c=o[t.vendor],!c)throw new Error("Unsupported NoiseCancellationOptions.vendor: "+t.vendor);s=c.supportedVersion,d=c.pluginFile,v=t.sdkAssetsPath,u=v+"/"+d,R.label=1;case 1:return R.trys.push([1,5,,6]),n.debug("loading noise cancellation sdk: ",u),[4,_(u)];case 2:return g=R.sent(),n.debug("Loaded noise cancellation sdk:",g),h=g.default,i({supportedVersion:s,plugin:h,log:n}),h.isInitialized()?[3,4]:(n.debug("initializing noise cancellation sdk: ",v),[4,h.init({rootDir:v})]);case 3:R.sent(),n.debug("noise cancellation sdk initialized!"),R.label=4;case 4:return a={vendor:t.vendor,isInitialized:function(){return h.isInitialized()},isConnected:function(){return h.isConnected()},isEnabled:function(){return h.isEnabled()},disconnect:function(){return h.disconnect()},enable:function(){return h.enable()},disable:function(){return h.disable()},destroy:function(){return h.destroy()},setLogging:function(T){return h.setLogging(T)},connect:function(T){n.debug("connect: ",T.id),h.isConnected()&&h.disconnect();var b=h.connect(new MediaStream([T]));if(!b)throw new Error("Error connecting with noise cancellation sdk");var y=b.getAudioTracks()[0];if(!y)throw new Error("Error getting clean track from noise cancellation sdk");return h.enable(),y}},e.set(t.vendor,a),[3,6];case 5:throw S=R.sent(),n.error("Error loading noise cancellation sdk:"+u,S),S;case 6:return[2,a]}})})}return Je.createNoiseCancellationAudioProcessor=r,Je}var Hi;function cu(){if(Hi)return Qe;Hi=1;var k=Qe&&Qe.__awaiter||function(e,r,t,n){function a(c){return c instanceof t?c:new t(function(s){s(c)})}return new(t||(t=Promise))(function(c,s){function d(g){try{u(n.next(g))}catch(h){s(h)}}function v(g){try{u(n.throw(g))}catch(h){s(h)}}function u(g){g.done?c(g.value):a(g.value).then(d,v)}u((n=n.apply(e,r||[])).next())})},p=Qe&&Qe.__generator||function(e,r){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,a,c,s;return s={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function d(u){return function(g){return v([u,g])}}function v(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(c=u[0]&2?a.return:u[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,u[1])).done)return c;switch(a=0,c&&(u=[u[0]&2,c.value]),u[0]){case 0:case 1:c=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!c||u[1]>c[0]&&u[1]<c[3])){t.label=u[1];break}if(u[0]===6&&t.label<c[1]){t.label=c[1],c=u;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(u);break}c[2]&&t.ops.pop(),t.trys.pop();continue}u=r.call(e,t)}catch(g){u=[6,g],a=0}finally{n=c=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.applyNoiseCancellation=Qe.NoiseCancellationImpl=void 0;var _=ou();ze();var o=function(){function e(r,t){this._processor=r,this._sourceTrack=t,this._disabledPermanent=!1}return Object.defineProperty(e.prototype,"vendor",{get:function(){return this._processor.vendor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sourceTrack",{get:function(){return this._sourceTrack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._processor.isEnabled()},enumerable:!1,configurable:!0}),e.prototype.enable=function(){if(this._disabledPermanent)throw new Error(this.vendor+" noise cancellation is disabled permanently for this track");return this._processor.enable(),Promise.resolve()},e.prototype.disable=function(){return this._processor.disable(),Promise.resolve()},e.prototype.reacquireTrack=function(r){return k(this,void 0,void 0,function(){var t,n,a;return p(this,function(c){switch(c.label){case 0:return t=this._processor.isEnabled(),this._processor.disconnect(),[4,r()];case 1:return n=c.sent(),this._sourceTrack=n,[4,this._processor.connect(n)];case 2:return a=c.sent(),t?this._processor.enable():this._processor.disable(),[2,a]}})})},e.prototype.disablePermanently=function(){return this._disabledPermanent=!0,this.disable()},e.prototype.stop=function(){this._processor.disconnect(),this._sourceTrack.stop()},e}();Qe.NoiseCancellationImpl=o;function i(e,r,t){return k(this,void 0,void 0,function(){var n,a,c,s;return p(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,_.createNoiseCancellationAudioProcessor(r,t)];case 1:return n=d.sent(),a=n.connect(e),c=new o(n,e),[2,{cleanTrack:a,noiseCancellation:c}];case 2:return s=d.sent(),t.warn("Failed to create noise cancellation. Returning normal audio track: "+s),[2,{cleanTrack:e}];case 3:return[2]}})})}return Qe.applyNoiseCancellation=i,Qe}var ye={},De={},Gi;function qe(){if(Gi)return De;Gi=1;var k=De&&De.__read||function(y,l){var f=typeof Symbol=="function"&&y[Symbol.iterator];if(!f)return y;var m=f.call(y),C,P=[],M;try{for(;(l===void 0||l-- >0)&&!(C=m.next()).done;)P.push(C.value)}catch(I){M={error:I}}finally{try{C&&!C.done&&(f=m.return)&&f.call(m)}finally{if(M)throw M.error}}return P},p=De&&De.__spreadArray||function(y,l){for(var f=0,m=l.length,C=y.length;f<m;f++,C++)y[C]=l[f];return y};function _(){var y={};return y.promise=new Promise(function(l,f){y.resolve=l,y.reject=f}),y}function o(y,l,f,m){if(!(m in l)&&!m.match(/^on[a-z]+$/)){var C=!1;try{var P=Object.getOwnPropertyDescriptor(y,m);C=P&&!!P.get}catch{}if(!C){var M;try{M=typeof y[m]}catch{}M==="function"&&(l[m]=function(){return this[f][m].apply(this[f],arguments)})}}}function i(y,l,f){for(var m in y)o(y,l,f,m)}function e(y,l){y=Array.isArray(y)?new Set(y):new Set(y.values()),l=Array.isArray(l)?new Set(l):new Set(l.values());var f=new Set;return y.forEach(function(m){l.has(m)||f.add(m)}),f}function r(y,l){var f=y instanceof Map||y instanceof Set?Array.from(y.values()):y;return f.reduce(function(m,C){return m.concat(l(C))},[])}function t(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:null}function n(y){return typeof y>"u"&&(y=t()),/Chrome|CriOS/.test(y)?"chrome":/Firefox|FxiOS/.test(y)?"firefox":/Safari|iPhone|iPad|iPod/.test(y)?"safari":null}function a(y){typeof y>"u"&&(y=t());var l={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[n(y)];if(!l)return null;var f=new RegExp("("+l+")/([^\\s]+)"),m=k(y.match(f)||[],3),C=m[2];if(!C)return null;var P=C.split(".").map(Number);return{major:isNaN(P[0])?null:P[0],minor:isNaN(P[1])?null:P[1]}}function c(y){return typeof y>"u"&&(y=t()),/Mobi/.test(y)&&n()==="chrome"&&/iPad|iPhone|iPod/.test(y)}function s(y,l){var f=null;Object.defineProperty(y,"on"+l,{get:function(){return f},set:function(m){f&&this.removeEventListener(l,f),typeof m=="function"?(f=m,this.addEventListener(l,f)):f=null}})}function d(y,l,f){return l?y.then(l,f):y}function v(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(y){var l=Math.random()*16|0,f=y==="x"?l:l&3|8;return f.toString(16)})}function u(y,l,f){Object.getOwnPropertyNames(y).forEach(function(m){g(y,l,f,m)})}function g(y,l,f,m){if(!(m in l)){if(m.match(/^on[a-z]+$/)){Object.defineProperty(l,m,{value:null,writable:!0}),f.addEventListener(m.slice(2),function(){for(var C=[],P=0;P<arguments.length;P++)C[P]=arguments[P];return l.dispatchEvent.apply(l,p([],k(C)))});return}Object.defineProperty(l,m,{enumerable:!0,get:function(){return f[m]}})}}function h(){return typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.getUserMedia=="function"&&typeof RTCPeerConnection=="function"}function S(y){if(typeof RTCRtpSender<"u"&&typeof RTCRtpSender.getCapabilities=="function")return Promise.resolve(new Set(RTCRtpSender.getCapabilities(y).codecs.map(function(f){var m=f.mimeType;return m.split("/")[1].toLowerCase()})));if(typeof RTCPeerConnection>"u"||typeof RTCPeerConnection.prototype>"u"||typeof RTCPeerConnection.prototype.addTransceiver!="function"||typeof RTCPeerConnection.prototype.close!="function"||typeof RTCPeerConnection.prototype.createOffer!="function")return Promise.resolve(new Set);var l=new RTCPeerConnection;return l.addTransceiver(y),l.createOffer().then(function(f){var m=f.sdp;return l.close(),new Set((m.match(/^a=rtpmap:.+$/gm)||[]).map(function(C){return C.match(/^a=rtpmap:.+ ([^/]+)/)[1].toLowerCase()}))},function(){return l.close(),new Set})}var R=new Map;function T(y,l){var f=R.get(l);return f?Promise.resolve(f.has(y.toLowerCase())):S(l).then(function(m){return R.set(l,m),m.has(y.toLowerCase())})}function b(){R.clear()}return De.clearCachedSupportedCodecs=b,De.defer=_,De.delegateMethods=i,De.difference=e,De.flatMap=r,De.guessBrowser=n,De.guessBrowserVersion=a,De.isCodecSupported=T,De.isIOSChrome=c,De.interceptEvent=s,De.legacyPromise=d,De.makeUUID=v,De.proxyProperties=u,De.support=h,De}var hn={},Qi;function rs(){if(Qi)return hn;Qi=1;var k="1234567890abcdef",p=32;function _(o){for(var i="",e=0;e<p;e++)i+=k.charAt(Math.floor(Math.random()*k.length));return""+o+i}return hn.sessionSID=_("SS"),hn.createSID=_,hn}var On,$i;function ns(){if($i)return On;$i=1;var k={recordingMediaLost:"recording-media-lost"};return On=k,On}var Ki;function Pe(){if(Ki)return ye;Ki=1;var k=ye&&ye.__extends||function(){var W=function(z,D){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,U){L.__proto__=U}||function(L,U){for(var ie in U)Object.prototype.hasOwnProperty.call(U,ie)&&(L[ie]=U[ie])},W(z,D)};return function(z,D){if(typeof D!="function"&&D!==null)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");W(z,D);function L(){this.constructor=z}z.prototype=D===null?Object.create(D):(L.prototype=D.prototype,new L)}}(),p=ye&&ye.__read||function(W,z){var D=typeof Symbol=="function"&&W[Symbol.iterator];if(!D)return W;var L=D.call(W),U,ie=[],fe;try{for(;(z===void 0||z-- >0)&&!(U=L.next()).done;)ie.push(U.value)}catch(me){fe={error:me}}finally{try{U&&!U.done&&(D=L.return)&&D.call(L)}finally{if(fe)throw fe.error}}return ie},_=ye&&ye.__spreadArray||function(W,z){for(var D=0,L=z.length,U=W.length;D<L;D++,U++)W[U]=z[D];return W},o=Ce(),i=o.typeErrors,e=o.trackPriority,r=qe(),t=rs().sessionSID,n=ns();function a(W,z){if(W instanceof z.LocalAudioTrack||W instanceof z.LocalVideoTrack||W instanceof z.LocalDataTrack)return W;if(W instanceof z.MediaStreamTrack)return W.kind==="audio"?new z.LocalAudioTrack(W,z):new z.LocalVideoTrack(W,z);throw i.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}function c(W,z,D,L){var U={audio:L.LocalAudioTrackPublication,video:L.LocalVideoTrackPublication,data:L.LocalDataTrackPublication}[W.kind];return new U(z,W,D,L)}function s(W){return W[0].toUpperCase()+W.slice(1)}function d(W,z,D,L){var U=new Set;z.on("newListener",function ie(fe){D.has(fe)&&!U.has(fe)&&(L.deprecated(W+"#"+fe+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(D.get(fe)?" Use "+W+"#"+D.get(fe)+" instead.":"")),U.add(fe)),U.size>=D.size&&z.removeListener("newListener",ie)})}function v(W,z){W=Array.isArray(W)?new Set(W):new Set(W.values()),z=Array.isArray(z)?new Set(z):new Set(z.values());var D=new Set;return W.forEach(function(L){z.has(L)||D.add(L)}),D}function u(W,z){return Object.keys(W).reduce(function(D,L){return W[L]!==z&&(D[L]=W[L]),D},{})}function g(W,z){var D=W instanceof Map||W instanceof Set?Array.from(W.values()):W;return z=z||function(U){return U},D.reduce(function(L,U){var ie=z(U);return L.concat(ie)},[])}function h(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent:"Unknown"}function S(){var W=h(),z=p(W.match(/\(([^)]+)\)/)||[],2),D=z[1],L=D===void 0?"unknown":D,U=p(L.split(";").map(function(fe){return fe.trim()}),1),ie=U[0];return ie.toLowerCase()}function R(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(W){var z=Math.random()*16|0,D=W==="x"?z:z&3|8;return D.toString(16)})}function T(W){var z=null;function D(){z=null,W()}return function(){z&&clearTimeout(z),z=setTimeout(D)}}function b(W,z,D,L){return new Promise(function(U,ie){function fe(){var we=[].slice.call(arguments);L&&z.removeListener(L,me),U.apply(void 0,_([],p(we)))}function me(){var we=[].slice.call(arguments);z.removeListener(D,fe),ie.apply(void 0,_([],p(we)))}z.once(D,fe),L&&z.once(L,me),W()})}function y(W,z){return z.split(".").reduce(function(D,L){return D?D[L]:null},W)}function l(){var W={};return W.promise=new Promise(function(z,D){W.resolve=z,W.reject=D}),W}function f(W,z,D,L){if(!(L in z)&&!L.match(/^on[a-z]+$/)){var U;try{U=typeof W[L]}catch{}U==="function"&&(z[L]=function(){for(var ie,fe=[],me=0;me<arguments.length;me++)fe[me]=arguments[me];return(ie=this[D])[L].apply(ie,_([],p(fe)))})}}function m(W,z,D){for(var L in W)f(W,z,D,L)}function C(W,z){if(W===z)return!0;if(typeof W!=typeof z)return!1;if(W===null)return z===null;if(z===null)return!1;if(Array.isArray(W))return Array.isArray(z)&&W.length===z.length&&W.every(function(U,ie){return C(U,z[ie])});if(typeof W=="object"){var D=Object.keys(W).sort(),L=Object.keys(z).sort();return!Array.isArray(z)&&C(D,L)&&D.every(function(U){return C(W[U],z[U])})}return!1}function P(W){return typeof W=="object"&&!Array.isArray(W)}function M(W,z,D){Object.getOwnPropertyNames(W).forEach(function(L){I(W,z,D,L)})}function I(W,z,D,L){if(!(L in z)){if(L.match(/^on[a-z]+$/)){Object.defineProperty(z,L,{value:null,writable:!0}),D.addEventListener(L.slice(2),function(){for(var U=[],ie=0;ie<arguments.length;ie++)U[ie]=arguments[ie];z.dispatchEvent.apply(z,_([],p(U)))});return}Object.defineProperty(z,L,{enumerable:!0,get:function(){return D[L]}})}}function O(W,z,D){return z?W.then(function(L){z(L)},function(L){D(L)}):W}function x(W){return typeof W=="string"?{default:W,media:W,signaling:W,webrtc:W}:W}function E(W,z){return z=z?"Local":"",z+(W.kind||"").replace(/\w{1}/,function(D){return D.toUpperCase()})+"Track"}function q(W,z){return z=z?"Local":"",z+(W.kind||"").replace(/\w{1}/,function(D){return D.toUpperCase()})+"TrackPublication"}function B(W){Object.getOwnPropertyNames(W).forEach(function(z){z.startsWith("_")&&F(W,z)})}function G(W,z){return function(D){k(L,D);function L(){for(var U=[],ie=0;ie<arguments.length;ie++)U[ie]=arguments[ie];var fe=D.apply(this,_([],p(U)))||this;return B(fe),N(fe,z),fe}return L}(W)}function F(W,z){var D=Object.getOwnPropertyDescriptor(W,z);D.enumerable=!1,Object.defineProperty(W,z,D)}function N(W,z){z===void 0&&(z=[]),z.forEach(function(D){W.hasOwnProperty(D)&&F(W,D)})}function A(W){return W.map(Y)}function w(W){return A(_([],p(W)))}function j(W){return _([],p(W.entries())).reduce(function(z,D){var L,U=p(D,2),ie=U[0],fe=U[1];return Object.assign((L={},L[ie]=Y(fe),L),z)},{})}function Q(W){return Object.entries(W).reduce(function(z,D){var L,U=p(D,2),ie=U[0],fe=U[1];return Object.assign((L={},L[ie]=Y(fe),L),z)},{})}function Y(W){return Array.isArray(W)?A(W):W instanceof Set?w(W):W instanceof Map?j(W):W&&typeof W=="object"?Q(W):W}function $(W){function z(ie){return ie?"true":"false"}var D={sessionSID:t,iceServers:(W.iceServers||[]).length,audioTracks:(W.tracks||[]).filter(function(ie){return ie.kind==="audio"}).length,videoTracks:(W.tracks||[]).filter(function(ie){return ie.kind==="video"}).length,dataTracks:(W.tracks||[]).filter(function(ie){return ie.kind==="data"}).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach(function(ie){var fe=p(ie,2),me=fe[0],we=fe[1];we=we||me,D[we]=z(!!W[me])}),[["maxVideoBitrate"],["maxAudioBitrate"]].forEach(function(ie){var fe=p(ie,2),me=fe[0],we=fe[1];we=we||me,typeof W[me]=="number"?D[we]=W[me]:isNaN(Number(W[me]))||(D[we]=Number(W[me]))}),[["iceTransportPolicy"],["region"],["name","roomName"]].forEach(function(ie){var fe=p(ie,2),me=fe[0],we=fe[1];we=we||me,typeof W[me]=="string"?D[we]=W[me]:typeof W[me]=="number"&&me==="name"&&(D[we]=W[me].toString())}),["preferredAudioCodecs","preferredVideoCodecs"].forEach(function(ie){ie in W&&(D[ie]=JSON.stringify(W[ie]))}),"networkQuality"in W&&(D.networkQualityConfiguration={},P(W.networkQuality)?["local","remote"].forEach(function(ie){typeof W.networkQuality[ie]=="number"&&(D.networkQualityConfiguration[ie]=W.networkQuality[ie])}):(D.networkQualityConfiguration.remote=0,D.networkQualityConfiguration.local=W.networkQuality?1:0)),W.bandwidthProfile&&W.bandwidthProfile.video){var L=W.bandwidthProfile.video||{};D.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach(function(ie){typeof L[ie]=="number"||typeof L[ie]=="string"?D.bandwidthProfileOptions[ie]=L[ie]:typeof L[ie]=="boolean"?D.bandwidthProfileOptions[ie]=z(L[ie]):typeof L[ie]=="object"&&(D.bandwidthProfileOptions[ie]=JSON.stringify(L[ie]))})}var U={RTCPeerConnection:"customRTCPeerConnectionImpl",MediaStream:"customMediaStreamImpl",getUserMedia:"customGetUserMediaImpl",enumerateDevices:"customEnumerateDevicesImpl"};return Object.entries(U).forEach(function(ie){var fe=p(ie,2),me=fe[0],we=fe[1];D[we]=z(typeof W[me]<"u")}),{group:"room",name:"connect",level:"info",payload:D}}function K(W){return ce(W,[{prop:"video",type:"object",transform:J}])}function J(W){return ce(W,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:oe},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function te(W,z,D,L,U,ie){var fe={transports:[{type:"data-channel"}]};return Object.assign(W?{active_speaker:fe}:{},z?{network_quality:fe}:{},ie?{render_hints:fe}:{},U?{publisher_hints:fe}:{},D?{track_priority:fe}:{},L?{track_switch_off:fe}:{})}function se(W){return ce(W,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function oe(W){var z=e.PRIORITY_HIGH,D=e.PRIORITY_LOW,L=e.PRIORITY_STANDARD;return ce(W,[{prop:z,type:"object",transform:se},{prop:D,type:"object",transform:se},{prop:L,type:"object",transform:se}])}function ce(W,z){return z.reduce(function(D,L){var U,ie=L.prop,fe=L.type,me=L.payloadProp,we=me===void 0?ie:me,Re=L.transform,_e=Re===void 0?function(je){return je}:Re;return typeof W[ie]===fe?Object.assign((U={},U[we]=_e(W[ie]),U),D):D},{})}function de(W){return{rules:[{type:W?"include":"exclude",all:!0}],revision:1}}function ve(W){var z,D=(z={},z[n.recordingMediaLost]="recordings",z);return W.map(function(L){return D[L]}).filter(function(L){return!!L})}function ue(W,z){var D=Math.random();return W-z+Math.floor(2*z*D+.5)}function ee(W,z,D){return z<=W&&W<=D}function he(W){return r.guessBrowser()==="chrome"&&W.kind==="video"&&"displaySurface"in W.getSettings()}function le(W){return W===void 0&&(W=10),new Promise(function(z){return setTimeout(z,W)})}function ge(W,z){return new Promise(function(D){W.addEventListener(z,function L(U){W.removeEventListener(z,L),D(U)})})}return ye.constants=o,ye.createBandwidthProfilePayload=K,ye.createMediaSignalingPayload=te,ye.createMediaWarningsPayload=ve,ye.createRoomConnectEventPayload=$,ye.createSubscribePayload=de,ye.asLocalTrack=a,ye.asLocalTrackPublication=c,ye.capitalize=s,ye.deprecateEvents=d,ye.difference=v,ye.filterObject=u,ye.flatMap=g,ye.getPlatform=S,ye.getUserAgent=h,ye.hidePrivateProperties=B,ye.hidePrivateAndCertainPublicPropertiesInClass=G,ye.isDeepEqual=C,ye.isNonArrayObject=P,ye.inRange=ee,ye.makeUUID=R,ye.oncePerTick=T,ye.promiseFromEvents=b,ye.getOrNull=y,ye.defer=l,ye.delegateMethods=m,ye.proxyProperties=M,ye.legacyPromise=O,ye.buildLogLevels=x,ye.trackClass=E,ye.trackPublicationClass=q,ye.valueToJSON=Y,ye.withJitter=ue,ye.isChromeScreenShareTrack=he,ye.waitForSometime=le,ye.waitForEvent=ge,ye}var $e={},zi;function un(){if(zi)return $e;zi=1;var k=qe(),p=k.flatMap,_=k.guessBrowser,o=null;function i(){if(typeof o=="boolean")return o;if(typeof RTCPeerConnection>"u")return o=!1,o;try{new RTCPeerConnection({sdpSemantics:"foo"}),o=!1}catch{o=!0}return o}var e=null;function r(){e=null}function t(){if(!e)if(typeof RTCPeerConnection<"u"&&"addTransceiver"in RTCPeerConnection.prototype){var C=new RTCPeerConnection;try{C.addTransceiver("audio"),e="unified"}catch{e="planb"}C.close()}else e="planb";return e}function n(C){return!C||!i()?t():{"plan-b":"planb","unified-plan":"unified"}[C]}function a(){return typeof RTCRtpTransceiver<"u"&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}function c(C){return{chrome:n(C),firefox:"unified",safari:a()}[_()]||null}function s(C,P){var M=P.match(new RegExp(C,"gm"))||[];return M.reduce(function(I,O){var x=O.match(new RegExp(C));return x?I.add(x[1]):I},new Set)}function d(C,P){return s(C,P)}function v(C){return d("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",C)}function u(C){return d("^a=msid:.+ +(.+) *$",C)}function g(C,P){var M="^a=ssrc:([0-9]+) +msid:[^ ]+ +"+P+" *$";return s(M,C)}function h(C,P,M){return P===void 0&&(P=".*"),M===void 0&&(M=".*"),C.split(`\r
m=`).slice(1).map(function(I){return"m="+I}).filter(function(I){var O=new RegExp("m="+P,"gm"),x=new RegExp("a="+M,"gm");return O.test(I)&&x.test(I)})}function S(C){return Array.from(s("^a=ssrc:([0-9]+) +.*$",C))}function R(C,P){var M=h(C),I=new RegExp("^a=msid:[^ ]+ +"+P+" *$","gm"),O=M.filter(function(x){return x.match(I)});return new Set(p(O,S))}function T(C,P,M){return new Map(Array.from(C(M)).map(function(I){return[I,P(M,I)]}))}function b(C){return T(v,g,C)}function y(C){return T(u,R,C)}function l(C,P,M){var I=C(M),O=new Map;I.forEach(function(q,B){if(!P.has(B)){P.set(B,q);return}var G=Array.from(P.get(B)),F=Array.from(q);G.forEach(function(N,A){var w=F[A];O.set(w,N);var j="^a=ssrc:"+w+" (.*)$",Q="a=ssrc:"+N+" $1";M=M.replace(new RegExp(j,"gm"),Q)})});var x="^(a=ssrc-group:[^ ]+ +)(.*)$",E=M.match(new RegExp(x,"gm"))||[];return E.forEach(function(q){var B=q.match(new RegExp(x));if(B){var G=B[1],F=B[2],N=F.split(" ").map(function(A){var w=O.get(A);return w||A}).join(" ");M=M.replace(B[0],G+N)}}),M}function f(C,P){return l(b,C,P)}function m(C,P){return l(y,C,P)}return $e.clearChromeCachedSdpFormat=r,$e.getSdpFormat=c,$e.getMediaSections=h,$e.getPlanBTrackIds=v,$e.getUnifiedPlanTrackIds=u,$e.getPlanBSSRCs=g,$e.getUnifiedPlanSSRCs=R,$e.updatePlanBTrackIdsToSSRCs=f,$e.updateUnifiedPlanTrackIdsToSSRCs=m,$e}var mt,Yi;function su(){if(Yi)return mt;Yi=1;var k=mt&&mt.__values||function(O){var x=typeof Symbol=="function"&&Symbol.iterator,E=x&&O[x],q=0;if(E)return E.call(O);if(O&&typeof O.length=="number")return{next:function(){return O&&q>=O.length&&(O=void 0),{value:O&&O[q++],done:!O}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},p=mt&&mt.__read||function(O,x){var E=typeof Symbol=="function"&&O[Symbol.iterator];if(!E)return O;var q=E.call(O),B,G=[],F;try{for(;(x===void 0||x-- >0)&&!(B=q.next()).done;)G.push(B.value)}catch(N){F={error:N}}finally{try{B&&!B.done&&(E=q.return)&&E.call(q)}finally{if(F)throw F.error}}return G},_=qe(),o=_.flatMap,i=_.guessBrowser,e=_.guessBrowserVersion,r=un().getSdpFormat,t=i(),n=e(),a=t==="chrome",c=t==="firefox",s=t==="safari",d=a?n.major:null,v=32767;function u(O,x){return typeof O.get=="function"?O.get(x):O.find(function(E){return E.id===x})}function g(O,x,E){var q,B,G,F,N,A,w,j,Q,Y,$,K,J,te,se,oe,ce,de,ve,ue,ee,he;E===void 0&&(E=!1);var le;if(Array.isArray(O))le=new Map(O.map(function(xe){return[xe.id||String(Math.random()),xe]}));else if(O instanceof Map)le=O;else if(typeof O=="object"&&O!==null){var ge=new Map;Object.keys(O).forEach(function(xe){ge.set(xe,O[xe])}),le=ge}else return new Map;if(!le||!x)return new Map;var W=new Map,z=x.id,D=x.kind,L=null,U=null,ie=null;try{for(var fe=k(le),me=fe.next();!me.done;me=fe.next()){var we=p(me.value,2),Re=we[0],_e=we[1];if(E&&_e.type==="inbound-rtp"&&_e.trackIdentifier===z){L=_e,U=Re,ie=_e.ssrc;break}else if(!E&&_e.type==="media-source"&&_e.trackIdentifier===z){L=_e,U=Re;break}else _e.type==="track"&&_e.trackIdentifier===z&&(L||(L=_e,U=Re))}}catch(xe){q={error:xe}}finally{try{me&&!me.done&&(B=fe.return)&&B.call(fe)}finally{if(q)throw q.error}}if(!L)if(E){var je=[];try{for(var He=k(le),We=He.next();!We.done;We=He.next()){var ae=p(We.value,2),Re=ae[0],_e=ae[1];_e.type==="inbound-rtp"&&(_e.kind===D||_e.mediaType===D)&&je.push({id:Re,stat:_e})}}catch(xe){G={error:xe}}finally{try{We&&!We.done&&(F=He.return)&&F.call(He)}finally{if(G)throw G.error}}(je.length===1||je.length>1)&&(L=je[0].stat,U=je[0].id,ie=L.ssrc)}else try{for(var re=k(le),V=re.next();!V.done;V=re.next()){var H=p(V.value,2),Re=H[0],_e=H[1];if(_e.type==="media-source"&&_e.kind===D){L=_e,U=Re;break}}}catch(xe){N={error:xe}}finally{try{V&&!V.done&&(A=re.return)&&A.call(re)}finally{if(N)throw N.error}}if(!L)return W;W.set(U,L);var X=new Set;if(E){if(L.codecId&&X.add(L.codecId),L.transportId&&X.add(L.transportId),L.remoteId&&X.add(L.remoteId),ie)try{for(var Z=k(le),ne=Z.next();!ne.done;ne=Z.next()){var be=p(ne.value,2),Re=be[0],_e=be[1];_e.type==="remote-outbound-rtp"&&_e.ssrc===ie&&X.add(Re)}}catch(xe){w={error:xe}}finally{try{ne&&!ne.done&&(j=Z.return)&&j.call(Z)}finally{if(w)throw w.error}}try{for(var Se=k(X),Ie=Se.next();!Ie.done;Ie=Se.next()){var Me=Ie.value;le.has(Me)&&W.set(Me,le.get(Me))}}catch(xe){Q={error:xe}}finally{try{Ie&&!Ie.done&&(Y=Se.return)&&Y.call(Se)}finally{if(Q)throw Q.error}}try{for(var Ee=k(le),Oe=Ee.next();!Oe.done;Oe=Ee.next()){var ke=p(Oe.value,2),Re=ke[0],_e=ke[1];_e.type==="track"&&_e.trackIdentifier===z&&W.set(Re,_e)}}catch(xe){$={error:xe}}finally{try{Oe&&!Oe.done&&(K=Ee.return)&&K.call(Ee)}finally{if($)throw $.error}}}else{try{for(var Le=k(le),Ve=Le.next();!Ve.done;Ve=Le.next()){var xt=p(Ve.value,2),Re=xt[0],_e=xt[1];if(_e.type==="outbound-rtp"&&_e.mediaSourceId===U){W.set(Re,_e),_e.codecId&&X.add(_e.codecId),_e.transportId&&X.add(_e.transportId);var $s=Re;try{for(var dn=(se=void 0,k(le)),Nt=dn.next();!Nt.done;Nt=dn.next()){var Ni=p(Nt.value,2),Ks=Ni[0],Tn=Ni[1];Tn.type==="remote-inbound-rtp"&&Tn.localId===$s&&W.set(Ks,Tn)}}catch(zs){se={error:zs}}finally{try{Nt&&!Nt.done&&(oe=dn.return)&&oe.call(dn)}finally{if(se)throw se.error}}}}}catch(xe){J={error:xe}}finally{try{Ve&&!Ve.done&&(te=Le.return)&&te.call(Le)}finally{if(J)throw J.error}}try{for(var fn=k(X),qt=fn.next();!qt.done;qt=fn.next()){var Me=qt.value;le.has(Me)&&W.set(Me,le.get(Me))}}catch(xe){ce={error:xe}}finally{try{qt&&!qt.done&&(de=fn.return)&&de.call(fn)}finally{if(ce)throw ce.error}}}var Vt=null,qi=new Set;try{for(var vn=k(W.values()),Ft=vn.next();!Ft.done;Ft=vn.next()){var _e=Ft.value;_e.transportId&&qi.add(_e.transportId)}}catch(xe){ve={error:xe}}finally{try{Ft&&!Ft.done&&(ue=vn.return)&&ue.call(vn)}finally{if(ve)throw ve.error}}try{for(var pn=k(qi),Bt=pn.next();!Bt.done;Bt=pn.next()){var wn=Bt.value;if(le.has(wn)){var Ge=le.get(wn);W.set(wn,Ge),Ge.selectedCandidatePairId&&(Vt=Ge.selectedCandidatePairId),Ge.localCertificateId&&le.has(Ge.localCertificateId)&&W.set(Ge.localCertificateId,le.get(Ge.localCertificateId)),Ge.remoteCertificateId&&le.has(Ge.remoteCertificateId)&&W.set(Ge.remoteCertificateId,le.get(Ge.remoteCertificateId))}}}catch(xe){ee={error:xe}}finally{try{Bt&&!Bt.done&&(he=pn.return)&&he.call(pn)}finally{if(ee)throw ee.error}}if(Vt&&le.has(Vt)){var Ye=le.get(Vt);W.set(Vt,Ye),Ye.localCandidateId&&le.has(Ye.localCandidateId)&&W.set(Ye.localCandidateId,le.get(Ye.localCandidateId)),Ye.remoteCandidateId&&le.has(Ye.remoteCandidateId)&&W.set(Ye.remoteCandidateId,le.get(Ye.remoteCandidateId))}return W}function h(O,x){return O&&typeof O.getStats=="function"?S(O,x):Promise.reject(new Error("Given PeerConnection does not support getStats"))}function S(O,x){var E=y(O,"audio","local"),q=y(O,"video","local"),B=y(O,"audio"),G=y(O,"video"),F={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},N=o([[E,"localAudioTrackStats",!1],[q,"localVideoTrackStats",!1],[B,"remoteAudioTrackStats",!0],[G,"remoteVideoTrackStats",!0]],function(A){var w=p(A,3),j=w[0],Q=w[1],Y=w[2];return j.map(function($){return f(O,$,Object.assign({isRemote:Y},x)).then(function(K){K.forEach(function(J){J.trackId=$.id,F[Q].push(J)})})})});return Promise.all(N).then(function(){return R(O,x)}).then(function(A){return F.activeIceCandidatePair=A,F})}function R(O,x){return x===void 0&&(x={}),typeof x.testForChrome<"u"||a||typeof x.testForSafari<"u"||s?O.getStats().then(T):typeof x.testForFirefox<"u"||c?O.getStats().then(b):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}function T(O){var x=Array.from(O.values()).find(function(A){var w=A.nominated,j=A.type;return j==="candidate-pair"&&w});if(!x)return null;var E=u(O,x.localCandidateId),q=u(O,x.remoteCandidateId),B=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],G=B.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),F=E?G.reduce(function(A,w){var j=w.key,Q=w.type;return A[j]=typeof E[j]===Q?E[j]:j==="deleted"?!1:null,A},{}):null,N=q?B.reduce(function(A,w){var j=w.key,Q=w.type;return A[j]=typeof q[j]===Q?q[j]:null,A},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(A){return A==="inprogress"?"in-progress":A}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(A,w){var j=w.key,Q=w.type,Y=w.fixup;return A[j]=typeof x[j]===Q?Y?Y(x[j]):x[j]:null,A},{localCandidate:F,remoteCandidate:N})}function b(O){var x=Array.from(O.values()).find(function(w){var j=w.nominated,Q=w.type;return Q==="candidate-pair"&&j});if(!x)return null;var E=u(O,x.localCandidateId),q=u(O,x.remoteCandidateId),B=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],G=B.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),F={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},N=E?G.reduce(function(w,j){var Q=j.ffKeys,Y=j.key,$=j.type,K=Q&&Q.find(function(J){return J in E})||Y;return w[Y]=typeof E[K]===$?K==="candidateType"&&F[E[K]]||E[K]:K==="deleted"?!1:null,w},{}):null,A=q?B.reduce(function(w,j){var Q=j.ffKeys,Y=j.key,$=j.type,K=Q&&Q.find(function(J){return J in q})||Y;return w[Y]=typeof q[K]===$?K==="candidateType"&&F[q[K]]||q[K]:null,w},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(w,j){var Q=j.key,Y=j.type;return w[Q]=typeof x[Q]===Y?x[Q]:null,w},{localCandidate:N,remoteCandidate:A})}function y(O,x,E){var q=E==="local"?"getSenders":"getReceivers";if(O[q])return O[q]().map(function(F){var N=F.track;return N}).filter(function(F){return F&&F.kind===x});var B=E==="local"?"getLocalStreams":"getRemoteStreams",G=x==="audio"?"getAudioTracks":"getVideoTracks";return o(O[B](),function(F){return F[G]()})}function l(O,x){var E,q,B,G,F,N;if(!O||!x)return!1;if(O.getReceivers){var A=O.getReceivers();try{for(var w=k(A),j=w.next();!j.done;j=w.next()){var Q=j.value;if(Q.track&&Q.track.id===x.id)return!0}}catch(de){E={error:de}}finally{try{j&&!j.done&&(q=w.return)&&q.call(w)}finally{if(E)throw E.error}}}if(O.getRemoteStreams){var Y=O.getRemoteStreams();try{for(var $=k(Y),K=$.next();!K.done;K=$.next()){var J=K.value,te=J.getTracks();try{for(var se=(F=void 0,k(te)),oe=se.next();!oe.done;oe=se.next()){var ce=oe.value;if(ce.id===x.id)return!0}}catch(de){F={error:de}}finally{try{oe&&!oe.done&&(N=se.return)&&N.call(se)}finally{if(F)throw F.error}}}}catch(de){B={error:de}}finally{try{K&&!K.done&&(G=$.return)&&G.call($)}finally{if(B)throw B.error}}}return!1}function f(O,x,E){return E===void 0&&(E={}),typeof E.testForChrome<"u"||a?m(O,x,E):typeof E.testForFirefox<"u"||c?C(O,x,E):typeof E.testForSafari<"u"||s?typeof E.testForSafari<"u"||r()==="unified"?m(O,x,E):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" "))):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}function m(O,x,E){var q=E.log;return d&&d<67?new Promise(function(B,G){O.getStats(function(F){B([P(F,x)])},null,G)}):O.getStats(x).then(function(B){return q.info("getStats by track successful"),M(B,E)}).catch(function(){return q.warn("getStats by track failed. Getting default stats"),O.getStats().then(function(B){q.info("getStats by default successful");var G=l(O,x);q.info("Starting filtering stats for "+(G?"remote":"local")+" track");var F=g(B,x,G);return q.info("Completed filtering stats for "+(G?"remote":"local")+" track"),M(F,E)})})}function C(O,x,E){return O.getStats(x).then(function(q){return[I(q,E)]})}function P(O,x){var E=O.result().find(function(B){return B.type==="ssrc"&&B.stat("googTrackId")===x.id}),q={};return E&&(q.timestamp=Math.round(Number(E.timestamp)),q=E.names().reduce(function(B,G){switch(G){case"googCodecName":B.codecName=E.stat(G);break;case"googRtt":B.roundTripTime=Number(E.stat(G));break;case"googJitterReceived":B.jitter=Number(E.stat(G));break;case"googFrameWidthInput":B.frameWidthInput=Number(E.stat(G));break;case"googFrameHeightInput":B.frameHeightInput=Number(E.stat(G));break;case"googFrameWidthSent":B.frameWidthSent=Number(E.stat(G));break;case"googFrameHeightSent":B.frameHeightSent=Number(E.stat(G));break;case"googFrameWidthReceived":B.frameWidthReceived=Number(E.stat(G));break;case"googFrameHeightReceived":B.frameHeightReceived=Number(E.stat(G));break;case"googFrameRateInput":B.frameRateInput=Number(E.stat(G));break;case"googFrameRateSent":B.frameRateSent=Number(E.stat(G));break;case"googFrameRateReceived":B.frameRateReceived=Number(E.stat(G));break;case"ssrc":B[G]=E.stat(G);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":B[G]=Number(E.stat(G));break}return B},q)),q}function M(O,x){var E=x.simulateExceptionWhileStandardizingStats,q=E===void 0?!1:E;if(q)throw new Error("Error while gathering stats");var B=null,G=[],F=null,N=null,A=null,w=null,j=null;O.forEach(function(J){var te=J.type;switch(te){case"inbound-rtp":B=J;break;case"outbound-rtp":G.push(J);break;case"media-source":j=J;break;case"track":A=J;break;case"codec":w=J;break;case"remote-inbound-rtp":F=J;break;case"remote-outbound-rtp":N=J;break}});var Q=A?A.remoteSource:!j,Y=Q?[B]:G,$=[],K=Q?N:F;return Y.forEach(function(J){var te={},se=[J,j,A,w,K&&K.ssrc===J.ssrc?K:null];function oe(ae){var re=se.find(function(V){return V&&typeof V[ae]<"u"})||null;return re?re[ae]:null}var ce=oe("ssrc");typeof ce=="number"&&(te.ssrc=String(ce));var de=oe("timestamp");te.timestamp=Math.round(de);var ve=oe("mimeType");typeof ve=="string"&&(ve=ve.split("/"),te.codecName=ve[ve.length-1]);var ue=oe("roundTripTime");typeof ue=="number"&&(te.roundTripTime=Math.round(ue*1e3));var ee=oe("jitter");typeof ee=="number"&&(te.jitter=Math.round(ee*1e3));var he=oe("frameWidth");typeof he=="number"&&(Q?te.frameWidthReceived=he:(te.frameWidthSent=he,te.frameWidthInput=A?A.frameWidth:j.width));var le=oe("frameHeight");typeof le=="number"&&(Q?te.frameHeightReceived=le:(te.frameHeightSent=le,te.frameHeightInput=A?A.frameHeight:j.height));var ge=oe("framesPerSecond");typeof ge=="number"&&(te[Q?"frameRateReceived":"frameRateSent"]=ge);var W=oe("bytesReceived");typeof W=="number"&&(te.bytesReceived=W);var z=oe("bytesSent");typeof z=="number"&&(te.bytesSent=z);var D=oe("packetsLost");typeof D=="number"&&(te.packetsLost=D);var L=oe("packetsReceived");typeof L=="number"&&(te.packetsReceived=L);var U=oe("packetsSent");typeof U=="number"&&(te.packetsSent=U);var ie=oe("audioLevel");typeof ie=="number"&&(ie=Math.round(ie*v),Q?te.audioOutputLevel=ie:te.audioInputLevel=ie);var fe=oe("totalPacketSendDelay");typeof fe=="number"&&(te.totalPacketSendDelay=fe);var me=oe("totalEncodeTime");typeof me=="number"&&(te.totalEncodeTime=me);var we=oe("framesEncoded");typeof we=="number"&&(te.framesEncoded=we);var Re=oe("estimatedPlayoutTimestamp");typeof Re=="number"&&(te.estimatedPlayoutTimestamp=Re);var _e=oe("totalDecodeTime");typeof _e=="number"&&(te.totalDecodeTime=_e);var je=oe("framesDecoded");typeof je=="number"&&(te.framesDecoded=je);var He=oe("jitterBufferDelay");typeof He=="number"&&(te.jitterBufferDelay=He);var We=oe("jitterBufferEmittedCount");typeof We=="number"&&(te.jitterBufferEmittedCount=We),$.push(te)}),$}function I(O,x){O===void 0&&(O=new Map);var E=x.isRemote,q=x.simulateExceptionWhileStandardizingStats,B=q===void 0?!1:q;if(B)throw new Error("Error while gathering stats");var G=null,F=null;O.forEach(function(L){var U=L.isRemote,ie=L.remoteId,fe=L.type;if(!U)switch(fe){case"inbound-rtp":G=L,F=u(O,ie);break;case"outbound-rtp":F=L,G=u(O,ie);break}});var N=E?G:F,A=E?F:G;function w(L){return N&&typeof N[L]<"u"?N[L]:A&&typeof A[L]<"u"?A[L]:null}var j={},Q=w("timestamp");j.timestamp=Math.round(Q);var Y=w("ssrc");typeof Y=="number"&&(j.ssrc=String(Y));var $=w("bytesSent");typeof $=="number"&&(j.bytesSent=$);var K=w("packetsLost");typeof K=="number"&&(j.packetsLost=K);var J=w("packetsSent");typeof J=="number"&&(j.packetsSent=J);var te=w("roundTripTime");typeof te=="number"&&(j.roundTripTime=Math.round(te*1e3));var se=w("jitter");typeof se=="number"&&(j.jitter=Math.round(se*1e3));var oe=w("framerateMean");typeof oe=="number"&&(j.frameRateSent=Math.round(oe));var ce=w("bytesReceived");typeof ce=="number"&&(j.bytesReceived=ce);var de=w("packetsReceived");typeof de=="number"&&(j.packetsReceived=de);var ve=w("framerateMean");typeof ve=="number"&&(j.frameRateReceived=Math.round(ve));var ue=w("totalPacketSendDelay");typeof ue=="number"&&(j.totalPacketSendDelay=ue);var ee=w("totalEncodeTime");typeof ee=="number"&&(j.totalEncodeTime=ee);var he=w("framesEncoded");typeof he=="number"&&(j.framesEncoded=he);var le=w("estimatedPlayoutTimestamp");typeof le=="number"&&(j.estimatedPlayoutTimestamp=le);var ge=w("totalDecodeTime");typeof ge=="number"&&(j.totalDecodeTime=ge);var W=w("framesDecoded");typeof W=="number"&&(j.framesDecoded=W);var z=w("jitterBufferDelay");typeof z=="number"&&(j.jitterBufferDelay=z);var D=w("jitterBufferEmittedCount");return typeof D=="number"&&(j.jitterBufferEmittedCount=D),j}return mt=h,mt}var Rn,Ji;function uu(){if(Ji)return Rn;Ji=1;function k(p){return p===void 0&&(p={audio:!0,video:!0}),typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.getUserMedia=="function"?navigator.mediaDevices.getUserMedia(p):Promise.reject(new Error("getUserMedia is not supported"))}return Rn=k,Rn}var _n={exports:{}},Xi;function is(){return Xi||(Xi=1,typeof MediaStream=="function"?_n.exports=MediaStream:_n.exports=function(){throw new Error("MediaStream is not supported")}),_n.exports}var mn={exports:{}},Zi;function lu(){return Zi||(Zi=1,typeof MediaStreamTrack=="function"?mn.exports=MediaStreamTrack:mn.exports=function(){throw new Error("MediaStreamTrack is not supported")}),mn.exports}var yn={exports:{}},ea;function du(){return ea||(ea=1,typeof RTCIceCandidate=="function"?yn.exports=RTCIceCandidate:yn.exports=function(){throw new Error("RTCIceCandidate is not supported")}),yn.exports}var yt={exports:{}},Ln,ta;function as(){if(ta)return Ln;ta=1;var k=function(){function p(_){this.descriptionInitDict=_;var o=_&&_.type==="rollback"?null:new RTCSessionDescription(_);Object.defineProperties(this,{_description:{get:function(){return o}}})}return Object.defineProperty(p.prototype,"sdp",{get:function(){return this._description?this._description.sdp:this.descriptionInitDict.sdp},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"type",{get:function(){return this._description?this._description.type:this.descriptionInitDict.type},enumerable:!1,configurable:!0}),p}();return Ln=k,Ln}var gn={exports:{}},ra;function Ue(){if(ra)return gn.exports;ra=1;var k=typeof Reflect=="object"?Reflect:null,p=k&&typeof k.apply=="function"?k.apply:function(y,l,f){return Function.prototype.apply.call(y,l,f)},_;k&&typeof k.ownKeys=="function"?_=k.ownKeys:Object.getOwnPropertySymbols?_=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:_=function(y){return Object.getOwnPropertyNames(y)};function o(b){console&&console.warn&&console.warn(b)}var i=Number.isNaN||function(y){return y!==y};function e(){e.init.call(this)}gn.exports=e,gn.exports.once=S,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._eventsCount=0,e.prototype._maxListeners=void 0;var r=10;function t(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(e,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(b){if(typeof b!="number"||b<0||i(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");r=b}}),e.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},e.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||i(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function n(b){return b._maxListeners===void 0?e.defaultMaxListeners:b._maxListeners}e.prototype.getMaxListeners=function(){return n(this)},e.prototype.emit=function(y){for(var l=[],f=1;f<arguments.length;f++)l.push(arguments[f]);var m=y==="error",C=this._events;if(C!==void 0)m=m&&C.error===void 0;else if(!m)return!1;if(m){var P;if(l.length>0&&(P=l[0]),P instanceof Error)throw P;var M=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw M.context=P,M}var I=C[y];if(I===void 0)return!1;if(typeof I=="function")p(I,this,l);else for(var O=I.length,x=u(I,O),f=0;f<O;++f)p(x[f],this,l);return!0};function a(b,y,l,f){var m,C,P;if(t(l),C=b._events,C===void 0?(C=b._events=Object.create(null),b._eventsCount=0):(C.newListener!==void 0&&(b.emit("newListener",y,l.listener?l.listener:l),C=b._events),P=C[y]),P===void 0)P=C[y]=l,++b._eventsCount;else if(typeof P=="function"?P=C[y]=f?[l,P]:[P,l]:f?P.unshift(l):P.push(l),m=n(b),m>0&&P.length>m&&!P.warned){P.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=b,M.type=y,M.count=P.length,o(M)}return b}e.prototype.addListener=function(y,l){return a(this,y,l,!1)},e.prototype.on=e.prototype.addListener,e.prototype.prependListener=function(y,l){return a(this,y,l,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function s(b,y,l){var f={fired:!1,wrapFn:void 0,target:b,type:y,listener:l},m=c.bind(f);return m.listener=l,f.wrapFn=m,m}e.prototype.once=function(y,l){return t(l),this.on(y,s(this,y,l)),this},e.prototype.prependOnceListener=function(y,l){return t(l),this.prependListener(y,s(this,y,l)),this},e.prototype.removeListener=function(y,l){var f,m,C,P,M;if(t(l),m=this._events,m===void 0)return this;if(f=m[y],f===void 0)return this;if(f===l||f.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete m[y],m.removeListener&&this.emit("removeListener",y,f.listener||l));else if(typeof f!="function"){for(C=-1,P=f.length-1;P>=0;P--)if(f[P]===l||f[P].listener===l){M=f[P].listener,C=P;break}if(C<0)return this;C===0?f.shift():g(f,C),f.length===1&&(m[y]=f[0]),m.removeListener!==void 0&&this.emit("removeListener",y,M||l)}return this},e.prototype.off=e.prototype.removeListener,e.prototype.removeAllListeners=function(y){var l,f,m;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[y]),this;if(arguments.length===0){var C=Object.keys(f),P;for(m=0;m<C.length;++m)P=C[m],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=f[y],typeof l=="function")this.removeListener(y,l);else if(l!==void 0)for(m=l.length-1;m>=0;m--)this.removeListener(y,l[m]);return this};function d(b,y,l){var f=b._events;if(f===void 0)return[];var m=f[y];return m===void 0?[]:typeof m=="function"?l?[m.listener||m]:[m]:l?h(m):u(m,m.length)}e.prototype.listeners=function(y){return d(this,y,!0)},e.prototype.rawListeners=function(y){return d(this,y,!1)},e.listenerCount=function(b,y){return typeof b.listenerCount=="function"?b.listenerCount(y):v.call(b,y)},e.prototype.listenerCount=v;function v(b){var y=this._events;if(y!==void 0){var l=y[b];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}e.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]};function u(b,y){for(var l=new Array(y),f=0;f<y;++f)l[f]=b[f];return l}function g(b,y){for(;y+1<b.length;y++)b[y]=b[y+1];b.pop()}function h(b){for(var y=new Array(b.length),l=0;l<y.length;++l)y[l]=b[l].listener||b[l];return y}function S(b,y){return new Promise(function(l,f){function m(P){b.removeListener(y,C),f(P)}function C(){typeof b.removeListener=="function"&&b.removeListener("error",m),l([].slice.call(arguments))}T(b,y,C,{once:!0}),y!=="error"&&R(b,m,{once:!0})})}function R(b,y,l){typeof b.on=="function"&&T(b,"error",y,l)}function T(b,y,l,f){if(typeof b.on=="function")f.once?b.once(y,l):b.on(y,l);else if(typeof b.addEventListener=="function")b.addEventListener(y,function m(C){f.once&&b.removeEventListener(y,m),l(C)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return gn.exports}var gt,na;function Oi(){if(na)return gt;na=1;var k=gt&&gt.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],c;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(s){c={error:s}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(c)throw c.error}}return a},p=gt&&gt.__spreadArray||function(i,e){for(var r=0,t=e.length,n=i.length;r<t;r++,n++)i[n]=e[r];return i},_=Ue().EventEmitter,o=function(){function i(){Object.defineProperties(this,{_eventEmitter:{value:new _}})}return i.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},i.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,p([],k(arguments)))},i.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,p([],k(arguments)))},i}();return gt=o,gt}var xn,ia;function os(){if(ia)return xn;ia=1;var k=qe().defer,p={high:new Set(["low"]),low:new Set(["high"])},_=function(){function i(e){e===void 0&&(e="low");var r=e;Object.defineProperties(this,{_state:{set:function(t){var n=this;if(r!==t){r=t;var a=this._whenDeferreds.get(r);a.forEach(function(c){return c.resolve(n)}),a.clear()}},get:function(){return r}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])}})}return Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),i.prototype.lower=function(){return this.transition("low")},i.prototype.raise=function(){return this.transition("high")},i.prototype.transition=function(e){if(!p[this.state].has(e))throw o(this.state,e);return this._state=e,this},i.prototype.when=function(e){if(this.state===e)return Promise.resolve(this);if(!p[this.state].has(e))return Promise.reject(o(this.state,e));var r=k();return this._whenDeferreds.get(e).add(r),r.promise},i}();function o(i,e){return new Error('Cannot transition from "'+i+'" to "'+e+'"')}return xn=_,xn}var An,aa;function fu(){if(aa)return An;aa=1;var k=function(){function p(_){Object.defineProperties(this,{track:{enumerable:!0,value:_,writable:!0}})}return p}();return An=k,An}var Xe,oa;function vu(){if(oa)return Xe;oa=1;var k=Xe&&Xe.__extends||function(){var I=function(O,x){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,q){E.__proto__=q}||function(E,q){for(var B in q)Object.prototype.hasOwnProperty.call(q,B)&&(E[B]=q[B])},I(O,x)};return function(O,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");I(O,x);function E(){this.constructor=O}O.prototype=x===null?Object.create(x):(E.prototype=x.prototype,new E)}}(),p=Xe&&Xe.__read||function(I,O){var x=typeof Symbol=="function"&&I[Symbol.iterator];if(!x)return I;var E=x.call(I),q,B=[],G;try{for(;(O===void 0||O-- >0)&&!(q=E.next()).done;)B.push(q.value)}catch(F){G={error:F}}finally{try{q&&!q.done&&(x=E.return)&&x.call(E)}finally{if(G)throw G.error}}return B},_=Xe&&Xe.__spreadArray||function(I,O){for(var x=0,E=O.length,q=I.length;x<E;x++,q++)I[q]=O[x];return I},o=as(),i=Oi(),e=os(),r=is(),t=fu(),n=un(),a=n.getSdpFormat,c=n.updatePlanBTrackIdsToSSRCs,s=n.updateUnifiedPlanTrackIdsToSSRCs,d=qe(),v=d.delegateMethods,u=d.interceptEvent,g=d.isIOSChrome,h=d.legacyPromise,S=d.proxyProperties,R=a()==="unified",T=function(I){k(O,I);function O(x,E){x===void 0&&(x={});var q=I.call(this)||this,B=Object.assign(x.iceTransportPolicy?{iceTransports:x.iceTransportPolicy}:{},x);u(q,"datachannel"),u(q,"signalingstatechange");var G=a(B.sdpSemantics),F=new RTCPeerConnection(B,E);return Object.defineProperties(q,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_localStream:{value:new r},_peerConnection:{value:F},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:G},_senders:{value:new Map},_signalingStateLatch:{value:new e},_tracksToSSRCs:{value:new Map,writable:!0}}),F.addEventListener("datachannel",function(N){P(N.channel),q.dispatchEvent(N)}),F.addEventListener("signalingstatechange",function(){for(var N=[],A=0;A<arguments.length;A++)N[A]=arguments[A];F.signalingState==="stable"&&(q._appliedTracksToSSRCs=new Map(q._tracksToSSRCs)),!q._pendingLocalOffer&&!q._pendingRemoteOffer&&q.dispatchEvent.apply(q,_([],p(N)))}),F.ontrack=function(){},typeof F.addTrack!="function"&&F.addStream(q._localStream),S(RTCPeerConnection.prototype,q,F),q}return Object.defineProperty(O.prototype,"localDescription",{get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"signalingState",{get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),O.prototype.addTrack=function(x){for(var E,q=[],B=1;B<arguments.length;B++)q[B-1]=arguments[B];if(typeof this._peerConnection.addTrack=="function")return(E=this._peerConnection).addTrack.apply(E,_([x],p(q)));if(this._peerConnection.signalingState==="closed")throw new Error("Cannot add MediaStreamTrack ["+x.id+`, 
        `+x.kind+"]: RTCPeerConnection is closed");var G=this._senders.get(x);if(G&&G.track)throw new Error("Cannot add MediaStreamTrack ['"+x.id+`, 
        `+x.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(x),this._peerConnection.addStream(this._localStream),G=new t(x),this._senders.set(x,G),G},O.prototype.removeTrack=function(x){if(this._peerConnection.signalingState==="closed")throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");if(typeof this._peerConnection.addTrack=="function")try{return this._peerConnection.removeTrack(x)}catch{}else{var E=x.track;if(!E)return;x=this._senders.get(E),x&&x.track&&(x.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(E),this._peerConnection.addStream(this._localStream))}},O.prototype.getSenders=function(){return typeof this._peerConnection.addTrack=="function"?this._peerConnection.getSenders():Array.from(this._senders.values())},O.prototype.addIceCandidate=function(x){for(var E=this,q=[],B=1;B<arguments.length;B++)q[B-1]=arguments[B];var G;return this.signalingState==="have-remote-offer"?G=this._signalingStateLatch.when("low").then(function(){return E._peerConnection.addIceCandidate(x)}):G=this._peerConnection.addIceCandidate(x),q.length>0?h.apply(void 0,_([G],p(q))):G},O.prototype.close=function(){this.signalingState!=="closed"&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},O.prototype.createAnswer=function(){for(var x=this,E=[],q=0;q<arguments.length;q++)E[q]=arguments[q];var B;return this._pendingRemoteOffer?B=this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return x._signalingStateLatch.lower(),x._peerConnection.createAnswer()}).then(function(G){return x._pendingRemoteOffer=null,x._rolledBackTracksToSSRCs.clear(),new o({type:"answer",sdp:M(x._sdpFormat,x._tracksToSSRCs,G.sdp)})},function(G){throw x._pendingRemoteOffer=null,G}):B=this._peerConnection.createAnswer().then(function(G){return x._rolledBackTracksToSSRCs.clear(),new o({type:"answer",sdp:M(x._sdpFormat,x._tracksToSSRCs,G.sdp)})}),E.length>1?h.apply(void 0,_([B],p(E))):B},O.prototype.createOffer=function(){for(var x=this,E=[],q=0;q<arguments.length;q++)E[q]=arguments[q];var B=p(E,3),G=B[0],F=B[1],N=B[2],A=N||G||{};if(g()){if(A.offerToReceiveVideo&&!this._audioTransceiver&&!(R&&l(this,"audio"))){delete A.offerToReceiveAudio;try{this._audioTransceiver=R?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(j){return Promise.reject(j)}}if(A.offerToReceiveVideo&&!this._videoTransceiver&&!(R&&l(this,"video"))){delete A.offerToReceiveVideo;try{this._videoTransceiver=R?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(j){return Promise.reject(j)}}}var w=this._peerConnection.createOffer(A).then(function(j){return x._rolledBackTracksToSSRCs.clear(),new o({type:j.type,sdp:M(x._sdpFormat,x._tracksToSSRCs,j.sdp)})});return E.length>1?h(w,G,F):w},O.prototype.createDataChannel=function(x,E){E=C(E);var q=this._peerConnection.createDataChannel(x,E);return P(q),q},O.prototype.setLocalDescription=function(){for(var x=[],E=0;E<arguments.length;E++)x[E]=arguments[E];var q=p(x,3),B=q[0],G=q[1],F=q[2];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var N=b(this,!0,B);return x.length>1?h(N,G,F):N},O.prototype.setRemoteDescription=function(){for(var x=[],E=0;E<arguments.length;E++)x[E]=arguments[E];var q=p(x,3),B=q[0],G=q[1],F=q[2];this._rolledBackTracksToSSRCs.clear();var N=b(this,!1,B);return x.length>1?h(N,G,F):N},O}(i);v(RTCPeerConnection.prototype,T.prototype,"_peerConnection");function b(I,O,x){function E(j){O?I._pendingLocalOffer=j:I._pendingRemoteOffer=j}function q(){O?I._pendingLocalOffer=null:I._pendingRemoteOffer=null}var B=O?I._pendingLocalOffer:I._pendingRemoteOffer,G=O?I._pendingRemoteOffer:I._pendingLocalOffer,F=O?"have-local-offer":"have-remote-offer",N=O?"setLocalDescription":"setRemoteDescription",A;if(!O&&G&&x.type==="answer")A=y(I,x);else if(x.type==="offer"){if(I.signalingState!==F&&I.signalingState!=="stable")return Promise.reject(new Error("Cannot set "+(O?"local":"remote")+" offer in state "+I.signalingState));!B&&I._signalingStateLatch.state==="low"&&I._signalingStateLatch.raise();var w=I.signalingState;E(f(x)),A=Promise.resolve(),I.signalingState!==w&&A.then(function(){return I.dispatchEvent(new Event("signalingstatechange"))})}else x.type==="rollback"&&(I.signalingState!==F?A=Promise.reject(new Error("Cannot rollback "+(O?"local":"remote")+" description in "+I.signalingState)):(q(),I._rolledBackTracksToSSRCs=new Map(I._tracksToSSRCs),I._tracksToSSRCs=new Map(I._appliedTracksToSSRCs),A=Promise.resolve(),A.then(function(){return I.dispatchEvent(new Event("signalingstatechange"))})));return A||I._peerConnection[N](f(x))}function y(I,O){var x=I._pendingLocalOffer;return I._peerConnection.setLocalDescription(x).then(function(){return I._pendingLocalOffer=null,I.setRemoteDescription(O)}).then(function(){I._signalingStateLatch.lower()})}function l(I,O){return!!I.getTransceivers().find(function(x){var E=x.receiver,q=E===void 0?{}:E,B=q.track,G=B===void 0?{}:B;return G.kind===O})}function f(I){return I instanceof o&&I._description?I._description:new RTCSessionDescription(I)}function m(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function C(I){return I=Object.assign({},I),m()&&"maxPacketLifeTime"in I&&(I.maxRetransmitTime=I.maxPacketLifeTime),I}function P(I){return Object.defineProperty(I,"maxRetransmits",{value:I.maxRetransmits===65535?null:I.maxRetransmits}),m()&&Object.defineProperty(I,"maxPacketLifeTime",{value:I.maxRetransmitTime===65535?null:I.maxRetransmitTime}),I}function M(I,O,x){return I==="unified"?s(O,x):c(O,x)}return Xe=T,Xe}var Mn,ca;function cs(){return ca||(ca=1,Mn=RTCSessionDescription),Mn}var Ze,sa;function pu(){if(sa)return Ze;sa=1;var k=Ze&&Ze.__extends||function(){var g=function(h,S){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,T){R.__proto__=T}||function(R,T){for(var b in T)Object.prototype.hasOwnProperty.call(T,b)&&(R[b]=T[b])},g(h,S)};return function(h,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");g(h,S);function R(){this.constructor=h}h.prototype=S===null?Object.create(S):(R.prototype=S.prototype,new R)}}(),p=Ze&&Ze.__read||function(g,h){var S=typeof Symbol=="function"&&g[Symbol.iterator];if(!S)return g;var R=S.call(g),T,b=[],y;try{for(;(h===void 0||h-- >0)&&!(T=R.next()).done;)b.push(T.value)}catch(l){y={error:l}}finally{try{T&&!T.done&&(S=R.return)&&S.call(R)}finally{if(y)throw y.error}}return b},_=Ze&&Ze.__spreadArray||function(g,h){for(var S=0,R=h.length,T=g.length;S<R;S++,T++)g[T]=h[S];return g},o=Oi(),i=cs(),e=un().updateUnifiedPlanTrackIdsToSSRCs,r=qe(),t=r.delegateMethods,n=r.interceptEvent,a=r.legacyPromise,c=r.proxyProperties,s=function(g){k(h,g);function h(S){var R=g.call(this)||this;n(R,"signalingstatechange");var T=new RTCPeerConnection(S);Object.defineProperties(R,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:T},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},peerIdentity:{enumerable:!0,value:Promise.resolve({idp:"",name:""})}});var b;return T.addEventListener("signalingstatechange",function(){for(var y=[],l=0;l<arguments.length;l++)y[l]=arguments[l];!R._rollingBack&&R.signalingState!==b&&(b=R.signalingState,R._isClosed?setTimeout(function(){return R.dispatchEvent.apply(R,_([],p(y)))}):R.dispatchEvent.apply(R,_([],p(y))))}),c(RTCPeerConnection.prototype,R,T),R}return Object.defineProperty(h.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"localDescription",{get:function(){return u(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),h.prototype.createAnswer=function(){for(var S=this,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var b;return b=this._peerConnection.createAnswer().then(function(y){return v(S,y),u(y,S._initiallyNegotiatedDtlsRole)}),typeof R[0]=="function"?a.apply(void 0,_([b],p(R))):b},h.prototype.createOffer=function(){for(var S=this,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var b=p(R,3),y=b[0],l=b[1],f=b[2],m=f||y||{},C;if(this.signalingState==="have-local-offer"||this.signalingState==="have-remote-offer"){var P=this.signalingState==="have-local-offer";C=d(this,P,function(){return S.createOffer(m)})}else C=this._peerConnection.createOffer(m);return C=C.then(function(M){return new i({type:M.type,sdp:e(S._tracksToSSRCs,M.sdp)})}),R.length>1?a(C,y,l):C},h.prototype.setLocalDescription=function(){for(var S,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var b=p(R),y=b[0],l=b.slice(1),f;return y&&y.type==="answer"&&this.signalingState==="have-local-offer"&&(f=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),f?R.length>1?a.apply(void 0,_([f],p(l))):f:(S=this._peerConnection).setLocalDescription.apply(S,_([],p(R)))},h.prototype.setRemoteDescription=function(){for(var S=this,R=[],T=0;T<arguments.length;T++)R[T]=arguments[T];var b=p(R),y=b[0],l=b.slice(1),f;return y&&this.signalingState==="have-remote-offer"&&(y.type==="answer"?f=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):y.type==="offer"&&(f=d(this,!1,function(){return S._peerConnection.setRemoteDescription(y)}))),f||(f=this._peerConnection.setRemoteDescription(y)),f=f.then(function(){return v(S,y,!0)}),R.length>1?a.apply(void 0,_([f],p(l))):f},h.prototype.close=function(){this.signalingState!=="closed"&&(this._isClosed=!0,this._peerConnection.close())},h}(o);t(RTCPeerConnection.prototype,s.prototype,"_peerConnection");function d(g,h,S){var R=h?"setLocalDescription":"setRemoteDescription";return g._rollingBack=!0,g._peerConnection[R](new i({type:"rollback"})).then(S).then(function(T){return g._rollingBack=!1,T},function(T){throw g._rollingBack=!1,T})}function v(g,h,S){if(!(g._initiallyNegotiatedDtlsRole||h.type==="offer")){var R=h.sdp.match(/a=setup:([a-z]+)/);if(R){var T=R[1];g._initiallyNegotiatedDtlsRole=S?{active:"passive",passive:"active"}[T]:T}}}function u(g,h){return g&&g.type==="answer"&&h?new i({type:g.type,sdp:g.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+h)}):g}return Ze=s,Ze}var et,ua;function hu(){if(ua)return et;ua=1;var k=et&&et.__extends||function(){var b=function(y,l){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,m){f.__proto__=m}||function(f,m){for(var C in m)Object.prototype.hasOwnProperty.call(m,C)&&(f[C]=m[C])},b(y,l)};return function(y,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");b(y,l);function f(){this.constructor=y}y.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)}}(),p=et&&et.__read||function(b,y){var l=typeof Symbol=="function"&&b[Symbol.iterator];if(!l)return b;var f=l.call(b),m,C=[],P;try{for(;(y===void 0||y-- >0)&&!(m=f.next()).done;)C.push(m.value)}catch(M){P={error:M}}finally{try{m&&!m.done&&(l=f.return)&&l.call(f)}finally{if(P)throw P.error}}return C},_=et&&et.__spreadArray||function(b,y){for(var l=0,f=y.length,m=b.length;l<f;l++,m++)b[m]=y[l];return b},o=Oi(),i=os(),e=un(),r=e.getSdpFormat,t=e.updatePlanBTrackIdsToSSRCs,n=e.updateUnifiedPlanTrackIdsToSSRCs,a=qe(),c=a.delegateMethods,s=a.interceptEvent,d=a.proxyProperties,v=r()==="unified",u=v?n:t,g=function(b){k(y,b);function y(l){var f=b.call(this)||this;s(f,"datachannel"),s(f,"iceconnectionstatechange"),s(f,"signalingstatechange"),s(f,"track");var m=new RTCPeerConnection(l);return Object.defineProperties(f,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:m},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new i},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0}}),m.addEventListener("datachannel",function(C){T(C.channel),f.dispatchEvent(C)}),m.addEventListener("iceconnectionstatechange",function(){for(var C=[],P=0;P<arguments.length;P++)C[P]=arguments[P];f._isClosed||f.dispatchEvent.apply(f,_([],p(C)))}),m.addEventListener("signalingstatechange",function(){for(var C=[],P=0;P<arguments.length;P++)C[P]=arguments[P];f._isClosed||(m.signalingState==="stable"&&(f._appliedTracksToSSRCs=new Map(f._tracksToSSRCs)),!f._pendingLocalOffer&&!f._pendingRemoteOffer&&f.dispatchEvent.apply(f,_([],p(C))))}),m.addEventListener("track",function(C){f._pendingRemoteOffer=null,f.dispatchEvent(C)}),d(RTCPeerConnection.prototype,f,m),f}return Object.defineProperty(y.prototype,"localDescription",{get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"iceConnectionState",{get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),y.prototype.addIceCandidate=function(l){var f=this;return this.signalingState==="have-remote-offer"?this._signalingStateLatch.when("low").then(function(){return f._peerConnection.addIceCandidate(l)}):this._peerConnection.addIceCandidate(l)},y.prototype.createOffer=function(l){var f=this;if(l=Object.assign({},l),l.offerToReceiveVideo&&!this._audioTransceiver&&!(v&&R(this,"audio"))){delete l.offerToReceiveAudio;try{this._audioTransceiver=v?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(m){return Promise.reject(m)}}if(l.offerToReceiveVideo&&!this._videoTransceiver&&!(v&&R(this,"video"))){delete l.offerToReceiveVideo;try{this._videoTransceiver=v?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(m){return Promise.reject(m)}}return this._peerConnection.createOffer(l).then(function(m){return f._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:m.type,sdp:u(f._tracksToSSRCs,m.sdp)})})},y.prototype.createAnswer=function(l){var f=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return f._signalingStateLatch.lower(),f._peerConnection.createAnswer()}).then(function(m){return f._pendingRemoteOffer=null,f._rolledBackTracksToSSRCs.clear(),v?new RTCSessionDescription({type:m.type,sdp:u(f._tracksToSSRCs,m.sdp)}):m},function(m){throw f._pendingRemoteOffer=null,m}):this._peerConnection.createAnswer(l).then(function(m){return f._rolledBackTracksToSSRCs.clear(),v?new RTCSessionDescription({type:m.type,sdp:u(f._tracksToSSRCs,m.sdp)}):m})},y.prototype.createDataChannel=function(l,f){var m=this._peerConnection.createDataChannel(l,f);return T(m),m},y.prototype.removeTrack=function(l){l.replaceTrack(null),this._peerConnection.removeTrack(l)},y.prototype.setLocalDescription=function(l){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),h(this,!0,l)},y.prototype.setRemoteDescription=function(l){return this._rolledBackTracksToSSRCs.clear(),h(this,!1,l)},y.prototype.close=function(){var l=this;this._isClosed||(this._isClosed=!0,this._peerConnection.close(),setTimeout(function(){l.dispatchEvent(new Event("iceconnectionstatechange")),l.dispatchEvent(new Event("signalingstatechange"))}))},y}(o);c(RTCPeerConnection.prototype,g.prototype,"_peerConnection");function h(b,y,l){function f(x){y?b._pendingLocalOffer=x:b._pendingRemoteOffer=x}function m(){y?b._pendingLocalOffer=null:b._pendingRemoteOffer=null}var C=y?b._pendingLocalOffer:b._pendingRemoteOffer,P=y?b._pendingRemoteOffer:b._pendingLocalOffer,M=y?"have-local-offer":"have-remote-offer",I=y?"setLocalDescription":"setRemoteDescription";if(!y&&P&&l.type==="answer")return S(b,l);if(l.type==="offer"){if(b.signalingState!==M&&b.signalingState!=="stable")return Promise.reject(new Error("Cannot set "+(y?"local":"remote")+`
        offer in state `+b.signalingState));!C&&b._signalingStateLatch.state==="low"&&b._signalingStateLatch.raise();var O=b.signalingState;return f(l),b.signalingState!==O?Promise.resolve().then(function(){return b.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}else if(l.type==="rollback")return b.signalingState!==M?Promise.reject(new Error(`Cannot rollback 
        `+(y?"local":"remote")+" description in "+b.signalingState)):(m(),b._rolledBackTracksToSSRCs=new Map(b._tracksToSSRCs),b._tracksToSSRCs=new Map(b._appliedTracksToSSRCs),Promise.resolve().then(function(){return b.dispatchEvent(new Event("signalingstatechange"))}));return b._peerConnection[I](l)}function S(b,y){var l=b._pendingLocalOffer;return b._peerConnection.setLocalDescription(l).then(function(){return b._pendingLocalOffer=null,b.setRemoteDescription(y)}).then(function(){return b._signalingStateLatch.lower()})}function R(b,y){return!!b.getTransceivers().find(function(l){var f=l.receiver,m=f===void 0?{}:f,C=m.track,P=C===void 0?{}:C;return P.kind===y})}function T(b){return Object.defineProperties(b,{maxPacketLifeTime:{value:b.maxPacketLifeTime===65535?null:b.maxPacketLifeTime},maxRetransmits:{value:b.maxRetransmits===65535?null:b.maxRetransmits}})}return et=g,et}var la;function _u(){if(la)return yt.exports;if(la=1,typeof RTCPeerConnection=="function"){var k=qe().guessBrowser;switch(k()){case"chrome":yt.exports=vu();break;case"firefox":yt.exports=pu();break;case"safari":yt.exports=hu();break;default:yt.exports=RTCPeerConnection;break}}else yt.exports=function(){throw new Error("RTCPeerConnection is not supported")};return yt.exports}var Mt={exports:{}},da;function mu(){if(da)return Mt.exports;if(da=1,typeof RTCSessionDescription=="function"){var k=qe().guessBrowser;switch(k()){case"chrome":Mt.exports=as();break;case"firefox":Mt.exports=cs();break;default:Mt.exports=RTCSessionDescription;break}}else Mt.exports=function(){throw new Error("RTCSessionDescription is not supported")};return Mt.exports}var In,fa;function Ot(){if(fa)return In;fa=1;var k={};return Object.defineProperties(k,{getStats:{enumerable:!0,value:su()},getUserMedia:{enumerable:!0,value:uu()},MediaStream:{enumerable:!0,value:is()},MediaStreamTrack:{enumerable:!0,value:lu()},RTCIceCandidate:{enumerable:!0,value:du()},RTCPeerConnection:{enumerable:!0,value:_u()},RTCSessionDescription:{enumerable:!0,value:mu()}}),In=k,In}var Dn,va;function Ri(){return va||(va=1,Dn=function(p,_){if(p&&_)if(p.super_=_,typeof Object.create=="function")p.prototype=Object.create(_.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}});else{var o=function(){function i(){}return i}();o.prototype=_.prototype,p.prototype=new o,p.prototype.constructor=p}}),Dn}var Ut,pa;function Rt(){if(pa)return Ut;pa=1;var k=Ut&&Ut.__read||function(s,d){var v=typeof Symbol=="function"&&s[Symbol.iterator];if(!v)return s;var u=v.call(s),g,h=[],S;try{for(;(d===void 0||d-- >0)&&!(g=u.next()).done;)h.push(g.value)}catch(R){S={error:R}}finally{try{g&&!g.done&&(v=u.return)&&v.call(u)}finally{if(S)throw S.error}}return h};function p(){return/Android/.test(navigator.userAgent)}function _(){return!!(navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2)}function o(){return _()&&window.screen.width>=744&&(/Macintosh/i.test(navigator.userAgent)||/iPad/.test(navigator.userAgent)||/iPad/.test(navigator.platform))}function i(){return _()&&window.screen.width<=476&&(/Macintosh/i.test(navigator.userAgent)||/iPhone/.test(navigator.userAgent)||/iPhone/.test(navigator.platform))}function e(){return o()||i()}function r(){return/Mobi/.test(navigator.userAgent)}function t(s){return s==="chrome"&&/Edge/.test(navigator.userAgent)&&(typeof chrome>"u"||typeof chrome.runtime>"u")}function n(s){if(s!=="chrome")return null;if("brave"in navigator)return"brave";var d=c(navigator.userAgent),v=d.reduce(function(S,R){return S.replace(R,"")},navigator.userAgent),u=v.match(/[^\s]+/g)||[],g=k(u.map(function(S){return S.split("/")[0].toLowerCase()})),h=g.slice(2);return h.find(function(S){return!["chrome","mobile","safari"].includes(S)})||null}function a(s){return s!=="safari"?null:"brave"in navigator?"brave":["edge","edg"].find(function(d){return navigator.userAgent.toLowerCase().includes(d)})||null}function c(s){for(var d=[],v=[],u=0;u<s.length;u++)if(s[u]==="(")d.push(u);else if(s[u]===")"&&d.length>0){var g=d.pop();d.length===0&&v.push(s.substring(g,u+1))}return v}return Ut={isAndroid:p,isIOS:e,isIpad:o,isIphone:i,isMobile:r,isNonChromiumEdge:t,mobileWebKitBrowser:a,rebrandedChromeBrowser:n},Ut}var jn,ha;function ss(){if(ha)return jn;ha=1;function k(_){return _=typeof _=="number"?_:0,new Promise(function(o){return setTimeout(o,_)})}function p(_,o,i){i=typeof i=="number"?i:250;var e=_.createMediaStreamSource(o),r=_.createAnalyser();r.fftSize=2048,e.connect(r);var t=new Uint8Array(r.fftSize),n=!1;setTimeout(function(){n=!0},i);function a(){return n?Promise.resolve(!0):(r.getByteTimeDomainData(t),t.some(function(c){return c!==128&&c!==0})?Promise.resolve(!1):k().then(a))}return a().then(function(c){return e.disconnect(),c},function(c){throw e.disconnect(),c})}return jn=p,jn}var Nn,_a;function Sn(){if(_a)return Nn;_a=1;var k=typeof AudioContext<"u"?AudioContext:typeof webkitAudioContext<"u"?webkitAudioContext:null,p=function(){function _(o){o=Object.assign({AudioContext:k},o),Object.defineProperties(this,{_AudioContext:{value:o.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:_}})}return _.prototype.getOrCreate=function(o){if(!this._holders.has(o)&&(this._holders.add(o),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch{}return this._audioContext},_.prototype.release=function(o){this._holders.has(o)&&(this._holders.delete(o),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))},_}();return Nn=new p,Nn}var qn,ma;function us(){if(ma)return qn;ma=1;var k=ss(),p=3,_=250;function o(i){var e=Sn(),r={},t=e.getOrCreate(r),n=p;function a(){return n--,k(t,i.srcObject,_).then(function(c){return c?n>0?a():!0:!1}).catch(function(){return!0})}return a().finally(function(){e.release(r)})}return qn=o,qn}var Vn,ya;function ls(){if(ya)return Vn;ya=1;var k=Pe().defer,p=function(){function _(){Object.defineProperties(this,{_audio:{value:k(),writable:!0},_video:{value:k(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return _.prototype.resolveDeferred=function(o){o==="audio"?this._audio.resolve():this._video.resolve()},_.prototype.startDeferred=function(o){o==="audio"?this._audio=k():this._video=k()},_.prototype.whenResolved=function(o){return o==="audio"?this._audio.promise:this._video.promise},_}();return Vn=new p,Vn}var Fn,ga;function ln(){if(ga)return Fn;ga=1;var k=Ue().EventEmitter,p=Pe().hidePrivateAndCertainPublicPropertiesInClass;return Fn=p(k,["domain"]),Fn}var Wt,ba;function Li(){if(ba)return Wt;ba=1;var k=Wt&&Wt.__extends||function(){var a=function(c,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(c,s)};return function(c,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(c,s);function d(){this.constructor=c}c.prototype=s===null?Object.create(s):(d.prototype=s.prototype,new d)}}(),p=ln(),_=Pe(),o=_.buildLogLevels,i=_.valueToJSON,e=Ce().DEFAULT_LOG_LEVEL,r=ze(),t=0,n=function(a){k(c,a);function c(s,d,v){var u=this;v=Object.assign({name:s,log:null,logLevel:e},v),u=a.call(this)||this;var g=String(v.name),h=o(v.logLevel),S=v.log?v.log.createLog("media",u):new r("media",u,h,v.loggerName);return Object.defineProperties(u,{_instanceId:{value:++t},_log:{value:S},kind:{enumerable:!0,value:d},name:{enumerable:!0,value:g}}),u}return c.prototype.toJSON=function(){return i(this)},c}(p);return Wt=n,Wt}var Ht,ka;function ds(){if(ka)return Ht;ka=1;var k=Ht&&Ht.__extends||function(){var s=function(d,v){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,g){u.__proto__=g}||function(u,g){for(var h in g)Object.prototype.hasOwnProperty.call(g,h)&&(u[h]=g[h])},s(d,v)};return function(d,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");s(d,v);function u(){this.constructor=d}d.prototype=v===null?Object.create(v):(u.prototype=v.prototype,new u)}}(),p=Rt().isIOS,_=Ot().MediaStream,o=Pe(),i=o.waitForEvent,e=o.waitForSometime,r=ls(),t=Li(),n=function(s){k(d,s);function d(v,u){var g=this;u=Object.assign({playPausedElementsIfNotBackgrounded:p()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string"},u),g=s.call(this,v.id,v.kind,u)||this;var h=!1;if(u=Object.assign({MediaStream:_},u),typeof u.MediaStream!="function")throw new Error("MediaTrack received an invalid MediaStream constructor: "+u.MediaStream);return Object.defineProperties(g,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return h},set:function(S){h=S}},_playPausedElementsIfNotBackgrounded:{value:u.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:u.workaroundWebKitBug212780||u.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:u.MediaStream},_mapMediaElement:{value:u.mapMediaElement},_disposeMediaElement:{value:u.disposeMediaElement},isStarted:{enumerable:!0,get:function(){return h}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||v.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),g._initialize(),g}return d.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)},d.prototype._initialize=function(){var v=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack&&this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("ended",function u(){v._end(),v.mediaStreamTrack.removeEventListener("ended",u)}):this.mediaStreamTrack&&(this.mediaStreamTrack.onended=function(){v._end(),v.mediaStreamTrack.onended=null}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))},d.prototype._end=function(){this._log.debug("Ended"),this._dummyEl&&(this._dummyEl.remove(),this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl.oncanplay=null,this._dummyEl=null)},d.prototype.attach=function(v){var u=this;if(typeof v=="string"?v=this._selectElement(v):v||(v=this._createElement()),this._log.debug("Attempting to attach to element:",v),v=this._attach(v),this._shouldShimAttachedElements&&!this._elShims.has(v)){var g=this._playPausedElementsIfNotBackgrounded?function(){return a(v,u._log)}:null;this._elShims.set(v,c(v,g))}return v},d.prototype._attach=function(v,u){u===void 0&&(u=this.processedTrack||this.mediaStreamTrack);var g=v.srcObject;g instanceof this._MediaStream||(g=new this._MediaStream);var h=u.kind==="audio"?"getAudioTracks":"getVideoTracks";return g[h]().forEach(function(S){g.removeTrack(S)}),g.addTrack(u),this._mapMediaElement&&(this._log.debug("Mapping element using mapMediaElement before attaching media to element"),this._mapMediaElement(v)),v.srcObject=g,v.autoplay=!0,v.playsInline=!0,this._attachments.has(v)||this._attachments.add(v),v},d.prototype._selectElement=function(v){var u=document.querySelector(v);if(!u)throw new Error("Selector matched no element: "+v);return u},d.prototype._updateElementsMediaStreamTrack=function(){var v=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach(function(u){return v._attach(u)})},d.prototype._createElement=function(){return typeof document<"u"?document.createElement(this.kind):null},d.prototype.detach=function(v){var u;return typeof v=="string"?u=[this._selectElement(v)]:v?u=[v]:u=this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",u),this._detachElements(u),v?u[0]:u},d.prototype._detachElements=function(v){return v.map(this._detachElement.bind(this))},d.prototype._detachElement=function(v){if(!this._attachments.has(v))return v;var u=v.srcObject;if(u instanceof this._MediaStream&&u.removeTrack(this.processedTrack||this.mediaStreamTrack),this._disposeMediaElement&&(this._log.debug("Disposing element using disposeMediaElement after removing media from element"),this._disposeMediaElement(v)),this._attachments.delete(v),this._shouldShimAttachedElements&&this._elShims.has(v)){var g=this._elShims.get(v);g.unShim(),this._elShims.delete(v)}return v},d.prototype._getAllAttachedElements=function(){var v=[];return this._attachments.forEach(function(u){v.push(u)}),v},d}(t);function a(s,d){var v=s.tagName.toLowerCase();d.warn("Unintentionally paused:",s),Promise.race([i(document,"visibilitychange"),e(1e3)]).then(function(){document.visibilityState==="visible"&&r.whenResolved("audio").then(function(){return d.info("Playing unintentionally paused <"+v+"> element"),d.debug("Element:",s),s.play()}).then(function(){d.info("Successfully played unintentionally paused <"+v+"> element"),d.debug("Element:",s)}).catch(function(u){d.warn("Error while playing unintentionally paused <"+v+"> element:",{error:u,el:s})})})}function c(s,d){d===void 0&&(d=null);var v=s.pause,u=s.play,g=!1;s.pause=function(){return g=!0,v.call(s)},s.play=function(){return g=!1,u.call(s)};var h=d?function(){g||d()}:null;return h&&s.addEventListener("pause",h),{pausedIntentionally:function(){return g},unShim:function(){s.pause=v,s.play=u,h&&s.removeEventListener("pause",h)}}}return Ht=n,Ht}var Gt,Sa;function fs(){if(Sa)return Gt;Sa=1;var k=Gt&&Gt.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=ds(),_=function(o){k(i,o);function i(e,r){return o.call(this,e,r)||this}return i.prototype.attach=function(){return o.prototype.attach.apply(this,arguments)},i.prototype.detach=function(){return o.prototype.detach.apply(this,arguments)},i}(p);return Gt=_,Gt}var Bn,Ta;function vs(){if(Ta)return Bn;Ta=1;var k=null,p=3,_=50,o=250,i=50;function e(t){try{var n=k.getContext("2d");n.drawImage(t,0,0,i,_);var a=n.getImageData(0,0,i,_),c=a.data.filter(function(d,v){return(v+1)%4}),s=Math.max.apply(Math,c);return s===0}catch(d){return console.log("Error checking silence: ",d),!1}}function r(t){return k=k||document.createElement("canvas"),new Promise(function(n){var a=p;setTimeout(function c(){return a--,e(t)?a>0?setTimeout(c,o):n(!0):n(!1)},o)})}return Bn=r,Bn}var Un,wa;function xi(){if(wa)return Un;wa=1;var k=function(){function p(_){var o=this;_===void 0&&(_=1),Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){o._emitVisible(document.visibilityState==="visible")}}});for(var i=0;i<_;i++)this._listeners.push([])}return p.prototype.clear=function(){for(var _=this._listeners.length,o=0;o<_;o++)this._listeners[o]=[]},p.prototype._listenerCount=function(){return this._listeners.reduce(function(_,o){return _+o.length},0)},p.prototype._emitVisible=function(_){for(var o=this,i=Promise.resolve(),e=function(t){i=i.then(function(){return o._emitVisiblePhase(t,_)})},r=1;r<=this._listeners.length;r++)e(r);return i},p.prototype._emitVisiblePhase=function(_,o){var i=this._listeners[_-1];return Promise.all(i.map(function(e){var r=e(o);return r instanceof Promise?r:Promise.resolve(r)}))},p.prototype._start=function(){document.addEventListener("visibilitychange",this._onVisibilityChange)},p.prototype._stop=function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)},p.prototype.onVisibilityChange=function(_,o){if(typeof _!="number"||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);var i=this._listeners[_-1];return i.push(o),this._listenerCount()===1&&this._start(),this},p.prototype.offVisibilityChange=function(_,o){if(typeof _!="number"||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);var i=this._listeners[_-1],e=i.indexOf(o);return e!==-1&&(i.splice(e,1),this._listenerCount()===0&&this._stop()),this},p}();return Un=new k(2),Un}var Wn,Ea;function ps(){if(Ea)return Wn;Ea=1;var k=ss();function p(_,o,i,e,r){e=typeof e=="number"?e:3;var t=0,n=Sn(),a={},c=n.getOrCreate(a);function s(){return o(i).then(function(d){var v=i.audio?k(c,d,r).catch(function(u){return _.warn("Encountered an error while detecting silence",u),!0}):Promise.resolve(!1);return v.then(function(u){if(u){if(e<=0)return _.warn("Got a silent audio MediaStreamTrack. Normally we would try 	to get a new one, but we've run out of retries; returning it anyway."),d}else return _.info("Got a non-silent audio MediaStreamTrack; returning it."),d;return _.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++t+"."),d.getTracks().forEach(function(g){return g.stop()}),e--,s()})})}return s().then(function(d){return n.release(a),d},function(d){throw n.release(a),d})}return Wn=p,Wn}var tt,Pa;function hs(){if(Pa)return tt;Pa=1;var k=tt&&tt.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=tt&&tt.__read||function(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),a,c=[],s;try{for(;(r===void 0||r-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(d){s={error:d}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return c},_=tt&&tt.__spreadArray||function(e,r){for(var t=0,n=r.length,a=e.length;t<n;t++,a++)e[a]=r[t];return e},o=Ue().EventEmitter,i=function(e){k(r,e);function r(){var t=e.call(this)||this;return Object.defineProperties(t,{_queuedEvents:{value:new Map}}),t}return r.prototype.dequeue=function(t){var n=this,a=!0;if(!t)return this._queuedEvents.forEach(function(s,d){a=this.dequeue(d)&&a},this),a;var c=this._queuedEvents.get(t)||[];return this._queuedEvents.delete(t),c.reduce(function(s,d){return n.emit.apply(n,_([],p([t].concat(d))))&&s},a)},r.prototype.queue=function(){var t=[].slice.call(arguments);if(this.emit.apply(this,_([],p(t))))return!0;var n=t[0];return this._queuedEvents.has(n)||this._queuedEvents.set(n,[]),this._queuedEvents.get(n).push(t.slice(1)),!1},r}(o);return tt=i,tt}var Qt,Ca;function _s(){if(Ca)return Qt;Ca=1;var k=Qt&&Qt.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=hs(),_=function(o){k(i,o);function i(e,r){var t=o.call(this)||this;return Object.defineProperties(t,{id:{enumerable:!0,value:e},kind:{enumerable:!0,value:r}}),t}return i.prototype.stop=function(){this.emit("stopped")},i}(p);return Qt=_,Qt}var $t,Oa;function ms(){if(Oa)return $t;Oa=1;var k=$t&&$t.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=_s(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e,r.kind)||this;return Object.defineProperties(t,{_track:{value:r,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),t}return i.prototype.stop=function(){this.track.stop(),o.prototype.stop.call(this)},i}(p);return $t=_,$t}var bt,Ra;function ys(){if(Ra)return bt;Ra=1;var k=bt&&bt.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=bt&&bt.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],c;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(s){c={error:s}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(c)throw c.error}}return a},_=ms(),o=function(i){k(e,i);function e(r){var t=i.call(this,r.id,r)||this;return Object.defineProperties(t,{_clones:{value:new Set},_eventsToReemitters:{value:new Map([["mute",function(){return t.queue("muted")}],["unmute",function(){return t.queue("unmuted")}]])},_senders:{value:new Set},_senderToPublisherHintCallbacks:{value:new Map},isPublishing:{enumerable:!0,get:function(){return!!this._clones.size}},muted:{enumerable:!0,get:function(){return this._track.muted}}}),t._reemitMediaStreamTrackEvents(),t}return e.prototype._reemitMediaStreamTrackEvents=function(r){r===void 0&&(r=this._track);var t=this,n=t._eventsToReemitters,a=t._track;if(r.addEventListener?n.forEach(function(s,d){return r.addEventListener(d,s)}):n.forEach(function(s,d){r["on"+d]=s}),a!==r&&(n.forEach(function(s,d){return a.removeEventListener(d,s)}),a.muted!==r.muted)){var c=n.get(r.muted?"mute":"unmute");c()}},e.prototype.clone=function(){var r=new e(this.track.clone());return this._clones.add(r),r},e.prototype.removeClone=function(r){this._clones.delete(r)},e.prototype.setMediaStreamTrack=function(r){var t=this,n=Array.from(this._clones),a=Array.from(this._senders);return Promise.all(n.map(function(c){return c.setMediaStreamTrack(r.clone())}).concat(a.map(function(c){return t._replaceTrack(c,r)}))).finally(function(){t._reemitMediaStreamTrackEvents(r),t._track=r})},e.prototype.addSender=function(r,t){return this._senders.add(r),t&&this._senderToPublisherHintCallbacks.set(r,t),this},e.prototype.removeSender=function(r){return this._senders.delete(r),this._senderToPublisherHintCallbacks.delete(r),this},e.prototype.setPublisherHint=function(r){var t=p(Array.from(this._senderToPublisherHintCallbacks.values()),1),n=t[0];return n?n(r):Promise.resolve("COULD_NOT_APPLY_HINT")},e.prototype._replaceTrack=function(r,t){var n=this;return r.replaceTrack(t).then(function(a){return n.setPublisherHint(null).catch(function(){}),n.emit("replaced"),a})},e}(_);return bt=o,bt}var Kt,La;function gs(){if(La)return Kt;La=1;var k=Kt&&Kt.__extends||function(){var S=function(R,T){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,y){b.__proto__=y}||function(b,y){for(var l in y)Object.prototype.hasOwnProperty.call(y,l)&&(b[l]=y[l])},S(R,T)};return function(R,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");S(R,T);function b(){this.constructor=R}R.prototype=T===null?Object.create(T):(b.prototype=T.prototype,new b)}}(),p=Ot().getUserMedia,_=Rt().isIOS,o=Pe(),i=o.capitalize,e=o.defer,r=o.waitForSometime,t=o.waitForEvent,n=Ce().typeErrors.ILLEGAL_INVOKE,a=us(),c=vs(),s=xi(),d=ls(),v=ps(),u=ys();function g(S){return function(R){k(T,R);function T(b,y){var l=this,f=_()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string";y=Object.assign({getUserMedia:p,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:f,gUMSilentTrackWorkaround:v},y);var m=new u(b),C=m.kind;return l=R.call(this,m,y)||this,Object.defineProperties(l,{_constraints:{value:typeof y[C]=="object"?y[C]:{},writable:!0},_getUserMedia:{value:y.getUserMedia},_gUMSilentTrackWorkaround:{value:y.gUMSilentTrackWorkaround},_eventsToReemitters:{value:new Map([["muted",function(){return l.emit("muted",l)}],["unmuted",function(){return l.emit("unmuted",l)}]])},_workaroundWebKitBug1208516:{value:y.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:y.isCreatedByCreateLocalTracks},_noiseCancellation:{value:y.noiseCancellation||null},_trackSender:{value:m},id:{enumerable:!0,value:m.id},isEnabled:{enumerable:!0,get:function(){return m.enabled}},isMuted:{enumerable:!0,get:function(){return m.muted}},isStopped:{enumerable:!0,get:function(){return m.readyState==="ended"}}}),l._workaroundWebKitBug1208516&&(l._workaroundWebKitBug1208516Cleanup=h(l)),l._reemitTrackSenderEvents(),l}return T.prototype._end=function(){var b=this;this._didCallEnd||(R.prototype._end.call(this),this._didCallEnd=!0,this._eventsToReemitters.forEach(function(y,l){return b._trackSender.removeListener(l,y)}),this.emit("stopped",this))},T.prototype._initialize=function(){this._didCallEnd&&(this._didCallEnd=!1),this._eventsToReemitters&&this._reemitTrackSenderEvents(),R.prototype._initialize.call(this)},T.prototype._reacquireTrack=function(b){var y,l=this,f=l._getUserMedia,m=l._gUMSilentTrackWorkaround,C=l._log,P=l.mediaStreamTrack.kind;C.info("Re-acquiring the MediaStreamTrack"),C.debug("Constraints:",b);var M=Object.assign({audio:!1,video:!1},(y={},y[P]=b,y)),I=this._workaroundWebKitBug1208516Cleanup?m(C,f,M):f(M);return I.then(function(O){return O.getTracks()[0]})},T.prototype._reemitTrackSenderEvents=function(){var b=this;this._eventsToReemitters.forEach(function(y,l){return b._trackSender.on(l,y)}),this._trackSender.dequeue("muted"),this._trackSender.dequeue("unmuted")},T.prototype._restart=function(b){var y=this,l=this._log;return b=b||this._constraints,this._stop(),this._reacquireTrack(b).catch(function(f){throw l.error("Failed to re-acquire the MediaStreamTrack:",{error:f,constraints:b}),f}).then(function(f){return l.info("Re-acquired the MediaStreamTrack"),l.debug("MediaStreamTrack:",f),y._constraints=Object.assign({},b),y._setMediaStreamTrack(f)})},T.prototype._setMediaStreamTrack=function(b){var y=this;return b.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then(function(){y._unprocessedTrack=b}):this._trackSender.setMediaStreamTrack(b).catch(function(l){y._log.warn("setMediaStreamTrack failed:",{error:l,mediaStreamTrack:b})})).then(function(){y._initialize(),y._getAllAttachedElements().forEach(function(l){return y._attach(l)})})},T.prototype._stop=function(){return this.mediaStreamTrack.stop(),this._end(),this},T.prototype.enable=function(b){return b=typeof b=="boolean"?b:!0,b!==this.mediaStreamTrack.enabled&&(this._log.info((b?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=b,this.emit(b?"enabled":"disabled",this)),this},T.prototype.disable=function(){return this.enable(!1)},T.prototype.restart=function(b){var y=this,l=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(n("restart","can only be called on a"+(" Local"+i(l)+"Track that is created using createLocalTracks")+(" or createLocal"+i(l)+"Track.")));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var f=this._restart(b);return this._workaroundWebKitBug1208516&&(f=f.finally(function(){y._workaroundWebKitBug1208516Cleanup=h(y)})),f},T.prototype.stop=function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()},T}(S)}function h(S){var R=S._log,T=S.kind,b=S._noiseCancellation,y={audio:a,video:c}[T],l=function(){return b?b.sourceTrack:S.mediaStreamTrack},f=S._dummyEl,m=l(),C=null;function P(){return f.play().then(function(){return y(f)}).then(function(B){return B?R.warn("Silence detected"):R.info("Non-silence detected"),B}).catch(function(B){R.warn("Failed to detect silence:",B)}).finally(function(){S.processedTrack||f.pause()})}function M(){var B=S._workaroundWebKitBug1208516Cleanup,G=S.isStopped,F=G&&!!B,N=l().muted;return Promise.resolve().then(function(){return document.visibilityState==="visible"&&!C&&(N||F||P())})}function I(){return Promise.race([t(m,"unmute"),r(50)]).then(function(){return M()}).then(function(B){B&&!C&&(C=e(),S._restart().finally(function(){f=S._dummyEl,E(),m=l(),x(),C.resolve(),C=null}).catch(function(F){R.error("failed to restart track: ",F)}));var G=C&&C.promise||Promise.resolve();return G.finally(function(){return d.resolveDeferred(T)})}).catch(function(B){R.error("error in maybeRestart: "+B.message)})}function O(){var B=S._log,G=S.kind;B.info("Muted"),B.debug("LocalMediaTrack:",S),d.startDeferred(G)}function x(){m.addEventListener?(m.addEventListener("ended",I),m.addEventListener("mute",O),m.addEventListener("unmute",I)):(m.onended=I,m.onmute=O,m.onunmute=I)}function E(){m.removeEventListener?(m.removeEventListener("ended",I),m.removeEventListener("mute",O),m.removeEventListener("unmute",I)):(m.onended=null,m.onmute=null,m.onunmute=null)}var q=function(B){return B?I():!1};return s.onVisibilityChange(1,q),x(),function(){s.offVisibilityChange(1,q),E()}}return Kt=g,Kt}var zt,xa;function yu(){if(xa)return zt;xa=1;var k=zt&&zt.__extends||function(){var n=function(a,c){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,d){s.__proto__=d}||function(s,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(s[v]=d[v])},n(a,c)};return function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");n(a,c);function s(){this.constructor=a}a.prototype=c===null?Object.create(c):(s.prototype=c.prototype,new s)}}(),p=Rt().isIOS,_=us(),o=qe().isIOSChrome,i=fs(),e=gs(),r=e(i),t=function(n){k(a,n);function a(c,s){var d=this,v=s?.noiseCancellation||null;d=n.call(this,c,s)||this;var u=d._log,g=c.label,h=g===void 0?"":g,S=c.getSettings(),R=S.deviceId,T=R===void 0?"":R,b=S.groupId,y=b===void 0?"":b;return Object.defineProperties(d,{_currentDefaultDeviceInfo:{value:{deviceId:T,groupId:y,label:h},writable:!0},_enumerateDevices:{value:typeof s?.enumerateDevices=="function"?s.enumerateDevices:navigator.mediaDevices.enumerateDevices},_defaultDeviceCaptureMode:{value:(!p()||v)&&d._isCreatedByCreateLocalTracks&&typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.addEventListener=="function"&&(typeof s?.enumerateDevices=="function"||typeof navigator.mediaDevices.enumerateDevices=="function")?s?.defaultDeviceCaptureMode||"auto":"manual"},_onDeviceChange:{value:function(){d._enumerateDevices().then(function(l){var f=l.find(function(m){var C=m.deviceId,P=m.kind;return P==="audioinput"&&C!=="default"});f&&["deviceId","groupId"].some(function(m){return f[m]!==d._currentDefaultDeviceInfo[m]})&&(u.info("Default device changed, restarting the LocalAudioTrack"),u.debug('Old default device: "'+d._currentDefaultDeviceInfo.deviceId+'" => "'+d._currentDefaultDeviceInfo.label+'"'),u.debug('New default device: "'+f.deviceId+'" => "'+f.label+'"'),d._currentDefaultDeviceInfo=f,d._restartDefaultDevice().catch(function(m){return u.warn("Failed to restart: "+m.message)}))},function(l){u.warn("Failed to run enumerateDevices(): "+l.message)})}},_restartOnDefaultDeviceChangeCleanup:{value:null,writable:!0},noiseCancellation:{enumerable:!0,value:v,writable:!1}}),u.debug("defaultDeviceCaptureMode:",d._defaultDeviceCaptureMode),d._maybeRestartOnDefaultDeviceChange(),d}return a.prototype.toString=function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"},a.prototype.attach=function(c){return c=n.prototype.attach.call(this,c),c.muted=!0,c},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._maybeRestartOnDefaultDeviceChange=function(){var c=this,s=this,d=s._constraints,v=s._defaultDeviceCaptureMode,u=s._log,g=this.noiseCancellation?this.noiseCancellation.sourceTrack:this.mediaStreamTrack,h=g.getSettings().deviceId,S=function(T){return T!==h||T==="default"},R=function T(b){return b===void 0&&(b={}),typeof b=="string"?S(b):Array.isArray(b)?b.every(S):b.exact?T(b.exact):b.ideal?T(b.ideal):!0}(d.deviceId);v==="auto"&&R?this._restartOnDefaultDeviceChangeCleanup||(u.info("LocalAudioTrack will be restarted if the default device changes"),navigator.mediaDevices.addEventListener("devicechange",this._onDeviceChange),this._restartOnDefaultDeviceChangeCleanup=function(){u.info("Cleaning up the listener to restart the LocalAudioTrack if the default device changes"),navigator.mediaDevices.removeEventListener("devicechange",c._onDeviceChange),c._restartOnDefaultDeviceChangeCleanup=null}):(u.info("LocalAudioTrack will NOT be restarted if the default device changes"),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup())},a.prototype._reacquireTrack=function(c){var s=this;return this._log.debug("_reacquireTrack: ",c),this.noiseCancellation?this.noiseCancellation.reacquireTrack(function(){return n.prototype._reacquireTrack.call(s,c)}):n.prototype._reacquireTrack.call(this,c)},a.prototype._restartDefaultDevice=function(){var c=this,s=Object.assign({},this._constraints),d=Object.assign({},s,{deviceId:this._currentDefaultDeviceInfo.deviceId});return this.restart(d).then(function(){c._constraints=s,c._maybeRestartOnDefaultDeviceChange()})},a.prototype._setMediaStreamTrack=function(c){var s=this,d=this,v=d._log,u=d.noiseCancellation,g=n.prototype._setMediaStreamTrack.call(this,c);return o()&&u&&(v.debug("iOS Chrome detected, checking if the restarted Krisp audio is silent"),g=g.then(function(){return _(s._dummyEl)}).then(function(h){return v.debug("Krisp audio is "+(h?"silent, using source audio":"not silent")),h&&u.disablePermanently().then(function(){return n.prototype._setMediaStreamTrack.call(s,u.sourceTrack)})})),g},a.prototype.disable=function(){return n.prototype.disable.apply(this,arguments)},a.prototype.enable=function(){return n.prototype.enable.apply(this,arguments)},a.prototype.restart=function(){return n.prototype.restart.apply(this,arguments)},a.prototype.stop=function(){return this.noiseCancellation&&this.noiseCancellation.stop(),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup(),n.prototype.stop.apply(this,arguments)},a}(r);return zt=t,zt}var Hn,Aa;function gu(){if(Aa)return Hn;Aa=1;var k=Ri(),p=yu();function _(o,i){var e=new p(o,i);return Object.setPrototypeOf(e,_.prototype),e}return k(_,p),Hn=_,Hn}var Yt,Ma;function bu(){if(Ma)return Yt;Ma=1;var k=Yt&&Yt.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],c;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(s){c={error:s}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(c)throw c.error}}return a},p=Ce().DEFAULT_FRAME_RATE;function _(i,e){var r=k(i.srcObject.getVideoTracks(),1),t=r[0],n=t.getSettings().frameRate,a=n===void 0?p:n,c,s=new ReadableStream({start:function(v){c=setInterval(function(){return v.enqueue()},1e3/a)}}),d=new TransformStream({transform:function(){return e()}});return s.pipeThrough(d).pipeTo(new WritableStream).then(function(){}),function(){clearInterval(c)}}function o(i,e,r){var t=k(i.srcObject.getVideoTracks(),1),n=t[0],a=new MediaStreamTrackProcessor({track:n}).readable,c=new MediaStreamTrackGenerator({kind:"video"}),s=!1,d=new TransformStream({transform:function(v,u){var g=r==="videoframe"?e(v):Promise.resolve(v.close()).then(e);return g.finally(function(){s&&u.terminate()})}});return a.pipeThrough(d).pipeTo(c.writable).then(function(){}),function(){s=!0}}return Yt=typeof MediaStreamTrackGenerator=="function"&&typeof MediaStreamTrackProcessor=="function"?o:_,Yt}var Jt,Ia;function ku(){if(Ia)return Jt;Ia=1;var k=Jt&&Jt.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Ue().EventEmitter,_=Ce().DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,o=function(i){k(e,i);function e(r){var t=i.call(this)||this;return Object.defineProperties(t,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:r},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),t.on("add",function(n){t._lastStatsSaveTime=Date.now(),t._lastStatsPublishTime=Date.now(),t._processorInfo=n,t._stats=[],t._reemitEvent("add",t._getEventData())}),t.on("remove",function(){var n=t._getEventData();t._lastStatsSaveTime=null,t._lastStatsPublishTime=null,t._processorInfo=null,t._stats=null,t._reemitEvent("remove",n)}),t.on("start",function(){t._reemitEvent("start",t._getEventData())}),t.on("stop",function(n){t._reemitEvent("stop",Object.assign({message:n},t._getEventData()))}),t.on("stats",function(){return t._maybeEmitStats()}),t}return e.prototype._getEventData=function(){if(!this._processorInfo)return{};var r=this._processorInfo,t=r.processor,n=r.captureHeight,a=r.captureWidth,c=r.inputFrameRate,s=r.isRemoteVideoTrack,d=r.inputFrameBufferType,v=r.outputFrameBufferContextType,u={captureHeight:n,captureWidth:a,inputFrameRate:c,isRemoteVideoTrack:s,inputFrameBufferType:d,outputFrameBufferContextType:v};return u.name=t._name||"VideoProcessor",["assetsPath","blurFilterRadius","debounce","fitType","isSimdEnabled","maskBlurRadius","pipeline","version"].forEach(function(g){var h=t["_"+g];typeof h<"u"&&(u[g]=h)}),Object.keys(u).forEach(function(g){var h=u[g];typeof h=="boolean"&&(u[g]=h?"true":"false")}),u},e.prototype._maybeEmitStats=function(){if(!(!this._stats||!this._processorInfo)){var r=this._processorInfo.processor._benchmark;if(r){var t=Date.now();if(!(t-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:r.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach(function(s){n[s]=r.getAverageDelay(s)}),this._lastStatsSaveTime=t,this._stats.push(n),!(t-this._lastStatsPublishTime<_)){this._lastStatsPublishTime=t;var a=this._stats.splice(0),c=a.reduce(function(s,d,v){return Object.keys(n).forEach(function(u){s[u]||(s[u]=0),s[u]=(s[u]*v+d[u])/(v+1)}),s},{});Object.keys(c).forEach(function(s){c[s]=parseFloat(c[s].toFixed(2))}),this._reemitEvent("stats",Object.assign({},c,this._getEventData()))}}}}},e.prototype._reemitEvent=function(r,t){this._log.debug("VideoProcessor:"+r,t),this.emit("event",{name:r,data:t})},e}(p);return Jt=o,Jt}var Xt,Da;function bs(){if(Da)return Xt;Da=1;var k=Xt&&Xt.__extends||function(){var t=function(n,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,s){c.__proto__=s}||function(c,s){for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(c[d]=s[d])},t(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");t(n,a);function c(){this.constructor=n}n.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}(),p=ds(),_=bu(),o=ku();qe().guessBrowser;var i=Ce().DEFAULT_FRAME_RATE,e=function(t){k(n,t);function n(a,c){var s=t.call(this,a,c)||this;return Object.defineProperties(s,{_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_processorOptions:{value:{},writable:!0},_stopCapture:{value:function(){},writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0}}),s._processorEventObserver=new(c.VideoProcessorEventObserver||o)(s._log),s}return n.prototype._checkIfCanCaptureFrames=function(a){a===void 0&&(a=!1);var c=!0,s="",d=this.mediaStreamTrack,v=d.enabled,u=d.readyState;return v||(c=!1,s="MediaStreamTrack is disabled"),u==="ended"&&(c=!1,s="MediaStreamTrack is ended"),this.processor||(c=!1,s="VideoProcessor not detected."),!this._attachments.size&&!a&&(c=!1,s="VideoTrack is not publishing and there is no attached element."),s&&this._log.debug(s),{canCaptureFrames:c,message:s}},n.prototype._captureFrames=function(){var a=this;if(this._isCapturing){this._log.debug("Ignoring captureFrames call. Capture is already in progress");return}if(!this._checkIfCanCaptureFrames().canCaptureFrames){this._isCapturing=!1,this._log.debug("Cannot capture frames. Ignoring captureFrames call.");return}this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var c=this._processorOptions.inputFrameBufferType;this._dummyEl.play().then(function(){var s=function(d){var v=a._checkIfCanCaptureFrames();if(!v.canCaptureFrames)return d&&d.close(),a._isCapturing=!1,a._stopCapture(),a._processorEventObserver.emit("stop",v.message),a._log.debug("Cannot capture frames. Stopping capturing frames."),Promise.resolve();var u=a.mediaStreamTrack.getSettings(),g=u.width,h=g===void 0?0:g,S=u.height,R=S===void 0?0:S;a._outputFrame&&a._outputFrame.width!==h&&(a._outputFrame.width=h,a._outputFrame.height=R),a._inputFrame&&(a._inputFrame.width!==h&&(a._inputFrame.width=h,a._inputFrame.height=R),a._inputFrame.getContext("2d").drawImage(a._dummyEl,0,0,h,R));var T=d||(["video","videoframe"].includes(c)?a._dummyEl:a._inputFrame),b=null;try{b=a.processor.processFrame(T,a._outputFrame)}catch(y){a._log.debug("Exception detected after calling processFrame.",y)}return(b instanceof Promise?b:Promise.resolve(b)).then(function(){a._outputFrame&&(typeof a.processedTrack.requestFrame=="function"&&a.processedTrack.requestFrame(),a._processorEventObserver.emit("stats"))})};a._stopCapture=_(a._dummyEl,s,c)}).catch(function(s){return a._log.error("Video element cannot be played",{error:s,track:a})})},n.prototype._initialize=function(){var a=this;t.prototype._initialize.call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){r(a,a._dummyEl)&&(a.dimensions.width=a._dummyEl.videoWidth,a.dimensions.height=a._dummyEl.videoHeight)},this._dummyEl.onresize=function(){r(a,a._dummyEl)&&(a.dimensions.width=a._dummyEl.videoWidth,a.dimensions.height=a._dummyEl.videoHeight,a.isStarted&&(a._log.debug("Dimensions changed:",a.dimensions),a.emit(n.DIMENSIONS_CHANGED,a)))})},n.prototype._restartProcessor=function(){var a=this.processor;if(a){var c=Object.assign({},this._processorOptions);this.removeProcessor(a),this.addProcessor(a,c)}},n.prototype._start=function(a){return this.dimensions.width=a.videoWidth,this.dimensions.height=a.videoHeight,this._log.debug("Dimensions:",this.dimensions),this.emit(n.DIMENSIONS_CHANGED,this),t.prototype._start.call(this,a)},n.prototype.addProcessor=function(a,c){var s=this;if(!a||typeof a.processFrame!="function")throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",a),this._unmuteHandler||(this._unmuteHandler=function(){s._log.debug("mediaStreamTrack unmuted"),s.processedTrack.muted&&(s._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),s._restartProcessor())},this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler):this.mediaStreamTrack.onunmute=this._unmuteHandler.bind(this)),this._processorOptions=c||{};var d=this._processorOptions,v=d.inputFrameBufferType,u=d.outputFrameBufferContextType;if(typeof OffscreenCanvas>"u"&&v==="offscreencanvas")throw new Error("OffscreenCanvas is not supported by this browser.");if(v&&v!=="videoframe"&&v!=="video"&&v!=="canvas"&&v!=="offscreencanvas")throw new Error("Invalid inputFrameBufferType of "+v);v||(v=typeof OffscreenCanvas>"u"?"canvas":"offscreencanvas");var g=this.mediaStreamTrack.getSettings(),h=g.width,S=h===void 0?0:h,R=g.height,T=R===void 0?0:R,b=g.frameRate,y=b===void 0?i:b;v==="offscreencanvas"&&(this._inputFrame=new OffscreenCanvas(S,T)),v==="canvas"&&(this._inputFrame=document.createElement("canvas")),this._inputFrame&&(this._inputFrame.width=S,this._inputFrame.height=T),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=S,this._outputFrame.height=T,u=u||"2d";var l=this._outputFrame.getContext(u);if(!l)throw new Error("Cannot get outputFrameBufferContextType: "+u+".");var f=typeof CanvasCaptureMediaStreamTrack<"u"&&CanvasCaptureMediaStreamTrack.prototype&&typeof CanvasCaptureMediaStreamTrack.prototype.requestFrame=="function"?0:void 0;return this.processedTrack=this._outputFrame.captureStream(f).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=a,this._processorEventObserver.emit("add",{processor:a,captureHeight:T,captureWidth:S,inputFrameRate:y,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack"),inputFrameBufferType:v,outputFrameBufferContextType:u}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this},n.prototype.attach=function(){var a=t.prototype.attach.apply(this,arguments);return this.processor&&this._captureFrames(),a},n.prototype.detach=function(){return t.prototype.detach.apply(this,arguments)},n.prototype.removeProcessor=function(a){if(!a)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(a!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",a),this._stopCapture(),this._stopCapture=function(){},this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._processorOptions={},this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this},n}(p);e.DIMENSIONS_CHANGED="dimensionsChanged";function r(t,n){return t.dimensions.width!==n.videoWidth||t.dimensions.height!==n.videoHeight}return Xt=e,Xt}var Zt,ja;function Su(){if(ja)return Zt;ja=1;var k=Zt&&Zt.__extends||function(){var n=function(a,c){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,d){s.__proto__=d}||function(s,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(s[v]=d[v])},n(a,c)};return function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");n(a,c);function s(){this.constructor=a}a.prototype=c===null?Object.create(c):(s.prototype=c.prototype,new s)}}(),p=Rt().isIOS,_=vs(),o=gs(),i=bs(),e=o(i),r=function(n){k(a,n);function a(c,s){var d=this;return s=Object.assign({workaroundSilentLocalVideo:p()&&typeof document<"u"&&typeof document.createElement=="function"},s),d=n.call(this,c,s)||this,Object.defineProperties(d,{_workaroundSilentLocalVideo:{value:s.workaroundSilentLocalVideo?t:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0}}),d._workaroundSilentLocalVideo&&(d._workaroundSilentLocalVideoCleanup=d._workaroundSilentLocalVideo(d,document)),d}return a.prototype.toString=function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"},a.prototype._checkIfCanCaptureFrames=function(){return n.prototype._checkIfCanCaptureFrames.call(this,this._trackSender.isPublishing)},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._setSenderMediaStreamTrack=function(c){var s=this,d=this.mediaStreamTrack,v=c?this.processedTrack:d;return this._trackSender.setMediaStreamTrack(v).catch(function(u){return s._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:u,mediaStreamTrack:v})}).then(function(){s._unprocessedTrack=c?d:null})},a.prototype.addProcessor=function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var c=n.prototype.addProcessor.apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),c):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")},a.prototype.removeProcessor=function(){var c=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var s=n.prototype.removeProcessor.apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then(function(){return c._updateElementsMediaStreamTrack()}),s},a.prototype.disable=function(){var c=n.prototype.disable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),c},a.prototype.enable=function(c){c===void 0&&(c=!0);var s=n.prototype.enable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=c,c&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),s},a.prototype.restart=function(){var c=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var s=n.prototype.restart.apply(this,arguments);return this.processor&&s.then(function(){c._restartProcessor()}),this._workaroundSilentLocalVideo&&s.finally(function(){c._workaroundSilentLocalVideoCleanup=c._workaroundSilentLocalVideo(c,document)}),s},a.prototype.stop=function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),n.prototype.stop.apply(this,arguments)},a}(e);function t(n,a){var c=n._log,s=n._dummyEl,d=n.mediaStreamTrack;function v(){n.isEnabled&&(c.info("Unmuted, checking silence"),s.play().then(function(){return _(s,a)}).then(function(u){if(!u){c.info("Non-silent frames detected, so no need to restart");return}return c.warn("Silence detected, restarting"),n._stop(),n._restart()}).catch(function(u){c.warn("Failed to detect silence and restart:",u)}).finally(function(){s=n._dummyEl,s&&!s.paused&&!n.processedTrack&&s.pause(),d.removeEventListener("unmute",v),d=n.mediaStreamTrack,d.addEventListener?d.addEventListener("unmute",v):d.onunmute=v}))}return d.addEventListener?d.addEventListener("unmute",v):d.onunmute=v,function(){d.removeEventListener?d.removeEventListener("unmute",v):d.onunmute=null}}return Zt=r,Zt}var Gn,Na;function Tu(){if(Na)return Gn;Na=1;var k=Ri(),p=Su();function _(o,i){var e=new p(o,i);return Object.setPrototypeOf(e,_.prototype),e}return k(_,p),Gn=_,Gn}var er,qa;function ks(){if(qa)return er;qa=1;var k=er&&er.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=_s(),_=function(o){k(i,o);function i(e,r,t,n){var a=o.call(this,e,"data")||this;return Object.defineProperties(a,{maxPacketLifeTime:{enumerable:!0,value:r},maxRetransmits:{enumerable:!0,value:t},ordered:{enumerable:!0,value:n}}),a}return i}(p);return er=_,er}var tr,Va;function wu(){if(Va)return tr;Va=1;var k=tr&&tr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=ks(),_=Pe().makeUUID,o=function(i){k(e,i);function e(r,t,n){var a=i.call(this,_(),r,t,n)||this;return Object.defineProperties(a,{_clones:{value:new Set},_dataChannels:{value:new Set}}),a}return e.prototype._addClone=function(r){this._clones.add(r)},e.prototype.removeClone=function(r){this._clones.delete(r)},e.prototype.addDataChannel=function(r){return this._dataChannels.add(r),this},e.prototype.clone=function(){var r=this,t=new e(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(t),t.once("stopped",function(){return r.removeClone(t)}),t},e.prototype.removeDataChannel=function(r){return this._dataChannels.delete(r),this},e.prototype.send=function(r){return this._dataChannels.forEach(function(t){try{t.send(r)}catch{}}),this._clones.forEach(function(t){try{t.send(r)}catch{}}),this},e.prototype.stop=function(){this._dataChannels.forEach(function(r){return r.close()}),this._clones.forEach(function(r){return r.stop()}),i.prototype.stop.call(this)},e}(p);return tr=o,tr}var rr,Fa;function Eu(){if(Fa)return rr;Fa=1;var k=rr&&rr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Li(),_=wu(),o=function(i){k(e,i);function e(r){var t=this;r=Object.assign({DataTrackSender:_,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},r);var n=r.DataTrackSender,a=new n(r.maxPacketLifeTime,r.maxRetransmits,r.ordered);return t=i.call(this,a.id,"data",r)||this,Object.defineProperties(t,{_trackSender:{value:a},id:{enumerable:!0,value:a.id},maxPacketLifeTime:{enumerable:!0,value:r.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:r.maxRetransmits},ordered:{enumerable:!0,value:r.ordered},reliable:{enumerable:!0,value:r.maxPacketLifeTime===null&&r.maxRetransmits===null}}),t}return e.prototype.send=function(r){this._trackSender.send(r)},e}(p);return rr=o,rr}var Qn,Ba;function Pu(){if(Ba)return Qn;Ba=1;var k=Ri(),p=Eu();function _(o){var i=new p(o);return Object.setPrototypeOf(i,_.prototype),i}return k(_,p),Qn=_,Qn}var $n,Ua;function It(){return Ua||(Ua=1,$n={LocalAudioTrack:gu(),LocalVideoTrack:Tu(),LocalDataTrack:Pu()}),$n}var Wa;function Cu(){if(Wa)return Fe;Wa=1;var k=Fe&&Fe.__assign||function(){return k=Object.assign||function(l){for(var f,m=1,C=arguments.length;m<C;m++){f=arguments[m];for(var P in f)Object.prototype.hasOwnProperty.call(f,P)&&(l[P]=f[P])}return l},k.apply(this,arguments)},p=Fe&&Fe.__awaiter||function(l,f,m,C){function P(M){return M instanceof m?M:new m(function(I){I(M)})}return new(m||(m=Promise))(function(M,I){function O(q){try{E(C.next(q))}catch(B){I(B)}}function x(q){try{E(C.throw(q))}catch(B){I(B)}}function E(q){q.done?M(q.value):P(q.value).then(O,x)}E((C=C.apply(l,f||[])).next())})},_=Fe&&Fe.__generator||function(l,f){var m={label:0,sent:function(){if(M[0]&1)throw M[1];return M[1]},trys:[],ops:[]},C,P,M,I;return I={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function O(E){return function(q){return x([E,q])}}function x(E){if(C)throw new TypeError("Generator is already executing.");for(;m;)try{if(C=1,P&&(M=E[0]&2?P.return:E[0]?P.throw||((M=P.return)&&M.call(P),0):P.next)&&!(M=M.call(P,E[1])).done)return M;switch(P=0,M&&(E=[E[0]&2,M.value]),E[0]){case 0:case 1:M=E;break;case 4:return m.label++,{value:E[1],done:!1};case 5:m.label++,P=E[1],E=[0];continue;case 7:E=m.ops.pop(),m.trys.pop();continue;default:if(M=m.trys,!(M=M.length>0&&M[M.length-1])&&(E[0]===6||E[0]===2)){m=0;continue}if(E[0]===3&&(!M||E[1]>M[0]&&E[1]<M[3])){m.label=E[1];break}if(E[0]===6&&m.label<M[1]){m.label=M[1],M=E;break}if(M&&m.label<M[2]){m.label=M[2],m.ops.push(E);break}M[2]&&m.ops.pop(),m.trys.pop();continue}E=f.call(l,m)}catch(q){E=[6,q],P=0}finally{C=M=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},o=Fe&&Fe.__read||function(l,f){var m=typeof Symbol=="function"&&l[Symbol.iterator];if(!m)return l;var C=m.call(l),P,M=[],I;try{for(;(f===void 0||f-- >0)&&!(P=C.next()).done;)M.push(P.value)}catch(O){I={error:O}}finally{try{P&&!P.done&&(m=C.return)&&m.call(C)}finally{if(I)throw I.error}}return M},i=Fe&&Fe.__spreadArray||function(l,f){for(var m=0,C=f.length,P=l.length;m<C;m++,P++)l[P]=f[m];return l};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.createLocalTracks=void 0;var e=cu(),r=Pe().buildLogLevels,t=Ot(),n=t.getUserMedia,a=t.MediaStreamTrack,c=It(),s=c.LocalAudioTrack,d=c.LocalDataTrack,v=c.LocalVideoTrack,u=ze(),g=Ce(),h=g.DEFAULT_LOG_LEVEL,S=g.DEFAULT_LOGGER_NAME,R=g.typeErrors.INVALID_VALUE,T=ps(),b=0;function y(l){return p(this,void 0,void 0,function(){var f,m,C,P,M,I,O,x,E,q,B,G,F,N=this;return _(this,function(A){switch(A.label){case 0:if(f=!(l&&("audio"in l||"video"in l)),m=k({audio:f,getUserMedia:n,loggerName:S,logLevel:h,LocalAudioTrack:s,LocalDataTrack:d,LocalVideoTrack:v,MediaStreamTrack:a,Log:u,video:f},l),C="[createLocalTracks #"+ ++b+"]",P=r(m.logLevel),M=new m.Log("default",C,P,m.loggerName),I=Object.assign({log:M},m),delete I.name,m.audio===!1&&m.video===!1)return M.info("Neither audio nor video requested, so returning empty LocalTracks"),[2,[]];if(m.tracks)return M.info("Adding user-provided LocalTracks"),M.debug("LocalTracks:",m.tracks),[2,m.tracks];if(O={audio:typeof m.audio=="object"&&m.audio.name?{name:m.audio.name}:{defaultDeviceCaptureMode:"auto"},video:typeof m.video=="object"&&m.video.name?{name:m.video.name}:{}},O.audio.isCreatedByCreateLocalTracks=!0,O.video.isCreatedByCreateLocalTracks=!0,typeof m.audio=="object")if(typeof m.audio.workaroundWebKitBug1208516=="boolean"&&(O.audio.workaroundWebKitBug1208516=m.audio.workaroundWebKitBug1208516),"noiseCancellationOptions"in m.audio&&(x=m.audio.noiseCancellationOptions,delete m.audio.noiseCancellationOptions),!("defaultDeviceCaptureMode"in m.audio))O.audio.defaultDeviceCaptureMode="auto";else{if(["auto","manual"].every(function(w){return w!==m.audio.defaultDeviceCaptureMode}))throw R("CreateLocalAudioTrackOptions.defaultDeviceCaptureMode",["auto","manual"]);O.audio.defaultDeviceCaptureMode=m.audio.defaultDeviceCaptureMode}typeof m.video=="object"&&typeof m.video.workaroundWebKitBug1208516=="boolean"&&(O.video.workaroundWebKitBug1208516=m.video.workaroundWebKitBug1208516),typeof m.audio=="object"&&delete m.audio.name,typeof m.video=="object"&&delete m.video.name,E={audio:m.audio,video:m.video},q=typeof m.audio=="object"&&m.audio.workaroundWebKitBug180748,A.label=1;case 1:return A.trys.push([1,4,,5]),[4,q?T(M,m.getUserMedia,E):m.getUserMedia(E)];case 2:return B=A.sent(),G=i(i([],o(B.getAudioTracks())),o(B.getVideoTracks())),M.info("Call to getUserMedia successful; got tracks:",G),[4,Promise.all(G.map(function(w){return p(N,void 0,void 0,function(){var j,Q,Y;return _(this,function($){switch($.label){case 0:return w.kind==="audio"&&x?[4,e.applyNoiseCancellation(w,x,M)]:[3,2];case 1:return j=$.sent(),Q=j.cleanTrack,Y=j.noiseCancellation,[2,new I.LocalAudioTrack(Q,k(k(k({},O.audio),I),{noiseCancellation:Y}))];case 2:if(w.kind==="audio")return[2,new I.LocalAudioTrack(w,k(k({},O.audio),I))];$.label=3;case 3:return[2,new I.LocalVideoTrack(w,k(k({},O.video),I))]}})})}))];case 3:return[2,A.sent()];case 4:throw F=A.sent(),M.warn("Call to getUserMedia failed:",F),F;case 5:return[2]}})})}return Fe.createLocalTracks=y,Fe}var Be={},nr={},Ha;function Ou(){if(Ha)return nr;Ha=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.Timer=void 0;var k=function(){function p(){this._end=void 0,this.start()}return p.prototype.start=function(){return this._start=Date.now(),this},p.prototype.stop=function(){return this._end=Date.now(),this},p.prototype.getTimeMeasurement=function(){return{start:this._start,end:this._end,duration:this._end===void 0?void 0:this._end-this._start}},p}();return nr.Timer=k,nr}var kt={},Ga;function Ru(){if(Ga)return kt;Ga=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.mosToScore=kt.calculateMOS=void 0;var k=94.768;function p(o,i,e){var r=o+i*2+10,t=0;switch(!0){case r<160:t=k-r/40;break;case r<1e3:t=k-(r-120)/10;break}switch(!0){case e<=t/2.5:t=Math.max(t-e*2.5,6.52);break;default:t=0;break}var n=1+.035*t+7e-6*t*(t-60)*(100-t);return n}kt.calculateMOS=p;function _(o){var i=0;return o?o>4.2?i=5:o>4?i=4:o>3.6?i=3:o>3?i=2:i=1:i=0,i}return kt.mosToScore=_,kt}var Ke={},Qa;function Lu(){if(Qa)return Ke;Qa=1;var k=Ke&&Ke.__awaiter||function(t,n,a,c){function s(d){return d instanceof a?d:new a(function(v){v(d)})}return new(a||(a=Promise))(function(d,v){function u(S){try{h(c.next(S))}catch(R){v(R)}}function g(S){try{h(c.throw(S))}catch(R){v(R)}}function h(S){S.done?d(S.value):s(S.value).then(u,g)}h((c=c.apply(t,n||[])).next())})},p=Ke&&Ke.__generator||function(t,n){var a={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},c,s,d,v;return v={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function u(h){return function(S){return g([h,S])}}function g(h){if(c)throw new TypeError("Generator is already executing.");for(;a;)try{if(c=1,s&&(d=h[0]&2?s.return:h[0]?s.throw||((d=s.return)&&d.call(s),0):s.next)&&!(d=d.call(s,h[1])).done)return d;switch(s=0,d&&(h=[h[0]&2,d.value]),h[0]){case 0:case 1:d=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,s=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(d=a.trys,!(d=d.length>0&&d[d.length-1])&&(h[0]===6||h[0]===2)){a=0;continue}if(h[0]===3&&(!d||h[1]>d[0]&&h[1]<d[3])){a.label=h[1];break}if(h[0]===6&&a.label<d[1]){a.label=d[1],d=h;break}if(d&&a.label<d[2]){a.label=d[2],a.ops.push(h);break}d[2]&&a.ops.pop(),a.trys.pop();continue}h=n.call(t,a)}catch(S){h=[6,S],s=0}finally{c=d=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},_=Ke&&Ke.__read||function(t,n){var a=typeof Symbol=="function"&&t[Symbol.iterator];if(!a)return t;var c=a.call(t),s,d=[],v;try{for(;(n===void 0||n-- >0)&&!(s=c.next()).done;)d.push(s.value)}catch(u){v={error:u}}finally{try{s&&!s.done&&(a=c.return)&&a.call(c)}finally{if(v)throw v.error}}return d};Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.getCombinedConnectionStats=void 0;function o(t,n,a,c){var s=[];return t.forEach(function(d){(c.length===0||c.includes(d.type))&&(a.length===0||a.includes(d.kind))&&typeof d[n]=="number"&&s.push(d[n])}),s}function i(t){var n=t.publisher,a=t.subscriber;return k(this,void 0,void 0,function(){var c,s,d,v,u,g,h,S,R,T,b,y,l,f,m;return p(this,function(C){switch(C.label){case 0:return[4,Promise.all([n,a].map(function(P){return P.getStats()}))];case 1:return c=_.apply(void 0,[C.sent(),2]),s=c[0],d=c[1],v=o(d,"timestamp",["audio"],["inbound-rtp"]),u=v.length>0?v[0]:0,g=o(d,"jitter",["audio"],["inbound-rtp"]).reduce(function(P,M){return Math.max(P,M)},0),h=o(d,"packetsReceived",["audio","video"],["inbound-rtp"]).reduce(function(P,M){return P+M},0),S=o(d,"packetsLost",["audio","video"],["inbound-rtp"]).reduce(function(P,M){return P+M},0),R=o(s,"roundTripTime",["audio","video"],["remote-inbound-rtp"]).reduce(function(P,M){return Math.max(P,M)},0),T=o(d,"currentRoundTripTime",[],["candidate-pair"]).reduce(function(P,M){return Math.max(P,M)},0),b=(T||R)*1e3,y=o(s,"bytesSent",[],["candidate-pair"]).reduce(function(P,M){return P+M},0),l=o(d,"bytesReceived",[],["candidate-pair"]).reduce(function(P,M){return P+M},0),f=r(d),m=[],d.forEach(function(P){(P.type==="local-candidate"||P.type==="remote-candidate")&&m.push(e(P))}),[2,{timestamp:u,jitter:g,packets:h,packetsLost:S,roundTripTime:b,bytesSent:y,bytesReceived:l,selectedIceCandidatePairStats:f,iceCandidateStats:m}]}})})}Ke.getCombinedConnectionStats=i;function e(t){var n=[{key:"transportId",type:"string"},{key:"candidateType",type:"string"},{key:"port",altKeys:["portNumber"],type:"number"},{key:"address",altKeys:["ip","ipAddress"],type:"string"},{key:"priority",type:"number"},{key:"protocol",altKeys:["transport"],type:"string"},{key:"url",type:"string"},{key:"relayProtocol",type:"string"}];return n.reduce(function(a,c){var s=[c.key];c.altKeys&&(s=s.concat(c.altKeys));var d=s.find(function(v){return v in t});return d&&typeof t[d]===c.type&&(a[c.key]=t[d]),a},{})}function r(t){var n=null,a=[];t.forEach(function(u){u.type==="transport"&&u.selectedCandidatePairId?n=u.selectedCandidatePairId:u.type==="candidate-pair"&&a.push(u)});var c=a.find(function(u){return u.selected||n&&u.id===n});if(!c)return null;var s=c,d=t.get(s.localCandidateId),v=t.get(s.remoteCandidateId);return!d||!v?null:{localCandidate:e(d),remoteCandidate:e(v)}}return Ke}var ir={},rt,$a;function Dt(){if($a)return rt;$a=1;var k=rt&&rt.__extends||function(){var d=function(v,u){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,h){g.__proto__=h}||function(g,h){for(var S in h)Object.prototype.hasOwnProperty.call(h,S)&&(g[S]=h[S])},d(v,u)};return function(v,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");d(v,u);function g(){this.constructor=v}v.prototype=u===null?Object.create(u):(g.prototype=u.prototype,new g)}}(),p=rt&&rt.__read||function(d,v){var u=typeof Symbol=="function"&&d[Symbol.iterator];if(!u)return d;var g=u.call(d),h,S=[],R;try{for(;(v===void 0||v-- >0)&&!(h=g.next()).done;)S.push(h.value)}catch(T){R={error:T}}finally{try{h&&!h.done&&(u=g.return)&&u.call(g)}finally{if(R)throw R.error}}return S},_=rt&&rt.__spreadArray||function(d,v){for(var u=0,g=v.length,h=d.length;u<g;u++,h++)d[h]=v[u];return d},o=Ue().EventEmitter,i=Pe(),e=function(d){k(v,d);function v(u,g){var h=d.call(this)||this,S=null,R=u;return g=c(g),Object.defineProperties(h,{_lock:{get:function(){return S},set:function(T){S=T}},_reachableStates:{value:n(g)},_state:{get:function(){return R},set:function(T){R=T}},_states:{value:g},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return S!==null}},state:{enumerable:!0,get:function(){return R}}}),h.on("stateChanged",function(T){h._whenDeferreds.forEach(function(b){b.when(T,b.resolve,b.reject)})}),h}return v.prototype._whenPromise=function(u){var g=this;if(typeof u!="function")return Promise.reject(new Error("when() executor must be a function"));var h=i.defer();return h.when=u,this._whenDeferreds.add(h),h.promise.then(function(S){return g._whenDeferreds.delete(h),S},function(S){throw g._whenDeferreds.delete(h),S})},v.prototype.bracket=function(u,g){var h,S=this;function R(T){if(S.hasLock(h)&&S.releaseLockCompletely(h),T)throw T}return this.takeLock(u).then(function(b){return h=b,g(h)}).then(function(b){return R(),b},R)},v.prototype.hasLock=function(u){return this._lock===u},v.prototype.preempt=function(u,g,h){if(!r(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');var S;this.isLocked&&(S=this._lock,this._lock=null);var R=null;g&&(R=this.takeLockSync(g));var T=R?null:this.takeLockSync("preemption");return this.transition(u,R||T,h),S&&S.resolve(),T&&this.releaseLock(T),R},v.prototype.releaseLock=function(u){if(this.isLocked){if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock")}else throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");u.depth===0?(this._lock=null,u.resolve()):u.depth--},v.prototype.releaseLockCompletely=function(u){if(this.isLocked){if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock")}else throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");u.depth=0,this._lock=null,u.resolve()},v.prototype.takeLock=function(u){var g=this;if(typeof u=="object"){var h=u;return new Promise(function(T){T(g.takeLockSync(h))})}var S=u;if(this.isLocked){var R=this.takeLock.bind(this,S);return this._lock.promise.then(R)}return Promise.resolve(this.takeLockSync(S))},v.prototype.takeLockSync=function(u){var g=typeof u=="string"?null:u,h=g?g.name:u;if(g&&!this.hasLock(g)||!g&&this.isLocked)throw new Error("Could not take the lock for "+h+" because the lock for "+this._lock.name+" was not released");if(g)return g.depth++,g;var S=t(h);return this._lock=S,S},v.prototype.transition=function(u,g,h){if(h=h||[],this.isLocked)if(g){if(!this.hasLock(g))throw new Error("Could not transition using the key for "+g.name+" because "+this._lock.name+" has the lock")}else throw new Error("You must provide the key in order to transition");else if(g)throw new Error("Key provided for "+g.name+", but the StateMachine was not locked (possibly due to preemption)");if(!r(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');this._state=u,this.emit.apply(this,_([],p(["stateChanged",u].concat(h))))},v.prototype.tryTransition=function(u,g,h){try{this.transition(u,g,h)}catch{return!1}return!0},v.prototype.when=function(u){var g=this;return this.state===u?Promise.resolve(this):r(this._reachableStates,this.state,u)?this._whenPromise(function(h,S,R){h===u?S(g):r(g._reachableStates,h,u)||R(s(h,u))}):Promise.reject(s(this.state,u))},v}(o);function r(d,v,u){return d.get(v).has(u)}function t(d){var v=i.defer();return v.name=d,v.depth=0,v}function n(d){return Array.from(d.keys()).reduce(function(v,u){return v.set(u,a(d,u))},new Map)}function a(d,v,u){return u=u||new Set,d.get(v).forEach(function(g){u.has(g)||(u.add(g),a(d,g,u).forEach(u.add,u))}),u}function c(d){var v=new Map;for(var u in d)v.set(u,new Set(d[u]));return v}function s(d,v){return new Error('"'+v+'" cannot be reached from "'+d+'"')}return rt=e,rt}var Kn,Ka;function xu(){if(Ka)return Kn;Ka=1;var k=function(){function p(_,o){var i=this;o=Object.assign({navigator,window},o);var e=o.navigator,r=e.connection||{type:null},t=r.type,n=r.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var d=t!==i.type&&i.isOnline;t=i.type,d&&_()}},_target:{value:r}}:{_events:{value:["online"]},_listener:{value:_},_target:{value:o.window}},a=n._events,c=n._listener,s=n._target;Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return typeof e.onLine=="boolean"?e.onLine:!0}},type:{enumerable:!0,get:function(){return r.type||null}},_listener:c,_events:a,_target:s})}return p.prototype.start=function(){var _=this;this._events.forEach(function(o){_._target.addEventListener(o,_._listener)})},p.prototype.stop=function(){var _=this;this._events.forEach(function(o){_._target.removeEventListener(o,_._listener)})},p}();return Kn=k,Kn}var zn,za;function Lt(){if(za)return zn;za=1;var k=function(){function p(_,o,i){i===void 0&&(i=!0),Object.defineProperties(this,{_delay:{value:o,writable:!0},_fn:{value:_},_timeout:{value:null,writable:!0}}),i&&this.start()}return Object.defineProperty(p.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isSet",{get:function(){return!!this._timeout},enumerable:!1,configurable:!0}),p.prototype.setDelay=function(_){this._delay=_},p.prototype.start=function(){var _=this;this.isSet||(this._timeout=setTimeout(function(){var o=_._fn;_.clear(),o()},this._delay))},p.prototype.clear=function(){clearTimeout(this._timeout),this._timeout=null},p.prototype.reset=function(){this.clear(),this.start()},p}();return zn=k,zn}var Yn,Ya;function Ss(){return Ya||(Ya=1,Yn=WebSocket),Yn}var nt,Ja;function Ts(){if(Ja)return nt;Ja=1;var k=nt&&nt.__extends||function(){var G=function(F,N){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,w){A.__proto__=w}||function(A,w){for(var j in w)Object.prototype.hasOwnProperty.call(w,j)&&(A[j]=w[j])},G(F,N)};return function(F,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");G(F,N);function A(){this.constructor=F}F.prototype=N===null?Object.create(N):(A.prototype=N.prototype,new A)}}(),p=nt&&nt.__read||function(G,F){var N=typeof Symbol=="function"&&G[Symbol.iterator];if(!N)return G;var A=N.call(G),w,j=[],Q;try{for(;(F===void 0||F-- >0)&&!(w=A.next()).done;)j.push(w.value)}catch(Y){Q={error:Y}}finally{try{w&&!w.done&&(N=A.return)&&N.call(A)}finally{if(Q)throw Q.error}}return j},_=nt&&nt.__spreadArray||function(G,F){for(var N=0,A=F.length,w=G.length;N<A;N++,w++)G[w]=F[N];return G},o=Dt(),i=Pe(),e=i.buildLogLevels,r=i.makeUUID,t=ze(),n=xu(),a=Lt(),c=0,s={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},d={closed:"close",open:"open",waiting:"waiting"},v=2,u=3,g=3,h=5e3,S=15e3,R=5e3,T=200,b=1e3,y=3e3,l=3001,f=3002,m=3003,C=3004,P=3005,M=3006,I=3007,O=globalThis,x=O.WebSocket?O.WebSocket:Ss(),E={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},q=new Map([[y,E.TIMEOUT],[l,E.TIMEOUT],[f,E.FAILED],[m,E.FAILED],[C,E.TIMEOUT],[M,E.BUSY],[I,E.TIMEOUT]]),B=function(G){k(F,G);function F(N,A){var w=G.call(this,"early",s)||this;A=Object.assign({helloBody:null,maxConsecutiveFailedHellos:g,maxConsecutiveMissedHeartbeats:u,requestedHeartbeatTimeout:h,openTimeout:S,welcomeTimeout:R,Log:t,WebSocket:x},A);var j=e(A.logLevel),Q=new A.Log("default",w,j,A.loggerName),Y=A.networkMonitor?new n(function(){var K=Y.type,J="Network changed"+(K?" to "+K:"");Q.debug(J),w._close({code:C,reason:J})}):null;Object.defineProperties(w,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:A.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:A.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++c},_log:{value:Q},_messageQueue:{value:[]},_networkMonitor:{value:Y},_options:{value:A},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:N},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var $={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return w.on("stateChanged",function(K){for(var J=[],te=1;te<arguments.length;te++)J[te-1]=arguments[te];K in d&&w.emit.apply(w,_([d[K]],p(J)));var se={name:K,group:"signaling",level:$[w.state]};if(K==="closed"){var oe=p(J,1),ce=oe[0];se.payload={reason:ce},se.level=ce===E.LOCAL?"info":"error"}w._eventObserver.emit("event",se)}),w._eventObserver.emit("event",{name:w.state,group:"signaling",level:$[w.state]}),w._connect(),w}return F.prototype.toString=function(){return"[TwilioConnection #"+this._instanceId+": "+this._ws.url+"]"},F.prototype._close=function(N){var A=N.code,w=N.reason;if(this.state!=="closed"){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&A!==P&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var j=this._log;A===b?(j.debug("Closed"),this.transition("closed",null,[E.LOCAL])):(j.warn("Closed: "+A+" - "+w),A!==P&&this.transition("closed",null,[q.get(A)||E.REMOTE]));var Q=this._ws.readyState,Y=this._options.WebSocket;Q!==Y.CLOSING&&Q!==Y.CLOSED&&this._ws.close(A,w)}},F.prototype._connect=function(){var N=this,A=this._log;if(this.state==="waiting")this.transition("early");else if(this.state!=="early"){A.warn('Unexpected state "'+this.state+'" for connecting to the TCMP server.');return}this._ws=new this._options.WebSocket(this._serverUrl);var w=this._ws;A.debug("Created a new WebSocket:",w),w.addEventListener("close",function(Q){return N._close(Q)});var j=this._options.openTimeout;this._openTimeout=new a(function(){var Q="Failed to open in "+j+" ms";N._close({code:I,reason:Q})},j),w.addEventListener("open",function(){A.debug("WebSocket opened:",w),N._openTimeout.clear(),N._startHandshake(),N._networkMonitor&&N._networkMonitor.start()}),w.addEventListener("message",function(Q){A.debug("Incoming: "+Q.data);try{Q=JSON.parse(Q.data)}catch(Y){N.emit("error",Y);return}switch(Q.type){case"bad":N._handleBad(Q);break;case"busy":N._handleBusy(Q);break;case"bye":break;case"msg":N._handleMessage(Q);case"heartbeat":N._handleHeartbeat();break;case"welcome":N._handleWelcome(Q);break;default:N._log.debug("Unknown message type: "+Q.type),N.emit("error",new Error("Unknown message type: "+Q.type));break}})},F.prototype._handleBad=function(N){var A=N.reason,w=this._log;if(!["connecting","open"].includes(this.state)){w.warn('Unexpected state "'+this.state+'" for handling a "bad" message from the TCMP server.');return}if(this.state==="connecting"){w.warn("Closing: "+f+" - "+A),this._close({code:f,reason:A});return}w.debug("Error: "+A),this.emit("error",new Error(A))},F.prototype._handleBusy=function(N){var A=this,w=N.cookie,j=N.keepAlive,Q=N.retryAfter,Y=this._log;if(!["connecting","waiting"].includes(this.state)){Y.warn('Unexpected state "'+this.state+'" for handling a "busy" message from the TCMP server.');return}this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var $=Q<0?'Received terminal "busy" message':'Received "busy" message, retrying after '+Q+" ms";if(Q<0){Y.warn("Closing: "+M+" - "+$),this._close({code:M,reason:$});return}var K=this._options.maxConsecutiveFailedHellos;this._hellosLeft=K,this._cookie=w||null,j?(Y.warn($),this._busyWaitTimeout=new a(function(){return A._startHandshake()},Q)):(Y.warn("Closing: "+P+" - "+$),this._close({code:P,reason:$}),this._busyWaitTimeout=new a(function(){return A._connect()},Q)),this.transition("waiting",null,[j,Q])},F.prototype._handleHeartbeat=function(){if(this.state!=="open"){this._log.warn('Unexpected state "'+this.state+'" for handling a "heartbeat" message from the TCMP server.');return}this._heartbeatTimeout.reset()},F.prototype._handleHeartbeatTimeout=function(){if(this.state==="open"){var N=this._log,A=this._options.maxConsecutiveMissedHeartbeats;N.debug("Consecutive heartbeats missed: "+A);var w="Missed "+A+' "heartbeat" messages';N.warn("Closing: "+l+" - "+w),this._close({code:l,reason:w})}},F.prototype._handleMessage=function(N){var A=N.body;if(this.state!=="open"){this._log.warn('Unexpected state "'+this.state+'" for handling a "msg" message from the TCMP server.');return}this.emit("message",A)},F.prototype._handleWelcome=function(N){var A=this,w=N.negotiatedTimeout,j=this._log;if(!["connecting","waiting"].includes(this.state)){j.warn('Unexpected state "'+this.state+'" for handling a "welcome" message from the TCMP server.');return}this.state==="waiting"&&(j.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var Q=this._options.maxConsecutiveMissedHeartbeats,Y=w*Q,$=w-T;this._welcomeTimeout.clear(),this._heartbeatTimeout=new a(function(){return A._handleHeartbeatTimeout()},Y),this._messageQueue.splice(0).forEach(function(K){return A._send(K)}),this._sendHeartbeatTimeout=new a(function(){return A._sendHeartbeat()},$),this.transition("open")},F.prototype._handleWelcomeTimeout=function(){if(this.state==="connecting"){var N=this._log;if(this._hellosLeft<=0){var A="All handshake attempts failed";N.warn("Closing: "+y+" - "+A),this._close({code:y,reason:A});return}var w=this._options.maxConsecutiveFailedHellos;N.warn("Handshake attempt "+(w-this._hellosLeft)+" failed"),this._startHandshake()}},F.prototype._send=function(N){var A=this._ws.readyState,w=this._options.WebSocket;if(A===w.OPEN){var j=JSON.stringify(N);this._log.debug("Outgoing: "+j);try{this._ws.send(j),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch{var Q="Failed to send message";this._log.warn("Closing: "+m+" - "+Q),this._close({code:m,reason:Q})}}},F.prototype._sendHeartbeat=function(){this.state!=="closed"&&this._send({type:"heartbeat"})},F.prototype._sendHello=function(){var N=this._options,A=N.helloBody,w=N.requestedHeartbeatTimeout,j={id:r(),timeout:w,type:"hello",version:v};this._cookie&&(j.cookie=this._cookie),A&&(j.body=A),this._send(j)},F.prototype._sendOrEnqueue=function(N){var A=this;if(this.state!=="closed"){var w=this.state==="open"?function(j){return A._send(j)}:function(j){return A._messageQueue.push(j)};w(N)}},F.prototype._startHandshake=function(){var N=this;if(["early","waiting"].includes(this.state)&&this.transition("connecting"),this.state==="connecting"){this._hellosLeft--,this._sendHello();var A=this._options.welcomeTimeout;this._welcomeTimeout=new a(function(){return N._handleWelcomeTimeout()},A)}},F.prototype.close=function(){this.state!=="closed"&&(this._sendOrEnqueue({type:"bye"}),this._close({code:b,reason:"Normal"}))},F.prototype.sendMessage=function(N){this._sendOrEnqueue({body:N,type:"msg"})},F}(o);return B.CloseReason=E,nt=B,nt}var pe={},it,Xa;function Au(){if(Xa)return it;Xa=1;var k=it&&it.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=it&&it.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],c;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(s){c={error:s}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(c)throw c.error}}return a},_=it&&it.__spreadArray||function(i,e){for(var r=0,t=e.length,n=i.length;r<t;r++,n++)i[n]=e[r];return i},o=function(i){k(e,i);function e(r){var t=this,n=[].slice.call(arguments,1);t=i.apply(this,_([],p(n)))||this,Object.setPrototypeOf(t,e.prototype);var a=Error.apply(t,n);return a.name="TwilioError",Object.defineProperty(t,"code",{value:r,enumerable:!0}),Object.getOwnPropertyNames(a).forEach(function(c){Object.defineProperty(this,c,{value:a[c],enumerable:!0})},t),t}return e.prototype.toString=function(){var r=this.message?": "+this.message:"";return this.name+" "+this.code+r},e}(Error);return it=o,it}var Za;function ht(){if(Za)return pe;Za=1;var k=pe&&pe.__extends||function(){var D=function(L,U){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ie,fe){ie.__proto__=fe}||function(ie,fe){for(var me in fe)Object.prototype.hasOwnProperty.call(fe,me)&&(ie[me]=fe[me])},D(L,U)};return function(L,U){if(typeof U!="function"&&U!==null)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");D(L,U);function ie(){this.constructor=L}L.prototype=U===null?Object.create(U):(ie.prototype=U.prototype,new ie)}}(),p=Au(),_={};pe.createTwilioError=function(L,U){return L=typeof L=="number"?L:0,U=typeof U=="string"&&U?U:"Unknown error",_[L]?new _[L]:new p(L,U)};var o=function(D){k(L,D);function L(){var U=D.call(this,20101,"Invalid Access Token")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.AccessTokenInvalidError=o,Object.defineProperty(_,20101,{value:o});var i=function(D){k(L,D);function L(){var U=D.call(this,20102,"Invalid Access Token header")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.AccessTokenHeaderInvalidError=i,Object.defineProperty(_,20102,{value:i});var e=function(D){k(L,D);function L(){var U=D.call(this,20103,"Invalid Access Token issuer/subject")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.AccessTokenIssuerInvalidError=e,Object.defineProperty(_,20103,{value:e});var r=function(D){k(L,D);function L(){var U=D.call(this,20104,"Access Token expired or expiration date invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.AccessTokenExpiredError=r,Object.defineProperty(_,20104,{value:r});var t=function(D){k(L,D);function L(){var U=D.call(this,20105,"Access Token not yet valid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.AccessTokenNotYetValidError=t,Object.defineProperty(_,20105,{value:t});var n=function(D){k(L,D);function L(){var U=D.call(this,20106,"Invalid Access Token grants")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.AccessTokenGrantsInvalidError=n,Object.defineProperty(_,20106,{value:n});var a=function(D){k(L,D);function L(){var U=D.call(this,20107,"Invalid Access Token signature")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.AccessTokenSignatureInvalidError=a,Object.defineProperty(_,20107,{value:a});var c=function(D){k(L,D);function L(){var U=D.call(this,53e3,"Signaling connection error")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.SignalingConnectionError=c,Object.defineProperty(_,53e3,{value:c});var s=function(D){k(L,D);function L(){var U=D.call(this,53001,"Signaling connection disconnected")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.SignalingConnectionDisconnectedError=s,Object.defineProperty(_,53001,{value:s});var d=function(D){k(L,D);function L(){var U=D.call(this,53002,"Signaling connection timed out")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.SignalingConnectionTimeoutError=d,Object.defineProperty(_,53002,{value:d});var v=function(D){k(L,D);function L(){var U=D.call(this,53003,"Client received an invalid signaling message")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.SignalingIncomingMessageInvalidError=v,Object.defineProperty(_,53003,{value:v});var u=function(D){k(L,D);function L(){var U=D.call(this,53004,"Client sent an invalid signaling message")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.SignalingOutgoingMessageInvalidError=u,Object.defineProperty(_,53004,{value:u});var g=function(D){k(L,D);function L(){var U=D.call(this,53006,"Video server is busy")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.SignalingServerBusyError=g,Object.defineProperty(_,53006,{value:g});var h=function(D){k(L,D);function L(){var U=D.call(this,53100,"Room name is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomNameInvalidError=h,Object.defineProperty(_,53100,{value:h});var S=function(D){k(L,D);function L(){var U=D.call(this,53101,"Room name is too long")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomNameTooLongError=S,Object.defineProperty(_,53101,{value:S});var R=function(D){k(L,D);function L(){var U=D.call(this,53102,"Room name contains invalid characters")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomNameCharsInvalidError=R,Object.defineProperty(_,53102,{value:R});var T=function(D){k(L,D);function L(){var U=D.call(this,53103,"Unable to create Room")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomCreateFailedError=T,Object.defineProperty(_,53103,{value:T});var b=function(D){k(L,D);function L(){var U=D.call(this,53104,"Unable to connect to Room")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomConnectFailedError=b,Object.defineProperty(_,53104,{value:b});var y=function(D){k(L,D);function L(){var U=D.call(this,53105,"Room contains too many Participants")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomMaxParticipantsExceededError=y,Object.defineProperty(_,53105,{value:y});var l=function(D){k(L,D);function L(){var U=D.call(this,53106,"Room not found")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomNotFoundError=l,Object.defineProperty(_,53106,{value:l});var f=function(D){k(L,D);function L(){var U=D.call(this,53107,"MaxParticipants is out of range")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomMaxParticipantsOutOfRangeError=f,Object.defineProperty(_,53107,{value:f});var m=function(D){k(L,D);function L(){var U=D.call(this,53108,"RoomType is not valid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomTypeInvalidError=m,Object.defineProperty(_,53108,{value:m});var C=function(D){k(L,D);function L(){var U=D.call(this,53109,"Timeout is out of range")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomTimeoutOutOfRangeError=C,Object.defineProperty(_,53109,{value:C});var P=function(D){k(L,D);function L(){var U=D.call(this,53110,"StatusCallbackMethod is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomStatusCallbackMethodInvalidError=P,Object.defineProperty(_,53110,{value:P});var M=function(D){k(L,D);function L(){var U=D.call(this,53111,"StatusCallback is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomStatusCallbackInvalidError=M,Object.defineProperty(_,53111,{value:M});var I=function(D){k(L,D);function L(){var U=D.call(this,53112,"Status is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomStatusInvalidError=I,Object.defineProperty(_,53112,{value:I});var O=function(D){k(L,D);function L(){var U=D.call(this,53113,"Room exists")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomRoomExistsError=O,Object.defineProperty(_,53113,{value:O});var x=function(D){k(L,D);function L(){var U=D.call(this,53114,"Room creation parameter(s) incompatible with the Room type")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomInvalidParametersError=x,Object.defineProperty(_,53114,{value:x});var E=function(D){k(L,D);function L(){var U=D.call(this,53115,"MediaRegion is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomMediaRegionInvalidError=E,Object.defineProperty(_,53115,{value:E});var q=function(D){k(L,D);function L(){var U=D.call(this,53116,"There are no media servers available in the MediaRegion")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomMediaRegionUnavailableError=q,Object.defineProperty(_,53116,{value:q});var B=function(D){k(L,D);function L(){var U=D.call(this,53117,"The subscription operation requested is not supported for the Room type")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomSubscriptionOperationNotSupportedError=B,Object.defineProperty(_,53117,{value:B});var G=function(D){k(L,D);function L(){var U=D.call(this,53118,"Room completed")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomCompletedError=G,Object.defineProperty(_,53118,{value:G});var F=function(D){k(L,D);function L(){var U=D.call(this,53124,"The AudioOnly flag is not supported for the Room type")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomAudioOnlyFlagNotSupportedError=F,Object.defineProperty(_,53124,{value:F});var N=function(D){k(L,D);function L(){var U=D.call(this,53125,"The track kind is not supported by the Room")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.RoomTrackKindNotSupportedError=N,Object.defineProperty(_,53125,{value:N});var A=function(D){k(L,D);function L(){var U=D.call(this,53200,"Participant identity is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.ParticipantIdentityInvalidError=A,Object.defineProperty(_,53200,{value:A});var w=function(D){k(L,D);function L(){var U=D.call(this,53201,"Participant identity is too long")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.ParticipantIdentityTooLongError=w,Object.defineProperty(_,53201,{value:w});var j=function(D){k(L,D);function L(){var U=D.call(this,53202,"Participant identity contains invalid characters")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.ParticipantIdentityCharsInvalidError=j,Object.defineProperty(_,53202,{value:j});var Q=function(D){k(L,D);function L(){var U=D.call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.ParticipantMaxTracksExceededError=Q,Object.defineProperty(_,53203,{value:Q});var Y=function(D){k(L,D);function L(){var U=D.call(this,53204,"Participant not found")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.ParticipantNotFoundError=Y,Object.defineProperty(_,53204,{value:Y});var $=function(D){k(L,D);function L(){var U=D.call(this,53205,"Participant disconnected because of duplicate identity")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.ParticipantDuplicateIdentityError=$,Object.defineProperty(_,53205,{value:$});var K=function(D){k(L,D);function L(){var U=D.call(this,53300,"Track is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.TrackInvalidError=K,Object.defineProperty(_,53300,{value:K});var J=function(D){k(L,D);function L(){var U=D.call(this,53301,"Track name is invalid")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.TrackNameInvalidError=J,Object.defineProperty(_,53301,{value:J});var te=function(D){k(L,D);function L(){var U=D.call(this,53302,"Track name is too long")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.TrackNameTooLongError=te,Object.defineProperty(_,53302,{value:te});var se=function(D){k(L,D);function L(){var U=D.call(this,53303,"Track name contains invalid characters")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.TrackNameCharsInvalidError=se,Object.defineProperty(_,53303,{value:se});var oe=function(D){k(L,D);function L(){var U=D.call(this,53304,"Track name is duplicated")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.TrackNameIsDuplicatedError=oe,Object.defineProperty(_,53304,{value:oe});var ce=function(D){k(L,D);function L(){var U=D.call(this,53305,"The server has reached capacity and cannot fulfill this request")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.TrackServerTrackCapacityReachedError=ce,Object.defineProperty(_,53305,{value:ce});var de=function(D){k(L,D);function L(){var U=D.call(this,53400,"Client is unable to create or apply a local media description")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.MediaClientLocalDescFailedError=de,Object.defineProperty(_,53400,{value:de});var ve=function(D){k(L,D);function L(){var U=D.call(this,53401,"Server is unable to create or apply a local media description")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.MediaServerLocalDescFailedError=ve,Object.defineProperty(_,53401,{value:ve});var ue=function(D){k(L,D);function L(){var U=D.call(this,53402,"Client is unable to apply a remote media description")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.MediaClientRemoteDescFailedError=ue,Object.defineProperty(_,53402,{value:ue});var ee=function(D){k(L,D);function L(){var U=D.call(this,53403,"Server is unable to apply a remote media description")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.MediaServerRemoteDescFailedError=ee,Object.defineProperty(_,53403,{value:ee});var he=function(D){k(L,D);function L(){var U=D.call(this,53404,"No supported codec")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.MediaNoSupportedCodecError=he,Object.defineProperty(_,53404,{value:he});var le=function(D){k(L,D);function L(){var U=D.call(this,53405,"Media connection failed or Media activity ceased")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.MediaConnectionError=le,Object.defineProperty(_,53405,{value:le});var ge=function(D){k(L,D);function L(){var U=D.call(this,53407,"Media connection failed due to DTLS handshake failure")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.MediaDTLSTransportFailedError=ge,Object.defineProperty(_,53407,{value:ge});var W=function(D){k(L,D);function L(){var U=D.call(this,53500,"Unable to acquire configuration")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);pe.ConfigurationAcquireFailedError=W,Object.defineProperty(_,53500,{value:W});var z=function(D){k(L,D);function L(){var U=D.call(this,53501,"Unable to acquire TURN credentials")||this;return Object.setPrototypeOf(U,L.prototype),U}return L}(p);return pe.ConfigurationAcquireTurnFailedError=z,Object.defineProperty(_,53501,{value:z}),pe}var eo;function Mu(){if(eo)return ir;eo=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.getTurnCredentials=void 0;var k=Ts(),p=Ce().ICE_VERSION,_=ht(),o=_.createTwilioError,i=_.SignalingConnectionError,e=Ue();function r(t,n){return new Promise(function(a,c){var s=new e.EventEmitter,d={networkMonitor:null,eventObserver:s,helloBody:{edge:"roaming",preflight:!0,token:t,type:"ice",version:p}},v=new k(n,d),u=!1;v.once("close",function(){u||(u=!0,c(new i))}),v.on("message",function(g){var h=g.code,S=g.message,R=g.ice_servers,T=g.type;(T==="iced"||T==="error")&&!u&&(u=!0,T==="iced"?a(R):c(o(h,S)),v.close())})})}return ir.getTurnCredentials=r,ir}var at={},to;function Iu(){if(to)return at;to=1;var k=at&&at.__read||function(o,i){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var r=e.call(o),t,n=[],a;try{for(;(i===void 0||i-- >0)&&!(t=r.next()).done;)n.push(t.value)}catch(c){a={error:c}}finally{try{t&&!t.done&&(e=r.return)&&e.call(r)}finally{if(a)throw a.error}}return n},p=at&&at.__spreadArray||function(o,i){for(var e=0,r=i.length,t=o.length;e<r;e++,t++)o[t]=i[e];return o};Object.defineProperty(at,"__esModule",{value:!0}),at.makeStat=void 0;function _(o){if(o&&o.length){var i=Math.min.apply(Math,p([],k(o))),e=Math.max.apply(Math,p([],k(o))),r=o.reduce(function(t,n){return t+n},0)/o.length;return{min:i,max:e,average:r}}return null}return at.makeStat=_,at}var ar={},ro;function Du(){if(ro)return ar;ro=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.syntheticAudio=void 0;function k(){var p=Sn(),_={},o=p.getOrCreate(_),i=o.createOscillator(),e=i.connect(o.createMediaStreamDestination());i.start();var r=e.stream.getAudioTracks()[0],t=r.stop;return r.stop=function(){t.call(r),p.release(_)},r}return ar.syntheticAudio=k,ar}var or={},no;function ju(){if(no)return or;no=1,Object.defineProperty(or,"__esModule",{value:!0}),or.syntheticVideo=void 0;function k(p){var _=p===void 0?{}:p,o=_.width,i=o===void 0?640:o,e=_.height,r=e===void 0?480:e,t=Object.assign(document.createElement("canvas"),{width:i,height:r}),n=t.getContext("2d");n.fillStyle="green",n.fillRect(0,0,t.width,t.height);var a=!1;requestAnimationFrame(function v(){if(!a){var u=Math.round(Math.random()*255),g=Math.round(Math.random()*255),h=Math.round(Math.random()*255),S=Math.round(Math.random()*255);n.fillStyle="rgba("+u+", "+g+", "+h+", "+S+")",n.fillRect(Math.random()*i,Math.random()*r,50,50),requestAnimationFrame(v)}});var c=t.captureStream(30),s=c.getTracks()[0],d=s.stop;return s.stop=function(){a=!0,d.call(s)},s}return or.syntheticVideo=k,or}var Jn,io;function ws(){if(io)return Jn;io=1;var k=function(){function p(){Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return p.prototype.get=function(){var _=this._samples,o=_[1].denominator-_[0].denominator||1/0,i=_[1].numerator-_[0].numerator;return i/o},p.prototype.putSample=function(_,o){var i=this._samples;i.shift(),i.push({denominator:o,numerator:_})},p}();return Jn=k,Jn}var cr,ao;function Es(){if(ao)return cr;ao=1;var k=cr&&cr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=Ue().EventEmitter,_=["signaling","room","media","quality","video-processor","preflight"],o=["debug","error","info","warning"],i=function(e){k(r,e);function r(t,n,a,c){c===void 0&&(c=null);var s=e.call(this)||this;return s.on("event",function(d){var v=d.name,u=d.group,g=d.level,h=d.payload;if(typeof v!="string")throw a.error("Unexpected name: ",v),new Error("Unexpected name: ",v);if(!_.includes(u))throw a.error("Unexpected group: ",u),new Error("Unexpected group: ",u);if(!o.includes(g))throw a.error("Unexpected level: ",g),new Error("Unexpected level: ",g);var S=Date.now(),R=S-n,T=Object.assign({elapsedTime:R,level:g},h||{});t.publish(u,v,T);var b=Object.assign({elapsedTime:R,group:u,level:g,name:v,timestamp:S},h?{payload:h}:{}),y={debug:"debug",error:"error",info:"info",warning:"warn"}[g];a[y]("event",b),c&&u==="signaling"&&c.emit("event",b)}),s}return r}(p);return cr=i,cr}var St,oo;function Ps(){if(oo)return St;oo=1;var k=St&&St.__extends||function(){var T=function(b,y){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,f){l.__proto__=f}||function(l,f){for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(l[m]=f[m])},T(b,y)};return function(b,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");T(b,y);function l(){this.constructor=b}b.prototype=y===null?Object.create(y):(l.prototype=y.prototype,new l)}}(),p=St&&St.__assign||function(){return p=Object.assign||function(T){for(var b,y=1,l=arguments.length;y<l;y++){b=arguments[y];for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(T[f]=b[f])}return T},p.apply(this,arguments)},_=Ue().EventEmitter,o=Pe().getUserAgent,i=5,e=50,r=1e3,t=globalThis,n=t.WebSocket?t.WebSocket:Ss(),a=Ce(),c=a.hardwareDevicePublisheriPad,s=a.hardwareDevicePublisheriPhone,d=Pe(),v=Rt(),u=function(T){k(b,T);function b(y,l,f,m,C,P){var M=T.call(this)||this;return P=Object.assign({gateway:h(m,C)+"/v1/VideoEvents",maxReconnectAttempts:i,reconnectIntervalMs:e,userAgent:o(),WebSocket:n},P),Object.defineProperties(M,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:d.defer()},_reconnectAttemptsLeft:{value:P.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:P.WebSocket}}),M._readyToConnect.promise.then(function(I){var O=I.roomSid,x=I.participantSid,E=M;M.on("disconnected",function q(B){if(E._session=null,B&&E._reconnectAttemptsLeft>0){E.emit("reconnecting"),R(E,y,l,f,O,x,P);return}E.removeListener("disconnected",q)}),g(M,y,l,f,O,x,P)}).catch(function(){}),M}return b.prototype.connect=function(y,l){this._readyToConnect.resolve({roomSid:y,participantSid:l})},b.prototype._publish=function(y){y.session=this._session,this._ws.send(JSON.stringify(y))},b.prototype.disconnect=function(){if(this._ws===null||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch{}return this.emit("disconnected"),!0},b.prototype.publish=function(y,l,f){if(this._ws!==null&&(this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED))return!1;var m=typeof this._session=="string"?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue);return m({group:y,name:l,payload:f,timestamp:Date.now(),type:"event",version:1}),!0},b}(_);function g(T,b,y,l,f,m,C){T._connectTimestamp=Date.now(),T._reconnectAttemptsLeft--,T._ws=new C.WebSocket(C.gateway);var P=T._ws;P.addEventListener("close",function(M){if(M.code===r){T.emit("disconnected");return}T.emit("disconnected",new Error("WebSocket Error "+M.code+": "+M.reason))}),P.addEventListener("message",function(M){S(T,JSON.parse(M.data),C)}),P.addEventListener("open",function(){var M={type:"connect",token:b,version:1};M.publisher={name:y,sdkVersion:l,userAgent:C.userAgent,participantSid:m,roomSid:f},v.isIpad()?M.publisher=p(p({},M.publisher),c):v.isIphone()&&(M.publisher=p(p({},M.publisher),s)),P.send(JSON.stringify(M))})}function h(T,b){return T==="prod"?"wss://sdkgw."+b+".twilio.com":"wss://sdkgw."+T+"-"+b+".twilio.com"}function S(T,b,y){switch(b.type){case"connected":T._session=b.session,T._reconnectAttemptsLeft=y.maxReconnectAttempts,T._eventQueue.splice(0).forEach(T._publish,T),T.emit("connected");break;case"error":T._ws.close(),T.emit("disconnected",new Error(b.message));break}}function R(T,b,y,l,f,m,C){var P=Date.now()-T._connectTimestamp,M=C.reconnectIntervalMs-P;if(M>0){setTimeout(function(){g(T,b,y,l,f,m,C)},M);return}g(T,b,y,l,f,m,C)}return St=u,St}var co;function Nu(){if(co)return Be;co=1;var k=Be&&Be.__extends||function(){var B=function(G,F){return B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,A){N.__proto__=A}||function(N,A){for(var w in A)Object.prototype.hasOwnProperty.call(A,w)&&(N[w]=A[w])},B(G,F)};return function(G,F){if(typeof F!="function"&&F!==null)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");B(G,F);function N(){this.constructor=G}G.prototype=F===null?Object.create(F):(N.prototype=F.prototype,new N)}}(),p=Be&&Be.__assign||function(){return p=Object.assign||function(B){for(var G,F=1,N=arguments.length;F<N;F++){G=arguments[F];for(var A in G)Object.prototype.hasOwnProperty.call(G,A)&&(B[A]=G[A])}return B},p.apply(this,arguments)},_=Be&&Be.__awaiter||function(B,G,F,N){function A(w){return w instanceof F?w:new F(function(j){j(w)})}return new(F||(F=Promise))(function(w,j){function Q(K){try{$(N.next(K))}catch(J){j(J)}}function Y(K){try{$(N.throw(K))}catch(J){j(J)}}function $(K){K.done?w(K.value):A(K.value).then(Q,Y)}$((N=N.apply(B,G||[])).next())})},o=Be&&Be.__generator||function(B,G){var F={label:0,sent:function(){if(w[0]&1)throw w[1];return w[1]},trys:[],ops:[]},N,A,w,j;return j={next:Q(0),throw:Q(1),return:Q(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function Q($){return function(K){return Y([$,K])}}function Y($){if(N)throw new TypeError("Generator is already executing.");for(;F;)try{if(N=1,A&&(w=$[0]&2?A.return:$[0]?A.throw||((w=A.return)&&w.call(A),0):A.next)&&!(w=w.call(A,$[1])).done)return w;switch(A=0,w&&($=[$[0]&2,w.value]),$[0]){case 0:case 1:w=$;break;case 4:return F.label++,{value:$[1],done:!1};case 5:F.label++,A=$[1],$=[0];continue;case 7:$=F.ops.pop(),F.trys.pop();continue;default:if(w=F.trys,!(w=w.length>0&&w[w.length-1])&&($[0]===6||$[0]===2)){F=0;continue}if($[0]===3&&(!w||$[1]>w[0]&&$[1]<w[3])){F.label=$[1];break}if($[0]===6&&F.label<w[1]){F.label=w[1],w=$;break}if(w&&F.label<w[2]){F.label=w[2],F.ops.push($);break}w[2]&&F.ops.pop(),F.trys.pop();continue}$=G.call(B,F)}catch(K){$=[6,K],A=0}finally{N=w=0}if($[0]&5)throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}};Object.defineProperty(Be,"__esModule",{value:!0}),Be.runPreflight=Be.PreflightTest=void 0;var i=Ce(),e=Ou(),r=Ru(),t=Lu(),n=Mu(),a=Iu(),c=Du(),s=ju(),d=Pe(),v=Ce().WS_SERVER,u=ze(),g=ln(),h=ws(),S=Es(),R=Ps(),T=rs(),b=T.createSID,y=T.sessionSID,l=ht(),f=l.SignalingConnectionTimeoutError,m=l.MediaConnectionError,C=1e3,P=10*C,M={mediaAcquired:"mediaAcquired",connected:"connected",mediaSubscribed:"mediaSubscribed",mediaStarted:"mediaStarted",dtlsConnected:"dtlsConnected",peerConnectionConnected:"peerConnectionConnected",iceConnected:"iceConnected"};function I(B){return B!==null&&typeof B<"u"}var O=0,x=function(B){k(G,B);function G(F,N){var A=B.call(this)||this;A._testTiming=new e.Timer,A._dtlsTiming=new e.Timer,A._iceTiming=new e.Timer,A._peerConnectionTiming=new e.Timer,A._mediaTiming=new e.Timer,A._connectTiming=new e.Timer,A._sentBytesMovingAverage=new h,A._packetLossMovingAverage=new h,A._progressEvents=[],A._receivedBytesMovingAverage=new h;var w=N,j=w.environment,Q=j===void 0?"prod":j,Y=w.region,$=Y===void 0?"gll":Y,K=w.duration,J=K===void 0?P:K,te=w.wsServer||v(Q,$);return A._log=new u("default",A,i.DEFAULT_LOG_LEVEL,i.DEFAULT_LOGGER_NAME),A._testDuration=J,A._instanceId=O++,A._testTiming.start(),A._runPreflightTest(F,Q,te),A}return G.prototype.toString=function(){return"[Preflight #"+this._instanceId+"]"},G.prototype.stop=function(){this._stopped=!0},G.prototype._generatePreflightReport=function(F){return this._testTiming.stop(),{testTiming:this._testTiming.getTimeMeasurement(),networkTiming:{dtls:this._dtlsTiming.getTimeMeasurement(),ice:this._iceTiming.getTimeMeasurement(),peerConnection:this._peerConnectionTiming.getTimeMeasurement(),connect:this._connectTiming.getTimeMeasurement(),media:this._mediaTiming.getTimeMeasurement()},stats:{jitter:a.makeStat(F?.jitter),rtt:a.makeStat(F?.rtt),packetLoss:a.makeStat(F?.packetLoss)},selectedIceCandidatePairStats:F?F.selectedIceCandidatePairStats:null,iceCandidateStats:F?F.iceCandidateStats:[],progressEvents:this._progressEvents,mos:a.makeStat(F?.mos)}},G.prototype._executePreflightStep=function(F,N,A){return _(this,void 0,void 0,function(){var w,j,Q,Y,$;return o(this,function(K){switch(K.label){case 0:if(this._log.debug("Executing step: ",F),w=this._testDuration+10*C,this._stopped)throw new Error("stopped");j=Promise.resolve().then(N),Q=null,Y=new Promise(function(J,te){Q=setTimeout(function(){te(A||new Error(F+" timeout."))},w)}),K.label=1;case 1:return K.trys.push([1,,3,4]),[4,Promise.race([Y,j])];case 2:return $=K.sent(),[2,$];case 3:return Q!==null&&clearTimeout(Q),[7];case 4:return[2]}})})},G.prototype._collectNetworkTimings=function(F){var N=this;return new Promise(function(A){var w;F.addEventListener("iceconnectionstatechange",function(){F.iceConnectionState==="checking"&&N._iceTiming.start(),F.iceConnectionState==="connected"&&(N._iceTiming.stop(),N._updateProgress(M.iceConnected),(!w||w&&w.state==="connected")&&A())}),F.addEventListener("connectionstatechange",function(){F.connectionState==="connecting"&&N._peerConnectionTiming.start(),F.connectionState==="connected"&&(N._peerConnectionTiming.stop(),N._updateProgress(M.peerConnectionConnected))});var j=F.getSenders(),Q=j.map(function(Y){return Y.transport}).find(I);typeof Q<"u"&&(w=Q,w.addEventListener("statechange",function(){w.state==="connecting"&&N._dtlsTiming.start(),w.state==="connected"&&(N._dtlsTiming.stop(),N._updateProgress(M.dtlsConnected),F.iceConnectionState==="connected"&&A())}))})},G.prototype._setupInsights=function(F){var N=F.token,A=F.environment,w=A===void 0?i.DEFAULT_ENVIRONMENT:A,j=F.realm,Q=j===void 0?i.DEFAULT_REALM:j,Y={},$=new R(N,i.SDK_NAME,i.SDK_VERSION,w,Q,Y);$.connect("PREFLIGHT_ROOM_SID","PREFLIGHT_PARTICIPANT");var K=new S($,Date.now(),this._log),J=void 0;return{reportToInsights:function(te){var se,oe,ce=te.report,de=ce.stats.jitter||J,ve=ce.stats.rtt||J,ue=ce.stats.packetLoss||J,ee=ce.mos||J,he=new Map;ce.iceCandidateStats.forEach(function(W){if(W.candidateType&&W.protocol){var z=he.get(W.candidateType)||[];z.indexOf(W.protocol)<0&&z.push(W.protocol),he.set(W.candidateType,z)}});var le=JSON.stringify(Object.fromEntries(he)),ge={name:"report",group:"preflight",level:ce.error?"error":"info",payload:{sessionSID:y,preflightSID:b("PF"),progressEvents:JSON.stringify(ce.progressEvents),testTiming:ce.testTiming,dtlsTiming:ce.networkTiming.dtls,iceTiming:ce.networkTiming.ice,peerConnectionTiming:ce.networkTiming.peerConnection,connectTiming:ce.networkTiming.connect,mediaTiming:ce.networkTiming.media,selectedLocalCandidate:(se=ce.selectedIceCandidatePairStats)===null||se===void 0?void 0:se.localCandidate,selectedRemoteCandidate:(oe=ce.selectedIceCandidatePairStats)===null||oe===void 0?void 0:oe.remoteCandidate,iceCandidateStats:le,jitterStats:de,rttStats:ve,packetLossStats:ue,mosStats:ee,error:ce.error}};K.emit("event",ge),setTimeout(function(){return $.disconnect()},2e3)}}},G.prototype._runPreflightTest=function(F,N,A){return _(this,void 0,void 0,function(){var w,j,Q,Y,$,K,J,te,se,oe,ce,de,ve=this;return o(this,function(ue){switch(ue.label){case 0:w=[],j=[],Q=this._setupInsights({token:F,environment:N}).reportToInsights,ue.label=1;case 1:return ue.trys.push([1,8,9,10]),Y=[],[4,this._executePreflightStep("Acquire media",function(){return[c.syntheticAudio(),s.syntheticVideo({width:640,height:480})]})];case 2:return w=ue.sent(),this._updateProgress(M.mediaAcquired),this.emit("debug",{localTracks:w}),this._connectTiming.start(),[4,this._executePreflightStep("Get turn credentials",function(){return n.getTurnCredentials(F,A)},new f)];case 3:return $=ue.sent(),this._connectTiming.stop(),this._updateProgress(M.connected),K=new RTCPeerConnection({iceServers:$,iceTransportPolicy:"relay",bundlePolicy:"max-bundle"}),J=new RTCPeerConnection({iceServers:$,bundlePolicy:"max-bundle"}),j.push(K),j.push(J),this._mediaTiming.start(),[4,this._executePreflightStep("Setup Peer Connections",function(){return _(ve,void 0,void 0,function(){var ee,he,le,ge;return o(this,function(W){switch(W.label){case 0:return K.addEventListener("icecandidate",function(z){return z.candidate&&J.addIceCandidate(z.candidate)}),J.addEventListener("icecandidate",function(z){return z.candidate&&K.addIceCandidate(z.candidate)}),w.forEach(function(z){return K.addTrack(z)}),ee=new Promise(function(z){var D=[];J.addEventListener("track",function(L){D.push(L.track),D.length===w.length&&z(D)})}),[4,K.createOffer()];case 1:return he=W.sent(),le=he,[4,K.setLocalDescription(le)];case 2:return W.sent(),[4,J.setRemoteDescription(le)];case 3:return W.sent(),[4,J.createAnswer()];case 4:return ge=W.sent(),[4,J.setLocalDescription(ge)];case 5:return W.sent(),[4,K.setRemoteDescription(ge)];case 6:return W.sent(),[4,this._collectNetworkTimings(K)];case 7:return W.sent(),[2,ee]}})})},new m)];case 4:return te=ue.sent(),this.emit("debug",{remoteTracks:te}),te.forEach(function(ee){ee.addEventListener("ended",function(){return ve._log.warn(ee.kind+":ended")}),ee.addEventListener("mute",function(){return ve._log.warn(ee.kind+":muted")}),ee.addEventListener("unmute",function(){return ve._log.warn(ee.kind+":unmuted")})}),this._updateProgress(M.mediaSubscribed),[4,this._executePreflightStep("Wait for tracks to start",function(){return new Promise(function(ee){var he=document.createElement("video");he.autoplay=!0,he.playsInline=!0,he.muted=!0,he.srcObject=new MediaStream(te),Y.push(he),ve.emit("debugElement",he),he.oncanplay=ee})},new m)];case 5:return ue.sent(),this._mediaTiming.stop(),this._updateProgress(M.mediaStarted),[4,this._executePreflightStep("Collect stats for duration",function(){return ve._collectRTCStatsForDuration(ve._testDuration,E(),K,J)})];case 6:return se=ue.sent(),[4,this._executePreflightStep("Generate report",function(){return ve._generatePreflightReport(se)})];case 7:return oe=ue.sent(),Q({report:oe}),this.emit("completed",oe),[3,10];case 8:return ce=ue.sent(),de=this._generatePreflightReport(),Q({report:p(p({},de),{error:ce?.toString()})}),this.emit("failed",ce,de),[3,10];case 9:return j.forEach(function(ee){return ee.close()}),w.forEach(function(ee){return ee.stop()}),[7];case 10:return[2]}})})},G.prototype._collectRTCStats=function(F,N,A){return _(this,void 0,void 0,function(){var w,j,Q,Y,$,K,J,te,se,oe,ce,de,ve,ue;return o(this,function(ee){switch(ee.label){case 0:return[4,t.getCombinedConnectionStats({publisher:N,subscriber:A})];case 1:return w=ee.sent(),j=w.timestamp,Q=w.bytesSent,Y=w.bytesReceived,$=w.packets,K=w.packetsLost,J=w.roundTripTime,te=w.jitter,se=w.selectedIceCandidatePairStats,oe=w.iceCandidateStats,ce=F.jitter.length>0,F.jitter.push(te),F.rtt.push(J),this._sentBytesMovingAverage.putSample(Q,j),this._receivedBytesMovingAverage.putSample(Y,j),this._packetLossMovingAverage.putSample(K,$),ce&&(F.outgoingBitrate.push(this._sentBytesMovingAverage.get()*1e3*8),F.incomingBitrate.push(this._receivedBytesMovingAverage.get()*1e3*8),de=this._packetLossMovingAverage.get(),ve=Math.min(100,de*100),F.packetLoss.push(ve),ue=r.calculateMOS(J,te,de),F.mos.push(ue)),F.selectedIceCandidatePairStats||(F.selectedIceCandidatePairStats=se),F.iceCandidateStats.length===0&&(F.iceCandidateStats=oe),[2]}})})},G.prototype._collectRTCStatsForDuration=function(F,N,A,w){return _(this,void 0,void 0,function(){var j,Q,Y;return o(this,function($){switch($.label){case 0:return j=Date.now(),Q=Math.min(1e3,F),[4,d.waitForSometime(Q)];case 1:return $.sent(),[4,this._collectRTCStats(N,A,w)];case 2:return $.sent(),Y=F-(Date.now()-j),Y>0?[4,this._collectRTCStatsForDuration(Y,N,A,w)]:[3,4];case 3:N=$.sent(),$.label=4;case 4:return[2,N]}})})},G.prototype._updateProgress=function(F){var N=Date.now()-this._testTiming.getTimeMeasurement().start;this._progressEvents.push({duration:N,name:F}),this.emit("progress",F)},G}(g);Be.PreflightTest=x;function E(){return{mos:[],jitter:[],rtt:[],outgoingBitrate:[],incomingBitrate:[],packetLoss:[],selectedIceCandidatePairStats:null,iceCandidateStats:[]}}function q(B,G){G===void 0&&(G={});var F=new x(B,G);return F}return Be.runPreflight=q,Be}var Tt,so;function Ai(){if(so)return Tt;so=1;var k=Tt&&Tt.__read||function(o,i){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var r=e.call(o),t,n=[],a;try{for(;(i===void 0||i-- >0)&&!(t=r.next()).done;)n.push(t.value)}catch(c){a={error:c}}finally{try{t&&!t.done&&(e=r.return)&&e.call(r)}finally{if(a)throw a.error}}return n},p=Tt&&Tt.__spreadArray||function(o,i){for(var e=0,r=i.length,t=o.length;e<r;e++,t++)o[t]=i[e];return o},_=function(){function o(i,e){var r=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:e}}),Object.defineProperty(this,"_promise",{value:new Promise(function(t,n){i(function(a){r._isCancelable=!1,t(a)},function(a){r._isCancelable=!1,n(a)},function(){return r._isCanceled})})})}return o.reject=function(i){return new o(function(r,t){t(i)},function(){})},o.resolve=function(i){return new o(function(r){r(i)},function(){})},o.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},o.prototype.catch=function(){var i=[].slice.call(arguments),e=this._promise;return new o(function(t,n){e.catch.apply(e,p([],k(i))).then(t,n)},this._onCancel)},o.prototype.then=function(){var i=[].slice.call(arguments),e=this._promise;return new o(function(t,n){e.then.apply(e,p([],k(i))).then(t,n)},this._onCancel)},o.prototype.finally=function(){var i=[].slice.call(arguments),e=this._promise;return new o(function(t,n){e.finally.apply(e,p([],k(i))).then(t,n)},this._onCancel)},o}();return Tt=_,Tt}var Xn,uo;function qu(){if(uo)return Xn;uo=1;var k=Ai();function p(_,o,i,e){var r,t=new Error("Canceled");return new k(function(a,c,s){var d;_(function(u){return s()?k.reject(t):(d=o(u),i(d).then(function(h){if(s())throw t;return r=h(),r}))}).then(function(u){if(s())throw u.disconnect(),t;a(e(d,u))}).catch(function(u){c(u)})},function(){r&&r.cancel()})}return Xn=p,Xn}var sr,lo;function Vu(){if(lo)return sr;lo=1;var k=sr&&sr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(o){k(i,o);function i(e,r){var t=o.call(this)||this;return e=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},e),Object.defineProperties(t,{maxAudioBitrate:{value:e.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:e.maxVideoBitrate,writable:!0},adaptiveSimulcast:{value:r}}),t}return i.prototype.toJSON=function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}},i.prototype.update=function(e){var r=this;e=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},e);var t=["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,a){return r[a]!==e[a]&&(r[a]=e[a],n=!0),n},!1);t&&this.emit("changed")},i}(p);return sr=_,sr}var ur={},fo;function Cs(){if(fo)return ur;fo=1;var k=Pe().isNonArrayObject,p=Ce(),_=p.typeErrors,o=p.clientTrackSwitchOffControl,i=p.videoContentPreferencesMode,e=p.subscriptionMode,r=p.trackPriority,t=p.trackSwitchOffMode;function n(d){var v=c(d,"options.bandwidthProfile");return!d||v||(v=c(d.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(i)},{prop:"dominantSpeakerPriority",values:Object.values(r)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(e)},{prop:"clientTrackSwitchOffControl",values:Object.values(o)},{prop:"trackSwitchOffMode",values:Object.values(t)}]),v)?v:d.video?"maxTracks"in d.video&&"clientTrackSwitchOffControl"in d.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in d.video&&"contentPreferencesMode"in d.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):s(d.video.renderDimensions):null}function a(d,v){if(!(d instanceof v.LocalAudioTrack||d instanceof v.LocalDataTrack||d instanceof v.LocalVideoTrack||d instanceof v.MediaStreamTrack))throw _.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}function c(d,v,u){return u===void 0&&(u=[]),typeof d>"u"?null:d===null||!k(d)?_.INVALID_TYPE(v,"object"):u.reduce(function(g,h){var S=h.prop,R=h.type,T=h.values;if(g||!(S in d))return g;var b=d[S];return R&&typeof b!==R||R==="number"&&isNaN(b)?_.INVALID_TYPE(v+"."+S,R):Array.isArray(T)&&!T.includes(b)?_.INVALID_VALUE(v+"."+S,T):g},null)}function s(d){var v="options.bandwidthProfile.video.renderDimensions",u=c(d,v);return d?u||Object.values(r).reduce(function(g,h){return g||c(d[h],v+"."+h,[{prop:"height",type:"number"},{prop:"width",type:"number"}])},null):u}return ur.validateBandwidthProfile=n,ur.validateLocalTrack=a,ur.validateObject=c,ur}var lr,vo;function Os(){if(vo)return lr;vo=1;var k=lr&&lr.__extends||function(){var a=function(c,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(c,s)};return function(c,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(c,s);function d(){this.constructor=c}c.prototype=s===null?Object.create(s):(d.prototype=s.prototype,new d)}}(),p=ln(),_=Pe(),o=_.buildLogLevels,i=_.valueToJSON,e=Ce().DEFAULT_LOG_LEVEL,r=ze(),t=0,n=function(a){k(c,a);function c(s,d,v){var u=a.call(this)||this;v=Object.assign({logLevel:e},v);var g=o(v.logLevel);return Object.defineProperties(u,{_instanceId:{value:t++},_log:{value:v.log?v.log.createLog("default",u):new r("default",u,g,v.loggerName)},trackName:{enumerable:!0,value:s},trackSid:{enumerable:!0,value:d}}),u}return c.prototype.toJSON=function(){return i(this)},c.prototype.toString=function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"},c}(p);return lr=n,lr}var ot,po;function Mi(){if(po)return ot;po=1;var k=ot&&ot.__extends||function(){var n=function(a,c){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,d){s.__proto__=d}||function(s,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(s[v]=d[v])},n(a,c)};return function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");n(a,c);function s(){this.constructor=a}a.prototype=c===null?Object.create(c):(s.prototype=c.prototype,new s)}}(),p=ot&&ot.__read||function(n,a){var c=typeof Symbol=="function"&&n[Symbol.iterator];if(!c)return n;var s=c.call(n),d,v=[],u;try{for(;(a===void 0||a-- >0)&&!(d=s.next()).done;)v.push(d.value)}catch(g){u={error:g}}finally{try{d&&!d.done&&(c=s.return)&&c.call(s)}finally{if(u)throw u.error}}return v},_=ot&&ot.__spreadArray||function(n,a){for(var c=0,s=a.length,d=n.length;c<s;c++,d++)n[d]=a[c];return n},o=Os(),i=Ce(),e=i.typeErrors,r=i.trackPriority,t=function(n){k(a,n);function a(c,s,d,v){var u=n.call(this,s.name,c.sid,v)||this;return Object.defineProperties(u,{_reemitSignalingEvent:{value:function(){for(var g=[],h=0;h<arguments.length;h++)g[h]=arguments[h];return u.emit.apply(u,_([g&&g.length?"warning":"warningsCleared"],p(g)))}},_reemitTrackEvent:{value:function(){return u.emit(u.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:c},_unpublish:{value:d},isTrackEnabled:{enumerable:!0,get:function(){return this.track.kind==="data"?!0:this.track.isEnabled}},kind:{enumerable:!0,value:s.kind},priority:{enumerable:!0,get:function(){return c.updatedPriority}},track:{enumerable:!0,value:s}}),["disabled","enabled"].forEach(function(g){return s.on(g,u._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(g){return c.on(g,u._reemitSignalingEvent)}),u}return a.prototype.toString=function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},a.prototype.setPriority=function(c){var s=Object.values(r);if(!s.includes(c))throw e.INVALID_VALUE("priority",s);return this._signaling.setPriority(c),this},a.prototype.unpublish=function(){var c=this;return["disabled","enabled"].forEach(function(s){return c.track.removeListener(s,c._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(s){return c._signaling.removeListener(s,c._reemitSignalingEvent)}),this._unpublish(this),this},a}(o);return ot=t,ot}var dr,ho;function Fu(){if(ho)return dr;ho=1;var k=dr&&dr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mi(),_=function(o){k(i,o);function i(e,r,t,n){return o.call(this,e,r,t,n)||this}return i.prototype.toString=function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return dr=_,dr}var fr,_o;function Bu(){if(_o)return fr;_o=1;var k=fr&&fr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mi(),_=function(o){k(i,o);function i(e,r,t,n){return o.call(this,e,r,t,n)||this}return i.prototype.toString=function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return fr=_,fr}var vr,mo;function Uu(){if(mo)return vr;mo=1;var k=vr&&vr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mi(),_=function(o){k(i,o);function i(e,r,t,n){return o.call(this,e,r,t,n)||this}return i.prototype.toString=function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return vr=_,vr}var ct,yo;function Rs(){if(yo)return ct;yo=1;var k=ct&&ct.__extends||function(){var c=function(s,d){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,u){v.__proto__=u}||function(v,u){for(var g in u)Object.prototype.hasOwnProperty.call(u,g)&&(v[g]=u[g])},c(s,d)};return function(s,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");c(s,d);function v(){this.constructor=s}s.prototype=d===null?Object.create(d):(v.prototype=d.prototype,new v)}}(),p=ct&&ct.__read||function(c,s){var d=typeof Symbol=="function"&&c[Symbol.iterator];if(!d)return c;var v=d.call(c),u,g=[],h;try{for(;(s===void 0||s-- >0)&&!(u=v.next()).done;)g.push(u.value)}catch(S){h={error:S}}finally{try{u&&!u.done&&(d=v.return)&&d.call(v)}finally{if(h)throw h.error}}return g},_=ct&&ct.__spreadArray||function(c,s){for(var d=0,v=s.length,u=c.length;d<v;d++,u++)c[u]=s[d];return c},o=Ce(),i=o.typeErrors,e=o.trackPriority,r=Rt().isIOS,t=xi();function n(c){return function(s){k(d,s);function d(v,u,g,h,S,R,T){var b=this;return T=Object.assign({workaroundWebKitBug212780:r()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string"},T),b=s.call(this,u,T)||this,Object.defineProperties(b,{_isEnabled:{value:g,writable:!0},_isSwitchedOff:{value:h,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:S},_setRenderHint:{value:function(y){b._log.debug("updating render hint:",y),R(y)}},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:v},_workaroundWebKitBug212780:{value:T.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),b}return d.prototype.setPriority=function(v){var u=_([null],p(Object.values(e)));if(!u.includes(v))throw i.INVALID_VALUE("priority",u);return this._priority!==v&&(this._priority=v,this._setPriority(v)),this},d.prototype._setEnabled=function(v){this._isEnabled!==v&&(this._isEnabled=v,this.emit(this._isEnabled?"enabled":"disabled",this))},d.prototype._setSwitchedOff=function(v){this._isSwitchedOff!==v&&(this._isSwitchedOff=v,this.emit(v?"switchedOff":"switchedOn",this))},d.prototype.attach=function(v){var u=s.prototype.attach.call(this,v);return this.mediaStreamTrack.enabled!==!0&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||a(this)),u},d.prototype.detach=function(v){var u=s.prototype.detach.call(this,v);return this._attachments.size===0&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),u},d}(c)}function a(c){var s=c._log,d=c.kind;function v(u){u&&c._attachments.forEach(function(g){var h=c._elShims.get(g),S=g.paused&&h&&!h.pausedIntentionally();S&&(s.info("Playing inadvertently paused <"+d+"> element"),s.debug("Element:",g),s.debug("RemoteMediaTrack:",c),g.play().then(function(){s.info("Successfully played inadvertently paused <"+d+"> element"),s.debug("Element:",g),s.debug("RemoteMediaTrack:",c)}).catch(function(R){s.warn("Error while playing inadvertently paused <"+d+"> element:",{err:R,el:g,remoteMediaTrack:c})}))})}return t.onVisibilityChange(2,v),function(){t.offVisibilityChange(2,v)}}return ct=n,ct}var pr,go;function Wu(){if(go)return pr;go=1;var k=pr&&pr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=fs(),_=Rs(),o=_(p),i=function(e){k(r,e);function r(t,n,a,c,s,d,v){return e.call(this,t,n,a,c,s,d,v)||this}return r.prototype.toString=function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"},r.prototype._start=function(){e.prototype._start.call(this),this._dummyEl&&(this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl=null)},r.prototype.setPriority=function(t){return e.prototype.setPriority.call(this,t)},r}(o);return pr=i,pr}var hr,bo;function Ii(){if(bo)return hr;bo=1;var k=hr&&hr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Os(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e.name,e.sid,r)||this;Object.defineProperties(t,{_signaling:{value:e},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return e.isEnabled}},kind:{enumerable:!0,value:e.kind},publishPriority:{enumerable:!0,get:function(){return e.priority}},track:{enumerable:!0,get:function(){return this._track}}});var n=e.error,a=e.isEnabled,c=e.isSwitchedOff,s=e.priority;return e.on("updated",function(){if(n!==e.error){n=e.error,t.emit("subscriptionFailed",e.error);return}a!==e.isEnabled&&(a=e.isEnabled,t.track&&t.track._setEnabled(e.isEnabled),t.emit(e.isEnabled?"trackEnabled":"trackDisabled")),c!==e.isSwitchedOff&&(t._log.debug(t.trackSid+": "+(c?"OFF":"ON")+" => "+(e.isSwitchedOff?"OFF":"ON")),c=e.isSwitchedOff,t.track?(t.track._setSwitchedOff(e.isSwitchedOff),t.emit(c?"trackSwitchedOff":"trackSwitchedOn",t.track)):c&&t._log.warn("Track was not subscribed when switched Off.")),s!==e.priority&&(s=e.priority,t.emit("publishPriorityChanged",s))}),t}return i.prototype.toString=function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i.prototype._subscribed=function(e){!this._track&&e&&(this._track=e,this.emit("subscribed",e))},i.prototype._unsubscribe=function(){if(this._track){var e=this._track;this._track=null,this.emit("unsubscribed",e)}},i}(p);return hr=_,hr}var _r,ko;function Hu(){if(ko)return _r;ko=1;var k=_r&&_r.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ii(),_=function(o){k(i,o);function i(e,r){return o.call(this,e,r)||this}return i.prototype.toString=function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return _r=_,_r}var st,So;function Gu(){if(So)return st;So=1;var k=st&&st.__extends||function(){var n=function(a,c){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,d){s.__proto__=d}||function(s,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(s[v]=d[v])},n(a,c)};return function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");n(a,c);function s(){this.constructor=a}a.prototype=c===null?Object.create(c):(s.prototype=c.prototype,new s)}}(),p=st&&st.__read||function(n,a){var c=typeof Symbol=="function"&&n[Symbol.iterator];if(!c)return n;var s=c.call(n),d,v=[],u;try{for(;(a===void 0||a-- >0)&&!(d=s.next()).done;)v.push(d.value)}catch(g){u={error:g}}finally{try{d&&!d.done&&(c=s.return)&&c.call(s)}finally{if(u)throw u.error}}return v},_=st&&st.__spreadArray||function(n,a){for(var c=0,s=a.length,d=n.length;c<s;c++,d++)n[d]=a[c];return n},o=Li(),i=Ce(),e=i.typeErrors,r=i.trackPriority,t=function(n){k(a,n);function a(c,s,d){var v=n.call(this,s.id,"data",d)||this;return Object.defineProperties(v,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:s.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:s.maxRetransmits},ordered:{enumerable:!0,value:s.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:s.maxPacketLifeTime===null&&s.maxRetransmits===null},sid:{enumerable:!0,value:c}}),s.on("message",function(u){v.emit("message",u,v)}),v}return a.prototype.setPriority=function(c){var s=_([null],p(Object.values(r)));if(!s.includes(c))throw e.INVALID_VALUE("priority",s);return this._priority=c,this},a.prototype._setEnabled=function(){},a.prototype._setSwitchedOff=function(c){this._isSwitchedOff!==c&&(this._isSwitchedOff=c,this.emit(c?"switchedOff":"switchedOn",this))},a}(o);return st=t,st}var mr,To;function Qu(){if(To)return mr;To=1;var k=mr&&mr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ii(),_=function(o){k(i,o);function i(e,r){return o.call(this,e,r)||this}return i.prototype.toString=function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return mr=_,mr}var yr,wo;function $u(){if(wo)return yr;wo=1;var k=yr&&yr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=function(){function i(e){Object.defineProperties(this,{_callback:{value:e}})}return i.prototype.observe=function(){},i.prototype.unobserve=function(){},i.prototype.makeVisible=function(e){var r=this._makeFakeEntry(e,!0);this._callback([r])},i.prototype.makeInvisible=function(e){var r=this._makeFakeEntry(e,!1);this._callback([r])},i.prototype._makeFakeEntry=function(e,r){return{target:e,isIntersecting:r}},i}(),_=function(i){k(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e}(p),o=function(i){k(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.resize=function(r){var t=this._makeFakeEntry(r,!0);this._callback([t])},e}(p);return yr={NullIntersectionObserver:_,NullResizeObserver:o,NullObserver:p},yr}var wt,Eo;function Ku(){if(Eo)return wt;Eo=1;var k=wt&&wt.__extends||function(){var u=function(g,h){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,R){S.__proto__=R}||function(S,R){for(var T in R)Object.prototype.hasOwnProperty.call(R,T)&&(S[T]=R[T])},u(g,h)};return function(g,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");u(g,h);function S(){this.constructor=g}g.prototype=h===null?Object.create(h):(S.prototype=h.prototype,new S)}}(),p=wt&&wt.__read||function(u,g){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var S=h.call(u),R,T=[],b;try{for(;(g===void 0||g-- >0)&&!(R=S.next()).done;)T.push(R.value)}catch(y){b={error:y}}finally{try{R&&!R.done&&(h=S.return)&&h.call(S)}finally{if(b)throw b.error}}return T},_=Rs(),o=bs(),i=xi(),e=$u().NullObserver,r=Lt(),t=_(o),n=50,a=function(u){k(g,u);function g(h,S,R,T,b,y,l){var f=this;return l=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},l),l=Object.assign({IntersectionObserver:typeof IntersectionObserver>"u"||l.clientTrackSwitchOffControl!=="auto"?e:IntersectionObserver,ResizeObserver:typeof ResizeObserver>"u"||l.contentPreferencesMode!=="auto"?e:ResizeObserver},l),f=u.call(this,h,S,R,T,b,y,l)||this,Object.defineProperties(f,{_enableDocumentVisibilityTurnOff:{value:l.enableDocumentVisibilityTurnOff===!0&&l.clientTrackSwitchOffControl==="auto"},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:l.clientTrackSwitchOffControl},_contentPreferencesMode:{value:l.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_elToPipCallbacks:{value:new WeakMap},_elToPipWindows:{value:new WeakMap},_turnOffTimer:{value:new r(function(){f._setRenderHint({enabled:!1})},n,!1)},_resizeObserver:{value:new l.ResizeObserver(function(m){var C=m.find(function(P){return!f._invisibleElements.has(P.target)});C&&d(f)})},_intersectionObserver:{value:new l.IntersectionObserver(function(m){var C=!1;m.forEach(function(P){var M=!f._invisibleElements.has(P.target);M!==P.isIntersecting&&(P.isIntersecting?(f._log.debug("intersectionObserver detected: Off => On"),f._invisibleElements.delete(P.target)):(f._log.debug("intersectionObserver detected: On => Off"),f._invisibleElements.add(P.target)),C=!0)}),C&&(s(f),d(f))},{threshold:.25})}}),f}return g.prototype._start=function(h){var S=u.prototype._start.call(this,h);return s(this),S},g.prototype.switchOn=function(){if(this._clientTrackSwitchOffControl!=="manual")throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this},g.prototype.switchOff=function(){if(this._clientTrackSwitchOffControl!=="manual")throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this},g.prototype.setContentPreferences=function(h){if(this._contentPreferencesMode!=="manual")throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return h.renderDimensions&&this._setRenderHint({renderDimensions:h.renderDimensions}),this},g.prototype._unObservePip=function(h){var S=this._elToPipCallbacks.get(h);S&&(h.removeEventListener("enterpictureinpicture",S.onEnterPip),h.removeEventListener("leavepictureinpicture",S.onLeavePip),this._elToPipCallbacks.delete(h))},g.prototype._observePip=function(h){var S=this,R=this._elToPipCallbacks.get(h);if(!R){var T=function(l){return S._onEnterPip(l,h)},b=function(l){return S._onLeavePip(l,h)},y=function(l){return S._onResizePip(l,h)};h.addEventListener("enterpictureinpicture",T),h.addEventListener("leavepictureinpicture",b),this._elToPipCallbacks.set(h,{onEnterPip:T,onLeavePip:b,onResizePip:y})}},g.prototype._onEnterPip=function(h,S){this._log.debug("onEnterPip");var R=h.pictureInPictureWindow;this._elToPipWindows.set(S,R);var T=this._elToPipCallbacks.get(S).onResizePip;R.addEventListener("resize",T),s(this)},g.prototype._onLeavePip=function(h,S){this._log.debug("onLeavePip"),this._elToPipWindows.delete(S);var R=this._elToPipCallbacks.get(S).onResizePip,T=h.pictureInPictureWindow;T.removeEventListener("resize",R),s(this)},g.prototype._onResizePip=function(){d(this)},g.prototype.attach=function(h){var S=u.prototype.attach.call(this,h);return this._clientTrackSwitchOffControl==="auto"&&this._invisibleElements.add(S),this._intersectionObserver.observe(S),this._resizeObserver.observe(S),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||v(this)),this._observePip(S),S},g.prototype.detach=function(h){var S=this,R=u.prototype.detach.call(this,h),T=Array.isArray(R)?R:[R];return T.forEach(function(b){S._intersectionObserver.unobserve(b),S._resizeObserver.unobserve(b),S._invisibleElements.delete(b),S._unObservePip(b)}),this._attachments.size===0&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),s(this),d(this),R},g.prototype.addProcessor=function(){return u.prototype.addProcessor.apply(this,arguments)},g.prototype.removeProcessor=function(){return u.prototype.removeProcessor.apply(this,arguments)},g.prototype.toString=function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"},g.prototype.setPriority=function(h){return u.prototype.setPriority.call(this,h)},g}(t);function c(u){if(!("documentPictureInPicture"in globalThis))return!1;var g=globalThis.documentPictureInPicture.window;if(!g)return!1;var h=new WeakSet(g.document.querySelectorAll("video"));return u._getAllAttachedElements().some(function(S){return h.has(S)})}function s(u){if(u._clientTrackSwitchOffControl==="auto"){var g=u._getAllAttachedElements().filter(function(R){return!u._invisibleElements.has(R)}),h=u._getAllAttachedElements().filter(function(R){return u._elToPipWindows.has(R)}),S=h.length>0||c(u)||document.visibilityState==="visible"&&g.length>0;S===!0?(u._turnOffTimer.clear(),u._setRenderHint({enabled:!0})):u._turnOffTimer.isSet||u._turnOffTimer.start()}}function d(u){if(u._contentPreferencesMode==="auto"){var g=u._getAllAttachedElements().filter(function(f){return!u._invisibleElements.has(f)}),h=u._getAllAttachedElements().map(function(f){var m=u._elToPipWindows.get(f);return m?{clientHeight:m.height,clientWidth:m.width}:{clientHeight:0,clientWidth:0}}),S=g.concat(h);if(S.length>0){var R=p(S.sort(function(f,m){return m.clientHeight+m.clientWidth-f.clientHeight-f.clientWidth-1}),1),T=R[0],b=T.clientHeight,y=T.clientWidth,l={height:b,width:y};u._setRenderHint({renderDimensions:l})}}}function v(u){function g(){s(u)}return i.onVisibilityChange(1,g),function(){i.offVisibilityChange(1,g)}}return wt=a,wt}var gr,Po;function zu(){if(Po)return gr;Po=1;var k=gr&&gr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ii(),_=function(o){k(i,o);function i(e,r){return o.call(this,e,r)||this}return i.prototype.toString=function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return gr=_,gr}var ut,Co;function Ls(){if(Co)return ut;Co=1;var k=ut&&ut.__extends||function(){var S=function(R,T){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,y){b.__proto__=y}||function(b,y){for(var l in y)Object.prototype.hasOwnProperty.call(y,l)&&(b[l]=y[l])},S(R,T)};return function(R,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");S(R,T);function b(){this.constructor=R}R.prototype=T===null?Object.create(T):(b.prototype=T.prototype,new b)}}(),p=ut&&ut.__read||function(S,R){var T=typeof Symbol=="function"&&S[Symbol.iterator];if(!T)return S;var b=T.call(S),y,l=[],f;try{for(;(R===void 0||R-- >0)&&!(y=b.next()).done;)l.push(y.value)}catch(m){f={error:m}}finally{try{y&&!y.done&&(T=b.return)&&T.call(b)}finally{if(f)throw f.error}}return l},_=ut&&ut.__spreadArray||function(S,R){for(var T=0,b=R.length,y=S.length;T<b;T++,y++)S[y]=R[T];return S},o=ln(),i=Wu(),e=Hu(),r=Gu(),t=Qu(),n=Ku(),a=zu(),c=Pe(),s=0,d=function(S){k(R,S);function R(T,b){var y=S.call(this)||this;b=Object.assign({RemoteAudioTrack:i,RemoteAudioTrackPublication:e,RemoteDataTrack:r,RemoteDataTrackPublication:t,RemoteVideoTrack:n,RemoteVideoTrackPublication:a,tracks:[]},b);var l=v(b.tracks),f=b.log.createLog("default",y),m=new Map(l.audioTracks),C=new Map(l.dataTracks),P=new Map(l.tracks),M=new Map(l.videoTracks);return Object.defineProperties(y,{_RemoteAudioTrack:{value:b.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:b.RemoteAudioTrackPublication},_RemoteDataTrack:{value:b.RemoteDataTrack},_RemoteDataTrackPublication:{value:b.RemoteDataTrackPublication},_RemoteVideoTrack:{value:b.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:b.RemoteVideoTrackPublication},_audioTracks:{value:m},_dataTracks:{value:C},_instanceId:{value:++s},_clientTrackSwitchOffControl:{value:b.clientTrackSwitchOffControl},_contentPreferencesMode:{value:b.contentPreferencesMode},_log:{value:f},_signaling:{value:T},_tracks:{value:P},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:M},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return T.identity}},networkQualityLevel:{enumerable:!0,get:function(){return T.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return T.networkQualityStats}},sid:{enumerable:!0,get:function(){return T.sid}},state:{enumerable:!0,get:function(){return T.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map},_MediaStream:{value:b.MediaStream},_mapMediaElement:{value:b.mapMediaElement},_disposeMediaElement:{value:b.disposeMediaElement}}),y._tracks.forEach(g.bind(null,y)),T.on("networkQualityLevelChanged",function(){return y.emit("networkQualityLevelChanged",y.networkQualityLevel,y.networkQualityStats&&(y.networkQualityStats.audio||y.networkQualityStats.video)?y.networkQualityStats:null)}),u(y,T),f.info("Created a new Participant"+(y.identity?": "+y.identity:"")),y}return R.prototype._getTrackEvents=function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]},R.prototype._getTrackPublicationEvents=function(){return[]},R.prototype.toString=function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"},R.prototype._addTrack=function(T,b){var y=this._log;if(this._tracks.has(b))return null;this._tracks.set(b,T);var l={audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[T.kind];return l.set(b,T),g(this,T,b),y.info("Added a new "+c.trackClass(T)+":",b),y.debug(c.trackClass(T)+":",T),T},R.prototype._addTrackPublication=function(T){var b=this._log;if(this.tracks.has(T.trackSid))return null;this.tracks.set(T.trackSid,T);var y={audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[T.kind];return y.set(T.trackSid,T),h(this,T),b.info("Added a new "+c.trackPublicationClass(T)+":",T.trackSid),b.debug(c.trackPublicationClass(T)+":",T),T},R.prototype._handleTrackSignalingEvents=function(){var T=this,b=T._log,y=T._clientTrackSwitchOffControl,l=T._contentPreferencesMode,f=T._MediaStream,m=T._mapMediaElement,C=T._disposeMediaElement,P=this;if(this.state==="disconnected")return;var M=this._RemoteAudioTrack,I=this._RemoteAudioTrackPublication,O=this._RemoteVideoTrack,x=this._RemoteVideoTrackPublication,E=this._RemoteDataTrack,q=this._RemoteDataTrackPublication,B=this._signaling;function G(w){var j={audio:I,data:q,video:x}[w.kind],Q=new j(w,{log:b});P._addTrackPublication(Q);var Y=w.isSubscribed;Y&&N(w),P._trackSignalingUpdatedEventCallbacks.set(w.sid,function(){if(Y!==w.isSubscribed){if(Y=w.isSubscribed,Y){N(w);return}A(w)}}),w.on("updated",P._trackSignalingUpdatedEventCallbacks.get(w.sid))}function F(w){w.isSubscribed&&w.setTrackTransceiver(null);var j=P._trackSignalingUpdatedEventCallbacks.get(w.sid);j&&(w.removeListener("updated",j),P._trackSignalingUpdatedEventCallbacks.delete(w.sid));var Q=P.tracks.get(w.sid);Q&&P._removeTrackPublication(Q)}function N(w){var j=w.isEnabled,Q=w.name,Y=w.kind,$=w.sid,K=w.trackTransceiver,J=w.isSwitchedOff,te={audio:M,video:O,data:E}[Y],se=P.tracks.get($);if(!(!te||Y!==K.kind)){var oe={log:b,name:Q,clientTrackSwitchOffControl:y,contentPreferencesMode:l,mapMediaElement:m,disposeMediaElement:C};f&&(oe.MediaStream=f);var ce=function(ue){return B.updateSubscriberTrackPriority($,ue)},de=function(ue){w.isSubscribed&&B.updateTrackRenderHint($,ue)},ve=Y==="data"?new te($,K,oe):new te($,K,j,J,ce,de,oe);P._addTrack(ve,se,K.id)}}function A(w){var j=p(Array.from(P._tracks.entries()).find(function(K){var J=p(K,2),te=J[1];return te.sid===w.sid}),2),Q=j[0],Y=j[1],$=P.tracks.get(w.sid);Y&&P._removeTrack(Y,$,Q)}B.on("trackAdded",G),B.on("trackRemoved",F),B.tracks.forEach(G),B.on("stateChanged",function w(j){j==="disconnected"?(b.debug("Removing event listeners"),B.removeListener("stateChanged",w),B.removeListener("trackAdded",G),B.removeListener("trackRemoved",F)):j==="connected"&&(b.info("reconnected"),setTimeout(function(){return P.emit("reconnected")},0))})},R.prototype._removeTrack=function(T,b){if(!this._tracks.has(b))return null;this._tracks.delete(b);var y={audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[T.kind];y.delete(b);var l=this._trackEventReemitters.get(b)||new Map;l.forEach(function(m,C){T.removeListener(C,m)});var f=this._log;return f.info("Removed a "+c.trackClass(T)+":",b),f.debug(c.trackClass(T)+":",T),T},R.prototype._removeTrackPublication=function(T){if(T=this.tracks.get(T.trackSid),!T)return null;this.tracks.delete(T.trackSid);var b={audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[T.kind];b.delete(T.trackSid);var y=this._trackPublicationEventReemitters.get(T.trackSid)||new Map;y.forEach(function(f,m){T.removeListener(m,f)});var l=this._log;return l.info("Removed a "+c.trackPublicationClass(T)+":",T.trackSid),l.debug(c.trackPublicationClass(T)+":",T),T},R.prototype.toJSON=function(){return c.valueToJSON(this)},R}(o);function v(S){var R=S.map(function(l){return[l.id,l]}),T=R.filter(function(l){return l[1].kind==="audio"}),b=R.filter(function(l){return l[1].kind==="video"}),y=R.filter(function(l){return l[1].kind==="data"});return{audioTracks:T,dataTracks:y,tracks:R,videoTracks:b}}function u(S,R){var T=S._log;S.state!=="disconnected"&&R.on("stateChanged",function b(y){T.debug("Transitioned to state:",y),S.emit(y,S),y==="disconnected"&&(T.debug("Removing Track event reemitters"),R.removeListener("stateChanged",b),S._tracks.forEach(function(l){var f=S._trackEventReemitters.get(l.id);l&&f&&f.forEach(function(m,C){l.removeListener(C,m)})}),R.tracks.forEach(function(l){var f=S._tracks.get(l.id),m=S._trackEventReemitters.get(l.id);f&&m&&m.forEach(function(C,P){f.removeListener(P,C)})}),S._trackEventReemitters.clear(),S.tracks.forEach(function(l){S._trackPublicationEventReemitters.get(l.trackSid).forEach(function(f,m){l.removeListener(m,f)})}),S._trackPublicationEventReemitters.clear())})}function g(S,R,T){var b=new Map;S.state!=="disconnected"&&(S._getTrackEvents().forEach(function(y){var l=y[0],f=y[1];b.set(l,function(){var m=[f].concat([].slice.call(arguments));return S.emit.apply(S,_([],p(m)))}),R.on(l,b.get(l))}),S._trackEventReemitters.set(T,b))}function h(S,R){var T=new Map;S.state!=="disconnected"&&(S._getTrackPublicationEvents().forEach(function(b){var y=p(b,2),l=y[0],f=y[1];T.set(l,function(){for(var m=[],C=0;C<arguments.length;C++)m[C]=arguments[C];S.emit.apply(S,_(_([f],p(m)),[R]))}),R.on(l,T.get(l))}),S._trackPublicationEventReemitters.set(R.trackSid,T))}return ut=d,ut}var br,Oo;function Yu(){if(Oo)return br;Oo=1;var k=br&&br.__extends||function(){var b=function(y,l){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,m){f.__proto__=m}||function(f,m){for(var C in m)Object.prototype.hasOwnProperty.call(m,C)&&(f[C]=m[C])},b(y,l)};return function(y,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");b(y,l);function f(){this.constructor=y}y.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)}}(),p=Ot().MediaStreamTrack,_=Pe(),o=_.asLocalTrack,i=_.asLocalTrackPublication,e=_.trackClass,r=Ce(),t=r.typeErrors,n=r.trackPriority,a=Cs().validateLocalTrack,c=It(),s=c.LocalAudioTrack,d=c.LocalDataTrack,v=c.LocalVideoTrack,u=Fu(),g=Bu(),h=Uu(),S=Ls(),R=function(b){k(y,b);function y(l,f,m){var C=this;m=Object.assign({LocalAudioTrack:s,LocalVideoTrack:v,LocalDataTrack:d,MediaStreamTrack:p,LocalAudioTrackPublication:u,LocalVideoTrackPublication:h,LocalDataTrackPublication:g,shouldStopLocalTracks:!1,tracks:f},m);var P=m.shouldStopLocalTracks?new Set(f.filter(function(M){return M.kind!=="data"})):new Set;return C=b.call(this,l,m)||this,Object.defineProperties(C,{_eventObserver:{value:m.eventObserver},_LocalAudioTrack:{value:m.LocalAudioTrack},_LocalDataTrack:{value:m.LocalDataTrack},_LocalVideoTrack:{value:m.LocalVideoTrack},_MediaStreamTrack:{value:m.MediaStreamTrack},_LocalAudioTrackPublication:{value:m.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:m.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:m.LocalVideoTrackPublication},_tracksToStop:{value:P},signalingRegion:{enumerable:!0,get:function(){return l.signalingRegion}}}),C._handleTrackSignalingEvents(),C}return y.prototype._addTrack=function(l,f,m){var C=b.prototype._addTrack.call(this,l,f);return C&&this.state!=="disconnected"&&this._addLocalTrack(l,m),C},y.prototype._addLocalTrack=function(l,f){var m,C=(m=l.noiseCancellation)===null||m===void 0?void 0:m.vendor;this._signaling.addTrack(l._trackSender,l.name,f,C),this._log.info("Added a new "+e(l,!0)+":",l.id),this._log.debug(e(l,!0)+":",l)},y.prototype._removeTrack=function(l,f){var m=b.prototype._removeTrack.call(this,l,f);return m&&this.state!=="disconnected"&&(this._signaling.removeTrack(l._trackSender),this._log.info("Removed a "+e(l,!0)+":",l.id),this._log.debug(e(l,!0)+":",l)),m},y.prototype._getTrackEvents=function(){return b.prototype._getTrackEvents.call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])},y.prototype.toString=function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},y.prototype._handleTrackSignalingEvents=function(){var l=this,f=this._log;if(this.state!=="disconnected"){var m=function(I){var O=l._signaling.getPublication(I._trackSender);O&&(O.disable(),f.debug("Disabled the "+e(I,!0)+":",I.id))},C=function(I){var O=l._signaling.getPublication(I._trackSender);O&&(O.enable(),f.debug("Enabled the "+e(I,!0)+":",I.id))},P=function(I){var O=l._signaling.getPublication(I._trackSender);return O&&O.stop(),O},M=function(I){f.debug("Transitioned to state:",I),I==="disconnected"?(f.debug("Removing LocalTrack event listeners"),l._signaling.removeListener("stateChanged",M),l.removeListener("trackDisabled",m),l.removeListener("trackEnabled",C),l.removeListener("trackStopped",P),l._tracks.forEach(function(O){var x=P(O);x&&O._trackSender.removeClone(x._trackTransceiver)}),f.info("LocalParticipant disconnected. Stopping "+l._tracksToStop.size+" automatically-acquired LocalTracks"),l._tracksToStop.forEach(function(O){O.stop()})):I==="connected"&&(f.info("reconnected"),setTimeout(function(){return l.emit("reconnected")},0))};this.on("trackDisabled",m),this.on("trackEnabled",C),this.on("trackStopped",P),this._signaling.on("stateChanged",M),this._tracks.forEach(function(I){l._addLocalTrack(I,n.PRIORITY_STANDARD),l._getOrCreateLocalTrackPublication(I).catch(function(O){f.warn("Failed to get or create LocalTrackPublication for "+I+":",O)})})}},y.prototype._getOrCreateLocalTrackPublication=function(l){var f=T(this.tracks,l);if(f)return Promise.resolve(f);var m=this._log,C=this,P=this._signaling.getPublication(l._trackSender);return P?new Promise(function(M,I){function O(){var x=P.error;if(x){P.removeListener("updated",O),m.warn("Failed to publish the "+e(l,!0)+": "+x.message),C._removeTrack(l,l.id),setTimeout(function(){C.emit("trackPublicationFailed",x,l)}),I(x);return}if(!C._tracks.has(l.id)){P.removeListener("updated",O),I(new Error("The "+l+" was unpublished"));return}var E=P.sid;if(E){P.removeListener("updated",O);var q={log:m,LocalAudioTrackPublication:C._LocalAudioTrackPublication,LocalDataTrackPublication:C._LocalDataTrackPublication,LocalVideoTrackPublication:C._LocalVideoTrackPublication};f=T(C.tracks,l);var B=function(A){return C.emit("trackWarning",A,f)},G=function(){return C.emit("trackWarningsCleared",f)},F=function(A){f.removeListener("trackWarning",B),f.removeListener("trackWarningsCleared",G),C.unpublishTrack(A.track)};f||(f=i(l,P,F,q),C._addTrackPublication(f)),f.on("warning",B),f.on("warningsCleared",G);var N=C._signaling.state;(N==="connected"||N==="connecting")&&(l._processorEventObserver&&l._processorEventObserver.on("event",function(A){C._eventObserver.emit("event",{name:A.name,payload:A.data,group:"video-processor",level:"info"})}),l.processedTrack&&(l._captureFrames(),l._setSenderMediaStreamTrack(!0))),N==="connected"&&setTimeout(function(){C.emit("trackPublished",f)}),M(f)}}P.on("updated",O)}):Promise.reject(new Error("Unexpected error: The "+l+" cannot be published"))},y.prototype.publishTrack=function(l,f){var m=T(this.tracks,l);if(m)return Promise.resolve(m);f=Object.assign({log:this._log,priority:n.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},f);var C;try{C=o(l,f)}catch(x){return Promise.reject(x)}var P=C.noiseCancellation,M=this._signaling.audioProcessors;P&&!M.includes(P.vendor)&&(this._log.warn(P.vendor+" is not supported in this room. disabling it permanently"),P.disablePermanently());var I=Object.values(n);if(!I.includes(f.priority))return Promise.reject(t.INVALID_VALUE("LocalTrackPublishOptions.priority",I));var O=this._addTrack(C,C.id,f.priority)||this._tracks.get(C.id);return this._getOrCreateLocalTrackPublication(O)},y.prototype.publishTracks=function(l){if(!Array.isArray(l))throw t.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(l.map(this.publishTrack,this))},y.prototype.setBandwidthProfile=function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")},y.prototype.setNetworkQualityConfiguration=function(l){if(typeof l!="object"||l===null)throw t.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach(function(f){if(f in l&&(typeof l[f]!="number"||isNaN(l[f])))throw t.INVALID_TYPE("networkQualityConfiguration."+f,"number")}),this._signaling.setNetworkQualityConfiguration(l),this},y.prototype.setParameters=function(l){if(typeof l<"u"&&typeof l!="object")throw t.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");if(l){if(this._signaling.getParameters().adaptiveSimulcast&&l.maxVideoBitrate)throw t.INVALID_TYPE("encodingParameters",'encodingParameters.maxVideoBitrate is not compatible with "preferredVideoCodecs=auto"');["maxAudioBitrate","maxVideoBitrate"].forEach(function(f){if(typeof l[f]<"u"&&typeof l[f]!="number"&&l[f]!==null)throw t.INVALID_TYPE("encodingParameters."+f,"number, null or undefined")})}else l===null&&(l={maxAudioBitrate:null,maxVideoBitrate:null});return this._signaling.setParameters(l),this},y.prototype.unpublishTrack=function(l){a(l,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var f=this._tracks.get(l.id);if(!f)return null;var m=this._signaling.getPublication(f._trackSender);if(m.publishFailed(new Error("The "+f+" was unpublished")),f=this._removeTrack(f,f.id),!f)return null;var C=T(this.tracks,f);return C&&this._removeTrackPublication(C),C},y.prototype.unpublishTracks=function(l){var f=this;if(!Array.isArray(l))throw t.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return l.reduce(function(m,C){var P=f.unpublishTrack(C);return P?m.concat(P):m},[])},y}(S);function T(b,y){return Array.from(b.values()).find(function(l){return l.track===y||l.track.mediaStreamTrack===y})||null}return br=R,br}var Zn,Ro;function Ju(){if(Ro)return Zn;Ro=1;var k=function(){function p(){Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return p.prototype.connect=function(){},p.prototype.disconnect=function(){return this._connected?(this._connected=!1,!0):!1},p.prototype.publish=function(){return this._connected},p}();return Zn=k,Zn}var Et,Lo;function Xu(){if(Lo)return Et;Lo=1;var k=Et&&Et.__extends||function(){var a=function(c,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(c,s)};return function(c,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(c,s);function d(){this.constructor=c}c.prototype=s===null?Object.create(s):(d.prototype=s.prototype,new d)}}(),p=Et&&Et.__read||function(a,c){var s=typeof Symbol=="function"&&a[Symbol.iterator];if(!s)return a;var d=s.call(a),v,u=[],g;try{for(;(c===void 0||c-- >0)&&!(v=d.next()).done;)u.push(v.value)}catch(h){g={error:h}}finally{try{v&&!v.done&&(s=d.return)&&s.call(d)}finally{if(g)throw g.error}}return u},_=Ue().EventEmitter,o=Ce(),i=o.DEFAULT_NQ_LEVEL_LOCAL,e=o.DEFAULT_NQ_LEVEL_REMOTE,r=o.MAX_NQ_LEVEL,t=Pe().inRange,n=function(a){k(c,a);function c(s){var d=a.call(this)||this;return s=Object.assign({local:i,remote:e},s),Object.defineProperties(d,{local:{value:t(s.local,i,r)?s.local:i,writable:!0},remote:{value:t(s.remote,e,r)?s.remote:e,writable:!0}}),d}return c.prototype.update=function(s){var d=this;s=Object.assign({local:this.local,remote:this.remote},s),[["local",i,3],["remote",e,3]].forEach(function(v){var u=p(v,3),g=u[0],h=u[1],S=u[2];d[g]=typeof s[g]=="number"&&t(s[g],h,S)?s[g]:h})},c}(_);return Et=n,Et}var lt,xo;function Zu(){if(xo)return lt;xo=1;var k=lt&&lt.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=lt&&lt.__read||function(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),a,c=[],s;try{for(;(r===void 0||r-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(d){s={error:d}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return c},_=lt&&lt.__spreadArray||function(e,r){for(var t=0,n=r.length,a=e.length;t<n;t++,a++)e[a]=r[t];return e},o=Ls(),i=function(e){k(r,e);function r(t,n){var a=e.call(this,t,n)||this;return a._handleTrackSignalingEvents(),a.once("disconnected",a._unsubscribeTracks.bind(a)),a}return r.prototype.toString=function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},r.prototype._addTrack=function(t,n,a){return e.prototype._addTrack.call(this,t,a)?(n._subscribed(t),this.emit("trackSubscribed",t,n),t):null},r.prototype._addTrackPublication=function(t){var n=e.prototype._addTrackPublication.call(this,t);return n?(this.emit("trackPublished",n),n):null},r.prototype._getTrackPublicationEvents=function(){return _(_([],p(e.prototype._getTrackPublicationEvents.call(this))),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]])},r.prototype._unsubscribeTracks=function(){var t=this;this.tracks.forEach(function(n){if(n.isSubscribed){var a=n.track;n._unsubscribe(),t.emit("trackUnsubscribed",a,n)}})},r.prototype._removeTrack=function(t,n,a){var c=this._tracks.get(a);return c?(e.prototype._removeTrack.call(this,c,a),n._unsubscribe(),this.emit("trackUnsubscribed",c,n),c):null},r.prototype._removeTrackPublication=function(t){this._signaling.clearTrackHint(t.trackSid);var n=e.prototype._removeTrackPublication.call(this,t);return n?(this.emit("trackUnpublished",n),n):null},r}(o);return lt=i,lt}var ei,Ao;function xs(){if(Ao)return ei;Ao=1;var k=function(){function p(_,o){if(typeof _!="string")throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:_,enumerable:!0},trackSid:{value:o.trackSid,enumerable:!0},timestamp:{value:o.timestamp,enumerable:!0},ssrc:{value:o.ssrc,enumerable:!0},packetsLost:{value:typeof o.packetsLost=="number"?o.packetsLost:null,enumerable:!0},codec:{value:typeof o.codecName=="string"?o.codecName:null,enumerable:!0}})}return p}();return ei=k,ei}var kr,Mo;function As(){if(Mo)return kr;Mo=1;var k=kr&&kr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=xs(),_=function(o){k(i,o);function i(e,r,t){var n=o.call(this,e,r)||this;return Object.defineProperties(n,{bytesSent:{value:typeof r.bytesSent=="number"?r.bytesSent:t?0:null,enumerable:!0},packetsSent:{value:typeof r.packetsSent=="number"?r.packetsSent:t?0:null,enumerable:!0},roundTripTime:{value:typeof r.roundTripTime=="number"?r.roundTripTime:t?0:null,enumerable:!0}}),n}return i}(p);return kr=_,kr}var Sr,Io;function el(){if(Io)return Sr;Io=1;var k=Sr&&Sr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=As(),_=function(o){k(i,o);function i(e,r,t){var n=o.call(this,e,r,t)||this;return Object.defineProperties(n,{audioLevel:{value:typeof r.audioInputLevel=="number"?r.audioInputLevel:null,enumerable:!0},jitter:{value:typeof r.jitter=="number"?r.jitter:null,enumerable:!0}}),n}return i}(p);return Sr=_,Sr}var Tr,Do;function tl(){if(Do)return Tr;Do=1;var k=Tr&&Tr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=As(),_=function(o){k(i,o);function i(e,r,t){var n=o.call(this,e,r,t)||this,a=null;typeof r.frameWidthInput=="number"&&typeof r.frameHeightInput=="number"&&(a={},Object.defineProperties(a,{width:{value:r.frameWidthInput,enumerable:!0},height:{value:r.frameHeightInput,enumerable:!0}}));var c=null;return typeof r.frameWidthSent=="number"&&typeof r.frameHeightSent=="number"&&(c={},Object.defineProperties(c,{width:{value:r.frameWidthSent,enumerable:!0},height:{value:r.frameHeightSent,enumerable:!0}})),Object.defineProperties(n,{captureDimensions:{value:a,enumerable:!0},dimensions:{value:c,enumerable:!0},captureFrameRate:{value:typeof r.frameRateInput=="number"?r.frameRateInput:null,enumerable:!0},frameRate:{value:typeof r.frameRateSent=="number"?r.frameRateSent:null,enumerable:!0}}),n}return i}(p);return Tr=_,Tr}var wr,jo;function Ms(){if(jo)return wr;jo=1;var k=wr&&wr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=xs(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e,r)||this;return Object.defineProperties(t,{bytesReceived:{value:typeof r.bytesReceived=="number"?r.bytesReceived:null,enumerable:!0},packetsReceived:{value:typeof r.packetsReceived=="number"?r.packetsReceived:null,enumerable:!0}}),t}return i}(p);return wr=_,wr}var Er,No;function rl(){if(No)return Er;No=1;var k=Er&&Er.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ms(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e,r)||this;return Object.defineProperties(t,{audioLevel:{value:typeof r.audioOutputLevel=="number"?r.audioOutputLevel:null,enumerable:!0},jitter:{value:typeof r.jitter=="number"?r.jitter:null,enumerable:!0}}),t}return i}(p);return Er=_,Er}var Pr,qo;function nl(){if(qo)return Pr;qo=1;var k=Pr&&Pr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ms(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e,r)||this,n=null;return typeof r.frameWidthReceived=="number"&&typeof r.frameHeightReceived=="number"&&(n={},Object.defineProperties(n,{width:{value:r.frameWidthReceived,enumerable:!0},height:{value:r.frameHeightReceived,enumerable:!0}})),Object.defineProperties(t,{dimensions:{value:n,enumerable:!0},frameRate:{value:typeof r.frameRateReceived=="number"?r.frameRateReceived:null,enumerable:!0}}),t}return i}(p);return Pr=_,Pr}var ti,Vo;function Is(){if(Vo)return ti;Vo=1;var k=el(),p=tl(),_=rl(),o=nl(),i=function(){function e(r,t,n){if(typeof r!="string")throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:r,enumerable:!0},localAudioTrackStats:{value:t.localAudioTrackStats.map(function(a){return new k(a.trackId,a,n)}),enumerable:!0},localVideoTrackStats:{value:t.localVideoTrackStats.map(function(a){return new p(a.trackId,a,n)}),enumerable:!0},remoteAudioTrackStats:{value:t.remoteAudioTrackStats.map(function(a){return new _(a.trackId,a)}),enumerable:!0},remoteVideoTrackStats:{value:t.remoteVideoTrackStats.map(function(a){return new o(a.trackId,a)}),enumerable:!0}})}return e}();return ti=i,ti}var dt,Fo;function il(){if(Fo)return dt;Fo=1;var k=dt&&dt.__extends||function(){var S=function(R,T){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,y){b.__proto__=y}||function(b,y){for(var l in y)Object.prototype.hasOwnProperty.call(y,l)&&(b[l]=y[l])},S(R,T)};return function(R,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");S(R,T);function b(){this.constructor=R}R.prototype=T===null?Object.create(T):(b.prototype=T.prototype,new b)}}(),p=dt&&dt.__read||function(S,R){var T=typeof Symbol=="function"&&S[Symbol.iterator];if(!T)return S;var b=T.call(S),y,l=[],f;try{for(;(R===void 0||R-- >0)&&!(y=b.next()).done;)l.push(y.value)}catch(m){f={error:m}}finally{try{y&&!y.done&&(T=b.return)&&T.call(b)}finally{if(f)throw f.error}}return l},_=dt&&dt.__spreadArray||function(S,R){for(var T=0,b=R.length,y=S.length;T<b;T++,y++)S[y]=R[T];return S},o=ln(),i=Zu(),e=Is(),r=Pe(),t=r.flatMap,n=r.valueToJSON,a=0,c=function(S){k(R,S);function R(T,b,y){var l=S.call(this)||this,f=y.log.createLog("default",l),m=new Map;return Object.defineProperties(l,{_log:{value:f},_clientTrackSwitchOffControl:{value:y.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:y.contentPreferencesMode||"disabled"},_instanceId:{value:++a},_options:{value:y},_participants:{value:m},_signaling:{value:b},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(b.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return b.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:T},name:{enumerable:!0,value:b.name},participants:{enumerable:!0,value:m},sid:{enumerable:!0,value:b.sid},state:{enumerable:!0,get:function(){return b.state}},mediaRegion:{enumerable:!0,value:b.mediaRegion}}),u(l,T),g(l,b.recording),h(l,b),s(l),f.info("Created a new Room:",l.name),f.debug("Initial RemoteParticipants:",Array.from(l._participants.values())),l}return R.prototype.toString=function(){return"[Room #"+this._instanceId+": "+this.sid+"]"},R.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},R.prototype.getStats=function(){var T=this;return this._signaling.getStats().then(function(b){return Array.from(b).map(function(y){var l=p(y,2),f=l[0],m=l[1];return new e(f,Object.assign({},m,{localAudioTrackStats:d(T,m.localAudioTrackStats),localVideoTrackStats:d(T,m.localVideoTrackStats)}))})})},R.prototype.refreshInactiveMedia=function(){var T=this.localParticipant.tracks,b=Array.from(T.values()).filter(function(C){var P=C.track.kind;return P!=="data"}).map(function(C){var P=C.track;return P}),y=t(this.participants,function(C){return Array.from(C.tracks.values())}).filter(function(C){var P=C.track;return P&&P.kind!=="data"}).map(function(C){var P=C.track;return P}),l=b.concat(y),f=new Event("unmute");b.forEach(function(C){var P=C.isMuted,M=C.mediaStreamTrack;P&&M.dispatchEvent(f)});var m=new Event("pause");return l.forEach(function(C){var P=C._attachments,M=C._elShims;return P.forEach(function(I){var O=M.get(I),x=I.paused&&O&&!O.pausedIntentionally();x&&I.dispatchEvent(m)})}),this},R.prototype.toJSON=function(){return n(this)},R}(o);function s(S){var R=S.localParticipant._signaling.audioProcessors;S.localParticipant.audioTracks.forEach(function(T){var b=T.track,y=b.noiseCancellation;y&&!R.includes(y.vendor)&&(S._log.warn(y.vendor+" is not supported in this room. disabling it permanently"),y.disablePermanently())})}function d(S,R){var T=S.localParticipant._signaling;return R.reduce(function(b,y){var l=T.tracks.get(y.trackId),f=T.getSender(l);return f?[Object.assign({},y,{trackId:f.id})].concat(b):b},[])}function v(S,R){var T=S._log,b=S._clientTrackSwitchOffControl,y=S._contentPreferencesMode,l=S._options,f=l.MediaStream,m=l.mapMediaElement,C=l.disposeMediaElement,P=new i(R,{log:T,clientTrackSwitchOffControl:b,contentPreferencesMode:y,MediaStream:f,mapMediaElement:m,disposeMediaElement:C});T.info("A new RemoteParticipant connected:",P),S._participants.set(P.sid,P),S.emit("participantConnected",P);var M=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map(function(I){var O=p(Array.isArray(I)?I:[I,I],2),x=O[0],E=O[1];function q(){var B=[].slice.call(arguments);B.unshift(E),B.push(P),S.emit.apply(S,_([],p(B)))}return P.on(x,q),[x,q]});P.once("disconnected",function(){var O=S.dominantSpeaker;T.info("RemoteParticipant disconnected:",P),S._participants.delete(P.sid),M.forEach(function(x){P.removeListener(x[0],x[1])}),S.emit("participantDisconnected",P),P===O&&S.emit("dominantSpeakerChanged",S.dominantSpeaker)})}function u(S,R){var T=["trackWarning","trackWarningsCleared"].map(function(b){return{eventName:b,handler:function(){for(var y=[],l=0;l<arguments.length;l++)y[l]=arguments[l];return S.emit.apply(S,_([b],p(_(_([],p(y)),[R]))))}}});T.forEach(function(b){var y=b.eventName,l=b.handler;return R.on(y,l)}),S.once("disconnected",function(){return T.forEach(function(b){var y=b.eventName,l=b.handler;return R.removeListener(y,l)})})}function g(S,R){R.on("updated",function(){var b=R.isEnabled;S._log.info("Recording "+(b?"started":"stopped")),S.emit("recording"+(b?"Started":"Stopped"))})}function h(S,R){var T=S._log;T.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),R.participants.forEach(v.bind(null,S)),T.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),R.on("participantConnected",v.bind(null,S)),R.on("dominantSpeakerChanged",function(){return S.emit("dominantSpeakerChanged",S.dominantSpeaker)}),R.on("stateChanged",function b(y,l){switch(T.info("Transitioned to state:",y),y){case"disconnected":S.participants.forEach(function(f){f._unsubscribeTracks()}),S.emit(y,S,l),S.localParticipant.tracks.forEach(function(f){f.unpublish()}),R.removeListener("stateChanged",b);break;case"reconnecting":setTimeout(function(){return S.emit("reconnecting",l)},0);break;default:setTimeout(function(){return S.emit("reconnected")},0)}})}return dt=c,dt}var ri,Bo;function Ds(){if(Bo)return ri;Bo=1;var k=function(){function p(_){Object.defineProperties(this,{_min:{value:_.min||100},_max:{value:_.max||1e4},_jitter:{value:_.jitter>0&&_.jitter<=1?_.jitter:0},_factor:{value:_.factor||2},_attempts:{value:0,writable:!0},_duration:{enumerable:!1,get:function(){var o=this._min*Math.pow(this._factor,this._attempts);if(this._jitter){var i=Math.random(),e=Math.floor(i*this._jitter*o);o=(Math.floor(i*10)&1)===0?o-e:o+e}return Math.min(o,this._max)|0}},_timeoutID:{value:null,writable:!0}})}return p.prototype.backoff=function(_){var o=this,i=this._duration;this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._timeoutID=setTimeout(function(){o._attempts++,_()},i)},p.prototype.reset=function(){this._attempts=0,this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},p}();return ri=k,ri}var Ne={},Cr,Uo;function al(){if(Uo)return Cr;Uo=1;var k=Cr&&Cr.__read||function(v,u){var g=typeof Symbol=="function"&&v[Symbol.iterator];if(!g)return v;var h=g.call(v),S,R=[],T;try{for(;(u===void 0||u-- >0)&&!(S=h.next()).done;)R.push(S.value)}catch(b){T={error:b}}finally{try{S&&!S.done&&(g=h.return)&&g.call(h)}finally{if(T)throw T.error}}return R},p=Pe(),_=p.difference,o=p.flatMap;function i(){var v=4294967295;return String(Math.floor(Math.random()*v))}var e=function(){function v(u,g,h){Object.defineProperties(this,{cName:{enumerable:!0,value:h},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:g},trackId:{enumerable:!0,value:u}})}return v.prototype.addSimulcastSSRCs=function(){if(!this.isSimulcastEnabled){var u=[i(),i()];u.forEach(function(g){this.primarySSRCs.add(g)},this),this.rtxPairs.size&&u.forEach(function(g){this.rtxPairs.set(i(),g)},this)}},v.prototype.addSSRC=function(u,g,h){g?this.rtxPairs.set(u,g):this.primarySSRCs.add(u),this.isSimulcastEnabled=this.isSimulcastEnabled||h},v.prototype.toSdpLines=function(u){var g=this,h=u?[]:Array.from(this.rtxPairs.entries()).map(function(l){return l.reverse()}),S=Array.from(this.primarySSRCs.values()),R=h.length?o(h):S,T=o(R,function(l){return["a=ssrc:"+l+" cname:"+g.cName,"a=ssrc:"+l+" msid:"+g.streamId+" "+g.trackId]}),b=h.map(function(l){return"a=ssrc-group:FID "+l.join(" ")}),y=["a=ssrc-group:SIM "+S.join(" ")];return b.concat(T).concat(y)},v}();function r(v,u){var g=v.match(new RegExp(u,"gm"))||[];return g.map(function(h){var S=h.match(new RegExp(u))||[];return S.slice(1)})}function t(v){var u="^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$";return new Set(o(r(v,u)))}function n(v,u,g){var h="a=ssrc:"+u+" "+g+":(.+)";return v.match(new RegExp(h))[1]}function a(v){var u="^a=ssrc-group:FID ([0-9]+) ([0-9]+)$";return new Map(r(v,u).map(function(g){return g.reverse()}))}function c(v){var u=k(o(r(v,"^a=msid:(.+) (.+)$")),2),g=u[0],h=u[1],S=o(r(v,"^a=ssrc:(.+) cname:.+$"));return S.map(function(R){return[R,g,h]})}function s(v){var u=t(v),g=a(v),h=c(v);return h.reduce(function(S,R){var T=R[0],b=R[1],y=R[2],l=S.get(y)||new e(y,b,n(v,T,"cname")),f=g.get(T)||null;return l.addSSRC(T,f,u.has(T)),S.set(y,l)},new Map)}function d(v,u){var g=s(v),h=Array.from(g.keys()),S=Array.from(u.keys()),R=_(h,S),T=_(S,h),b=o(R,function(M){return g.get(M)});b.forEach(function(M){M.addSimulcastSSRCs(),u.set(M.trackId,M)}),S=Array.from(u.keys());var y=_(S,T),l=o(y,function(M){return u.get(M)}),f=!v.match(/a=rtpmap:[0-9]+ rtx/),m=o(l,function(M){return M.toSdpLines(f)}),C=o(new Set(v.split(`\r
`).concat(m))),P="a=x-google-flag:conference";return v.match(P)||C.push(P),C.join(`\r
`)}return Cr=d,Cr}var Wo;function Di(){if(Wo)return Ne;Wo=1;var k=Ne&&Ne.__read||function(M,I){var O=typeof Symbol=="function"&&M[Symbol.iterator];if(!O)return M;var x=O.call(M),E,q=[],B;try{for(;(I===void 0||I-- >0)&&!(E=x.next()).done;)q.push(E.value)}catch(G){B={error:G}}finally{try{E&&!E.done&&(O=x.return)&&O.call(x)}finally{if(B)throw B.error}}return q},p=Pe(),_=p.difference,o=p.flatMap,i=al(),e={0:"PCMU",8:"PCMA"};function r(M){return Array.from(n(M)).reduce(function(I,O){var x=O[0],E=O[1],q=I.get(E)||[];return I.set(E,q.concat(x))},new Map)}function t(M){return s(M).reduce(function(I,O){var x=c(O);return x?I.set(x,O):I},new Map)}function n(M){return d(M).reduce(function(I,O){var x=new RegExp("a=rtpmap:"+O+" ([^/]+)"),E=M.match(x),q=E?E[1].toLowerCase():e[O]?e[O].toLowerCase():"";return I.set(O,q)},new Map)}function a(M,I){var O=new RegExp("^a=fmtp:"+M+" (.+)$","m"),x=I.match(O);return x&&x[1].split(";").reduce(function(E,q){var B=k(q.split("="),2),G=B[0],F=B[1];return E[G]=isNaN(F)?F:parseInt(F,10),E},{})}function c(M){var I=M.match(/^a=mid:(.+)$/m);return I&&I[1]}function s(M,I,O){return M.replace(/\r\n\r\n$/,`\r
`).split(`\r
m=`).slice(1).map(function(x){return"m="+x}).filter(function(x){var E=new RegExp("m="+(I||".*"),"gm"),q=new RegExp("a="+(O||".*"),"gm");return E.test(x)&&q.test(x)})}function d(M){var I=M.split(`\r
`)[0],O=I.match(/([0-9]+)/g);return O?O.slice(1).map(function(x){return parseInt(x,10)}):[]}function v(M,I){I=I.map(function(q){var B=q.codec;return B.toLowerCase()});var O=o(I,function(q){return M.get(q)||[]}),x=_(Array.from(M.keys()),I),E=o(x,function(q){return M.get(q)});return O.concat(E)}function u(M,I){var O=I.split(`\r
`),x=O[0],E=O.slice(1);return x=x.replace(/([0-9]+\s?)+$/,M.join(" ")),[x].concat(E).join(`\r
`)}function g(M,I,O){var x=s(M),E=M.split(`\r
m=`)[0];return[E].concat(x.map(function(q){if(!/^m=(audio|video)/.test(q))return q;var B=q.match(/^m=(audio|video)/)[1],G=r(q),F=B==="audio"?I:O,N=v(G,F),A=u(N,q),w=G.get("pcma")||[],j=G.get("pcmu")||[],Q=B==="audio"?new Set(w.concat(j)):new Set;return Q.has(N[0])?A.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):A})).join(`\r
`)}function h(M,I){var O=s(M),x=M.split(`\r
m=`)[0];return[x].concat(O.map(function(E){if(E=E.replace(/\r\n$/,""),!/^m=video/.test(E))return E;var q=r(E),B=d(E),G=new Set(q.get("vp8")||[]),F=B.some(function(N){return G.has(N)});return F?i(E,I):E})).concat("").join(`\r
`)}function S(M,I,O,x,E){var q=O.get(M)||[];if(q.length<=1)return q;var B=a(I,E);if(!B)return q;var G=q.find(function(F){var N=a(F,x);return N&&Object.keys(B).every(function(A){return B[A]===N[A]})});return typeof G=="number"?[G]:q}function R(M,I,O){if(!/^m=(audio|video)/.test(M))return M;var x=c(M),E=x&&I.get(x);if(!E)return M;var q=n(E),B=r(M),G=o(Array.from(q),function(w){var j=k(w,2),Q=j[0],Y=j[1];return Y!=="rtx"&&!O.includes(Y)?S(Y,Q,B,M,E):[]}),F=B.get("rtx")||[];G=G.concat(F.filter(function(w){var j=a(w,M);return j&&G.includes(j.apt)}));var N=M.split(`\r
`).filter(function(w){var j=w.match(/^a=(rtpmap|fmtp|rtcp-fb):(.+) .+$/),Q=j&&j[2];return!j||Q&&G.includes(parseInt(Q,10))}),A=d(M).filter(function(w){return G.includes(w)});return u(A,N.join(`\r
`))}function T(M,I){var O=s(M),x=M.split(`\r
m=`)[0],E=t(I);return[x].concat(O.map(function(q){return R(q,E,[])})).join(`\r
`)}function b(M,I,O,x){x===void 0&&(x=!1);var E=t(O),q=t(I),B=s(M),G=M.split(`\r
m=`)[0];return[G].concat(B.map(function(F){if(F=F.replace(/\r\n$/,""),!/^m=video/.test(F))return F;var N=F.match(/^a=mid:(.+)$/m),A=N&&N[1];if(!A)return F;var w=E.get(A),j=n(w),Q=d(w),Y=Q.length&&j.get(Q[0])==="vp8",$=x||!Y;return $?q.get(A).replace(/\r\n$/,""):F})).concat("").join(`\r
`)}function y(M,I,O){var x=Array.from(O).reduce(function(E,q){var B=k(q,2),G=B[0],F=B[1],N=s(M,G,"send(only|recv)"),A=N.map(c).filter(function(w){return!I.has(w)});return A.forEach(function(w,j){return E.set(w,F[j])}),E},new Map);return l(M,x)}function l(M,I){var O=s(M),x=M.split(`\r
m=`)[0];return[x].concat(O.map(function(E){if(!/^m=(audio|video)/.test(E))return E;var q=c(E);if(!q)return E;var B=I.get(q);if(!B)return E;var G=(E.match(/^a=msid:(.+)$/m)||[])[1];if(!G)return E;var F=k(G.split(" "),2),N=F[0],A=F[1],w=new RegExp("msid:"+N+(A?" "+A:"")+"$","gm");return E.replace(w,"msid:"+N+" "+B)})).join(`\r
`)}function f(M,I){return M.split(`\r
`).filter(function(O){return!I.find(function(x){return new RegExp("a=ssrc:.*"+x+":","g").test(O)})}).join(`\r
`)}function m(M){var I=s(M),O=M.split(`\r
m=`)[0];return[O].concat(I.map(function(x){if(!/^m=video/.test(x))return x;var E=r(x),q=E.get("rtx");if(!q)return x;var B=new Set(d(x));q.forEach(function(A){return B.delete(A)});var G=x.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),F=G&&G[1],N=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(F?[new RegExp("^a=ssrc:"+F+" .+$")]:[]);return x=x.split(`\r
`).filter(function(A){return N.every(function(w){return!w.test(A)})}).join(`\r
`),u(Array.from(B),x)})).join(`\r
`)}function C(M,I){var O=Object.entries(I).map(function(x){var E=k(x,2),q=E[0],B=E[1];return q+"="+B}).join(";");return"a=fmtp:"+M+" "+O}function P(M,I){var O=s(M),x=M.split(`\r
m=`)[0];return I=I||O.filter(function(E){return/^m=audio/.test(E)}).map(c),[x].concat(O.map(function(E){if(!/^m=audio/.test(E))return E;var q=r(E),B=q.get("opus");if(!B)return E;var G=a(B,E);if(!G)return E;var F=C(B,G),N=new RegExp(F),A=c(E);I.includes(A)?G.usedtx=1:delete G.usedtx;var w=C(B,G);return E.replace(N,w)})).join(`\r
`)}return Ne.addOrRewriteNewTrackIds=y,Ne.addOrRewriteTrackIds=l,Ne.createCodecMapForMediaSection=r,Ne.createPtToCodecName=n,Ne.disableRtx=m,Ne.enableDtxForOpus=P,Ne.filterLocalCodecs=T,Ne.getMediaSections=s,Ne.removeSSRCAttributes=f,Ne.revertSimulcast=b,Ne.setCodecPreferences=g,Ne.setSimulcast=h,Ne}var ni,Ho;function ol(){if(Ho)return ni;Ho=1;var k=function(){function p(_){_=Object.assign({getKey:function(i){return i},getValue:function(i){return i},isLessThanOrEqualTo:function(i,e){return i<=e}},_),Object.defineProperties(this,{_getKey:{value:_.getKey},_getValue:{value:_.getValue},_isLessThanOrEqualTo:{value:_.isLessThanOrEqualTo},_map:{value:new Map}})}return p.prototype.toMap=function(){return new Map(this._map)},p.prototype.updateAndFilter=function(_){return _.filter(this.update,this)},p.prototype.update=function(_){var o=this._getKey(_),i=this._getValue(_);return this._map.has(o)&&this._isLessThanOrEqualTo(i,this._map.get(o))?!1:(this._map.set(o,i),!0)},p}();return ni=k,ni}var ii,Go;function cl(){if(Go)return ii;Go=1;var k=ol(),p=function(){function _(){Object.defineProperties(this,{_filter:{value:new k({getKey:function(i){return i.ufrag},isLessThanOrEqualTo:function(i,e){return i.revision<=e.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return _.prototype.setUfrag=function(o){this._ufrag=o;var i=this._filter.toMap().get(o);return i?i.candidates:[]},_.prototype.update=function(o){o.candidates=o.candidates||[];var i=this._filter.toMap().get(o.ufrag),e=i?i.candidates:[];return this._filter.update(o)&&this._ufrag===o.ufrag?o.candidates.slice(e.length):[]},_}();return ii=p,ii}var ai,Qo;function sl(){if(Qo)return ai;Qo=1;var k=Ce(),p=k.ICE_ACTIVITY_CHECK_PERIOD_MS,_=k.ICE_INACTIVITY_THRESHOLD_MS,o=function(){function i(e,r){r=Object.assign({activityCheckPeriodMs:p,inactivityThresholdMs:_},r),Object.defineProperties(this,{_activityCheckPeriodMs:{value:r.activityCheckPeriodMs},_inactivityThresholdMs:{value:r.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:e},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return i.prototype._getActivePairStat=function(e){var r=Array.from(e.values()),t=r.find(function(n){return n.type==="candidate-pair"&&n.nominated});return t||{bytesReceived:0,timestamp:Math.round(new Date().getTime())}},i.prototype._getIceConnectionStats=function(){var e=this;return this._peerConnection.getStats().then(function(r){return e._getActivePairStat(r)}).catch(function(){return null})},i.prototype._scheduleInactivityCallback=function(e){var r=this;e&&this._onIceConnectionStateChanged===null?(this._onIceConnectionStateChanged=function(){r._peerConnection.iceConnectionState==="disconnected"&&e()},this._peerConnection.addEventListener?this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=this._onIceConnectionStateChanged):!e&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener?this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=null,this._onIceConnectionStateChanged=null)},i.prototype.start=function(e){var r=this;this.stop(),this._timer=setInterval(function(){r._getIceConnectionStats().then(function(t){t&&((!r._lastActivity||r._lastActivity.bytesReceived!==t.bytesReceived)&&(r._lastActivity=t,r._scheduleInactivityCallback(null)),t.timestamp-r._lastActivity.timestamp>=r._inactivityThresholdMs&&(r._peerConnection.iceConnectionState==="disconnected"?e():r._onIceConnectionStateChanged===null&&r._scheduleInactivityCallback(e)))})},this._activityCheckPeriodMs)},i.prototype.stop=function(){this._scheduleInactivityCallback(null),this._timer!==null&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)},i}();return ai=o,ai}var Or,$o;function ul(){if($o)return Or;$o=1;var k=Or&&Or.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(o){k(i,o);function i(e){var r=o.call(this)||this;return Object.defineProperties(r,{_dataChannel:{value:e},_messageQueue:{value:[]}}),e.addEventListener("open",function(){r._messageQueue.splice(0).forEach(function(t){return r._publish(t)})}),e.addEventListener("message",function(t){var n=t.data;try{var a=JSON.parse(n);r.emit("message",a)}catch{}}),r.publish({type:"ready"}),r}return i.prototype._publish=function(e){var r=JSON.stringify(e);try{this._dataChannel.send(r)}catch{}},i.prototype.publish=function(e){var r=this._dataChannel;return r.readyState==="closing"||r.readyState==="closed"?!1:r.readyState==="connecting"?(this._messageQueue.push(e),!0):(this._publish(e),!0)},i}(p);return Or=_,Or}var Rr,Ko;function ll(){if(Ko)return Rr;Ko=1;var k=Rr&&Rr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=ks(),_=ul(),o=function(i){k(e,i);function e(r){var t=i.call(this,r.label,r.maxPacketLifeTime,r.maxRetransmits,r.ordered)||this;return Object.defineProperties(t,{_dataChannel:{value:r}}),r.binaryType="arraybuffer",r.addEventListener("message",function(n){t.emit("message",n.data)}),r.addEventListener("close",function(){t.emit("close")}),t}return e.prototype.stop=function(){this._dataChannel.close(),i.prototype.stop.call(this)},e.prototype.toDataTransport=function(){return new _(this._dataChannel)},e}(p);return Rr=o,Rr}var Lr,zo;function dl(){if(zo)return Lr;zo=1;var k=Lr&&Lr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=ms(),_=function(o){k(i,o);function i(e,r){return o.call(this,e,r)||this}return i}(p);return Lr=_,Lr}var oi,Yo;function fl(){if(Yo)return oi;Yo=1;var k=Di().getMediaSections,p=function(){function _(){Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return _.prototype.match=function(o){return this._midsToTrackIds.get(o.transceiver.mid)||null},_.prototype.update=function(o){var i=k(o,"(audio|video)");this._midsToTrackIds=i.reduce(function(e,r){var t=r.match(/^a=mid:(.+)$/m)||[],n=r.match(/^a=msid:.+ (.+)$/m)||[],a=t[1],c=n[1];return a&&c?e.set(a,c):e},this._midsToTrackIds)},_}();return oi=p,oi}var ci,Jo;function vl(){if(Jo)return ci;Jo=1;var k=Ot().RTCSessionDescription,p=Di(),_=p.createPtToCodecName,o=p.getMediaSections;function i(u){var g={type:u.type};return u.type!=="rollback"&&(g.sdp=e(u.sdp)),new k(g)}function e(u){var g=o(u),h=u.split(`\r
m=`)[0];return[h].concat(g.map(r)).join(`\r
`)}function r(u){var g=_(u);u=t(u,g);var h=n(g),S=h.get("rtx")||new Set,R=new Set,T=a(u,g,S,R),b=c(T,R),y=Array.from(R),l=["h264","vp8","vp9"],f=l.reduce(function(m,C){var P=h.get(C)||new Set;return Array.from(P).reduce(function(M,I){return b.has(I)?M:M.add(I)},m)},new Set);return f.forEach(function(m){if(y.length){var C=y.shift();u=s(u,C),u=v(u,C,m)}}),y.forEach(function(m){u=s(u,m),u=d(u,m)}),u}function t(u,g){return Array.from(g.keys()).reduce(function(h,S){var R=new RegExp("^a=rtpmap:"+S+" rtx.+$","gm");return(h.match(R)||[]).slice(g.get(S)==="rtx"?1:0).reduce(function(T,b){var y=new RegExp(`\r
`+b),l=new RegExp(`\r
a=fmtp:`+S+" apt=[0-9]+");return T.replace(y,"").replace(l,"")},h)},u)}function n(u){var g=new Map;return u.forEach(function(h,S){var R=g.get(h)||new Set;return g.set(h,R.add(S))}),g}function a(u,g,h,S){return Array.from(h).reduce(function(R,T){var b=new RegExp("a=fmtp:"+T+" apt=(\\d+)"),y=u.match(b);if(!y)return S.add(T),R;var l=Number.parseInt(y[1]);if(!g.has(l))return S.add(T),R;var f=g.get(l);return f==="rtx"?(S.add(T),R):R.set(T,l)},new Map)}function c(u,g){var h=Array.from(u).reduce(function(S,R){var T=R[0],b=R[1],y=S.get(b)||new Set;return S.set(b,y.add(T))},new Map);return Array.from(h).reduce(function(S,R){var T=R[0],b=Array.from(R[1]);return b.length>1?(b.forEach(function(y){g.add(y)}),S):S.set(T,b[0])},new Map)}function s(u,g){var h=new RegExp("a=fmtp:"+g+`.*\r
`,"gm");return u.replace(h,"")}function d(u,g){var h=new RegExp("a=rtpmap:"+g+`.*\r
`,"gm");return u.replace(h,"")}function v(u,g,h){return u.endsWith(`\r
`)?u+"a=fmtp:"+g+" apt="+h+`\r
`:u+`\r
a=fmtp:`+g+" apt="+h}return ci=i,ci}var ft,Xo;function pl(){if(Xo)return ft;Xo=1;var k=ft&&ft.__extends||function(){var ae=function(re,V){return ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(H,X){H.__proto__=X}||function(H,X){for(var Z in X)Object.prototype.hasOwnProperty.call(X,Z)&&(H[Z]=X[Z])},ae(re,V)};return function(re,V){if(typeof V!="function"&&V!==null)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");ae(re,V);function H(){this.constructor=re}re.prototype=V===null?Object.create(V):(H.prototype=V.prototype,new H)}}(),p=ft&&ft.__read||function(ae,re){var V=typeof Symbol=="function"&&ae[Symbol.iterator];if(!V)return ae;var H=V.call(ae),X,Z=[],ne;try{for(;(re===void 0||re-- >0)&&!(X=H.next()).done;)Z.push(X.value)}catch(be){ne={error:be}}finally{try{X&&!X.done&&(V=H.return)&&V.call(H)}finally{if(ne)throw ne.error}}return Z},_=ft&&ft.__spreadArray||function(ae,re){for(var V=0,H=re.length,X=ae.length;V<H;V++,X++)ae[X]=re[V];return ae},o=Ds(),i=Ot(),e=i.RTCIceCandidate,r=i.RTCPeerConnection,t=i.RTCSessionDescription,n=i.getStats,a=qe(),c=Ce(),s=c.DEFAULT_ICE_GATHERING_TIMEOUT_MS,d=c.DEFAULT_LOG_LEVEL,v=c.DEFAULT_SESSION_TIMEOUT_SEC,u=c.iceRestartBackoffConfig,g=Di(),h=g.addOrRewriteNewTrackIds,S=g.addOrRewriteTrackIds,R=g.createCodecMapForMediaSection,T=g.disableRtx,b=g.enableDtxForOpus,y=g.filterLocalCodecs,l=g.getMediaSections,f=g.removeSSRCAttributes,m=g.revertSimulcast,C=g.setCodecPreferences,P=g.setSimulcast,M=Lt(),I=ht(),O=I.MediaClientLocalDescFailedError,x=I.MediaClientRemoteDescFailedError,E=Pe(),q=E.buildLogLevels,B=E.getPlatform,G=E.isChromeScreenShareTrack,F=E.oncePerTick,N=E.defer,A=cl(),w=sl(),j=ll(),Q=dl(),Y=Dt(),$=ze(),K=fl(),J=vl(),te=a.guessBrowser(),se=B(),oe=/android/.test(se),ce=te==="chrome",de=te==="firefox",ve=te==="safari",ue=0,ee={open:["closed","updating"],updating:["closed","open"],closed:[]},he=function(ae){k(re,ae);function re(V,H,X,Z){var ne=ae.call(this,"open",ee)||this;Z=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:G,iceServers:[],logLevel:d,offerOptions:{},revertSimulcast:m,sessionTimeout:v*1e3,setCodecPreferences:C,setSimulcast:P,Backoff:o,IceConnectionMonitor:w,RTCIceCandidate:e,RTCPeerConnection:r,RTCSessionDescription:t,Timeout:M},Z);var be=D(Object.assign({},Z,Z.rtcConfiguration)),Se=q(Z.logLevel),Ie=Z.RTCPeerConnection;Z.enableDscp===!0&&(Z.chromeSpecificConstraints=Z.chromeSpecificConstraints||{},Z.chromeSpecificConstraints.optional=Z.chromeSpecificConstraints.optional||[],Z.chromeSpecificConstraints.optional.push({googDscp:!0}));var Me=Z.log?Z.log.createLog("webrtc",ne):new $("webrtc",ne,Se,Z.loggerName),Ee=new Ie(be,Z.chromeSpecificConstraints);Z.dummyAudioMediaStreamTrack&&Ee.addTrack(Z.dummyAudioMediaStreamTrack),Object.defineProperties(ne,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_enableDscp:{value:Z.enableDscp},_encodingParameters:{value:H},_isChromeScreenShareTrack:{value:Z.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new Z.Timeout(function(){return ne._handleIceGatheringTimeout()},s,!1)},_iceRestartBackoff:{value:new Z.Backoff(u)},_instanceId:{value:++ue},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_log:{value:Me},_eventObserver:{value:Z.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_rtpNewSenders:{value:new Set},_iceConnectionMonitor:{value:new Z.IceConnectionMonitor(Ee)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:Z.offerOptions},_onEncodingParametersChanged:{value:F(function(){ne._needsAnswer||je(ne)})},_peerConnection:{value:Ee},_preferredAudioCodecs:{value:X.audio},_preferredVideoCodecs:{value:X.video},_shouldApplyDtx:{value:X.audio.every(function(ke){var Le=ke.codec;return Le!=="opus"})||X.audio.some(function(ke){var Le=ke.codec,Ve=ke.dtx;return Le==="opus"&&Ve})},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new Z.Timeout(function(){Me.debug("ICE reconnect timed out"),ne.close()},Z.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new A},_setCodecPreferences:{value:de&&oe&&X.video[0]&&X.video[0].codec.toLowerCase()!=="h264"?function(ke){return ke}:Z.setCodecPreferences},_setSimulcast:{value:Z.setSimulcast},_revertSimulcast:{value:Z.revertSimulcast},_RTCIceCandidate:{value:Z.RTCIceCandidate},_RTCPeerConnection:{value:Z.RTCPeerConnection},_RTCSessionDescription:{value:Z.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},_mediaTrackSenderToPublisherHints:{value:new Map},id:{enumerable:!0,value:V}}),H.on("changed",ne._onEncodingParametersChanged),Ee.addEventListener("connectionstatechange",ne._handleConnectionStateChange.bind(ne)),Ee.addEventListener("datachannel",ne._handleDataChannelEvent.bind(ne)),Ee.addEventListener("icecandidate",ne._handleIceCandidateEvent.bind(ne)),Ee.addEventListener("iceconnectionstatechange",ne._handleIceConnectionStateChange.bind(ne)),Ee.addEventListener("icegatheringstatechange",ne._handleIceGatheringStateChange.bind(ne)),Ee.addEventListener("signalingstatechange",ne._handleSignalingStateChange.bind(ne)),Ee.addEventListener("track",ne._handleTrackEvent.bind(ne));var Oe=ne;return ne.on("stateChanged",function ke(Le){Le==="closed"&&(Oe.removeListener("stateChanged",ke),Oe._dataChannels.forEach(function(Ve,xt){Oe.removeDataTrackSender(xt)}))}),ne}return re.prototype.toString=function(){return"[PeerConnectionV2 #"+this._instanceId+": "+this.id+"]"},re.prototype.setEffectiveAdaptiveSimulcast=function(V){this._log.debug("Setting setEffectiveAdaptiveSimulcast: ",V),this._preferredVideoCodecs.forEach(function(H){"adaptiveSimulcast"in H&&(H.adaptiveSimulcast=V)})},Object.defineProperty(re.prototype,"_shouldApplySimulcast",{get:function(){if(!ce&&!ve)return!1;var V=this._preferredVideoCodecs.some(function(H){return H.codec.toLowerCase()==="vp8"&&H.simulcast&&H.adaptiveSimulcast!==!1});return V},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"connectionState",{get:function(){return this.iceConnectionState==="failed"?"failed":this._peerConnection.connectionState||this.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"iceConnectionState",{get:function(){return this._isIceConnectionInactive&&this._peerConnection.iceConnectionState==="disconnected"||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"isApplicationSectionNegotiated",{get:function(){return this._peerConnection.signalingState!=="closed"?this._peerConnection.localDescription?l(this._peerConnection.localDescription.sdp,"application").length>0:!1:!0},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"_isAdaptiveSimulcastEnabled",{get:function(){var V=this._preferredVideoCodecs.find(function(H){return"adaptiveSimulcast"in H});return V&&V.adaptiveSimulcast===!0},enumerable:!1,configurable:!0}),re.prototype._maybeUpdateEncodings=function(V,H,X){if(X===void 0&&(X=!1),V.kind!=="video"||V.readyState==="ended")return!1;var Z=V.getSettings(),ne=Z.height,be=Z.width;if(typeof ne!="number"||typeof be!="number")return!1;var Se=a.guessBrowser();return Se==="safari"||Se==="chrome"&&this._isAdaptiveSimulcastEnabled?(this._updateEncodings(V,H,X),!0):!1},re.prototype._updateEncodings=function(V,H,X){if(this._isChromeScreenShareTrack(V)){var Z=[{scaleResolutionDownBy:1},{scaleResolutionDownBy:1}];H.forEach(function(ke,Le){var Ve=Z[Le];Ve?(ke.scaleResolutionDownBy=Ve.scaleResolutionDownBy,X&&delete ke.active):(ke.active=!1,delete ke.scaleResolutionDownBy)})}else{var ne=V.getSettings(),be=ne.width,Se=ne.height,Ie=[{pixels:960*540,maxActiveLayers:3},{pixels:480*270,maxActiveLayers:2},{pixels:0,maxActiveLayers:1}],Me=be*Se,Ee=Ie.find(function(ke){return Me>=ke.pixels}),Oe=Math.min(H.length,Ee.maxActiveLayers);H.forEach(function(ke,Le){var Ve=Le<Oe;Ve?(ke.scaleResolutionDownBy=1<<Oe-Le-1,X&&(ke.active=!0)):(ke.active=!1,delete ke.scaleResolutionDownBy)})}this._log.debug("_updateEncodings:",H.map(function(ke,Le){var Ve=ke.active,xt=ke.scaleResolutionDownBy;return"["+Le+": "+Ve+", "+(xt||0)+"]"}).join(", "))},re.prototype._addIceCandidate=function(V){var H=this;return Promise.resolve().then(function(){return V=new H._RTCIceCandidate(V),H._peerConnection.addIceCandidate(V)}).catch(function(X){H._log.warn("Failed to add RTCIceCandidate "+(V?'"'+V.candidate+'"':"null")+": "+X.message)})},re.prototype._addIceCandidates=function(V){return Promise.all(V.map(this._addIceCandidate,this)).then(function(){})},re.prototype._addOrUpdateTransceiver=function(V){var H=this,X=fe(this,V.kind);if(X&&X.sender){var Z=X.sender.track?X.sender.track.id:null;return Z&&this._log.warn("Reusing transceiver: "+X.mid+"] "+Z+" => "+V.id),this._replaceTrackPromises.set(X,X.sender.replaceTrack(V).then(function(){X.direction="sendrecv"},function(){}).finally(function(){H._replaceTrackPromises.delete(X)})),X}return this._peerConnection.addTransceiver(V,{})},re.prototype._checkIceBox=function(V){var H=z(V);if(!H)return Promise.resolve();var X=this._remoteCandidates.setUfrag(H);return this._addIceCandidates(X)},re.prototype._answer=function(V){var H=this;return Promise.resolve().then(function(){return H._negotiationRole||(H._negotiationRole="answerer"),H._setRemoteDescription(V)}).catch(function(){throw new x}).then(function(){return H._peerConnection.createAnswer()}).then(function(X){de?X=new H._RTCSessionDescription({sdp:T(X.sdp),type:X.type}):X=J(X);var Z=f(X.sdp,["mslabel","label"]);if(H._shouldApplySimulcast){var ne=Z;Z=H._setSimulcast(ne,H._trackIdsToAttributes),Z=H._revertSimulcast(Z,ne,V.sdp)}return Z=Z.replace(/42e015/g,"42e01f"),H._setLocalDescription({type:X.type,sdp:Z})}).then(function(){return H._checkIceBox(V)}).then(function(){return H._queuedDescription&&H._updateDescription(H._queuedDescription)}).then(function(){return H._queuedDescription=null,H._maybeReoffer(H._peerConnection.localDescription)}).catch(function(X){var Z=X instanceof x?X:new O;throw H._publishMediaWarning({message:"Failed to _answer",code:Z.code,error:X}),Z})},re.prototype._close=function(){return this._iceConnectionMonitor.stop(),this._peerConnection.signalingState!=="closed"?(this._peerConnection.close(),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0):!1},re.prototype._handleConnectionStateChange=function(){this.emit("connectionStateChanged")},re.prototype._handleDataChannelEvent=function(V){var H=this,X=V.channel,Z=new j(X);this._dataTrackReceivers.add(Z),X.addEventListener("close",function(){H._dataTrackReceivers.delete(Z)}),this.emit("trackAdded",Z)},re.prototype._handleGlare=function(V){var H=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return H._trackIdsToAttributes=new Map(H._appliedTrackIdsToAttributes),H._setLocalDescription({type:"rollback"})}).then(function(){return H._needsAnswer=!1,H._answer(V)}).then(function(X){return X?Promise.resolve():H._offer()})},re.prototype._publishMediaWarning=function(V){var H=V.message,X=V.code,Z=V.error,ne=V.sdp;this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:H,code:X,context:JSON.stringify({error:Z.message,sdp:ne})}})},re.prototype._handleIceCandidateEvent=function(V){V.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(V.candidate));var H={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};V.candidate||(H.ice.complete=!0),this._isIceLite&&V.candidate||(H.ice.revision=this._localCandidatesRevision++,this.emit("candidates",H))},re.prototype._handleIceConnectionStateChange=function(){var V=this,H=this._peerConnection.iceConnectionState,X=["connected","completed"].includes(H),Z=this._log;Z.debug('ICE connection state is "'+H+'"'),X&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),this._lastIceConnectionState!=="failed"&&H==="failed"&&!this._shouldRestartIce&&!this._isRestartingIce?(Z.warn("ICE failed"),this._initiateIceRestartBackoff()):["disconnected","failed"].includes(this._lastIceConnectionState)&&X&&Z.debug("ICE reconnected"),H==="connected"?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start(function(){V._iceConnectionMonitor.stop(),!V._shouldRestartIce&&!V._isRestartingIce&&(Z.warn("ICE Connection Monitor detected inactivity"),V._isIceConnectionInactive=!0,V._initiateIceRestartBackoff(),V.emit("iceConnectionStateChanged"),V.emit("connectionStateChanged"))})):["disconnected","completed"].includes(H)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=H,this.emit("iceConnectionStateChanged")},re.prototype._handleIceGatheringTimeout=function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")},re.prototype._handleIceGatheringStateChange=function(){var V=this._peerConnection.iceGatheringState,H=this._log;H.debug('ICE gathering state is "'+V+'"');var X=this._iceGatheringTimeout,Z=X.delay,ne=X.isSet;V==="gathering"&&!this._didGenerateLocalCandidates&&!ne&&(H.debug("Starting ICE gathering timeout: "+Z),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())},re.prototype._handleSignalingStateChange=function(){this._peerConnection.signalingState==="stable"&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))},re.prototype._handleTrackEvent=function(V){var H=this,X=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher=this._trackMatcher||new K,this._trackMatcher.update(X);var Z=V.track,ne=this._trackMatcher.match(V)||Z.id,be=new Q(ne,Z);this._mediaTrackReceivers.forEach(function(Se){Se.track.id===be.track.id&&H._mediaTrackReceivers.delete(Se)}),this._mediaTrackReceivers.add(be),Z.addEventListener?Z.addEventListener("ended",function(){return H._mediaTrackReceivers.delete(be)}):Z.onended=function(){return H._mediaTrackReceivers.delete(be)},this.emit("trackAdded",be)},re.prototype._initiateIceRestart=function(){if(this._peerConnection.signalingState!=="closed"){var V=this._log;V.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var H=this._iceReconnectTimeout,X=H.delay,Z=H.isSet;Z||(V.debug("Starting ICE reconnect timeout: "+X),this._iceReconnectTimeout.start()),this.offer().catch(function(ne){V.error("offer failed in _initiateIceRestart with: "+ne.message)})}},re.prototype._initiateIceRestartBackoff=function(){var V=this;this._peerConnection.signalingState==="closed"||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff(function(){return V._initiateIceRestart()}))},re.prototype._maybeReoffer=function(V){var H=this._shouldOffer;if(V&&V.sdp){var X=this._peerConnection.getSenders().filter(function(Ie){return Ie.track});H=["audio","video"].reduce(function(Ie,Me){var Ee=l(V.sdp,Me,"(sendrecv|sendonly)"),Oe=X.filter(L.bind(null,Me));return Ie||Ee.length<Oe.length},H);var Z=this._dataChannels.size>0,ne=l(V.sdp,"application").length>0,be=Z&&!ne;H=H||be}var Se=H?this._offer():Promise.resolve();return Se.then(function(){return H})},re.prototype._offer=function(){var V=this,H=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,H.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then(function(){return V._peerConnection.createOffer(H)}).catch(function(X){var Z=new O;throw V._publishMediaWarning({message:"Failed to create offer",code:Z.code,error:X}),Z}).then(function(X){de?X=new V._RTCSessionDescription({sdp:T(X.sdp),type:X.type}):X=J(X);var Z=f(X.sdp,["mslabel","label"]);Z=V._peerConnection.remoteDescription?y(Z,V._peerConnection.remoteDescription.sdp):Z;var ne=V._setCodecPreferences(Z,V._preferredAudioCodecs,V._preferredVideoCodecs);return V._shouldOffer=!1,V._negotiationRole||(V._negotiationRole="offerer"),V._shouldApplySimulcast&&(V._localDescriptionWithoutSimulcast={type:"offer",sdp:ne},ne=V._setSimulcast(ne,V._trackIdsToAttributes)),V._setLocalDescription({type:"offer",sdp:ne})})},re.prototype._getMediaTrackSenderId=function(V){var H=Array.from(this._rtpSenders.keys()).find(function(X){var Z=X.track.id;return Z===V});return H?H.id:V},re.prototype._addOrRewriteLocalTrackIds=function(V){var H=this,X=this._peerConnection.getTransceivers(),Z=X.filter(function(Oe){var ke=Oe.sender,Le=Oe.stopped;return!Le&&ke&&ke.track}),ne=Z.filter(function(Oe){var ke=Oe.mid;return ke}),be=new Map(ne.map(function(Oe){var ke=Oe.mid,Le=Oe.sender;return[ke,H._getMediaTrackSenderId(Le.track.id)]})),Se=S(V.sdp,be),Ie=Z.filter(function(Oe){var ke=Oe.mid;return!ke}),Me=new Map(["audio","video"].map(function(Oe){return[Oe,Ie.filter(function(ke){var Le=ke.sender;return Le.track.kind===Oe}).map(function(ke){var Le=ke.sender;return H._getMediaTrackSenderId(Le.track.id)})]})),Ee=h(Se,be,Me);return new this._RTCSessionDescription({sdp:Ee,type:V.type})},re.prototype._rollbackAndApplyOffer=function(V){var H=this;return this._setLocalDescription({type:"rollback"}).then(function(){return H._setLocalDescription(V)})},re.prototype._setLocalDescription=function(V){var H=this;return V.type!=="rollback"&&this._shouldApplyDtx&&(V=new this._RTCSessionDescription({sdp:b(V.sdp),type:V.type})),this._peerConnection.setLocalDescription(V).catch(function(X){H._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+V.type+'" failed with the error "'+X.message+'".',X);var Z=new O,ne={message:'Calling setLocalDescription with an RTCSessionDescription of type "'+V.type+'" failed',code:Z.code,error:X};throw V.sdp&&(H._log.warn("The SDP was "+V.sdp),ne.sdp=V.sdp),H._publishMediaWarning(ne),Z}).then(function(){V.type!=="rollback"&&(H._localDescription=H._addOrRewriteLocalTrackIds(V),H._shouldApplyDtx&&(H._localDescription=new H._RTCSessionDescription({sdp:b(H._localDescription.sdp,[]),type:H._localDescription.type})),H._localCandidates=[],V.type==="offer"?H._descriptionRevision++:V.type==="answer"&&(H._lastStableDescriptionRevision=H._descriptionRevision,_e(H)),H._localUfrag=z(V),H.emit("description",H.getState()))})},re.prototype._setRemoteDescription=function(V){var H=this;return V.sdp&&(V.sdp=this._setCodecPreferences(V.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),this._shouldApplyDtx?V.sdp=b(V.sdp):V.sdp=b(V.sdp,[]),de&&(V.sdp=U(V.sdp)),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(V.sdp))),V=new this._RTCSessionDescription(V),Promise.resolve().then(function(){if(V.type==="answer"&&H._localDescriptionWithoutSimulcast){var X=H._preferredVideoCodecs.find(function(be){return"adaptiveSimulcast"in be}),Z=!!X&&X.adaptiveSimulcast===!1,ne=H._revertSimulcast(H._localDescription.sdp,H._localDescriptionWithoutSimulcast.sdp,V.sdp,Z);if(H._localDescriptionWithoutSimulcast=null,ne!==H._localDescription.sdp)return H._rollbackAndApplyOffer({type:H._localDescription.type,sdp:ne})}}).then(function(){return H._peerConnection.setRemoteDescription(V)}).then(function(){V.type==="answer"&&(H._isRestartingIce&&(H._log.debug("An ICE restart was in-progress and is now completed"),H._isRestartingIce=!1),_e(H))},function(X){throw H._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+V.type+'" failed with the error "'+X.message+'".',X),V.sdp&&H._log.warn("The SDP was "+V.sdp),X})},re.prototype._updateDescription=function(V){var H=this;switch(V.type){case"answer":case"pranswer":if(V.revision!==this._descriptionRevision||this._peerConnection.signalingState!=="have-local-offer")return Promise.resolve();this._descriptionRevision=V.revision;break;case"close":return this._close();case"create-offer":return V.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=V,Promise.resolve()):(this._descriptionRevision=V.revision,this._offer());case"offer":return V.revision<=this._lastStableDescriptionRevision||this._peerConnection.signalingState==="closed"?Promise.resolve():this._peerConnection.signalingState==="have-local-offer"?this._needsAnswer&&this._lastStableDescriptionRevision===0?(this._queuedDescription=V,Promise.resolve()):(this._descriptionRevision=V.revision,this._handleGlare(V)):(this._descriptionRevision=V.revision,this._answer(V).then(function(){}))}var X=V.revision;return Promise.resolve().then(function(){return H._setRemoteDescription(V)}).catch(function(Z){var ne=new x;throw H._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'+V.type+'" failed',code:ne.code,error:Z,sdp:V.sdp}),ne}).then(function(){return H._lastStableDescriptionRevision=X,H._needsAnswer=!1,H._checkIceBox(V)}).then(function(){return H._queuedDescription&&H._updateDescription(H._queuedDescription)}).then(function(){return H._queuedDescription=null,H._maybeReoffer(H._peerConnection.localDescription).then(function(){})})},re.prototype._updateIce=function(V){var H=this._remoteCandidates.update(V);return this._addIceCandidates(H)},re.prototype.addDataTrackSender=function(V){if(!this._dataChannels.has(V))try{var H={ordered:V.ordered};V.maxPacketLifeTime!==null&&(H.maxPacketLifeTime=V.maxPacketLifeTime),V.maxRetransmits!==null&&(H.maxRetransmits=V.maxRetransmits);var X=this._peerConnection.createDataChannel(V.id,H);V.addDataChannel(X),this._dataChannels.set(V,X)}catch(Z){this._log.warn('Error creating an RTCDataChannel for DataTrack "'+V.id+'": '+Z.message)}},re.prototype._handleQueuedPublisherHints=function(){var V=this;this._peerConnection.signalingState==="stable"&&this._mediaTrackSenderToPublisherHints.forEach(function(H,X){var Z=H.deferred,ne=H.encodings;V._mediaTrackSenderToPublisherHints.delete(X),V._setPublisherHint(X,ne).then(function(be){return Z.resolve(be)}).catch(function(be){return Z.reject(be)})})},re.prototype._setPublisherHint=function(V,H){var X=this;if(de)return Promise.resolve("COULD_NOT_APPLY_HINT");if(this._mediaTrackSenderToPublisherHints.has(V)){var Z=this._mediaTrackSenderToPublisherHints.get(V);Z.deferred.resolve("REQUEST_SKIPPED"),this._mediaTrackSenderToPublisherHints.delete(V)}var ne=this._rtpSenders.get(V);if(!ne)return this._log.warn("Could not apply publisher hint because RTCRtpSender was not found"),Promise.resolve("UNKNOWN_TRACK");if(this._peerConnection.signalingState==="closed")return this._log.warn('Could not apply publisher hint because signalingState was "closed"'),Promise.resolve("COULD_NOT_APPLY_HINT");if(this._peerConnection.signalingState!=="stable"){this._log.debug("Queuing up publisher hint because signalingState:",this._peerConnection.signalingState);var be=N();return this._mediaTrackSenderToPublisherHints.set(V,{deferred:be,encodings:H}),be.promise}var Se=ne.getParameters();return H!==null&&H.forEach(function(Ie){var Me=Ie.enabled,Ee=Ie.layer_index;Se.encodings.length>Ee?(X._log.debug("layer:"+Ee+", active:"+Se.encodings[Ee].active+" => "+Me),Se.encodings[Ee].active=Me):X._log.warn("invalid layer:"+Ee+", active:"+Me)}),this._maybeUpdateEncodings(ne.track,Se.encodings,H===null),ne.setParameters(Se).then(function(){return"OK"}).catch(function(Ie){return X._log.error("Failed to apply publisher hints:",Ie),"COULD_NOT_APPLY_HINT"})},re.prototype.addMediaTrackSender=function(V){var H=this;if(!(this._peerConnection.signalingState==="closed"||this._rtpSenders.has(V))){var X=this._addOrUpdateTransceiver(V.track),Z=X.sender;V.addSender(Z,function(ne){return H._setPublisherHint(V,ne)}),this._rtpNewSenders.add(Z),this._rtpSenders.set(V,Z)}},re.prototype.close=function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))},re.prototype.getTrackReceivers=function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))},re.prototype.getState=function(){if(!this._localDescription)return null;var V=this._localDescription.type==="answer"?this._lastStableDescriptionRevision:this._descriptionRevision,H={type:this._localDescription.type,revision:V};return this._localDescription.sdp&&(H.sdp=this._localDescription.sdp),{description:H,id:this.id}},re.prototype.offer=function(){var V=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(H){V.transition("updating",H);var X=V._needsAnswer||V._isRestartingIce?Promise.resolve():V._offer();return X.then(function(){V.tryTransition("open",H)},function(Z){throw V.tryTransition("open",H),Z})})},re.prototype.removeDataTrackSender=function(V){var H=this._dataChannels.get(V);H&&(V.removeDataChannel(H),this._dataChannels.delete(V),H.close())},re.prototype.removeMediaTrackSender=function(V){var H=this._rtpSenders.get(V);if(H){if(this._peerConnection.signalingState!=="closed"&&this._peerConnection.removeTrack(H),V.removeSender(H),this._mediaTrackSenderToPublisherHints.has(V)){var X=this._mediaTrackSenderToPublisherHints.get(V);X.deferred.resolve("UNKNOWN_TRACK"),this._mediaTrackSenderToPublisherHints.delete(V)}this._rtpNewSenders.delete(H),this._rtpSenders.delete(V)}},re.prototype.setConfiguration=function(V){typeof this._peerConnection.setConfiguration=="function"&&this._peerConnection.setConfiguration(D(V))},re.prototype.setIceReconnectTimeout=function(V){return this._iceReconnectTimeout.setDelay(V),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this},re.prototype.update=function(V){var H=this;return this.bracket("updating",function(X){if(H.state==="closed")return Promise.resolve();H.transition("updating",X);var Z=[];return V.ice&&Z.push(H._updateIce(V.ice)),V.description&&Z.push(H._updateDescription(V.description)),Promise.all(Z).then(function(){H.tryTransition("open",X)},function(ne){throw H.tryTransition("open",X),ne})})},re.prototype.getStats=function(){var V=this;return n(this._peerConnection,{log:this._log}).then(function(H){return W(V,H)})},re}(Y);function le(ae,re){var V=ae._getMediaTrackSenderId(re.trackId);return Object.assign(re,{trackId:V})}function ge(ae,re){var V=_([],p(ae._mediaTrackReceivers)).find(function(X){return X.track.id===re.trackId}),H=V?V.id:null;return Object.assign(re,{trackId:H})}function W(ae,re){return Object.assign(re,{remoteAudioTrackStats:re.remoteAudioTrackStats.map(function(V){return ge(ae,V)}),remoteVideoTrackStats:re.remoteVideoTrackStats.map(function(V){return ge(ae,V)}),localAudioTrackStats:re.localAudioTrackStats.map(function(V){return le(ae,V)}),localVideoTrackStats:re.localVideoTrackStats.map(function(V){return le(ae,V)})})}function z(ae){if(ae.sdp){var re=ae.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(re)return re[1]}return null}function D(ae){return ae===void 0&&(ae={}),Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},ae)}function L(ae,re){var V=re.track;return V&&V.kind===ae&&V.readyState!=="ended"}function U(ae){return ae.replace(/a=msid:[^ ]+ /g,"a=msid:- ")}function ie(ae,re){return!ae.stopped&&!re._replaceTrackPromises.has(ae)&&["inactive","recvonly"].includes(ae.direction)}function fe(ae,re){var V={audio:ae._preferredAudioCodecs.map(function(ne){var be=ne.codec;return be.toLowerCase()}),video:ae._preferredVideoCodecs.map(function(ne){var be=ne.codec;return be.toLowerCase()})}[re],H=ae._recycledTransceivers[re],X=V.find(function(ne){return ae._localCodecs.has(ne)});if(!X)return H.shift();var Z=H.find(function(ne){var be=ae._remoteCodecMaps.get(ne.mid);return be&&be.has(X)});return Z&&H.splice(H.indexOf(Z),1),Z}function me(ae){var re=ae._peerConnection.localDescription;!re||!re.sdp||l(re.sdp).forEach(function(V){var H=R(V);H.forEach(function(X,Z){return ae._localCodecs.add(Z)})})}function we(ae){var re=ae._peerConnection.remoteDescription;!re||!re.sdp||l(re.sdp).forEach(function(V){var H=V.match(/^a=mid:(.+)$/m);if(!(!H||!H[1])){var X=H[1],Z=R(V);ae._remoteCodecMaps.set(X,Z)}})}function Re(ae){ae._recycledTransceivers.audio=[],ae._recycledTransceivers.video=[],ae._peerConnection.getTransceivers().forEach(function(re){if(ie(re,ae)){var V=re.receiver.track;ae._recycledTransceivers[V.kind].push(re)}})}function _e(ae){Re(ae),me(ae),we(ae),je(ae).then(function(){ae._handleQueuedPublisherHints()})}function je(ae){var re=ae._encodingParameters,V=re.maxAudioBitrate,H=re.maxVideoBitrate,X=new Map([["audio",V],["video",H]]),Z=[];return ae._peerConnection.getSenders().filter(function(ne){return ne.track}).forEach(function(ne){var be=X.get(ne.track.kind),Se=ne.getParameters();be===null||be===0?He(Se):ae._isChromeScreenShareTrack(ne.track)?ae._log.warn("Not setting maxBitrate for "+ne.track.kind+" Track "+ne.track.id+" because it appears to be screen share track: "+ne.track.label):We(Se,be),!de&&Se.encodings.length>0&&(ne.track.kind==="audio"?Se.encodings[0].priority="high":ae._isChromeScreenShareTrack(ne.track)&&(Se.encodings[0].priority="medium"),ae._enableDscp&&(Se.encodings[0].networkPriority="high"));var Ie=ae._rtpNewSenders.has(ne);ae._maybeUpdateEncodings(ne.track,Se.encodings,Ie),ae._rtpNewSenders.delete(ne);var Me=ne.setParameters(Se).catch(function(Ee){ae._log.warn("Error while setting encodings parameters for "+ne.track.kind+" Track "+ne.track.id+": "+(Ee.message||Ee.name))});Z.push(Me)}),Promise.all(Z)}function He(ae){Array.isArray(ae.encodings)&&ae.encodings.forEach(function(re){return delete re.maxBitrate})}function We(ae,re){de?ae.encodings=[{maxBitrate:re}]:ae.encodings.forEach(function(V){V.maxBitrate=re})}return ft=he,ft}var vt,Zo;function hl(){if(Zo)return vt;Zo=1;var k=vt&&vt.__extends||function(){var l=function(f,m){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,P){C.__proto__=P}||function(C,P){for(var M in P)Object.prototype.hasOwnProperty.call(P,M)&&(C[M]=P[M])},l(f,m)};return function(f,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");l(f,m);function C(){this.constructor=f}f.prototype=m===null?Object.create(m):(C.prototype=m.prototype,new C)}}(),p=vt&&vt.__read||function(l,f){var m=typeof Symbol=="function"&&l[Symbol.iterator];if(!m)return l;var C=m.call(l),P,M=[],I;try{for(;(f===void 0||f-- >0)&&!(P=C.next()).done;)M.push(P.value)}catch(O){I={error:O}}finally{try{P&&!P.done&&(m=C.return)&&m.call(C)}finally{if(I)throw I.error}}return M},_=vt&&vt.__spreadArray||function(l,f){for(var m=0,C=f.length,P=l.length;m<C;m++,P++)l[P]=f[m];return l},o=qe().guessBrowser,i=pl(),e=ys(),r=hs(),t=Pe(),n=ht().MediaConnectionError,a=o()==="firefox",c=function(l){k(f,l);function f(m,C,P){var M=l.call(this)||this;P=Object.assign({audioContextFactory:a?Sn():null,PeerConnectionV2:i},P);var I=P.audioContextFactory?P.audioContextFactory.getOrCreate(M):null,O=I?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(M,{_audioContextFactory:{value:P.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:t.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:I?new e(s(I)):null},_encodingParameters:{value:m},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:O},_peerConnections:{value:new Map},_preferredCodecs:{value:C},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:P.PeerConnectionV2}}),M}return f.prototype.setEffectiveAdaptiveSimulcast=function(m){this._peerConnections.forEach(function(C){return C.setEffectiveAdaptiveSimulcast(m)}),this._preferredCodecs.video.forEach(function(C){"adaptiveSimulcast"in C&&(C.adaptiveSimulcast=m)})},Object.defineProperty(f.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"iceConnectionState",{get:function(){return this._iceConnectionState},enumerable:!1,configurable:!0}),f.prototype._closeAbsentPeerConnections=function(m){var C=new Set(m.map(function(P){return P.id}));return this._peerConnections.forEach(function(P){C.has(P.id)||P._close()}),this},f.prototype._getConfiguration=function(){return this._configurationDeferred.promise},f.prototype._getOrCreate=function(m,C){var P=this,M=this,I=this._peerConnections.get(m);if(!I){var O=this._PeerConnectionV2,x=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},C);try{I=new O(m,this._encodingParameters,this._preferredCodecs,x)}catch{throw new n}this._peerConnections.set(I.id,I),I.on("candidates",this.queue.bind(this,"candidates")),I.on("description",this.queue.bind(this,"description")),I.on("trackAdded",this.queue.bind(this,"trackAdded")),I.on("stateChanged",function E(q){q==="closed"&&(I.removeListener("stateChanged",E),M._dataTrackSenders.forEach(function(B){return I.removeDataTrackSender(B)}),M._mediaTrackSenders.forEach(function(B){return I.removeMediaTrackSender(B)}),M._peerConnections.delete(I.id),M._closedPeerConnectionIds.add(I.id),y(M),b(M))}),I.on("connectionStateChanged",function(){return y(P)}),I.on("iceConnectionStateChanged",function(){return b(P)}),this._dataTrackSenders.forEach(I.addDataTrackSender,I),this._mediaTrackSenders.forEach(I.addMediaTrackSender,I),b(this)}return I},f.prototype.close=function(){return this._peerConnections.forEach(function(m){m.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),b(this),this},f.prototype.createAndOffer=function(){var m=this;return this._getConfiguration().then(function(C){var P;do P=t.makeUUID();while(m._peerConnections.has(P));return m._getOrCreate(P,C)}).then(function(C){return C.offer()}).then(function(){return m})},f.prototype.getTrackReceivers=function(){return t.flatMap(this._peerConnections,function(m){return m.getTrackReceivers()})},f.prototype.getStates=function(){var m=[];return this._peerConnections.forEach(function(C){var P=C.getState();P&&m.push(P)}),m},f.prototype.setConfiguration=function(m){return this._configuration&&(this._configurationDeferred=t.defer(),this._peerConnections.forEach(function(C){C.setConfiguration(m)})),this._configuration=m,this._configurationDeferred.resolve(m),this},f.prototype.setIceReconnectTimeout=function(m){return this._sessionTimeout===null&&(this._peerConnections.forEach(function(C){C.setIceReconnectTimeout(m)}),this._sessionTimeout=m),this},f.prototype.setTrackSenders=function(m){var C=new Set(m.filter(function(I){return I.kind==="data"})),P=new Set(m.filter(function(I){return I&&(I.kind==="audio"||I.kind==="video")})),M=u(this,C,P);return this._dataTrackSenders=C,this._mediaTrackSenders=P,d(this,M),this},f.prototype.update=function(m,C){var P=this;return C===void 0&&(C=!1),C&&this._closeAbsentPeerConnections(m),this._getConfiguration().then(function(M){return Promise.all(m.map(function(I){if(P._closedPeerConnectionIds.has(I.id))return null;var O=P._getOrCreate(I.id,M);return O.update(I)}))}).then(function(){return P})},f.prototype.getStats=function(){var m=Array.from(this._peerConnections.values());return Promise.all(m.map(function(C){return C.getStats().then(function(P){return[C.id,P]})})).then(function(C){return new Map(C)})},f}(r);function s(l){var f=l.createMediaStreamDestination();return f.stream.getAudioTracks()[0]}function d(l,f){(f.data.add.size||f.data.remove.size||f.media.add.size||f.media.remove.size)&&l._peerConnections.forEach(function(m){f.data.remove.forEach(m.removeDataTrackSender,m),f.media.remove.forEach(m.removeMediaTrackSender,m),f.data.add.forEach(m.addDataTrackSender,m),f.media.add.forEach(m.addMediaTrackSender,m),(f.media.add.size||f.media.remove.size||f.data.add.size&&!m.isApplicationSectionNegotiated)&&m.offer()})}function v(l,f){var m=t.difference(f,l._dataTrackSenders),C=t.difference(l._dataTrackSenders,f);return{add:m,remove:C}}function u(l,f,m){return{data:v(l,f),media:g(l,m)}}function g(l,f){var m=t.difference(f,l._mediaTrackSenders),C=t.difference(l._mediaTrackSenders,f);return{add:m,remove:C}}var h={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3},S;function R(){return Object.keys(h).reduce(function(l,f){var m;return Object.assign(l,(m={},m[h[f]]=f,m))},{})}function T(l){return l.length?(S=S||R(),l.reduce(function(f,m){return S[Math.max(h[f],h[m])]})):"new"}function b(l){l._lastIceConnectionState=l.iceConnectionState,l._iceConnectionState=T(_([],p(l._peerConnections.values())).map(function(f){return f.iceConnectionState})),l.iceConnectionState!==l._lastIceConnectionState&&l.emit("iceConnectionStateChanged")}function y(l){l._lastConnectionState=l.connectionState,l._connectionState=T(_([],p(l._peerConnections.values())).map(function(f){return f.connectionState})),l.connectionState!==l._lastConnectionState&&l.emit("connectionStateChanged")}return vt=c,vt}var xr,ec;function jt(){if(ec)return xr;ec=1;var k=xr&&xr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Ue(),_=0,o=function(i){k(e,i);function e(r,t,n){var a=i.call(this)||this;return Object.defineProperties(a,{_instanceId:{value:_++},channel:{value:t},_log:{value:n.log.createLog("default",a)},_getReceiver:{value:r},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),a}return Object.defineProperty(e.prototype,"isSetup",{get:function(){return!!this._receiverPromise},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"[MediaSignaling #"+this._instanceId+":"+this.channel+"]"},e.prototype.setup=function(r){var t=this;this._teardown(),this._log.info("setting up msp transport for id:",r);var n=this._getReceiver(r).then(function(a){if(a.kind!=="data"&&t._log.error("Expected a DataTrackReceiver"),t._receiverPromise===n){try{t._transport=a.toDataTransport(),t.emit("ready",t._transport)}catch(c){t._log.error("Failed to toDataTransport: "+c.message)}a.once("close",function(){return t._teardown()})}});this._receiverPromise=n},e.prototype._teardown=function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))},e}(p);return xr=o,xr}var Ar,tc;function _l(){if(tc)return Ar;tc=1;var k=Ar&&Ar.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jt(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e,"active_speaker",r)||this;return Object.defineProperties(t,{_loudestParticipantSid:{value:null,writable:!0}}),t.on("ready",function(n){n.on("message",function(a){switch(a.type){case"active_speaker":t._setLoudestParticipantSid(a.participant);break}})}),t}return Object.defineProperty(i.prototype,"loudestParticipantSid",{get:function(){return this._loudestParticipantSid},enumerable:!1,configurable:!0}),i.prototype._setLoudestParticipantSid=function(e){this.loudestParticipantSid!==e&&(this._loudestParticipantSid=e,this.emit("updated"))},i}(p);return Ar=_,Ar}var si,rc;function ml(){if(rc)return si;rc=1;var k=function(){function p(_,o,i,e){Object.defineProperties(this,{availableSend:{enumerable:!0,value:i},recv:{enumerable:!0,value:o},rtt:{enumerable:!0,value:e},send:{enumerable:!0,value:_}})}return p.of=function(_,o){var i=(o.timestamp-_.timestamp)/1e3,e=o.bytesSent-_.bytesSent,r=o.bytesReceived-_.bytesReceived,t=i>0?e/i*8:0,n=i>0?r/i*8:0,a=o.availableOutgoingBitrate,c=o.currentRoundTripTime;return new p(t,n,a,c)},p}();return si=k,si}var ui,nc;function yl(){if(nc)return ui;nc=1;var k=ml(),p=function(){function _(){Object.defineProperties(this,{lastReport:{enumerable:!0,value:new k(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return _.prototype.next=function(o){var i=this.lastStats;if(this.lastStats=o,i){var e=i.id===o.id?k.of(i,o):new k(0,0);this.lastReport=e}return this.lastReport},_}();return ui=p,ui}var li,ic;function js(){if(ic)return li;ic=1;function k(p){return p=p.filter(function(_){return typeof _=="number"}),p.length<1?void 0:p.reduce(function(_,o){return o+_})/p.length}return li=k,li}var di,ac;function Ns(){if(ac)return di;ac=1;var k=function(){function p(_,o,i){Object.defineProperties(this,{id:{enumerable:!0,value:_},trackId:{enumerable:!0,value:o},bitrate:{enumerable:!0,value:i}})}return p}();return di=k,di}var fi,oc;function qs(){if(oc)return fi;oc=1;function k(p){return p.reduce(function(_,o){return typeof o=="number"?o+_:_},0)}return fi=k,fi}var Mr,cc;function Vs(){if(cc)return Mr;cc=1;var k=Mr&&Mr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=js(),_=Ns(),o=qs(),i=function(e){k(r,e);function r(t,n,a,c,s,d,v){var u=e.call(this,t,n,a)||this,g=s>0?c/s:0;return Object.defineProperties(u,{deltaPacketsLost:{enumerable:!0,value:c},deltaPacketsReceived:{enumerable:!0,value:s},fractionLost:{enumerable:!0,value:d},jitter:{enumerable:!0,value:v},phonyFractionLost:{enumerable:!0,value:g}}),u}return r.of=function(t,n,a){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var c=(a.timestamp-n.timestamp)/1e3,s=a.bytesReceived-n.bytesReceived,d=c>0?s/c*8:0,v=Math.max(a.packetsLost-n.packetsLost,0),u=a.packetsReceived-n.packetsReceived,g=a.fractionLost,h=a.jitter;return new r(n.id,t,d,v,u,g,h)},r.summarize=function(t){var n=t.map(function(d){return d.summarize()}),a=o(n.map(function(d){return d.bitrate})),c=p(n.map(function(d){return d.fractionLost})),s=p(n.map(function(d){return d.jitter}));return{bitrate:a,fractionLost:c,jitter:s}},r.prototype.summarize=function(){return{bitrate:this.bitrate,fractionLost:typeof this.fractionLost=="number"?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}},r}(_);return Mr=i,Mr}var Ir,sc;function Fs(){if(sc)return Ir;sc=1;var k=Ir&&Ir.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=js(),_=Ns(),o=qs(),i=function(e){k(r,e);function r(t,n,a,c){var s=e.call(this,t,n,a)||this;return Object.defineProperties(s,{rtt:{enumerable:!0,value:c}}),s}return r.of=function(t,n,a,c){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var s=(a.timestamp-n.timestamp)/1e3,d=a.bytesSent-n.bytesSent,v=s>0?d/s*8:0,u=c&&typeof c.roundTripTime=="number"?c.roundTripTime/1e3:void 0;return new r(n.id,t,v,u)},r.summarize=function(t){var n=o(t.map(function(c){return c.bitrate})),a=p(t.map(function(c){return c.rtt}));return{bitrate:n,rtt:a}},r}(_);return Ir=i,Ir}var vi,uc;function gl(){if(uc)return vi;uc=1;var k=Vs(),p=Fs(),_=function(){function o(i,e,r){Object.defineProperties(this,{ice:{enumerable:!0,value:i},audio:{enumerable:!0,value:e},video:{enumerable:!0,value:r}})}return o.prototype.summarize=function(){var i=this.audio.send.concat(this.video.send),e=p.summarize(i),r=this.audio.recv.concat(this.video.recv),t=k.summarize(r);return{ice:this.ice,send:e,recv:t,audio:{send:p.summarize(this.audio.send),recv:k.summarize(this.audio.recv)},video:{send:p.summarize(this.video.send),recv:k.summarize(this.video.recv)}}},o}();return vi=_,vi}var pi,lc;function Bs(){if(lc)return pi;lc=1;var k=function(){function p(_,o,i){Object.defineProperties(this,{id:{enumerable:!0,value:_,writable:!0},trackId:{enumerable:!0,value:o,writable:!0},lastStats:{enumerable:!0,value:i,writable:!0}})}return p}();return pi=k,pi}var Dr,dc;function bl(){if(dc)return Dr;dc=1;var k=Dr&&Dr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Vs(),_=Bs(),o=function(i){k(e,i);function e(r,t){var n=i.call(this,t.id,r,t)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return e.prototype.next=function(r,t){var n=this.lastStats;this.lastStats=t,this.trackId=r;var a=p.of(r,n,t);return this.lastReport=a,a},e}(_);return Dr=o,Dr}var jr,fc;function kl(){if(fc)return jr;fc=1;var k=jr&&jr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Bs(),_=Fs(),o=function(i){k(e,i);function e(r,t){var n=i.call(this,t.id,r,t)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return e.prototype.next=function(r,t,n){var a=this.lastStats;this.lastStats=t,this.trackId=r;var c=_.of(r,a,t,n);return this.lastReport=c,c},e}(p);return jr=o,jr}var pt,vc;function Sl(){if(vc)return pt;vc=1;var k=pt&&pt.__read||function(f,m){var C=typeof Symbol=="function"&&f[Symbol.iterator];if(!C)return f;var P=C.call(f),M,I=[],O;try{for(;(m===void 0||m-- >0)&&!(M=P.next()).done;)I.push(M.value)}catch(x){O={error:x}}finally{try{M&&!M.done&&(C=P.return)&&C.call(P)}finally{if(O)throw O.error}}return I},p=pt&&pt.__spreadArray||function(f,m){for(var C=0,P=m.length,M=f.length;C<P;C++,M++)f[M]=m[C];return f},_=pt&&pt.__values||function(f){var m=typeof Symbol=="function"&&Symbol.iterator,C=m&&f[m],P=0;if(C)return C.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&P>=f.length&&(f=void 0),{value:f&&f[P++],done:!f}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")},o=qe().guessBrowser,i=yl(),e=gl(),r=bl(),t=kl(),n=function(){function f(m){Object.defineProperties(this,{pc:{enumerable:!0,value:m},ice:{enumerable:!0,value:new i},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return f.prototype.next=function(){var m=this,C=o()==="firefox"?y(this):l(this);return C.then(function(){var P=p([],k(m.audio.send.values())),M=p([],k(m.video.send.values())),I=p([],k(m.audio.recv.values())),O=p([],k(m.video.recv.values())),x=new e(m.ice.lastReport,{send:P.map(function(E){return E.lastReport}).filter(function(E){return E}),recv:I.map(function(E){return E.lastReport}).filter(function(E){return E})},{send:M.map(function(E){return E.lastReport}).filter(function(E){return E}),recv:O.map(function(E){return E.lastReport}).filter(function(E){return E})});return m.lastReport=x,x})},f}();function a(f){return Promise.all(f.map(function(m){var C=m.track.id;return m.getStats().then(function(P){var M,I;try{for(var O=_(P.values()),x=O.next();!x.done;x=O.next()){var E=x.value;E.type==="inbound-rtp"&&(E.id=C+"-"+E.id)}}catch(q){M={error:q}}finally{try{x&&!x.done&&(I=O.return)&&I.call(O)}finally{if(M)throw M.error}}return[C,P]})})).then(function(m){return new Map(m)})}function c(f,m,C,P,M){var I=m[P.mediaType];if(!M){var O=C.get(P.trackId);O&&(M=O.trackIdentifier)}if(I&&M){if(I.has(P.id))return I.get(P.id);var x=new f(M,P);I.set(P.id,x)}return null}function s(f){return{audio:f.audio.send,video:f.video.send}}function d(f){return{audio:f.audio.recv,video:f.video.recv}}function v(f,m,C,P){return c(t,s(f),m,C,P)}function u(f,m,C,P){return c(r,d(f),m,C,P)}function g(f){return{audio:new Set(f.audio.send.keys()),video:new Set(f.video.send.keys())}}function h(f){return{audio:new Set(f.audio.recv.keys()),video:new Set(f.video.recv.keys())}}function S(f,m,C,P){var M,I;try{for(var O=_(m.values()),x=O.next();!x.done;x=O.next()){var E=x.value;if(E.type==="outbound-rtp"&&!E.isRemote){if(o()!=="firefox"&&!E.trackId)continue;var q=C[E.mediaType];q&&q.delete(E.id);var B=v(f,m,E,P);if(B){var G=m.get(E.remoteId);B.next(P||B.trackId,E,G)}}}}catch(F){M={error:F}}finally{try{x&&!x.done&&(I=O.return)&&I.call(O)}finally{if(M)throw M.error}}}function R(f,m,C,P){var M,I;try{for(var O=_(m.values()),x=O.next();!x.done;x=O.next()){var E=x.value;if(E.type==="inbound-rtp"&&!E.isRemote){var q=C[E.mediaType];q&&q.delete(E.id);var B=u(f,m,E,P);B&&B.next(P||B.trackId,E)}}}catch(G){M={error:G}}finally{try{x&&!x.done&&(I=O.return)&&I.call(O)}finally{if(M)throw M.error}}}function T(f,m){var C=function(M){var I=f[M],O=m[M];O.forEach(function(x){return I.delete(x)})};for(var P in m)C(P)}function b(f,m){var C,P,M,I,O;try{for(var x=_(m.values()),E=x.next();!E.done;E=x.next()){var q=E.value;q.type==="transport"&&(O=m.get(q.selectedCandidatePairId))}}catch(F){C={error:F}}finally{try{E&&!E.done&&(P=x.return)&&P.call(x)}finally{if(C)throw C.error}}if(O){f.next(O);return}try{for(var B=_(m.values()),G=B.next();!G.done;G=B.next()){var q=G.value;q.type==="candidate-pair"&&q.nominated&&(!("selected"in q)||q.selected)&&f.next(q)}}catch(F){M={error:F}}finally{try{G&&!G.done&&(I=B.return)&&I.call(B)}finally{if(M)throw M.error}}}function y(f){var m=f.pc.getTransceivers().filter(function(P){return P.currentDirection&&P.currentDirection.match(/send/)&&P.sender.track}).map(function(P){return P.sender}),C=f.pc.getTransceivers().filter(function(P){return P.currentDirection&&P.currentDirection.match(/recv/)}).map(function(P){return P.receiver});return Promise.all([a(m),a(C),f.pc.getStats()]).then(function(P){var M=k(P,3),I=M[0],O=M[1],x=M[2],E=s(f),q=g(f);I.forEach(function(F,N){return S(f,F,q,N)}),T(E,q);var B=d(f),G=h(f);O.forEach(function(F,N){return R(f,F,G,N)}),T(B,G),b(f.ice,x)})}function l(f){return f.pc.getStats().then(function(m){var C=s(f),P=g(f);S(f,m,P),T(C,P);var M=d(f),I=h(f);R(f,m,I),T(M,I),b(f.ice,m)})}return pt=n,pt}var Pt,pc;function Tl(){if(pc)return Pt;pc=1;var k=Pt&&Pt.__extends||function(){var r=function(t,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(a[s]=c[s])},r(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");r(t,n);function a(){this.constructor=t}t.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),p=Pt&&Pt.__read||function(r,t){var n=typeof Symbol=="function"&&r[Symbol.iterator];if(!n)return r;var a=n.call(r),c,s=[],d;try{for(;(t===void 0||t-- >0)&&!(c=a.next()).done;)s.push(c.value)}catch(v){d={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(d)throw d.error}}return s},_=Ue(),o=Sl(),i=function(r){k(t,r);function t(n,a){var c=r.call(this)||this;return Object.defineProperties(c,{_factories:{value:new WeakMap},_manager:{value:n},_signaling:{value:a}}),a.on("updated",function(){return c.emit("updated")}),c}return Object.defineProperty(t.prototype,"level",{get:function(){return this._signaling.level},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"levels",{get:function(){return this._signaling.levels},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteLevels",{get:function(){return this._signaling.remoteLevels},enumerable:!1,configurable:!0}),t.prototype.start=function(){var n=this;this.stop();var a=setTimeout(function(){n._timeout===a&&e(n).then(function(c){if(n._timeout===a){if(c.length){var s=p(c,1),d=s[0];n._signaling.put(d)}n.start()}})},200);this._timeout=a},t.prototype.stop=function(){clearTimeout(this._timeout),this._timeout=null},t}(_);function e(r){var t=r._manager._peerConnections?Array.from(r._manager._peerConnections.values()):[],n=t.map(function(s){return s._peerConnection}).filter(function(s){return s.signalingState!=="closed"}),a=n.map(function(s){if(r._factories.has(s))return r._factories.get(s);var d=new o(s);return r._factories.set(s,d),d}),c=a.map(function(s){return s.next().catch(function(){return null})});return Promise.all(c).then(function(s){return s.filter(function(d){return d}).map(function(d){return d.summarize()})})}return Pt=i,Pt}var hi,hc;function wl(){if(hc)return hi;hc=1;var k=Pe().defer,p=function(){function _(){Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return _.prototype.put=function(o){this._hasValue=!0,this._value=o;var i=this._deferreds.shift();return i&&i.resolve(o),this},_.prototype.take=function(){var o=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var i=k();return this._deferreds.push(i),i.promise.then(function(e){return o._hasValue=!1,e})},_}();return hi=p,hi}var Nr,_c;function El(){if(_c)return Nr;_c=1;var k=Nr&&Nr.__extends||function(){var t=function(n,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,s){c.__proto__=s}||function(c,s){for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(c[d]=s[d])},t(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");t(n,a);function c(){this.constructor=n}n.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}(),p=jt(),_=wl(),o=Lt(),i=5e3,e=function(t){k(n,t);function n(a,c,s){var d=t.call(this,a,"network_quality",s)||this;return Object.defineProperties(d,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new _},_resendTimer:{value:new o(function(){d._resendTimer.setDelay(d._resendTimer.delay*1.5),d._sendNetworkQualityInputs()},i,!1)},_networkQualityReportLevels:{get:function(){return{reportLevel:c.local,remoteReportLevel:c.remote}}}}),d.on("ready",function(v){v.on("message",function(u){switch(d._log.debug("Incoming: ",u),u.type){case"network_quality":d._handleNetworkQualityMessage(u);break}})}),d._sendNetworkQualityInputs(),d}return Object.defineProperty(n.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remoteLevels",{get:function(){return this._remoteLevels},enumerable:!1,configurable:!0}),n.prototype._handleNetworkQualityMessage=function(a){var c=this,s=!1,d=null,v=a?a.local:null;typeof v=="number"?(d=v,this._levels=null):typeof v=="object"&&v&&(this._levels=v,d=typeof v.level=="number"?v.level:Math.min(v.audio.send,v.audio.recv,v.video.send,v.video.recv)),d!==null&&this.level!==d&&(this._level=d,s=!0),this._remoteLevels=a&&a.remotes?a.remotes.reduce(function(u,g){var h=c._remoteLevels.get(g.sid)||{};return h.level!==g.level&&(s=!0),u.set(g.sid,g)},new Map):this._remoteLevels,s&&this.emit("updated"),this._resendTimer.setDelay(i),this._resendTimer.isSet&&setTimeout(function(){return c._sendNetworkQualityInputs()},1e3)},n.prototype._sendNetworkQualityInputs=function(){var a=this;return this._resendTimer.clear(),this._networkQualityInputs.take().then(function(c){a._transport&&a._transport.publish(r(c,a._networkQualityReportLevels))}).finally(function(){a._resendTimer.start()})},n.prototype.put=function(a){this._networkQualityInputs.put(a)},n}(p);function r(t,n){return Object.assign({type:"network_quality"},t,n)}return Nr=e,Nr}var qr,mc;function Us(){if(mc)return qr;mc=1;var k=qr&&qr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(o){k(i,o);function i(){var e=o.call(this)||this;return Object.defineProperties(e,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),e}return i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return e=typeof e=="boolean"?e:!0,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},i}(p);return qr=_,qr}var Vr,yc;function Pl(){if(yc)return Vr;yc=1;var k=Vr&&Vr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Us(),_=function(o){k(i,o);function i(){var e=o.call(this)||this;return Object.defineProperties(e,{_revision:{value:1,writable:!0}}),e}return i.prototype.update=function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.is_recording))},i}(p);return Vr=_,Vr}var Fr,gc;function Ws(){if(gc)return Fr;gc=1;var k=Fr&&Fr.__extends||function(){var g=function(h,S){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,T){R.__proto__=T}||function(R,T){for(var b in T)Object.prototype.hasOwnProperty.call(T,b)&&(R[b]=T[b])},g(h,S)};return function(h,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");g(h,S);function R(){this.constructor=h}h.prototype=S===null?Object.create(S):(R.prototype=S.prototype,new R)}}(),p=Us(),_=Dt(),o=Lt(),i=Pe().buildLogLevels,e=Ce().DEFAULT_LOG_LEVEL,r=ze(),t=ht(),n=t.MediaConnectionError,a=t.MediaDTLSTransportFailedError,c=t.SignalingConnectionDisconnectedError,s=0,d={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},v=function(g){k(h,g);function h(S,R,T,b){var y=this;b=Object.assign({logLevel:e,RecordingSignaling:p,Timeout:o},b);var l=i(b.logLevel);y=g.call(this,"connected",d)||this;var f=b.RecordingSignaling,m=new b.Timeout(function(){y._disconnect(y._reconnectingError)},b.sessionTimeout,!1);return Object.defineProperties(y,{_instanceId:{value:s++},_log:{value:b.log?b.log.createLog("default",y):new r("default",y,l,b.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:b},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:m},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:S},name:{enumerable:!0,value:T},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new f},sid:{enumerable:!0,value:R}}),y.on("connectionStateChanged",function(){y.connectionState==="failed"&&!["disconnected","failed"].includes(y.iceConnectionState)&&y._disconnect(new a)}),y.on("iceConnectionStateChanged",function(){return u(y)}),y.on("signalingConnectionStateChanged",function(){return u(y)}),setTimeout(function(){return u(y)}),y}return h.prototype._disconnect=function(S){return this.state!=="disconnected"?(this.preempt("disconnected",null,[S]),!0):!1},h.prototype.toString=function(){return"[RoomSignaling #"+this._instanceId+": "+(this.localParticipant?this.localParticipant.sid:"null")+"]"},h.prototype.connectParticipant=function(S){var R=this;return S.state==="disconnected"||this.participants.has(S.sid)?!1:(this.participants.set(S.sid,S),S.on("stateChanged",function T(b){b==="disconnected"&&(S.removeListener("stateChanged",T),R.participants.delete(S.sid),R.emit("participantDisconnected",S))}),this.emit("participantConnected",S),!0)},h.prototype.disconnect=function(){return this._disconnect()},h.prototype.setDominantSpeaker=function(S){this.dominantSpeakerSid=S,this.emit("dominantSpeakerChanged")},h}(_);function u(g){if(g.state==="disconnected"||g.signalingConnectionState==="disconnected"){g._sessionTimeout.clear();return}var h;g.signalingConnectionState==="reconnecting"?h=g.signalingConnectionState:g.iceConnectionState==="failed"?(g._mediaConnectionIsReconnecting=!0,h="reconnecting"):g.iceConnectionState==="new"||g.iceConnectionState==="checking"?h=g._mediaConnectionIsReconnecting?"reconnecting":"connected":(g._mediaConnectionIsReconnecting=!1,g._reconnectingError=null,g._sessionTimeout.clear(),h="connected"),h!==g.state&&(h==="reconnecting"?(g._reconnectingError=g.signalingConnectionState==="reconnecting"?new c:new n,g._sessionTimeout.start(),g.preempt(h,null,[g._reconnectingError])):g.preempt(h))}return Fr=v,Fr}var _i,bc;function Cl(){if(bc)return _i;bc=1;var k=function(){function p(_){var o=_.actual,i=o===void 0?null:o,e=_.available,r=e===void 0?null:e,t=_.level,n=t===void 0?null:t;Object.defineProperties(this,{actual:{value:i,enumerable:!0},available:{value:r,enumerable:!0},level:{value:n,enumerable:!0}})}return p}();return _i=k,_i}var mi,kc;function Ol(){if(kc)return mi;kc=1;var k=function(){function p(_){var o=_.fractionLost,i=o===void 0?null:o,e=_.level,r=e===void 0?null:e;Object.defineProperties(this,{fractionLost:{value:i,enumerable:!0},level:{value:r,enumerable:!0}})}return p}();return mi=k,mi}var yi,Sc;function Rl(){if(Sc)return yi;Sc=1;var k=function(){function p(_){var o=_.jitter,i=o===void 0?null:o,e=_.rtt,r=e===void 0?null:e,t=_.level,n=t===void 0?null:t;Object.defineProperties(this,{jitter:{value:i,enumerable:!0},rtt:{value:r,enumerable:!0},level:{value:n,enumerable:!0}})}return p}();return yi=k,yi}var gi,Tc;function Hs(){if(Tc)return gi;Tc=1;var k=Cl(),p=Ol(),_=Rl(),o=function(){function i(e){var r=e.bandwidth,t=r===void 0?null:r,n=e.fractionLost,a=n===void 0?null:n,c=e.latency,s=c===void 0?null:c;Object.defineProperties(this,{bandwidth:{value:t?new k(t):null,enumerable:!0},fractionLost:{value:a?new p(a):null,enumerable:!0},latency:{value:s?new _(s):null,enumerable:!0}})}return i}();return gi=o,gi}var Br,wc;function Ll(){if(wc)return Br;wc=1;var k=Br&&Br.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Hs(),_=function(o){k(i,o);function i(e){return o.call(this,e)||this}return i}(p);return Br=_,Br}var Ur,Ec;function xl(){if(Ec)return Ur;Ec=1;var k=Ur&&Ur.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Hs(),_=function(o){k(i,o);function i(e){return o.call(this,e)||this}return i}(p);return Ur=_,Ur}var bi,Pc;function Gs(){if(Pc)return bi;Pc=1;var k=Ll(),p=xl(),_=function(){function o(i){var e=i.send,r=i.recv,t=i.sendStats,n=t===void 0?null:t,a=i.recvStats,c=a===void 0?null:a;Object.defineProperties(this,{send:{value:e,enumerable:!0},recv:{value:r,enumerable:!0},sendStats:{value:n?new k(n):null,enumerable:!0},recvStats:{value:c?new p(c):null,enumerable:!0}})}return o}();return bi=_,bi}var Wr,Cc;function Al(){if(Cc)return Wr;Cc=1;var k=Wr&&Wr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Gs(),_=function(o){k(i,o);function i(e){return o.call(this,e)||this}return i}(p);return Wr=_,Wr}var Hr,Oc;function Ml(){if(Oc)return Hr;Oc=1;var k=Hr&&Hr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Gs(),_=function(o){k(i,o);function i(e){return o.call(this,e)||this}return i}(p);return Hr=_,Hr}var ki,Rc;function Il(){if(Rc)return ki;Rc=1;var k=Al(),p=Ml(),_=function(){function o(i){var e=i.level,r=i.audio,t=i.video;Object.defineProperties(this,{level:{value:e,enumerable:!0},audio:{value:r?new k(r):null,enumerable:!0},video:{value:t?new p(t):null,enumerable:!0}})}return o}();return ki=_,ki}var Gr,Lc;function ji(){if(Lc)return Gr;Lc=1;var k=Gr&&Gr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=Dt(),_=Il(),o={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},i=function(e){k(r,e);function r(){var t=e.call(this,"connecting",o)||this;return Object.defineProperties(t,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),t}return Object.defineProperty(r.prototype,"networkQualityLevel",{get:function(){return this._networkQualityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"networkQualityStats",{get:function(){return this._networkQualityStats},enumerable:!1,configurable:!0}),r.prototype.addTrack=function(t){return this.tracks.set(t.id||t.sid,t),this.emit("trackAdded",t),this},r.prototype.disconnect=function(){return this.state!=="disconnected"?(this.preempt("disconnected"),!0):!1},r.prototype.removeTrack=function(t){var n=this.tracks.get(t.id||t.sid);return this.tracks.delete(t.id||t.sid),n&&this.emit("trackRemoved",t),n||null},r.prototype.setNetworkQualityLevel=function(t,n){this._networkQualityLevel!==t&&(this._networkQualityLevel=t,this._networkQualityStats=n&&(n.audio||n.video)?new _(n):null,this.emit("networkQualityLevelChanged"))},r.prototype.connect=function(t,n){return this.state==="connecting"||this.state==="reconnecting"?(this._sid||(this._sid=t),this._identity||(this._identity=n),this.preempt("connected"),!0):!1},r.prototype.reconnecting=function(){return this.state==="connecting"||this.state==="connected"?(this.preempt("reconnecting"),!0):!1},r}(p);return Gr=i,Gr}var Qr,xc;function Dl(){if(xc)return Qr;xc=1;var k=Qr&&Qr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=ji(),_=function(o){k(i,o);function i(e,r){var t=o.call(this)||this;return t.connect(e,r),t}return i}(p);return Qr=_,Qr}var $r,Ac;function Qs(){if(Ac)return $r;Ac=1;var k=$r&&$r.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(o){k(i,o);function i(e,r,t,n){var a=o.call(this)||this,c=null;return Object.defineProperties(a,{_error:{value:null,writable:!0},_isEnabled:{value:t,writable:!0},_priority:{value:n,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return c},set:function(s){c===null&&(c=s)}},kind:{enumerable:!0,value:r},name:{enumerable:!0,value:e}}),a}return Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackTransceiver",{get:function(){return this._trackTransceiver},enumerable:!1,configurable:!0}),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return e=typeof e=="boolean"?e:!0,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},i.prototype.setTrackTransceiver=function(e){return e=e||null,this.trackTransceiver!==e&&(this._trackTransceiver=e,this.emit("updated")),this},i.prototype.setSid=function(e){return this.sid===null&&(this._sid=e,this.emit("updated")),this},i}(p);return $r=_,$r}var Kr,Mc;function jl(){if(Mc)return Kr;Mc=1;var k=Kr&&Kr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Qs(),_=function(o){k(i,o);function i(e,r,t,n,a,c){var s=o.call(this,r,t,n,a)||this;return Object.defineProperties(s,{_isSwitchedOff:{value:c,writable:!0}}),s.setSid(e),s}return Object.defineProperty(i.prototype,"isSubscribed",{get:function(){return!!this.trackTransceiver},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSwitchedOff",{get:function(){return this._isSwitchedOff},enumerable:!1,configurable:!0}),i.prototype.subscribeFailed=function(e){return this.error||(this._error=e,this.emit("updated")),this},i.prototype.setPriority=function(e){return this._priority!==e&&(this._priority=e,this.emit("updated")),this},i.prototype.setSwitchedOff=function(e){return this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit("updated")),this},i}(p);return Kr=_,Kr}var zr,Ic;function Nl(){if(Ic)return zr;Ic=1;var k=zr&&zr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jl(),_=function(o){k(i,o);function i(e,r){return o.call(this,e.sid,e.name,e.kind,e.enabled,e.priority,r)||this}return i.prototype.update=function(e){return this.enable(e.enabled),this.setPriority(e.priority),this},i}(p);return zr=_,zr}var Yr,Dc;function ql(){if(Dc)return Yr;Dc=1;var k=Yr&&Yr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Dl(),_=Nl(),o=function(i){k(e,i);function e(r,t,n,a,c,s){var d=i.call(this,r.sid,r.identity)||this;return s=Object.assign({RemoteTrackPublicationV2:_},s),Object.defineProperties(d,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:s.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:t},updateSubscriberTrackPriority:{value:function(v,u){return n(v,u)}},updateTrackRenderHint:{value:function(v,u){return a(v,u)}},clearTrackHint:{value:function(v){return c(v)}},revision:{enumerable:!0,get:function(){return this._revision}}}),d.update(r)}return e.prototype._getOrCreateTrack=function(r){var t=this._RemoteTrackPublicationV2,n=this.tracks.get(r.sid);if(!n){var a=this._getInitialTrackSwitchOffState(r.sid);n=new t(r,a),this.addTrack(n)}return n},e.prototype.update=function(r){var t=this;if(this.revision!==null&&r.revision<=this.revision)return this;this._revision=r.revision;var n=new Set;switch(r.tracks.forEach(function(a){var c=t._getOrCreateTrack(a);c.update(a),n.add(c)}),this.tracks.forEach(function(a){n.has(a)||t.removeTrack(a)}),r.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity);break}return this},e}(p);return Yr=o,Yr}var Jr,jc;function Vl(){if(jc)return Jr;jc=1;var k=Jr&&Jr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jt(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e,"track_priority",r)||this;return Object.defineProperties(t,{_enqueuedPriorityUpdates:{value:new Map}}),t.on("ready",function(n){Array.from(t._enqueuedPriorityUpdates.keys()).forEach(function(a){n.publish({type:"track_priority",track:a,subscribe:t._enqueuedPriorityUpdates.get(a)})})}),t}return i.prototype.sendTrackPriorityUpdate=function(e,r,t){if(r!=="subscribe")throw new Error("only subscribe priorities are supported, found: "+r);this._enqueuedPriorityUpdates.set(e,t),this._transport&&this._transport.publish({type:"track_priority",track:e,subscribe:t})},i}(p);return Jr=_,Jr}var Xr,Nc;function Fl(){if(Nc)return Xr;Nc=1;var k=Xr&&Xr.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jt(),_=function(o){k(i,o);function i(e,r){var t=o.call(this,e,"track_switch_off",r)||this;return t.on("ready",function(n){n.on("message",function(a){switch(a.type){case"track_switch_off":t._setTrackSwitchOffUpdates(a.off||[],a.on||[]);break}})}),t}return i.prototype._setTrackSwitchOffUpdates=function(e,r){this.emit("updated",e,r)},i}(p);return Xr=_,Xr}var Zr,qc;function Bl(){if(qc)return Zr;qc=1;var k=Zr&&Zr.__extends||function(){var t=function(n,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,s){c.__proto__=s}||function(c,s){for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(c[d]=s[d])},t(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");t(n,a);function c(){this.constructor=n}n.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}(),p=jt(),_=Lt(),o=Pe().isDeepEqual,i=2e3,e=1,r=function(t){k(n,t);function n(a,c){var s=t.call(this,a,"render_hints",c)||this;return Object.defineProperties(s,{_trackSidsToRenderHints:{value:new Map},_responseTimer:{value:new _(function(){s._sendAllHints(),s._responseTimer.setDelay(s._responseTimer.delay*2)},i,!1)}}),s.on("ready",function(d){d.on("message",function(v){switch(s._log.debug("Incoming: ",v),v.type){case"render_hints":s._processHintResults(v&&v.subscriber&&v.subscriber.hints||[]);break;default:s._log.warn("Unknown message type: ",v.type);break}}),s._sendAllHints()}),s}return n.prototype._sendAllHints=function(){var a=this;Array.from(this._trackSidsToRenderHints.keys()).forEach(function(c){var s=a._trackSidsToRenderHints.get(c);s.renderDimensions&&(s.isDimensionDirty=!0),"enabled"in s&&(s.isEnabledDirty=!0)}),this._sendHints()},n.prototype._processHintResults=function(a){var c=this;this._responseTimer.clear(),this._responseTimer.setDelay(i),a.forEach(function(s){s.result!=="OK"&&c._log.debug("Server error processing hint:",s)}),this._sendHints()},n.prototype._sendHints=function(){var a=this;if(!(!this._transport||this._responseTimer.isSet)){var c=[];if(Array.from(this._trackSidsToRenderHints.keys()).forEach(function(d){var v=a._trackSidsToRenderHints.get(d);if(v.isEnabledDirty||v.isDimensionDirty){var u={track:d};v.isEnabledDirty&&(u.enabled=v.enabled,v.isEnabledDirty=!1),v.isDimensionDirty&&(u.render_dimensions=v.renderDimensions,v.isDimensionDirty=!1),c.push(u)}}),c.length>0){var s={type:"render_hints",subscriber:{id:e++,hints:c}};this._log.debug("Outgoing: ",s),this._transport.publish(s),this._responseTimer.start()}}},n.prototype.setTrackHint=function(a,c){var s=this._trackSidsToRenderHints.get(a)||{isEnabledDirty:!1,isDimensionDirty:!1};"enabled"in c&&s.enabled!==c.enabled&&(s.enabled=!!c.enabled,s.isEnabledDirty=!0),c.renderDimensions&&!o(c.renderDimensions,s.renderDimensions)&&(s.renderDimensions=c.renderDimensions,s.isDimensionDirty=!0),this._trackSidsToRenderHints.set(a,s),this._sendHints()},n.prototype.clearTrackHint=function(a){this._trackSidsToRenderHints.delete(a)},n}(p);return Zr=r,Zr}var en,Vc;function Ul(){if(Vc)return en;Vc=1;var k=en&&en.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=jt(),_=1,o=function(i){k(e,i);function e(r,t){var n=i.call(this,r,"publisher_hints",t)||this;return n.on("ready",function(a){n._log.debug("publisher_hints transport ready:",a),a.on("message",function(c){switch(n._log.debug("Incoming: ",c),c.type){case"publisher_hints":c.publisher&&c.publisher.hints&&c.publisher.id&&n._processPublisherHints(c.publisher.hints,c.publisher.id);break;default:n._log.warn("Unknown message type: ",c.type);break}})}),n}return e.prototype.sendTrackReplaced=function(r){var t=r.trackSid;if(this._transport){var n={type:"client_reset",track:t,id:_++};this._log.debug("Outgoing: ",n),this._transport.publish(n)}},e.prototype.sendHintResponse=function(r){var t=r.id,n=r.hints;if(this._transport){var a={type:"publisher_hints",id:t,hints:n};this._log.debug("Outgoing: ",a),this._transport.publish(a)}},e.prototype._processPublisherHints=function(r,t){try{this.emit("updated",r,t)}catch(n){this._log.error("error processing hints:",n)}},e}(p);return en=o,en}var Ct,Fc;function Wl(){if(Fc)return Ct;Fc=1;var k=Ct&&Ct.__extends||function(){var N=function(A,w){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,Q){j.__proto__=Q}||function(j,Q){for(var Y in Q)Object.prototype.hasOwnProperty.call(Q,Y)&&(j[Y]=Q[Y])},N(A,w)};return function(A,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");N(A,w);function j(){this.constructor=A}A.prototype=w===null?Object.create(w):(j.prototype=w.prototype,new j)}}(),p=Ct&&Ct.__read||function(N,A){var w=typeof Symbol=="function"&&N[Symbol.iterator];if(!w)return N;var j=w.call(N),Q,Y=[],$;try{for(;(A===void 0||A-- >0)&&!(Q=j.next()).done;)Y.push(Q.value)}catch(K){$={error:K}}finally{try{Q&&!Q.done&&(w=j.return)&&w.call(j)}finally{if($)throw $.error}}return Y},_=_l(),o=Tl(),i=El(),e=Pl(),r=Ws(),t=ql(),n=Is(),a=Vl(),c=Fl(),s=Bl(),d=Ul(),v=Pe(),u=v.constants.DEFAULT_SESSION_TIMEOUT_SEC,g=v.createBandwidthProfilePayload,h=v.defer,S=v.difference,R=v.filterObject,T=v.flatMap,b=v.oncePerTick,y=ws(),l=ht().createTwilioError,f=1e4,m=function(N){k(A,N);function A(w,j,Q,Y,$){var K=this;j.options=Object.assign({session_timeout:u},j.options),$=Object.assign({DominantSpeakerSignaling:_,NetworkQualityMonitor:o,NetworkQualitySignaling:i,RecordingSignaling:e,RemoteParticipantV2:t,TrackPrioritySignaling:a,TrackSwitchOffSignaling:c,bandwidthProfile:null,sessionTimeout:j.options.session_timeout*1e3,statsPublishIntervalMs:f},$),w.setBandwidthProfile($.bandwidthProfile);var J=j.options,te=J.signaling_region,se=J.audio_processors,oe=se===void 0?[]:se;w.setSignalingRegion(te),oe.includes("krisp")&&oe.push("rnnoise"),w.setAudioProcessors(oe),Y.setIceReconnectTimeout($.sessionTimeout),K=N.call(this,w,j.sid,j.name,$)||this;var ce=function(ve){return K._getTrackReceiver(ve)},de=K._log;return Object.defineProperties(K,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:$.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:w.bandwidthProfileRevision,writable:!0},_mediaStatesWarningsRevision:{value:0,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:w.networkQualityConfiguration},_peerConnectionManager:{value:Y},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:$.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new $.DominantSpeakerSignaling(ce,{log:de})},_networkQualitySignaling:{value:new $.NetworkQualitySignaling(ce,w.networkQualityConfiguration,{log:de})},_renderHintsSignaling:{value:new s(ce,{log:de})},_publisherHintsSignaling:{value:new d(ce,{log:de})},_trackPrioritySignaling:{value:new $.TrackPrioritySignaling(ce,{log:de})},_trackSwitchOffSignaling:{value:new $.TrackSwitchOffSignaling(ce,{log:de})},_pendingSwitchOffStates:{value:new Map},_transport:{value:Q},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:j.options.media_region||null}}),K._initTrackSwitchOffSignaling(),K._initDominantSpeakerSignaling(),K._initNetworkQualityMonitorSignaling(),K._initPublisherHintSignaling(),I(K,w),O(K,Y),x(K,Q),E(K,Q,$.statsPublishIntervalMs),K._update(j),K._peerConnectionManager.setEffectiveAdaptiveSimulcast(K._publisherHintsSignaling.isSetup),K}return Object.defineProperty(A.prototype,"connectionState",{get:function(){return this._peerConnectionManager.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"signalingConnectionState",{get:function(){return this._transport.state==="syncing"?"reconnecting":this._transport.state},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"iceConnectionState",{get:function(){return this._peerConnectionManager.iceConnectionState},enumerable:!1,configurable:!0}),A.prototype._deleteTrackReceiverDeferred=function(w){return this._trackReceiverDeferreds.delete(w)},A.prototype._getOrCreateTrackReceiverDeferred=function(w){var j=this._trackReceiverDeferreds.get(w)||h(),Q=this._peerConnectionManager.getTrackReceivers(),Y=Q.find(function($){return $.id===w&&$.readyState!=="ended"});return Y?j.resolve(Y):this._trackReceiverDeferreds.set(w,j),j},A.prototype._addTrackReceiver=function(w){var j=this._getOrCreateTrackReceiverDeferred(w.id);return j.resolve(w),this},A.prototype._disconnect=function(w){var j=N.prototype._disconnect.call(this,w);return j&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(Q){Q.publishFailed(w||new Error("LocalParticipant disconnected"))}),j},A.prototype._getTrackReceiver=function(w){var j=this;return this._getOrCreateTrackReceiverDeferred(w).promise.then(function(Q){return j._deleteTrackReceiverDeferred(w),Q})},A.prototype._getInitialTrackSwitchOffState=function(w){var j=this._pendingSwitchOffStates.get(w)||!1;return this._pendingSwitchOffStates.delete(w),j&&this._log.warn("["+w+"] was initially switched off! "),j},A.prototype._getTrackSidsToTrackSignalings=function(){var w=T(this.participants,function(j){return Array.from(j.tracks)});return new Map(w)},A.prototype._getOrCreateRemoteParticipant=function(w){var j=this,Q=this._RemoteParticipantV2,Y=this.participants.get(w.sid),$=this;return Y||(Y=new Q(w,function(K){return j._getInitialTrackSwitchOffState(K)},function(K,J){return j._trackPrioritySignaling.sendTrackPriorityUpdate(K,"subscribe",J)},function(K,J){return j._renderHintsSignaling.setTrackHint(K,J)},function(K){return j._renderHintsSignaling.clearTrackHint(K)}),Y.on("stateChanged",function K(J){J==="disconnected"&&(Y.removeListener("stateChanged",K),$.participants.delete(Y.sid),$._disconnectedParticipantRevisions.set(Y.sid,Y.revision))}),this.connectParticipant(Y)),Y},A.prototype._getState=function(){return{participant:this.localParticipant.getState()}},A.prototype._maybeAddBandwidthProfile=function(w){var j=this.localParticipant,Q=j.bandwidthProfile,Y=j.bandwidthProfileRevision;return Q&&this._lastBandwidthProfileRevision<Y?(this._lastBandwidthProfileRevision=Y,Object.assign({bandwidth_profile:g(Q)},w)):w},A.prototype._publishNewLocalParticipantState=function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))},A.prototype._publishPeerConnectionState=function(w){this._transport.publish(Object.assign({peer_connections:[w]},this._getState()))},A.prototype._update=function(w){var j=this;if(w.subscribed&&w.subscribed.revision>this._subscribedRevision){this._subscribedRevision=w.subscribed.revision,w.subscribed.tracks.forEach(function($){$.id?(j._subscriptionFailures.delete($.sid),j._subscribed.set($.sid,$.id)):$.error&&!j._subscriptionFailures.has($.sid)&&j._subscriptionFailures.set($.sid,$.error)});var Q=new Set(w.subscribed.tracks.filter(function($){return!!$.id}).map(function($){return $.sid}));this._subscribed.forEach(function($,K){Q.has(K)||j._subscribed.delete(K)})}var Y=new Set;return(w.participants||[]).forEach(function($){if($.sid!==j.localParticipant.sid){var K=j._disconnectedParticipantRevisions.get($.sid);if(!(K&&$.revision<=K)){K&&j._disconnectedParticipantRevisions.delete($.sid);var J=j._getOrCreateRemoteParticipant($);J.update($),Y.add(J)}}}),w.type==="synced"&&this.participants.forEach(function($){Y.has($)||$.disconnect()}),q(this),w.peer_connections&&this._peerConnectionManager.update(w.peer_connections,w.type==="synced"),w.recording&&this.recording.update(w.recording),w.published&&w.published.revision>this._publishedRevision&&(this._publishedRevision=w.published.revision,w.published.tracks.forEach(function($){$.sid&&j._published.set($.id,$.sid)}),this.localParticipant.update(w.published)),w.participant&&this.localParticipant.connect(w.participant.sid,w.participant.identity),[this._dominantSpeakerSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling,this._publisherHintsSignaling].forEach(function($){var K=$.channel;!$.isSetup&&w.media_signaling&&w.media_signaling[K]&&w.media_signaling[K].transport&&w.media_signaling[K].transport.type==="data-channel"&&$.setup(w.media_signaling[K].transport.label)}),w.type==="warning"&&w.states&&w.states.revision>this._mediaStatesWarningsRevision&&(this._mediaStatesWarningsRevision=w.states.revision,this.localParticipant.updateMediaStates(w.states)),this},A.prototype._initPublisherHintSignaling=function(){var w=this;this._publisherHintsSignaling.on("updated",function(Q,Y){Promise.all(Q.map(function($){return w.localParticipant.setPublisherHint($.track,$.encodings).then(function(K){return{track:$.track,result:K}})})).then(function($){w._publisherHintsSignaling.sendHintResponse({id:Y,hints:$})})});var j=function(Q){Q.kind==="video"&&Q.trackTransceiver.on("replaced",function(){w._publisherHintsSignaling.sendTrackReplaced({trackSid:Q.sid})})};Array.from(this.localParticipant.tracks.values()).forEach(function(Q){return j(Q)}),this.localParticipant.on("trackAdded",function(Q){return j(Q)})},A.prototype._initTrackSwitchOffSignaling=function(){var w=this;this._trackSwitchOffSignaling.on("updated",function(j,Q){try{w._log.debug("received trackSwitch: ",{tracksOn:Q,tracksOff:j});var Y=new Map;Q.forEach(function($){return Y.set($,!0)}),j.forEach(function($){Y.get($)&&w._log.warn($+" is DUPLICATED in both tracksOff and tracksOn list"),Y.set($,!1)}),w.participants.forEach(function($){$.tracks.forEach(function(K){var J=Y.get(K.sid);typeof J<"u"&&(K.setSwitchedOff(!J),Y.delete(K.sid))})}),Y.forEach(function($,K){return w._pendingSwitchOffStates.set(K,!$)})}catch($){w._log.error("error processing track switch off:",$)}})},A.prototype._initDominantSpeakerSignaling=function(){var w=this;this._dominantSpeakerSignaling.on("updated",function(){return w.setDominantSpeaker(w._dominantSpeakerSignaling.loudestParticipantSid)})},A.prototype._initNetworkQualityMonitorSignaling=function(){var w=this;this._networkQualitySignaling.on("ready",function(){var j=new w._NetworkQualityMonitor(w._peerConnectionManager,w._networkQualitySignaling);w._networkQualityMonitor=j,j.on("updated",function(){w.iceConnectionState!=="failed"&&(w.localParticipant.setNetworkQualityLevel(j.level,j.levels),w.participants.forEach(function(Q){var Y=j.remoteLevels.get(Q.sid);Y&&Q.setNetworkQualityLevel(Y.level,Y)}))}),j.start()}),this._networkQualitySignaling.on("teardown",function(){return w._teardownNetworkQualityMonitor()})},A.prototype._teardownNetworkQualityMonitor=function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)},A.prototype.getStats=function(){var w=this;return this._peerConnectionManager.getStats().then(function(j){return new Map(Array.from(j).map(function(Q){var Y=p(Q,2),$=Y[0],K=Y[1];return[$,Object.assign({},K,{localAudioTrackStats:P(w,K.localAudioTrackStats),localVideoTrackStats:P(w,K.localVideoTrackStats),remoteAudioTrackStats:M(w,K.remoteAudioTrackStats),remoteVideoTrackStats:M(w,K.remoteVideoTrackStats)})]}))})},A}(r);function C(N,A){return A.reduce(function(w,j){var Q=N.get(j.trackId);return Q?[Object.assign({},j,{trackSid:Q})].concat(w):w},[])}function P(N,A){return C(N._published,A)}function M(N,A){var w=new Map(Array.from(N._subscribed.entries()).map(function(j){var Q=p(j,2),Y=Q[0],$=Q[1];return[$,Y]}));return C(w,A)}function I(N,A){var w=b(function(){N._publishNewLocalParticipantState()}),j=b(function(){var Q=T(A.tracks,function(Y){return Y.trackTransceiver});N._peerConnectionManager.setTrackSenders(Q)});A.on("trackAdded",j),A.on("trackRemoved",j),A.on("updated",w),N.on("stateChanged",function Q(Y){Y==="disconnected"&&(A.removeListener("trackAdded",j),A.removeListener("trackRemoved",j),A.removeListener("updated",w),N.removeListener("stateChanged",Q),A.disconnect())}),N.on("signalingConnectionStateChanged",function(){var Q=N.localParticipant,Y=N.signalingConnectionState,$=Q.identity,K=Q.sid;switch(Y){case"connected":Q.connect(K,$);break;case"reconnecting":Q.reconnecting();break}})}function O(N,A){A.on("description",function(j){N._publishPeerConnectionState(j)}),A.dequeue("description"),A.on("candidates",function(j){N._publishPeerConnectionState(j)}),A.dequeue("candidates"),A.on("trackAdded",N._addTrackReceiver.bind(N)),A.dequeue("trackAdded"),A.getTrackReceivers().forEach(N._addTrackReceiver,N),A.on("connectionStateChanged",function(){N.emit("connectionStateChanged")}),A.on("iceConnectionStateChanged",function(){N.emit("iceConnectionStateChanged"),N.iceConnectionState==="failed"&&(N.localParticipant.networkQualityLevel!==null&&N.localParticipant.setNetworkQualityLevel(0),N.participants.forEach(function(w){w.networkQualityLevel!==null&&w.setNetworkQualityLevel(0)}))})}function x(N,A){A.on("message",N._update.bind(N)),A.on("stateChanged",function w(j,Q){j==="disconnected"&&(N.state!=="disconnected"&&N._disconnect(Q),A.removeListener("stateChanged",w)),N.emit("signalingConnectionStateChanged")})}function E(N,A,w){var j=new Map,Q=!1,Y=setInterval(function(){N.getStats().then(function($){Q=!Q,$.forEach(function(K,J){var te=new n(J,K,!0);A.publishEvent("quality","stats-report","info",{audioTrackStats:te.remoteAudioTrackStats.map(function(de,ve){return G(de,K.remoteAudioTrackStats[ve],j)}),localAudioTrackStats:te.localAudioTrackStats.map(function(de,ve){return B(de,K.localAudioTrackStats[ve],j)}),localVideoTrackStats:te.localVideoTrackStats.map(function(de,ve){return B(de,K.localVideoTrackStats[ve],j)}),peerConnectionId:te.peerConnectionId,videoTrackStats:te.remoteVideoTrackStats.map(function(de,ve){return G(de,K.remoteVideoTrackStats[ve],j)})});var se=T(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],function(de){return te[de].map(function(ve){var ue=ve.ssrc,ee=ve.trackSid;return ee+"+"+ue})}),oe=S(Array.from(j.keys()),se);if(oe.forEach(function(de){return j.delete(de)}),Q){var ce=F(K.activeIceCandidatePair,te.peerConnectionId);A.publishEvent("quality","active-ice-candidate-pair","info",ce)}})},function(){})},w);N.on("stateChanged",function $(K){K==="disconnected"&&(clearInterval(Y),N.removeListener("stateChanged",$))})}function q(N){var A=N._getTrackSidsToTrackSignalings();N._subscriptionFailures.forEach(function(w,j){var Q=A.get(j);Q&&(N._subscriptionFailures.delete(j),Q.subscribeFailed(l(w.code,w.message)))}),A.forEach(function(w){var j=N._subscribed.get(w.sid);(!j||w.isSubscribed&&w.trackTransceiver.id!==j)&&w.setTrackTransceiver(null),j&&N._getTrackReceiver(j).then(function(Q){return w.setTrackTransceiver(Q)})})}function B(N,A,w){var j=A.framesEncoded,Q=A.packetsSent,Y=A.totalEncodeTime,$=A.totalPacketSendDelay,K=Object.assign({},N),J=N.trackSid+"+"+N.ssrc,te=w.get(J)||new Map;if(typeof Y=="number"&&typeof j=="number"){var se=te.get("avgEncodeDelay")||new y;se.putSample(Y*1e3,j),K.avgEncodeDelay=Math.round(se.get()),te.set("avgEncodeDelay",se)}if(typeof $=="number"&&typeof Q=="number"){var oe=te.get("avgPacketSendDelay")||new y;oe.putSample($*1e3,Q),K.avgPacketSendDelay=Math.round(oe.get()),te.set("avgPacketSendDelay",oe)}return w.set(J,te),K}function G(N,A,w){var j=A.estimatedPlayoutTimestamp,Q=A.framesDecoded,Y=A.jitterBufferDelay,$=A.jitterBufferEmittedCount,K=A.totalDecodeTime,J=Object.assign({},N),te=N.trackSid+"+"+N.ssrc,se=w.get(te)||new Map;if(typeof j=="number"&&(J.estimatedPlayoutTimestamp=j),typeof Q=="number"&&typeof K=="number"){var oe=se.get("avgDecodeDelay")||new y;oe.putSample(K*1e3,Q),J.avgDecodeDelay=Math.round(oe.get()),se.set("avgDecodeDelay",oe)}if(typeof Y=="number"&&typeof $=="number"){var ce=se.get("avgJitterBufferDelay")||new y;ce.putSample(Y*1e3,$),J.avgJitterBufferDelay=Math.round(ce.get()),se.set("avgJitterBufferDelay",ce)}return w.set(te,se),J}function F(N,A){return N=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:A,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},R(N||{},null)),N.localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},R(N.localCandidate||{},null)),N.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},R(N.remoteCandidate||{},null)),N}return Ct=m,Ct}var tn,Bc;function Hl(){if(Bc)return tn;Bc=1;var k=tn&&tn.__extends||function(){var O=function(x,E){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,B){q.__proto__=B}||function(q,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(q[G]=B[G])},O(x,E)};return function(x,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");O(x,E);function q(){this.constructor=x}x.prototype=E===null?Object.create(E):(q.prototype=E.prototype,new q)}}(),p=Dt(),_=Ts(),o=Ds(),i=Ce().reconnectBackoffConfig,e=Lt(),r=Ce(),t=r.SDK_NAME,n=r.SDK_VERSION,a=r.SDP_FORMAT,c=Pe(),s=c.createBandwidthProfilePayload,d=c.createMediaSignalingPayload,v=c.createMediaWarningsPayload,u=c.createSubscribePayload,g=c.getUserAgent,h=c.isNonArrayObject,S=ht(),R=S.createTwilioError,T=S.RoomCompletedError,b=S.SignalingConnectionError,y=S.SignalingServerBusyError,l=1,f=2,m={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},C=function(O){k(x,O);function x(E,q,B,G,F,N){var A=this;return N=Object.assign({Backoff:o,TwilioConnection:_,iceServers:null,trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:g()},N),A=O.call(this,"connecting",m)||this,Object.defineProperties(A,{_accessToken:{value:q},_automaticSubscription:{value:N.automaticSubscription},_bandwidthProfile:{value:N.bandwidthProfile},_dominantSpeaker:{value:N.dominantSpeaker},_adaptiveSimulcast:{value:N.adaptiveSimulcast},_eventObserver:{value:N.eventObserver,writable:!1},_renderHints:{value:N.renderHints},_iceServersStatus:{value:Array.isArray(N.iceServers)?"overrode":"acquire"},_localParticipant:{value:B},_name:{value:E},_networkQuality:{value:h(N.networkQuality)||N.networkQuality},_notifyWarnings:{value:N.notifyWarnings},_options:{value:N},_peerConnectionManager:{value:G},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:new N.Backoff(i)},_session:{value:null,writable:!0},_trackPriority:{value:N.trackPriority},_trackSwitchOff:{value:N.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:N.userAgent},_wsServer:{value:F}}),I(A),A}return x.prototype._createConnectOrSyncOrDisconnectMessage=function(){if(this.state==="connected")return null;if(this.state==="disconnected")return{session:this._session,type:"disconnect",version:f};var E={connecting:"connect",syncing:"sync"}[this.state],q={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:E,version:f};return q.type==="connect"?(q.ice_servers=this._iceServersStatus,q.publisher={name:t,sdk_version:n,user_agent:this._userAgent},this._bandwidthProfile&&(q.bandwidth_profile=s(this._bandwidthProfile)),this._notifyWarnings&&(q.participant.media_warnings=v(this._notifyWarnings)),q.media_signaling=d(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._adaptiveSimulcast,this._renderHints),q.subscribe=u(this._automaticSubscription),q.format=a,q.token=this._accessToken):q.type==="sync"?(q.session=this._session,q.token=this._accessToken):q.type==="update"&&(q.session=this._session),q},x.prototype._createIceMessage=function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:l}},x.prototype._sendConnectOrSyncOrDisconnectMessage=function(){var E=this._createConnectOrSyncOrDisconnectMessage();E&&this._twilioConnection.sendMessage(E)},x.prototype.disconnect=function(E){return this.state!=="disconnected"?(this.preempt("disconnected",null,[E]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),!0):!1},x.prototype.publish=function(E){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:f},E)),!0;case"connecting":case"syncing":return this._updatesToSend.push(E),!0;case"disconnected":default:return!1}},x.prototype.publishEvent=function(E,q,B,G){this._eventObserver.emit("event",{group:E,name:q,level:B,payload:G})},x.prototype.sync=function(){return this.state==="connected"?(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0):!1},x.prototype._setSession=function(E,q){this._session=E,this._sessionTimeoutMS=q*1e3},x.prototype._getReconnectTimer=function(){var E=this;return this._sessionTimeoutMS===0?null:(this._sessionTimer||(this._sessionTimer=new e(function(){E._sessionTimer&&(E._sessionTimeoutMS=0)},this._sessionTimeoutMS)),new Promise(function(q){E._reconnectBackoff.backoff(q)}))},x.prototype._clearReconnectTimer=function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)},x}(p);function P(O){return Array.from(O.reduce(function(x,E){var q=x.get(E.id)||E;return(!q.description&&E.description||q.description&&E.description&&E.description.revision>q.description.revision)&&(q.description=E.description),(!q.ice&&E.ice||q.ice&&E.ice&&E.ice.revision>q.ice.revision)&&(q.ice=E.ice),x.set(q.id,q),x},new Map).values())}function M(O){return O.reduce(function(x,E){return(!x.participant&&E.participant||x.participant&&E.participant&&E.participant.revision>x.participant.revision)&&(x.participant=E.participant),!x.peer_connections&&E.peer_connections?x.peer_connections=P(E.peer_connections):x.peer_connections&&E.peer_connections&&(x.peer_connections=P(x.peer_connections.concat(E.peer_connections))),x},{})}function I(O){function x(){if(O.state!=="disconnected"){O._twilioConnection&&O._twilioConnection.removeListener("message",q);var A=O._iceServersStatus,w=O._options,j=O._wsServer,Q=O.state,Y=w.TwilioConnection,$=new Y(j,Object.assign({helloBody:Q==="connecting"&&A==="acquire"?O._createIceMessage():O._createConnectOrSyncOrDisconnectMessage()},w));$.once("close",function(K){K===Y.CloseReason.LOCAL?E():E(new Error(K))}),$.on("message",q),O._twilioConnection=$}}function E(A){if(O.state!=="disconnected"){if(!A){O.disconnect();return}var w=O._getReconnectTimer();if(!w){var j=A.message===_.CloseReason.BUSY?new y:new b;O.disconnect(j);return}O.state==="connected"&&O.preempt("syncing"),w.then(x)}}function q(A){if(O.state!=="disconnected"){if(A.type==="error"){O.disconnect(R(A.code,A.message));return}switch(O.state){case"connected":switch(A.type){case"connected":case"synced":case"update":case"warning":O.emit("message",A);return;case"disconnected":O.disconnect(A.status==="completed"?new T:null);return;default:return}case"connecting":switch(A.type){case"iced":O._options.onIced(A.ice_servers).then(function(){O._sendConnectOrSyncOrDisconnectMessage()});return;case"connected":O._setSession(A.session,A.options.session_timeout),O.emit("connected",A),O.preempt("connected");return;case"synced":case"update":O._updatesReceived.push(A);return;case"disconnected":O.disconnect(A.status==="completed"?new T:null);return;default:return}case"syncing":switch(A.type){case"connected":case"update":O._updatesReceived.push(A);return;case"synced":O._clearReconnectTimer(),O.emit("message",A),O.preempt("connected");return;case"disconnected":O.disconnect(A.status==="completed"?new T:null);return;default:return}default:return}}}O.on("stateChanged",function A(w){switch(w){case"connected":{var j=O._updatesToSend.splice(0);j.length&&O.publish(M(j)),O._updatesReceived.splice(0).forEach(function(Q){return O.emit("message",Q)});return}case"disconnected":O._twilioConnection.removeListener("message",q),O.removeListener("stateChanged",A);return;case"syncing":return;default:return}});var B=O._options,G=O._iceServersStatus,F=B.iceServers,N=B.onIced;G==="overrode"?N(F).then(x):x()}return tn=C,tn}var Si,Uc;function Gl(){if(Uc)return Si;Uc=1;var k=Ai(),p=hl(),_=Wl(),o=Hl(),i=ht(),e=i.SignalingConnectionDisconnectedError,r=i.SignalingIncomingMessageInvalidError,t=Pe(),n=t.flatMap,a=t.createRoomConnectEventPayload;function c(s,d,v,u,g,h){h=Object.assign({PeerConnectionManager:p,RoomV2:_,Transport:o},h);var S=g.video[0]&&g.video[0].adaptiveSimulcast===!0,R=h.PeerConnectionManager,T=h.RoomV2,b=h.Transport,y=h.iceServers,l=h.log,f=new R(u,g,h),m=n(v.tracks,function(I){return[I.trackTransceiver]});f.setTrackSenders(m);var C=new Error("Canceled"),P,M=new k(function(I,O,x){var E=function(ve){return x()?(O(C),Promise.reject(C)):(l.debug("Got ICE servers:",ve),h.iceServers=ve,f.setConfiguration(h),f.createAndOffer().then(function(){if(x())throw O(C),C;l.debug("createAndOffer() succeeded."),f.dequeue("description")}).catch(function(ue){throw l.error("createAndOffer() failed:",ue),O(ue),ue}))},q=h.automaticSubscription,B=h.bandwidthProfile,G=h.dominantSpeaker,F=h.environment,N=h.eventObserver,A=h.loggerName,w=h.logLevel,j=h.name,Q=h.networkMonitor,Y=h.networkQuality,$=h.notifyWarnings,K=h.realm,J=h.sdpSemantics,te=!!B,se=!!B,oe=!!B&&(h.clientTrackSwitchOffControl!=="disabled"||h.contentPreferencesMode!=="disabled"),ce=Object.assign({adaptiveSimulcast:S,automaticSubscription:q,dominantSpeaker:G,environment:F,eventObserver:N,loggerName:A,logLevel:w,networkMonitor:Q,networkQuality:Y,notifyWarnings:$,iceServers:y,onIced:E,realm:K,renderHints:oe,sdpSemantics:J,trackPriority:te,trackSwitchOff:se},B?{bandwidthProfile:B}:{});P=new b(j,s,v,f,d,ce);var de=a(h);N.emit("event",de),P.once("connected",function(ve){if(l.debug("Transport connected:",ve),x()){O(C);return}var ue=ve.participant;if(!ue){O(new r);return}I(new T(v,ve,P,f,h))}),P.once("stateChanged",function(ve,ue){ve==="disconnected"?(P=null,O(ue||new e)):l.debug("Transport state changed:",ve)})},function(){P&&(P.disconnect(),P=null)});return M.catch(function(){P&&(P.disconnect(),P=null),f.close()}),M}return Si=c,Si}var rn,Wc;function Ql(){if(Wc)return rn;Wc=1;var k=rn&&rn.__extends||function(){var o=function(i,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},o(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=ji(),_=function(o){k(i,o);function i(){var e=o.call(this)||this;return Object.defineProperties(e,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),e}return i.prototype.addTrack=function(e,r,t,n){n===void 0&&(n=null);var a=this._createLocalTrackPublicationSignaling(e,r,t,n);return this._trackSendersToPublications.set(e,a),this._publicationsToTrackSenders.set(a,e),o.prototype.addTrack.call(this,a),this},i.prototype.getPublication=function(e){return this._trackSendersToPublications.get(e)||null},i.prototype.getSender=function(e){return this._publicationsToTrackSenders.get(e)||null},i.prototype.removeTrack=function(e){var r=this._trackSendersToPublications.get(e);if(!r)return null;this._trackSendersToPublications.delete(e),this._publicationsToTrackSenders.delete(r);var t=o.prototype.removeTrack.call(this,r);return t&&r.stop(),r},i}(p);return rn=_,rn}var nn,Hc;function $l(){if(Hc)return nn;Hc=1;var k=nn&&nn.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Qs(),_=function(i){k(e,i);function e(r,t,n){var a=this,c=r.clone();r.kind!=="data"&&(c.track.enabled=r.track.enabled),r=c;var s=r.kind==="data"?!0:r.track.enabled;return a=i.call(this,t,r.kind,s,n)||this,a.setTrackTransceiver(r),Object.defineProperties(a,{_updatedPriority:{value:n,writable:!0},id:{enumerable:!0,value:r.id}}),a}return Object.defineProperty(e.prototype,"updatedPriority",{get:function(){return this._updatedPriority},enumerable:!1,configurable:!0}),e.prototype.enable=function(r){return r=typeof r=="boolean"?r:!0,this.trackTransceiver.track.enabled=r,i.prototype.enable.call(this,r)},e.prototype.publishFailed=function(r){return o(this,r)&&this.emit("updated"),this},e.prototype.setPriority=function(r){return this._updatedPriority!==r&&(this._updatedPriority=r,this.emit("updated")),this},e.prototype.setSid=function(r){return this._error?this:i.prototype.setSid.call(this,r)},e.prototype.stop=function(){this.trackTransceiver.stop()},e}(p);function o(i,e){return i._sid!==null||i._error?!1:(i._error=e,!0)}return nn=_,nn}var an,Gc;function Kl(){if(Gc)return an;Gc=1;var k=an&&an.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=$l(),_=ns(),o=ht().createTwilioError,i=function(e){k(r,e);function r(t,n,a,c,s){var d=e.call(this,t,n,a)||this;return Object.defineProperties(d,{_log:{value:s.log.createLog("default",d)},_mediaStates:{value:{recordings:null},writable:!0},_noiseCancellationVendor:{value:c}}),d}return r.prototype.getState=function(){var t={enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority};return this._noiseCancellationVendor&&(t.audio_processor=this._noiseCancellationVendor),t},r.prototype.toString=function(){return"[LocalTrackPublicationV2: "+this.sid+"]"},r.prototype.update=function(t){switch(t.state){case"ready":this.setSid(t.sid);break;case"failed":{var n=t.error;this.publishFailed(o(n.code,n.message));break}}return this},r.prototype.updateMediaStates=function(t){if(!t||!t.recordings||this._mediaStates.recordings===t.recordings)return this;switch(this._mediaStates.recordings=t.recordings,this._mediaStates.recordings){case"OK":this._log.info("Warnings have cleared."),this.emit("warningsCleared");break;case"NO_MEDIA":this._log.warn("Recording media lost."),this.emit("warning",_.recordingMediaLost);break;default:this._log.warn("Unknown media state detected: "+this._mediaStates.recordings);break}return this},r}(p);return an=i,an}var on,Qc;function zl(){if(Qc)return on;Qc=1;var k=on&&on.__extends||function(){var a=function(c,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(c,s)};return function(c,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(c,s);function d(){this.constructor=c}c.prototype=s===null?Object.create(s):(d.prototype=s.prototype,new d)}}(),p=Ql(),_=Kl(),o=Ce().DEFAULT_LOG_LEVEL,i=ze(),e=Pe(),r=e.buildLogLevels,t=e.isDeepEqual,n=function(a){k(c,a);function c(s,d,v){var u=this;v=Object.assign({logLevel:o,LocalTrackPublicationV2:_},v),u=a.call(this)||this;var g=r(v.logLevel);return Object.defineProperties(u,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:s},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:v.LocalTrackPublicationV2},_log:{value:v.log?v.log.createLog("default",u):new i("default",u,g,v.loggerName)},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},audioProcessors:{value:[],writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:d},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),u}return c.prototype.toString=function(){return"[LocalParticipantSignaling: "+this.sid+"]"},c.prototype.setSignalingRegion=function(s){this._signalingRegion||(this._signalingRegion=s)},c.prototype.setBandwidthProfile=function(s){t(this._bandwidthProfile,s)||(this._bandwidthProfile=JSON.parse(JSON.stringify(s)),this._bandwidthProfileRevision++,this.didUpdate())},c.prototype.setAudioProcessors=function(s){this.audioProcessors=s},c.prototype.getParameters=function(){return this._encodingParameters},c.prototype.setParameters=function(s){return this._encodingParameters.update(s),this},c.prototype.update=function(s){return this._publishedRevision>=s.revision?this:(this._publishedRevision=s.revision,s.tracks.forEach(function(d){var v=this.tracks.get(d.id);v&&v.update(d)},this),this)},c.prototype.updateMediaStates=function(s){return!s||!s.tracks?this:(Array.from(this.tracks.values()).forEach(function(d){var v=s.tracks[d.sid];v&&d.updateMediaStates(v)}),this)},c.prototype._createLocalTrackPublicationSignaling=function(s,d,v,u){return new this._LocalTrackPublicationV2(s,d,v,u,{log:this._log})},c.prototype.addTrack=function(s,d,v,u){var g=this;a.prototype.addTrack.call(this,s,d,v,u);var h=this.getPublication(s),S=h.isEnabled,R=h.updatedPriority,T=function(){(S!==h.isEnabled||R!==h.updatedPriority)&&(g.didUpdate(),S=h.isEnabled,R=h.updatedPriority)};return h.on("updated",T),this._removeListener(h),this._removeListeners.set(h,function(){return h.removeListener("updated",T)}),this.didUpdate(),this},c.prototype._removeListener=function(s){var d=this._removeListeners.get(s);d&&d()},c.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(s){return s.getState()})}},c.prototype.didUpdate=function(){this._revision++,this.emit("updated")},c.prototype.removeTrack=function(s){var d=a.prototype.removeTrack.call(this,s);return d&&(s.removeClone(d.trackTransceiver),this._removeListener(d),this.didUpdate()),d},c.prototype.setNetworkQualityConfiguration=function(s){this.networkQualityConfiguration.update(s)},c.prototype.setPublisherHint=function(s,d){var v=Array.from(this.tracks.values()).find(function(u){return u.sid===s});return v?v.trackTransceiver.setPublisherHint(d):(this._log.warn("track:"+s+" not found"),Promise.resolve("UNKNOWN_TRACK"))},c}(p);return on=n,on}var cn,$c;function Yl(){if($c)return cn;$c=1;var k=cn&&cn.__extends||function(){var r=function(t,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(a[s]=c[s])},r(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");r(t,n);function a(){this.constructor=t}t.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),p=ji(),_=Ws(),o=Dt(),i={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},e=function(r){k(t,r);function t(){return r.call(this,"closed",i)||this}return t.prototype._close=function(n){return this.transition("closing",n),this.transition("closed",n),Promise.resolve(this)},t.prototype._connect=function(n,a,c,s,d){n.connect("PA00000000000000000000000000000000","test");var v="RM00000000000000000000000000000000",u=Promise.resolve(new _(n,v,d));return u.cancel=function(){},u},t.prototype._open=function(n){return this.transition("opening",n),this.transition("open",n),Promise.resolve(this)},t.prototype.close=function(){var n=this;return this.bracket("close",function(a){switch(n.state){case"closed":return n;case"open":return n._close(a);default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},t.prototype.connect=function(n,a,c,s,d){var v=this;return this.bracket("connect",function u(g){switch(v.state){case"closed":return v._open(g).then(u.bind(null,g));case"open":return v.releaseLockCompletely(g),v._connect(n,a,c,s,d);default:throw new Error('Unexpected Signaling state "'+v.state+'"')}})},t.prototype.createLocalParticipantSignaling=function(){return new p},t.prototype.open=function(){var n=this;return this.bracket("open",function(a){switch(n.state){case"closed":return n._open(a);case"open":return n;default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},t}(o);return cn=e,cn}var sn,Kc;function Jl(){if(Kc)return sn;Kc=1;var k=sn&&sn.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=Gl(),_=zl(),o=Yl(),i=function(e){k(r,e);function r(t,n){var a=this;return n=Object.assign({createCancelableRoomSignalingPromise:p},n),a=e.call(this)||this,Object.defineProperties(a,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:t}}),a}return r.prototype._connect=function(t,n,a,c,s){return s=Object.assign({},this._options,s),this._createCancelableRoomSignalingPromise.bind(null,n,this._wsServer,t,a,c,s)},r.prototype.createLocalParticipantSignaling=function(t,n){return new _(t,n)},r}(o);return sn=i,sn}var Ti,zc;function Xl(){if(zc)return Ti;zc=1;var k=Ot().MediaStreamTrack,p=qe(),_=p.guessBrowser,o=p.guessBrowserVersion,i=p.isCodecSupported,e=qu(),r=Vu(),t=Yu(),n=Ps(),a=Ju(),c=It(),s=c.LocalAudioTrack,d=c.LocalDataTrack,v=c.LocalVideoTrack,u=Xu(),g=il(),h=Jl(),S=Pe(),R=S.asLocalTrack,T=S.buildLogLevels,b=S.filterObject,y=S.isNonArrayObject,l=Ce(),f=l.DEFAULT_ENVIRONMENT,m=l.DEFAULT_LOG_LEVEL,C=l.DEFAULT_LOGGER_NAME,P=l.DEFAULT_REALM,M=l.DEFAULT_REGION,I=l.WS_SERVER,O=l.SDK_NAME,x=l.SDK_VERSION,E=l.typeErrors,q=Ai(),B=Es(),G=ze(),F=Cs().validateBandwidthProfile,N=_()==="safari"&&o(),A=0,w=!1,j=!1;if(N){var Q=N.major,Y=N.minor;j=Q<12||Q===12&&Y<1}var $=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),K=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function J(ue,ee){if(typeof ee>"u"&&(ee={}),!y(ee))return q.reject(E.INVALID_TYPE("options","object"));var he=ee.Log||G,le=ee.loggerName||C,ge=ee.logLevel||m,W=T(ge),z="[connect #"+ ++A+"]",D;try{D=new he("default",z,W,le)}catch(H){return q.reject(H)}te(ee,D,$);var L=ee.preferredVideoCodecs==="auto";if(L&&(ee.preferredVideoCodecs=[{codec:"VP8",simulcast:!0,adaptiveSimulcast:!0}]),ee.maxVideoBitrate&&L)return D.error('ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'),q.reject(E.ILLEGAL_INVOKE("connect",'ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'));ee=Object.assign({automaticSubscription:!0,dominantSpeaker:!1,enableDscp:!1,environment:f,eventListener:null,insights:!0,LocalAudioTrack:s,LocalDataTrack:d,LocalParticipant:t,LocalVideoTrack:v,Log:he,MediaStreamTrack:k,loggerName:le,logLevel:ge,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:P,region:M,signaling:h},b(ee));var U={};typeof ee.wsServerInsights=="string"&&(U.gateway=ee.wsServerInsights);var ie=ee.insights?n:a,fe=new ie(ue,O,x,ee.environment,ee.realm,U),me=I(ee.environment,ee.region),we=new B(fe,Date.now(),D,ee.eventListener);if(ee=Object.assign({eventObserver:we,wsServer:me},ee),ee.log=D,j&&!w&&D.logLevel!=="error"&&D.logLevel!=="off"&&(w=!0,D.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),typeof ue!="string")return q.reject(E.INVALID_TYPE("token","string"));var Re=Object.assign({},ee);if(delete Re.name,"tracks"in ee){if(!Array.isArray(ee.tracks))return q.reject(E.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{ee.tracks=ee.tracks.map(function(H){return R(H,Re)})}catch(H){return q.reject(H)}}var _e=F(ee.bandwidthProfile);if(_e)return q.reject(_e);ee.clientTrackSwitchOffControl="disabled",ee.contentPreferencesMode="disabled",ee.bandwidthProfile&&(ee.clientTrackSwitchOffControl="auto",ee.contentPreferencesMode="auto",ee.bandwidthProfile.video&&(te(ee.bandwidthProfile.video,D,K),"maxTracks"in ee.bandwidthProfile.video?ee.clientTrackSwitchOffControl="disabled":ee.bandwidthProfile.video.clientTrackSwitchOffControl==="manual"?ee.clientTrackSwitchOffControl="manual":ee.clientTrackSwitchOffControl="auto","renderDimensions"in ee.bandwidthProfile.video?ee.contentPreferencesMode="disabled":ee.bandwidthProfile.video.contentPreferencesMode==="manual"?ee.contentPreferencesMode="manual":ee.contentPreferencesMode="auto"));var je=ee.signaling,He=new je(ee.wsServer,ee);D.info("Connecting to a Room"),D.debug("Options:",ee);var We=new r({maxAudioBitrate:ee.maxAudioBitrate,maxVideoBitrate:ee.maxVideoBitrate},L),ae={audio:ee.preferredAudioCodecs.map(ve),video:ee.preferredVideoCodecs.map(ve)},re=new u(y(ee.networkQuality)?ee.networkQuality:{});["audio","video"].forEach(function(H){return ae[H].forEach(function(X){var Z=X.codec;return i(Z,H).then(function(ne){return!ne&&D.warn("The preferred "+H+' codec "'+Z+'" will be ignored as it is not supported by the browser.')})})});var V=e(de.bind(null,ee),se.bind(null,He,D,We,re,ee),ce.bind(null,ue,ee,He,We,ae),oe.bind(null,ee));return V.then(function(H){return fe.connect(H.sid,H.localParticipant.sid),D.info("Connected to Room:",H.toString()),D.info("Room name:",H.name),D.debug("Room:",H),H.once("disconnected",function(){return fe.disconnect()}),H},function(H){fe.disconnect(),V._isCanceled?D.info("Attempt to connect to a Room was canceled"):D.info("Error while connecting to a Room:",H)}),V}function te(ue,ee,he){he.forEach(function(le){var ge=le.didWarn,W=le.name,z=le.newName,D=le.shouldDelete;W in ue&&typeof ue[W]<"u"&&(z&&D&&(ue[z]=ue[W]),D&&delete ue[W],!ge&&!["error","off"].includes(ee.level)&&(ee.warn('The ConnectOptions "'+W+'" is '+(z?'deprecated and scheduled for removal. Please use "'+z+'" instead.':"no longer applicable and will be ignored.")),le.didWarn=!0))})}function se(ue,ee,he,le,ge,W){var z=ue.createLocalParticipantSignaling(he,le);return ee.debug("Creating a new LocalParticipant:",z),new ge.LocalParticipant(z,W,ge)}function oe(ue,ee,he){var le=new g(ee,he,ue),ge=ue.log;return ge.debug("Creating a new Room:",le),he.on("stateChanged",function W(z){z==="disconnected"&&(ge.info("Disconnected from Room:",le.toString()),he.removeListener("stateChanged",W))}),le}function ce(ue,ee,he,le,ge,W){return ee.log.debug("Creating a new RoomSignaling"),he.connect(W._signaling,ue,le,ge,ee)}function de(ue,ee){var he=ue.log;return ue.shouldStopLocalTracks=!ue.tracks,ue.shouldStopLocalTracks?he.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(he.info("Getting LocalTracks"),he.debug("Options:",ue)),ue.createLocalTracks(ue).then(function(ge){var W=ee(ge);return W.catch(function(){ue.shouldStopLocalTracks&&(he.info("The automatically acquired LocalTracks will now be stopped"),ge.forEach(function(D){D.stop()}))}),W})}function ve(ue){var ee=typeof ue=="string"?{codec:ue}:ue;switch(ee.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},ee);case"vp8":return Object.assign({simulcast:!1},ee);default:return ee}}return Ti=J,Ti}var wi,Yc;function Jc(){if(Yc)return wi;Yc=1;var k=Ce(),p=k.DEFAULT_LOG_LEVEL,_=k.DEFAULT_LOGGER_NAME;function o(r,t){t=Object.assign({loggerName:_,logLevel:p},t);var n={};n.loggerName=t.loggerName,n.logLevel=t.logLevel,delete t.loggerName,delete t.logLevel;var a=["getUserMedia","enumerateDevices","MediaStream","mapMediaElement","disposeMediaElement"];a.forEach(function(s){s in t&&(n[s]=t[s],delete t[s])});var c=t.createLocalTracks;return delete t.createLocalTracks,n[r]=Object.keys(t).length>0?t:!0,c(n).then(function(s){return s[0]})}function i(r){return o("audio",r)}function e(r){return o("video",r)}return wi={audio:i,video:e},wi}var Ei,Xc;function Zl(){if(Xc)return Ei;Xc=1;var k=qe(),p=k.guessBrowser,_=k.support,o=un().getSdpFormat,i=Rt(),e=i.isAndroid,r=i.isMobile,t=i.isNonChromiumEdge,n=i.rebrandedChromeBrowser,a=i.mobileWebKitBrowser,c=["crios","edg","edge","electron","headlesschrome"],s=["chrome","firefox"],d=["chrome","safari"],v=[];function u(){var g=p();if(!g)return!1;var h=n(g),S=a(g),R=e()?s:d;return!!g&&_()&&o()==="unified"&&(!h||c.includes(h))&&!t(g)&&(!S||v.includes(S))&&(!r()||R.includes(g))}return Ei=u,Ei}var Pi=bn.exports,Zc;function ed(){if(Zc)return bn.exports;Zc=1;var k=Pi&&Pi.__assign||function(){return k=Object.assign||function(v){for(var u,g=1,h=arguments.length;g<h;g++){u=arguments[g];for(var S in u)Object.prototype.hasOwnProperty.call(u,S)&&(v[S]=u[S])}return v},k.apply(this,arguments)};Object.defineProperty(Pi,"__esModule",{value:!0});var p=Cu(),_=Nu(),o={connect:Xl(),createLocalAudioTrack:Jc().audio,createLocalVideoTrack:Jc().video,isSupported:Zl()(),version:ts.version,Logger:es(),LocalAudioTrack:It().LocalAudioTrack,LocalDataTrack:It().LocalDataTrack,LocalVideoTrack:It().LocalVideoTrack};function i(v,u){var g=k({createLocalTracks:p.createLocalTracks},u);return o.connect(v,g)}function e(v){var u=k({createLocalTracks:p.createLocalTracks},v);return o.createLocalAudioTrack(u)}function r(v){var u=k({createLocalTracks:p.createLocalTracks},v);return o.createLocalVideoTrack(u)}var t=o.isSupported,n=o.version,a=o.Logger,c=o.LocalAudioTrack,s=o.LocalVideoTrack,d=o.LocalDataTrack;return bn.exports={connect:i,createLocalAudioTrack:e,createLocalVideoTrack:r,createLocalTracks:p.createLocalTracks,runPreflight:_.runPreflight,isSupported:t,version:n,Logger:a,LocalAudioTrack:c,LocalVideoTrack:s,LocalDataTrack:d},bn.exports}var td=ed();const Ci=Ys(td),rd=({content:k,onContentChange:p,isOpen:_,theme:o})=>{const i=`notepad-container ${_?"open":""} ${o}`;return Te.jsxs("div",{className:i,children:[Te.jsx("h3",{className:"notepad-header",children:"Shared Notes"}),Te.jsx("textarea",{value:k,onChange:e=>p(e.target.value),placeholder:"Type your shared notes here...",className:"notepad-textarea"})]})},nd=({transcript:k})=>Te.jsxs("div",{className:"transcript-container-overlay",children:[Te.jsx("h3",{className:"transcript-header",children:"Live Transcript"}),Te.jsx("div",{className:"transcript-content",children:Te.jsx("p",{children:k})})]}),id=({startTime:k})=>{const[p,_]=Ae.useState(0);Ae.useEffect(()=>{const t=setInterval(()=>_(Date.now()-k),1e3);return()=>clearInterval(t)},[k]);const o=Math.floor(p/1e3),i=Math.floor(o/60),e=o%60;let r="text-green-500";return i>=45&&(r="text-yellow-500"),i>=55&&(r="text-red-500"),Te.jsxs("div",{className:`font-mono text-lg font-bold ${r}`,children:[String(i).padStart(2,"0"),":",String(e).padStart(2,"0")]})},od=()=>{const{theme:k}=Js(),{sessionId:p}=Xs(),{token:_,user:o}=Zs(),i=eu(),[e,r]=Ae.useState(null),[t,n]=Ae.useState(null),[a,c]=Ae.useState({message:"Initializing...",type:"info"}),[s,d]=Ae.useState(null),v=Ae.useRef(null),u=Ae.useRef(null),g=Ae.useRef(null),[h,S]=Ae.useState(!1),[R,T]=Ae.useState(""),[b,y]=Ae.useState(!1),[l,f]=Ae.useState(!1),[m,C]=Ae.useState(!1),[P,M]=Ae.useState(!1),[I,O]=Ae.useState(""),x=Ae.useRef(null),E=Ae.useRef(null),[q,B]=Ae.useState(!1),[G,F]=Ae.useState(!1),N=Ae.useRef(!1);Ae.useEffect(()=>{!p||!_||(c({message:"Authenticating...",type:"connecting"}),En.post(`/sessions/${p}/call-token`,{},{headers:{Authorization:`Bearer ${_}`}}).then(J=>{r(J.data.videoToken),c({message:"Ready to join session.",type:"info"})}).catch(J=>c({message:"Error: Could not authenticate for call.",type:"error"})))},[p,_]),Ae.useEffect(()=>{if(!e)return;let J=null,te=null;return c({message:"Joining room...",type:"connecting"}),Ci.connect(e,{name:p,audio:!0,video:!0}).then(se=>{J=se,n(se),c({message:"Joined room. Waiting for other participant...",type:"success"}),v.current&&(v.current.innerHTML="",se.localParticipant.tracks.forEach(ce=>{ce.track&&v.current?.appendChild(ce.track.attach())}));const oe=ce=>{c({message:"Participant connected!",type:"success"}),s||d(Date.now()),ce.tracks.forEach(de=>{de.track&&u.current&&u.current.appendChild(de.track.attach())}),ce.on("trackSubscribed",de=>{u.current&&u.current.appendChild(de.attach())}),ce.on("trackUnsubscribed",de=>{de.detach().forEach(ve=>ve.remove())})};se.on("participantConnected",oe),se.participants.forEach(oe),se.on("participantDisconnected",()=>{c({message:"The other user has left.",type:"info"}),u.current&&(u.current.innerHTML="")})}).catch(se=>c({message:"Error: Failed to connect to video service.",type:"error"})),te=tu("http://localhost:5000/api",{auth:{token:_}}),g.current=te,te.emit("join-data-room",p),te.on("notepad-update",se=>T(se)),()=>{J?.disconnect(),te?.disconnect()}},[e,p,_,s]),Ae.useEffect(()=>{t&&o?.role==="MENTEE"&&!N.current&&(N.current=!0,En.post(`/sessions/${p}/notify-call`).then(()=>{At.success("Your mentor has been notified that you've joined the call.")}).catch(J=>{console.error("Failed to send call notification:",J),At.error("Could not notify your mentor.")}))},[t,o,p]);const A=Ae.useCallback(J=>{T(J),g.current?.emit("notepad-change",{roomId:p,content:J})},[p]),w=()=>{t?.localParticipant.audioTracks.forEach(J=>{J.track.isEnabled?J.track.disable():J.track.enable(),y(!J.track.isEnabled)})},j=()=>{t?.localParticipant.videoTracks.forEach(J=>{J.track.isEnabled?J.track.disable():J.track.enable(),f(!J.track.isEnabled)})},Q=async()=>{if(m){const{localParticipant:J}=t,te=Array.from(J.videoTracks.values())[0].track;J.unpublishTrack(te),te.stop();const se=await Ci.createLocalVideoTrack();J.publishTrack(se),C(!1)}else try{const J=await navigator.mediaDevices.getDisplayMedia({video:!0}),te=new Ci.LocalVideoTrack(J.getTracks()[0]),{localParticipant:se}=t;se.unpublishTrack(Array.from(se.videoTracks.values())[0].track),se.publishTrack(te),C(!0),te.mediaStreamTrack.onended=()=>{Q()}}catch(J){console.error("Screen share failed:",J),C(!1)}},Y=()=>{if(P)x.current?.stop(),E.current?.close(),M(!1),At.success("Transcription stopped.");else{const J=new Promise((te,se)=>{if(!t?.participants.size)return se("Cannot start transcription without another participant.");const oe=Array.from(t.participants.values())[0],ce=Array.from(oe.audioTracks.values())[0]?.track;if(ce&&ce.mediaStreamTrack){const de=new MediaStream([ce.mediaStreamTrack.clone()]),ve="7183aa14021913883cc5b688c4cdbe1e72952feb",ue="wss://api.deepgram.com/v1/listen?encoding=linear16&sample_rate=16000&channels=1&punctuate=true&interim_results=true",ee=new WebSocket(ue,["token",ve]);ee.onopen=()=>{const he=new MediaRecorder(de);he.ondataavailable=le=>{le.data.size>0&&ee.readyState===1&&ee.send(le.data)},x.current=he,he.start(250),M(!0),te()},ee.onmessage=he=>{const le=JSON.parse(he.data),ge=le.channel.alternatives[0].transcript;ge&&le.is_final&&O(W=>W+ge+" ")},ee.onerror=()=>{se("Could not connect to transcription service.")},E.current=ee}else se("The other participant's audio is not available.")});At.promise(J,{loading:"Starting transcription...",success:"Transcription started!",error:te=>te.toString()})}},$=()=>{if(!I||!p){At.error("No transcript available to generate insights.");return}B(!0);const J=En.post("/ai/summarize",{sessionId:p,transcript:I});At.promise(J,{loading:"Generating AI insights...",success:te=>(F(!0),B(!1),"Insights have been generated and saved!"),error:te=>(B(!1),te.response?.data?.message||"Failed to generate insights.")})},K=J=>{switch(J){case"success":return"status-success";case"error":return"status-error";case"connecting":return"status-connecting";default:return"status-info"}};return Te.jsxs("div",{className:`video-call-container ${k}`,children:[Te.jsxs("div",{className:"flex justify-between items-center",children:[Te.jsx("h1",{className:"video-call-header",children:"Video Session"}),s&&Te.jsx(id,{startTime:s})]}),Te.jsx("p",{className:`video-call-status ${K(a.type)}`,children:a.message}),Te.jsxs("div",{className:`video-main-area ${K(a.type)}`,children:[Te.jsxs("div",{className:"video-grid-container",children:[Te.jsxs("div",{className:"video-participant-container",children:[Te.jsx("div",{ref:u,className:"video-feed"}),Te.jsx("div",{className:"video-label",children:o?.role==="MENTEE"?"Mentor":"Mentee"})]}),Te.jsxs("div",{className:"video-participant-container",children:[Te.jsx("div",{ref:v,className:"video-feed"}),Te.jsx("div",{className:"video-label",children:o?.role==="MENTEE"?"You (Mentee)":"You (Mentor)"})]})]}),Te.jsx(rd,{isOpen:h,onToggle:()=>S(J=>!J),content:R,onContentChange:A,theme:k}),P&&Te.jsx(nd,{transcript:I})]}),t&&Te.jsxs("div",{className:"control-bar",children:[Te.jsx("button",{onClick:w,className:`control-button ${b?"inactive":"active"}`,children:b?"Unmute":"Mute"}),Te.jsx("button",{onClick:j,className:`control-button ${l?"inactive":"active"}`,children:l?"Start Video":"Stop Video"}),Te.jsx("button",{onClick:Q,className:`control-button ${m?"inactive":"active"}`,children:m?"Stop Sharing":"Share Screen"}),Te.jsx("button",{onClick:()=>S(J=>!J),className:`control-button ${h?"inactive":"active"}`,children:h?"Close Notepad":"Open Notepad"}),Te.jsx("button",{onClick:Y,className:`control-button ${P?"inactive":"active"}`,children:P?"Stop Transcript":"Start Transcript"}),!P&&I.length>0&&!G&&Te.jsx("button",{onClick:$,disabled:q,className:"control-button active",children:q?"Generating...":"Generate AI Insights"}),G&&Te.jsx(ru,{to:`/session/${p}/insights`,className:"control-button active",children:"View Insights"}),Te.jsx("button",{onClick:()=>{t.disconnect(),i("/my-sessions")},className:"control-button inactive",children:"Leave Session"})]})]})};export{od as default};
