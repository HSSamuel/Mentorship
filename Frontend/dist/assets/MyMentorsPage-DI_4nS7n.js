import{r as s,j as e,V as i,c as b,u as H,L as U}from"./index-kKR_KBkN.js";import{G as V}from"./GoalList-DBzTTnSE.js";import{P as z}from"./plus-CuJYe4j9.js";const $=()=>e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),K=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M15 4V2"}),e.jsx("path",{d:"M15 16v-2"}),e.jsx("path",{d:"M8 9h2"}),e.jsx("path",{d:"M20 9h2"}),e.jsx("path",{d:"M17.8 11.8 19 13"}),e.jsx("path",{d:"M15 9a3 3 0 0 0-3-3"}),e.jsx("path",{d:"M12 12a3 3 0 0 0-3-3H6a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h3a3 3 0 0 0 3-3v-1a3 3 0 0 0-3-3H9"}),e.jsx("path",{d:"m5 7-1.8-1.8"})]}),B=({isOpen:d,onClose:G,onSave:o,goal:c})=>{const[m,x]=s.useState(""),[R,u]=s.useState(!1),[g,N]=s.useState(!1),[h,j]=s.useState(""),[F,p]=s.useState(""),[y,f]=s.useState(""),[M,t]=s.useState(""),[n,v]=s.useState(""),[C,I]=s.useState(""),[a,r]=s.useState(""),[w,A]=s.useState(!1);if(s.useEffect(()=>{d&&(c?(j(c.title),p(c.description||""),f(c.specific||""),t(c.measurable||""),v(c.achievable||""),I(c.relevant||""),r(c.timeBound||""),u(!0)):(j(""),p(""),f(""),t(""),v(""),I(""),r(""),x(""),u(!1)))},[c,d]),!d)return null;const L=async()=>{if(!m.trim()){i.error("Please enter a goal to get started.");return}N(!0);try{const l=await b.post("/ai/refine-goal",{goal:m}),{title:E,specific:D,measurable:P,achievable:T,relevant:O,timeBound:W}=l.data;j(E),f(D),t(P),v(T),I(O),r(W),u(!0)}catch(l){console.error("Failed to refine goal with AI:",l),i.error("Could not refine goal. Please try again.")}finally{N(!1)}},q=async l=>{if(l.preventDefault(),!h||!y||!M||!n||!C||!a){i.error("Please fill out the Title and all S.M.A.R.T. goal fields.");return}A(!0);try{await o({title:h,description:F,specific:y,measurable:M,achievable:n,relevant:C,timeBound:a})}catch{}finally{A(!1)}},k="mt-1 block w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",S="block text-sm font-medium text-gray-700 dark:text-gray-300";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-center text-gray-800 dark:text-gray-100 mb-4",children:c?"Edit Goal":"Add New Goal"}),R?e.jsxs("form",{onSubmit:q,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:S,children:"Goal Title"}),e.jsx("input",{type:"text",id:"title",value:h,onChange:l=>j(l.target.value),required:!0,className:k})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:S,children:"Description (Optional)"}),e.jsx("textarea",{id:"description",value:F,onChange:l=>p(l.target.value),className:k,rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"specific",className:S,children:"Specific"}),e.jsx("input",{type:"text",id:"specific",value:y,onChange:l=>f(l.target.value),required:!0,className:k,placeholder:"What exactly do I want to accomplish?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"measurable",className:S,children:"Measurable"}),e.jsx("input",{type:"text",id:"measurable",value:M,onChange:l=>t(l.target.value),required:!0,className:k,placeholder:"How will I track my progress?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"achievable",className:S,children:"Achievable"}),e.jsx("input",{type:"text",id:"achievable",value:n,onChange:l=>v(l.target.value),required:!0,className:k,placeholder:"Is this goal realistic?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"relevant",className:S,children:"Relevant"}),e.jsx("input",{type:"text",id:"relevant",value:C,onChange:l=>I(l.target.value),required:!0,className:k,placeholder:"Why is this goal important to me?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"timeBound",className:S,children:"Time-bound"}),e.jsx("input",{type:"text",id:"timeBound",value:a,onChange:l=>r(l.target.value),required:!0,className:k,placeholder:"What is the deadline?"})]}),e.jsxs("div",{className:"flex justify-between items-center gap-4 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"text-sm font-medium text-gray-600 dark:text-gray-400 hover:underline",children:"← Start Over"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:G,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-400 disabled:cursor-not-allowed flex items-center justify-center w-28",children:w?e.jsx($,{}):c?"Save":"Add Goal"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"initial-goal",className:S,children:"What is your goal?"}),e.jsx("textarea",{id:"initial-goal",value:m,onChange:l=>x(l.target.value),className:k,rows:3,placeholder:"e.g., 'Become a software engineer' or 'Get better at public speaking'"}),e.jsx("button",{type:"button",onClick:L,disabled:g,className:"w-full flex justify-center items-center gap-2 px-4 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-purple-500 to-indigo-600 rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all disabled:opacity-70",children:g?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx(K,{})," Refine with AI ✨"]})}),e.jsx("button",{type:"button",onClick:G,className:"w-full text-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"})]})]})})},Y=({mentorshipId:d,onAddGoal:G,onEditGoal:o})=>{const{user:c}=H(),[m,x]=s.useState([]),[R,u]=s.useState([]),[g,N]=s.useState([]),[h,j]=s.useState(null),[F,p]=s.useState(!1),[y,f]=s.useState(null),[M,t]=s.useState(!0),n=s.useCallback(async()=>{if(d){t(!0);try{const a=await b.get(`/goals/mentorship/${d}`);x(a.data),u(a.data)}catch(a){console.error("Failed to fetch goals:",a),i.error("Could not load your goals.")}finally{t(!1)}return}t(!0);try{const[a,r]=await Promise.all([b.get("/goals"),b.get("/users/connections")]);x(a.data),N(r.data),r.data.length>0&&j(r.data[0].id)}catch(a){console.error("Failed to fetch goals or mentorships:",a),i.error("Could not load your goals.")}finally{t(!1)}},[d]);s.useEffect(()=>{n()},[n]),s.useEffect(()=>{if(d){u(m.filter(a=>a.mentorshipRequestId===d));return}if(h){const a=m.filter(r=>r.mentorshipRequest?.mentorId===h||r.mentorshipRequest?.menteeId===h);u(a)}else u(g.length===0?m:[])},[h,m,g,d]);const v=async a=>{try{if(y){const{data:r}=await b.put(`/goals/${y.id}`,a);x(m.map(w=>w.id===r.id?r:w)),i.success("Goal updated!")}else{const r=d||h,A=g.find(q=>q.id===r)?.mentorshipRequestId;if(!A){i.error("Could not find the associated mentorship to save this goal.");return}const{data:L}=await b.post("/goals",{...a,mentorshipRequestId:A});x([...m,L]),i.success("Goal added!")}p(!1),f(null)}catch(r){console.error("Failed to save goal:",r),i.error("Failed to save goal.")}},C=a=>{x(r=>r.map(w=>w.id===a.id?a:w)),i.success("Goal status updated!")},I=async a=>{if(window.confirm("Are you sure you want to delete this goal?"))try{await b.delete(`/goals/${a}`),x(m.filter(r=>r.id!==a)),i.success("Goal deleted.")}catch(r){console.error("Failed to delete goal:",r),i.error("Failed to delete goal.")}};return M?e.jsx("p",{className:"text-gray-500",children:"Loading goals..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-700 dark:text-gray-200",children:"Our Goals"}),e.jsxs("button",{onClick:()=>{G?G():(f(null),p(!0))},className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(z,{size:16})," Add New Goal"]})]}),!d&&g.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"mentorship-select",className:"sr-only",children:"Select a mentorship"}),e.jsx("select",{id:"mentorship-select",value:h||"",onChange:a=>j(a.target.value),className:"w-full p-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600",children:g.map(a=>e.jsxs("option",{value:a.id,children:["Goals with ",a.name]},a.id))})]}),e.jsx(V,{goals:R,onUpdate:C,onEdit:a=>{o?o(a):(f(a),p(!0))},onDelete:I}),e.jsx(B,{isOpen:F,onClose:()=>{p(!1),f(null)},onSave:v,goal:y,mentorshipId:h})]})},Z=()=>{const[d,G]=s.useState([]),[o,c]=s.useState(null),[m,x]=s.useState(!0),[R,u]=s.useState(!1),[g,N]=s.useState(null),[h,j]=s.useState(0),[F,p]=s.useState(!1);s.useEffect(()=>{(async()=>{x(!0);try{const v=(await b.get("/requests/sent")).data.filter(C=>C.status==="ACCEPTED");G(v),v.length>0&&c(v[0])}catch(n){console.error("Failed to fetch matches:",n)}finally{x(!1)}})()},[]);const y=t=>t?.avatarUrl?t.avatarUrl.startsWith("http")?t.avatarUrl:`${b.defaults.baseURL}${t.avatarUrl}`.replace("/api",""):`https://ui-avatars.com/api/?name=${encodeURIComponent(t?.name||"User")}&background=random&color=fff`,f=t=>{if(!t)return console.error("Received an invalid date value from the backend:",t),"Date not available";const n=new Date(t);return isNaN(n.getTime())?(console.error("Could not parse the following date string:",t),"Invalid Date"):n.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},M=async t=>{if(!o){i.error("No mentor selected.");return}console.log("Saving goal for mentorshipId:",o.id,"with data:",t),p(!0);try{g?(await b.put(`/goals/${g.id}`,t),i.success("Goal updated successfully!")):(await b.post("/goals",{...t,mentorshipRequestId:o.id}),i.success("Goal added successfully!")),j(n=>n+1),u(!1),N(null)}catch(n){console.error("Failed to save goal:",n),i.error("Failed to save goal.")}finally{p(!1)}};return m?e.jsx("p",{className:"text-center text-gray-500",children:"Loading your mentors..."}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-center text-gray-900 dark:text-white mb-8",children:"My Mentors"}),d.length>0?e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("aside",{className:"w-full md:w-1/3 lg:w-1/4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:e.jsx("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:d.map(t=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>c(t),className:`w-full text-left p-4 transition-all duration-200 flex items-center ${o?.id===t.id?"bg-gradient-to-r from-purple-100 to-blue-100 dark:from-purple-900/50 dark:to-blue-900/50":"hover:bg-gray-50 dark:hover:bg-gray-700/50"}`,children:[e.jsx("img",{src:y(t.mentor.profile),alt:`Avatar of ${t.mentor.profile.name}`,className:"w-10 h-10 rounded-full object-cover mr-4"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-semibold ${o?.id===t.id?"text-purple-700 dark:text-purple-300":"text-gray-800 dark:text-gray-200"}`,children:t.mentor.profile.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Matched on ",f(t.updatedAt)]})]})]})},t.id))})})}),e.jsx("main",{className:"flex-1",children:o?e.jsxs("div",{className:"rounded-xl shadow-2xl p-6 bg-gradient-to-br from-purple-100 via-blue-100 to-cyan-100 dark:from-purple-900/70 dark:via-blue-900/70 dark:to-cyan-900/70",children:[e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b border-gray-300 dark:border-gray-600 mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:y(o.mentor.profile),alt:`Avatar of ${o.mentor.profile.name}`,className:"w-16 h-16 rounded-full object-cover mr-4 ring-2 ring-white/50"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.mentor.profile.name})]}),e.jsx(U,{to:`/book-session/${o.mentor.id}`,className:"px-5 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-md hover:from-blue-600 hover:to-purple-700 transition-all duration-300",children:"Book a Session"})]}),e.jsx("div",{className:"bg-white/50 dark:bg-gray-800/50 p-6 rounded-lg",children:e.jsx(Y,{mentorshipId:o.id,onAddGoal:()=>{N(null),u(!0)},onEditGoal:t=>{N(t),u(!0)}},h)})]}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Select a mentor to see details."})})]}):e.jsxs("div",{className:"text-center py-16 px-6 bg-white dark:bg-gray-800 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"No Active Mentors"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"You have no active mentorships. Find a mentor to get started!"}),e.jsx(U,{to:"/mentors",className:"mt-4 inline-block px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"Find a Mentor"})]}),o&&e.jsx(B,{isOpen:R,onClose:()=>u(!1),onSave:M,goal:g,isSubmitting:F})]})};export{Z as default};
