import{g as Yc,j as Se,n as Jc,f as Xc,u as Zc,a as eu,r as Pe,l as tu,c as hn,V as At,L as ru}from"./index-kKR_KBkN.js";var kn={exports:{}},Fe={},Qe={},Je={},Pn,Vi;function nu(){return Vi||(Vi=1,Pn=function(k){var p=k.location,_=k.URL;return[p,_].some(function(s){return!s})?function(i){return Promise.reject(new Error("Failed to import: "+i+": dynamicImport is not supported"))}:(k.__twilioVideoImportedModules={},function(i){return i in k.__twilioVideoImportedModules?Promise.resolve(k.__twilioVideoImportedModules[i]):new Function("scope","return import('"+new _(i,p)+"').then(m => scope.__twilioVideoImportedModules['"+i+"'] = m);")(k)})}(globalThis)),Pn}var Cn,Fi;function ec(){if(Fi)return Cn;Fi=1;var k=function(){},p="undefined",_=typeof window!==p&&typeof window.navigator!==p&&/Trident\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"];function i(u,y){var h=u[y];if(typeof h.bind=="function")return h.bind(u);try{return Function.prototype.bind.call(h,u)}catch{return function(){return Function.prototype.apply.apply(h,[u,arguments])}}}function e(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(u){return u==="debug"&&(u="log"),typeof console===p?!1:u==="trace"&&_?e:console[u]!==void 0?i(console,u):console.log!==void 0?i(console,"log"):k}function t(u,y){for(var h=0;h<s.length;h++){var S=s[h];this[S]=h<u?k:this.methodFactory(S,u,y)}this.log=this.debug}function n(u,y,h){return function(){typeof console!==p&&(t.call(this,y,h),this[u].apply(this,arguments))}}function a(u,y,h){return r(u)||n.apply(this,arguments)}function o(u,y,h){var S=this,L,T="loglevel";typeof u=="string"?T+=":"+u:typeof u=="symbol"&&(T=void 0);function b(f){var m=(s[f]||"silent").toUpperCase();if(!(typeof window===p||!T)){try{window.localStorage[T]=m;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+m+";"}catch{}}}function g(){var f;if(!(typeof window===p||!T)){try{f=window.localStorage[T]}catch{}if(typeof f===p)try{var m=window.document.cookie,P=m.indexOf(encodeURIComponent(T)+"=");P!==-1&&(f=/^([^;]+)/.exec(m.slice(P))[1])}catch{}return S.levels[f]===void 0&&(f=void 0),f}}S.name=u,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=h||a,S.getLevel=function(){return L},S.setLevel=function(f,m){if(typeof f=="string"&&S.levels[f.toUpperCase()]!==void 0&&(f=S.levels[f.toUpperCase()]),typeof f=="number"&&f>=0&&f<=S.levels.SILENT){if(L=f,m!==!1&&b(f),t.call(S,f,u),typeof console===p&&f<S.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+f},S.setDefaultLevel=function(f){g()||S.setLevel(f,!1)},S.enableAll=function(f){S.setLevel(S.levels.TRACE,f)},S.disableAll=function(f){S.setLevel(S.levels.SILENT,f)};var l=g();l==null&&(l=y??"WARN"),S.setLevel(l,!1)}var c=new o,d={};c.getLogger=function(y){if(typeof y!="symbol"&&typeof y!="string"||y==="")throw new TypeError("You must supply a name when creating a logger.");var h=d[y];return h||(h=d[y]=new o(y,c.getLevel(),c.methodFactory)),h};var v=typeof window!==p?window.log:void 0;return c.noConflict=function(){return typeof window!==p&&window.log===c&&(window.log=v),c},c.getLoggers=function(){return d},c.default=c,Cn=c,Cn}var Sn={exports:{}};const iu="twilio-video",au="2.31.0",tc={name:iu,version:au};Sn.exports;var Bi;function Oe(){return Bi||(Bi=1,function(k){var p=tc;k.exports.SDK_NAME=p.name+".js",k.exports.SDK_VERSION=p.version,k.exports.SDP_FORMAT="unified",k.exports.hardwareDevicePublisheriPad={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPad",hwDeviceType:"tablet",platformName:"iOS"},k.exports.hardwareDevicePublisheriPhone={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPhone",hwDeviceType:"mobile",platformName:"iOS"},k.exports.DEFAULT_ENVIRONMENT="prod",k.exports.DEFAULT_REALM="us1",k.exports.DEFAULT_REGION="gll",k.exports.DEFAULT_LOG_LEVEL="warn",k.exports.DEFAULT_LOGGER_NAME="twilio-video",k.exports.WS_SERVER=function(s,i){return i=i==="gll"?"global":encodeURIComponent(i),s==="prod"?"wss://"+i+".vss.twilio.com/signaling":"wss://"+i+".vss."+s+".twilio.com/signaling"},k.exports.PUBLISH_MAX_ATTEMPTS=5,k.exports.PUBLISH_BACKOFF_JITTER=10,k.exports.PUBLISH_BACKOFF_MS=20;function _(s){return["a","e","i","o","u"].includes(s.toLowerCase()[0])?"an":"a"}k.exports.typeErrors={ILLEGAL_INVOKE:function(s,i){return new TypeError("Illegal call to "+s+": "+i)},INVALID_TYPE:function(s,i){return new TypeError(s+" must be "+_(i)+" "+i)},INVALID_VALUE:function(s,i){return new RangeError(s+" must be one of "+i.join(", "))},REQUIRED_ARGUMENT:function(s){return new TypeError(s+" must be specified")}},k.exports.DEFAULT_FRAME_RATE=24,k.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,k.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,k.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,k.exports.DEFAULT_NQ_LEVEL_LOCAL=1,k.exports.DEFAULT_NQ_LEVEL_REMOTE=0,k.exports.MAX_NQ_LEVEL=3,k.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,k.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,k.exports.iceRestartBackoffConfig={factor:1.1,min:1,max:k.exports.DEFAULT_SESSION_TIMEOUT_SEC*1e3,jitter:1},k.exports.reconnectBackoffConfig={factor:1.5,min:80,jitter:1},k.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},k.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},k.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},k.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},k.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}}(Sn)),Sn.exports}var _t,Ui;function ze(){if(Ui)return _t;Ui=1;var k=_t&&_t.__read||function(y,h){var S=typeof Symbol=="function"&&y[Symbol.iterator];if(!S)return y;var L=S.call(y),T,b=[],g;try{for(;(h===void 0||h-- >0)&&!(T=L.next()).done;)b.push(T.value)}catch(l){g={error:l}}finally{try{T&&!T.done&&(S=L.return)&&S.call(L)}finally{if(g)throw g.error}}return b},p=_t&&_t.__spreadArray||function(y,h){for(var S=0,L=h.length,T=y.length;S<L;S++,T++)y[T]=h[S];return y},_=ec().getLogger,s=Oe(),i=s.DEFAULT_LOG_LEVEL,e=s.DEFAULT_LOGGER_NAME,r=Oe().typeErrors,t;function n(y){if(t=t||new Map,t.has(y))return t.get(y);var h=new Set;return t.set(y,h),h}var a=function(){function y(h,S,L,T,b){if(typeof h!="string")throw r.INVALID_TYPE("moduleName","string");if(!S)throw r.REQUIRED_ARGUMENT("component");typeof L!="object"&&(L={}),b=b||_,u(L),Object.defineProperties(this,{_component:{value:S},_logLevels:{value:L},_warnings:{value:new Set},_loggerName:{get:function(){var l=T&&typeof T=="string"?T:e;return this._logLevelsEqual||(l=l+"-"+h),l}},_logger:{get:function(){var l=b(this._loggerName),f=this._logLevels[h]||i;return f=f==="off"?"silent":f,l.setDefaultLevel(f),l}},_logLevelsEqual:{get:function(){return new Set(Object.values(this._logLevels)).size===1}},logLevel:{get:function(){return y.getLevelByName(L[h]||i)}},name:{get:S.toString.bind(S)}})}return y.getLevelByName=function(h){return isNaN(h)?(h=h.toUpperCase(),v(h),y[h]):parseInt(h,10)},y.prototype.createLog=function(h,S){var L=this._loggerName;return this._logLevelsEqual||(L=L.substring(0,L.lastIndexOf("-"))),new y(h,S,this._logLevels,L)},y.prototype.setLevels=function(h){return u(h),Object.assign(this._logLevels,h),this},y.prototype.log=function(h,S){var L=y._levels[h];if(!L)throw r.INVALID_VALUE("logLevel",c);L=L.toLowerCase();var T=[new Date().toISOString(),L,this.name];return(this._logger[L]||function(){}).apply(void 0,p([],k(T.concat(S)))),this},y.prototype.debug=function(){return this.log(y.DEBUG,[].slice.call(arguments))},y.prototype.deprecated=function(h){var S=n(this._component.constructor);return S.has(h)?this:(S.add(h),this.warn(h))},y.prototype.info=function(){return this.log(y.INFO,[].slice.call(arguments))},y.prototype.warn=function(){return this.log(y.WARN,[].slice.call(arguments))},y.prototype.warnOnce=function(h){return this._warnings.has(h)?this:(this._warnings.add(h),this.warn(h))},y.prototype.error=function(){return this.log(y.ERROR,[].slice.call(arguments))},y.prototype.throw=function(h,S){throw h.clone&&(h=h.clone(S)),this.log(y.ERROR,h),h},y}();Object.defineProperties(a,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var o={},c=[],d=a._levels.map(function(y,h){return o[y]=!0,c.push(h),y});function v(y){if(!(y in o))throw r.INVALID_VALUE("level",d)}function u(y){Object.keys(y).forEach(function(h){v(y[h].toUpperCase())})}return _t=a,_t}var Wi;function ou(){if(Wi)return Je;Wi=1;var k=Je&&Je.__awaiter||function(t,n,a,o){function c(d){return d instanceof a?d:new a(function(v){v(d)})}return new(a||(a=Promise))(function(d,v){function u(S){try{h(o.next(S))}catch(L){v(L)}}function y(S){try{h(o.throw(S))}catch(L){v(L)}}function h(S){S.done?d(S.value):c(S.value).then(u,y)}h((o=o.apply(t,n||[])).next())})},p=Je&&Je.__generator||function(t,n){var a={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},o,c,d,v;return v={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function u(h){return function(S){return y([h,S])}}function y(h){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,c&&(d=h[0]&2?c.return:h[0]?c.throw||((d=c.return)&&d.call(c),0):c.next)&&!(d=d.call(c,h[1])).done)return d;switch(c=0,d&&(h=[h[0]&2,d.value]),h[0]){case 0:case 1:d=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,c=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(d=a.trys,!(d=d.length>0&&d[d.length-1])&&(h[0]===6||h[0]===2)){a=0;continue}if(h[0]===3&&(!d||h[1]>d[0]&&h[1]<d[3])){a.label=h[1];break}if(h[0]===6&&a.label<d[1]){a.label=d[1],d=h;break}if(d&&a.label<d[2]){a.label=d[2],a.ops.push(h);break}d[2]&&a.ops.pop(),a.trys.pop();continue}h=n.call(t,a)}catch(S){h=[6,S],c=0}finally{o=d=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}};Object.defineProperty(Je,"__esModule",{value:!0}),Je.createNoiseCancellationAudioProcessor=void 0;var _=nu();ze();var s={krisp:{supportedVersion:"1.0.0",pluginFile:"krispsdk.mjs"},rnnoise:{supportedVersion:"0.6.0",pluginFile:"rnnoise_sdk.mjs"}},i=function(t){var n=t.supportedVersion,a=t.plugin,o=t.log;if(!a.getVersion||!a.isSupported)throw new Error("Plugin does not export getVersion/isSupported api. Are you using old version of the plugin ?");var c=a.getVersion();o.debug("Plugin Version = "+c);var d=n.split(".").map(function(h){return Number(h)}),v=c.split(".").map(function(h){return Number(h)});if(d.length!==3||v.length!==3)throw new Error("Unsupported Plugin version format: "+n+", "+c);if(d[0]!==v[0])throw new Error("Major version mismatch: [Plugin version "+c+"],  [Supported Version "+n+"]");if(v[1]<d[1])throw new Error("Minor version mismatch: [Plugin version "+c+"] < [Supported Version "+n+"]");var u=new AudioContext,y=a.isSupported(u);if(u.close(),!y)throw new Error("Noise Cancellation plugin is not supported on your browser")},e=new Map;function r(t,n){return k(this,void 0,void 0,function(){var a,o,c,d,v,u,y,h,S;return p(this,function(L){switch(L.label){case 0:if(a=e.get(t.vendor),a)return[3,6];if(o=s[t.vendor],!o)throw new Error("Unsupported NoiseCancellationOptions.vendor: "+t.vendor);c=o.supportedVersion,d=o.pluginFile,v=t.sdkAssetsPath,u=v+"/"+d,L.label=1;case 1:return L.trys.push([1,5,,6]),n.debug("loading noise cancellation sdk: ",u),[4,_(u)];case 2:return y=L.sent(),n.debug("Loaded noise cancellation sdk:",y),h=y.default,i({supportedVersion:c,plugin:h,log:n}),h.isInitialized()?[3,4]:(n.debug("initializing noise cancellation sdk: ",v),[4,h.init({rootDir:v})]);case 3:L.sent(),n.debug("noise cancellation sdk initialized!"),L.label=4;case 4:return a={vendor:t.vendor,isInitialized:function(){return h.isInitialized()},isConnected:function(){return h.isConnected()},isEnabled:function(){return h.isEnabled()},disconnect:function(){return h.disconnect()},enable:function(){return h.enable()},disable:function(){return h.disable()},destroy:function(){return h.destroy()},setLogging:function(T){return h.setLogging(T)},connect:function(T){n.debug("connect: ",T.id),h.isConnected()&&h.disconnect();var b=h.connect(new MediaStream([T]));if(!b)throw new Error("Error connecting with noise cancellation sdk");var g=b.getAudioTracks()[0];if(!g)throw new Error("Error getting clean track from noise cancellation sdk");return h.enable(),g}},e.set(t.vendor,a),[3,6];case 5:throw S=L.sent(),n.error("Error loading noise cancellation sdk:"+u,S),S;case 6:return[2,a]}})})}return Je.createNoiseCancellationAudioProcessor=r,Je}var Hi;function su(){if(Hi)return Qe;Hi=1;var k=Qe&&Qe.__awaiter||function(e,r,t,n){function a(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function d(y){try{u(n.next(y))}catch(h){c(h)}}function v(y){try{u(n.throw(y))}catch(h){c(h)}}function u(y){y.done?o(y.value):a(y.value).then(d,v)}u((n=n.apply(e,r||[])).next())})},p=Qe&&Qe.__generator||function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,a,o,c;return c={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function d(u){return function(y){return v([u,y])}}function v(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(o=u[0]&2?a.return:u[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,u[1])).done)return o;switch(a=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=r.call(e,t)}catch(y){u=[6,y],a=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.applyNoiseCancellation=Qe.NoiseCancellationImpl=void 0;var _=ou();ze();var s=function(){function e(r,t){this._processor=r,this._sourceTrack=t,this._disabledPermanent=!1}return Object.defineProperty(e.prototype,"vendor",{get:function(){return this._processor.vendor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sourceTrack",{get:function(){return this._sourceTrack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._processor.isEnabled()},enumerable:!1,configurable:!0}),e.prototype.enable=function(){if(this._disabledPermanent)throw new Error(this.vendor+" noise cancellation is disabled permanently for this track");return this._processor.enable(),Promise.resolve()},e.prototype.disable=function(){return this._processor.disable(),Promise.resolve()},e.prototype.reacquireTrack=function(r){return k(this,void 0,void 0,function(){var t,n,a;return p(this,function(o){switch(o.label){case 0:return t=this._processor.isEnabled(),this._processor.disconnect(),[4,r()];case 1:return n=o.sent(),this._sourceTrack=n,[4,this._processor.connect(n)];case 2:return a=o.sent(),t?this._processor.enable():this._processor.disable(),[2,a]}})})},e.prototype.disablePermanently=function(){return this._disabledPermanent=!0,this.disable()},e.prototype.stop=function(){this._processor.disconnect(),this._sourceTrack.stop()},e}();Qe.NoiseCancellationImpl=s;function i(e,r,t){return k(this,void 0,void 0,function(){var n,a,o,c;return p(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,_.createNoiseCancellationAudioProcessor(r,t)];case 1:return n=d.sent(),a=n.connect(e),o=new s(n,e),[2,{cleanTrack:a,noiseCancellation:o}];case 2:return c=d.sent(),t.warn("Failed to create noise cancellation. Returning normal audio track: "+c),[2,{cleanTrack:e}];case 3:return[2]}})})}return Qe.applyNoiseCancellation=i,Qe}var ge={},De={},Gi;function qe(){if(Gi)return De;Gi=1;var k=De&&De.__read||function(g,l){var f=typeof Symbol=="function"&&g[Symbol.iterator];if(!f)return g;var m=f.call(g),P,C=[],M;try{for(;(l===void 0||l-- >0)&&!(P=m.next()).done;)C.push(P.value)}catch(D){M={error:D}}finally{try{P&&!P.done&&(f=m.return)&&f.call(m)}finally{if(M)throw M.error}}return C},p=De&&De.__spreadArray||function(g,l){for(var f=0,m=l.length,P=g.length;f<m;f++,P++)g[P]=l[f];return g};function _(){var g={};return g.promise=new Promise(function(l,f){g.resolve=l,g.reject=f}),g}function s(g,l,f,m){if(!(m in l)&&!m.match(/^on[a-z]+$/)){var P=!1;try{var C=Object.getOwnPropertyDescriptor(g,m);P=C&&!!C.get}catch{}if(!P){var M;try{M=typeof g[m]}catch{}M==="function"&&(l[m]=function(){return this[f][m].apply(this[f],arguments)})}}}function i(g,l,f){for(var m in g)s(g,l,f,m)}function e(g,l){g=Array.isArray(g)?new Set(g):new Set(g.values()),l=Array.isArray(l)?new Set(l):new Set(l.values());var f=new Set;return g.forEach(function(m){l.has(m)||f.add(m)}),f}function r(g,l){var f=g instanceof Map||g instanceof Set?Array.from(g.values()):g;return f.reduce(function(m,P){return m.concat(l(P))},[])}function t(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:null}function n(g){return typeof g>"u"&&(g=t()),/Chrome|CriOS/.test(g)?"chrome":/Firefox|FxiOS/.test(g)?"firefox":/Safari|iPhone|iPad|iPod/.test(g)?"safari":null}function a(g){typeof g>"u"&&(g=t());var l={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[n(g)];if(!l)return null;var f=new RegExp("("+l+")/([^\\s]+)"),m=k(g.match(f)||[],3),P=m[2];if(!P)return null;var C=P.split(".").map(Number);return{major:isNaN(C[0])?null:C[0],minor:isNaN(C[1])?null:C[1]}}function o(g){return typeof g>"u"&&(g=t()),/Mobi/.test(g)&&n()==="chrome"&&/iPad|iPhone|iPod/.test(g)}function c(g,l){var f=null;Object.defineProperty(g,"on"+l,{get:function(){return f},set:function(m){f&&this.removeEventListener(l,f),typeof m=="function"?(f=m,this.addEventListener(l,f)):f=null}})}function d(g,l,f){return l?g.then(l,f):g}function v(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){var l=Math.random()*16|0,f=g==="x"?l:l&3|8;return f.toString(16)})}function u(g,l,f){Object.getOwnPropertyNames(g).forEach(function(m){y(g,l,f,m)})}function y(g,l,f,m){if(!(m in l)){if(m.match(/^on[a-z]+$/)){Object.defineProperty(l,m,{value:null,writable:!0}),f.addEventListener(m.slice(2),function(){for(var P=[],C=0;C<arguments.length;C++)P[C]=arguments[C];return l.dispatchEvent.apply(l,p([],k(P)))});return}Object.defineProperty(l,m,{enumerable:!0,get:function(){return f[m]}})}}function h(){return typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.getUserMedia=="function"&&typeof RTCPeerConnection=="function"}function S(g){if(typeof RTCRtpSender<"u"&&typeof RTCRtpSender.getCapabilities=="function")return Promise.resolve(new Set(RTCRtpSender.getCapabilities(g).codecs.map(function(f){var m=f.mimeType;return m.split("/")[1].toLowerCase()})));if(typeof RTCPeerConnection>"u"||typeof RTCPeerConnection.prototype>"u"||typeof RTCPeerConnection.prototype.addTransceiver!="function"||typeof RTCPeerConnection.prototype.close!="function"||typeof RTCPeerConnection.prototype.createOffer!="function")return Promise.resolve(new Set);var l=new RTCPeerConnection;return l.addTransceiver(g),l.createOffer().then(function(f){var m=f.sdp;return l.close(),new Set((m.match(/^a=rtpmap:.+$/gm)||[]).map(function(P){return P.match(/^a=rtpmap:.+ ([^/]+)/)[1].toLowerCase()}))},function(){return l.close(),new Set})}var L=new Map;function T(g,l){var f=L.get(l);return f?Promise.resolve(f.has(g.toLowerCase())):S(l).then(function(m){return L.set(l,m),m.has(g.toLowerCase())})}function b(){L.clear()}return De.clearCachedSupportedCodecs=b,De.defer=_,De.delegateMethods=i,De.difference=e,De.flatMap=r,De.guessBrowser=n,De.guessBrowserVersion=a,De.isCodecSupported=T,De.isIOSChrome=o,De.interceptEvent=c,De.legacyPromise=d,De.makeUUID=v,De.proxyProperties=u,De.support=h,De}var _n={},Qi;function rc(){if(Qi)return _n;Qi=1;var k="1234567890abcdef",p=32;function _(s){for(var i="",e=0;e<p;e++)i+=k.charAt(Math.floor(Math.random()*k.length));return""+s+i}return _n.sessionSID=_("SS"),_n.createSID=_,_n}var On,$i;function nc(){if($i)return On;$i=1;var k={recordingMediaLost:"recording-media-lost"};return On=k,On}var Ki;function Ce(){if(Ki)return ge;Ki=1;var k=ge&&ge.__extends||function(){var W=function(K,I){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,B){R.__proto__=B}||function(R,B){for(var ae in B)Object.prototype.hasOwnProperty.call(B,ae)&&(R[ae]=B[ae])},W(K,I)};return function(K,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");W(K,I);function R(){this.constructor=K}K.prototype=I===null?Object.create(I):(R.prototype=I.prototype,new R)}}(),p=ge&&ge.__read||function(W,K){var I=typeof Symbol=="function"&&W[Symbol.iterator];if(!I)return W;var R=I.call(W),B,ae=[],fe;try{for(;(K===void 0||K-- >0)&&!(B=R.next()).done;)ae.push(B.value)}catch(me){fe={error:me}}finally{try{B&&!B.done&&(I=R.return)&&I.call(R)}finally{if(fe)throw fe.error}}return ae},_=ge&&ge.__spreadArray||function(W,K){for(var I=0,R=K.length,B=W.length;I<R;I++,B++)W[B]=K[I];return W},s=Oe(),i=s.typeErrors,e=s.trackPriority,r=qe(),t=rc().sessionSID,n=nc();function a(W,K){if(W instanceof K.LocalAudioTrack||W instanceof K.LocalVideoTrack||W instanceof K.LocalDataTrack)return W;if(W instanceof K.MediaStreamTrack)return W.kind==="audio"?new K.LocalAudioTrack(W,K):new K.LocalVideoTrack(W,K);throw i.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}function o(W,K,I,R){var B={audio:R.LocalAudioTrackPublication,video:R.LocalVideoTrackPublication,data:R.LocalDataTrackPublication}[W.kind];return new B(K,W,I,R)}function c(W){return W[0].toUpperCase()+W.slice(1)}function d(W,K,I,R){var B=new Set;K.on("newListener",function ae(fe){I.has(fe)&&!B.has(fe)&&(R.deprecated(W+"#"+fe+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(I.get(fe)?" Use "+W+"#"+I.get(fe)+" instead.":"")),B.add(fe)),B.size>=I.size&&K.removeListener("newListener",ae)})}function v(W,K){W=Array.isArray(W)?new Set(W):new Set(W.values()),K=Array.isArray(K)?new Set(K):new Set(K.values());var I=new Set;return W.forEach(function(R){K.has(R)||I.add(R)}),I}function u(W,K){return Object.keys(W).reduce(function(I,R){return W[R]!==K&&(I[R]=W[R]),I},{})}function y(W,K){var I=W instanceof Map||W instanceof Set?Array.from(W.values()):W;return K=K||function(B){return B},I.reduce(function(R,B){var ae=K(B);return R.concat(ae)},[])}function h(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent:"Unknown"}function S(){var W=h(),K=p(W.match(/\(([^)]+)\)/)||[],2),I=K[1],R=I===void 0?"unknown":I,B=p(R.split(";").map(function(fe){return fe.trim()}),1),ae=B[0];return ae.toLowerCase()}function L(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(W){var K=Math.random()*16|0,I=W==="x"?K:K&3|8;return I.toString(16)})}function T(W){var K=null;function I(){K=null,W()}return function(){K&&clearTimeout(K),K=setTimeout(I)}}function b(W,K,I,R){return new Promise(function(B,ae){function fe(){var we=[].slice.call(arguments);R&&K.removeListener(R,me),B.apply(void 0,_([],p(we)))}function me(){var we=[].slice.call(arguments);K.removeListener(I,fe),ae.apply(void 0,_([],p(we)))}K.once(I,fe),R&&K.once(R,me),W()})}function g(W,K){return K.split(".").reduce(function(I,R){return I?I[R]:null},W)}function l(){var W={};return W.promise=new Promise(function(K,I){W.resolve=K,W.reject=I}),W}function f(W,K,I,R){if(!(R in K)&&!R.match(/^on[a-z]+$/)){var B;try{B=typeof W[R]}catch{}B==="function"&&(K[R]=function(){for(var ae,fe=[],me=0;me<arguments.length;me++)fe[me]=arguments[me];return(ae=this[I])[R].apply(ae,_([],p(fe)))})}}function m(W,K,I){for(var R in W)f(W,K,I,R)}function P(W,K){if(W===K)return!0;if(typeof W!=typeof K)return!1;if(W===null)return K===null;if(K===null)return!1;if(Array.isArray(W))return Array.isArray(K)&&W.length===K.length&&W.every(function(B,ae){return P(B,K[ae])});if(typeof W=="object"){var I=Object.keys(W).sort(),R=Object.keys(K).sort();return!Array.isArray(K)&&P(I,R)&&I.every(function(B){return P(W[B],K[B])})}return!1}function C(W){return typeof W=="object"&&!Array.isArray(W)}function M(W,K,I){Object.getOwnPropertyNames(W).forEach(function(R){D(W,K,I,R)})}function D(W,K,I,R){if(!(R in K)){if(R.match(/^on[a-z]+$/)){Object.defineProperty(K,R,{value:null,writable:!0}),I.addEventListener(R.slice(2),function(){for(var B=[],ae=0;ae<arguments.length;ae++)B[ae]=arguments[ae];K.dispatchEvent.apply(K,_([],p(B)))});return}Object.defineProperty(K,R,{enumerable:!0,get:function(){return I[R]}})}}function O(W,K,I){return K?W.then(function(R){K(R)},function(R){I(R)}):W}function x(W){return typeof W=="string"?{default:W,media:W,signaling:W,webrtc:W}:W}function E(W,K){return K=K?"Local":"",K+(W.kind||"").replace(/\w{1}/,function(I){return I.toUpperCase()})+"Track"}function q(W,K){return K=K?"Local":"",K+(W.kind||"").replace(/\w{1}/,function(I){return I.toUpperCase()})+"TrackPublication"}function U(W){Object.getOwnPropertyNames(W).forEach(function(K){K.startsWith("_")&&F(W,K)})}function G(W,K){return function(I){k(R,I);function R(){for(var B=[],ae=0;ae<arguments.length;ae++)B[ae]=arguments[ae];var fe=I.apply(this,_([],p(B)))||this;return U(fe),N(fe,K),fe}return R}(W)}function F(W,K){var I=Object.getOwnPropertyDescriptor(W,K);I.enumerable=!1,Object.defineProperty(W,K,I)}function N(W,K){K===void 0&&(K=[]),K.forEach(function(I){W.hasOwnProperty(I)&&F(W,I)})}function A(W){return W.map(Y)}function w(W){return A(_([],p(W)))}function j(W){return _([],p(W.entries())).reduce(function(K,I){var R,B=p(I,2),ae=B[0],fe=B[1];return Object.assign((R={},R[ae]=Y(fe),R),K)},{})}function Q(W){return Object.entries(W).reduce(function(K,I){var R,B=p(I,2),ae=B[0],fe=B[1];return Object.assign((R={},R[ae]=Y(fe),R),K)},{})}function Y(W){return Array.isArray(W)?A(W):W instanceof Set?w(W):W instanceof Map?j(W):W&&typeof W=="object"?Q(W):W}function $(W){function K(ae){return ae?"true":"false"}var I={sessionSID:t,iceServers:(W.iceServers||[]).length,audioTracks:(W.tracks||[]).filter(function(ae){return ae.kind==="audio"}).length,videoTracks:(W.tracks||[]).filter(function(ae){return ae.kind==="video"}).length,dataTracks:(W.tracks||[]).filter(function(ae){return ae.kind==="data"}).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach(function(ae){var fe=p(ae,2),me=fe[0],we=fe[1];we=we||me,I[we]=K(!!W[me])}),[["maxVideoBitrate"],["maxAudioBitrate"]].forEach(function(ae){var fe=p(ae,2),me=fe[0],we=fe[1];we=we||me,typeof W[me]=="number"?I[we]=W[me]:isNaN(Number(W[me]))||(I[we]=Number(W[me]))}),[["iceTransportPolicy"],["region"],["name","roomName"]].forEach(function(ae){var fe=p(ae,2),me=fe[0],we=fe[1];we=we||me,typeof W[me]=="string"?I[we]=W[me]:typeof W[me]=="number"&&me==="name"&&(I[we]=W[me].toString())}),["preferredAudioCodecs","preferredVideoCodecs"].forEach(function(ae){ae in W&&(I[ae]=JSON.stringify(W[ae]))}),"networkQuality"in W&&(I.networkQualityConfiguration={},C(W.networkQuality)?["local","remote"].forEach(function(ae){typeof W.networkQuality[ae]=="number"&&(I.networkQualityConfiguration[ae]=W.networkQuality[ae])}):(I.networkQualityConfiguration.remote=0,I.networkQualityConfiguration.local=W.networkQuality?1:0)),W.bandwidthProfile&&W.bandwidthProfile.video){var R=W.bandwidthProfile.video||{};I.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach(function(ae){typeof R[ae]=="number"||typeof R[ae]=="string"?I.bandwidthProfileOptions[ae]=R[ae]:typeof R[ae]=="boolean"?I.bandwidthProfileOptions[ae]=K(R[ae]):typeof R[ae]=="object"&&(I.bandwidthProfileOptions[ae]=JSON.stringify(R[ae]))})}var B={RTCPeerConnection:"customRTCPeerConnectionImpl",MediaStream:"customMediaStreamImpl",getUserMedia:"customGetUserMediaImpl",enumerateDevices:"customEnumerateDevicesImpl"};return Object.entries(B).forEach(function(ae){var fe=p(ae,2),me=fe[0],we=fe[1];I[we]=K(typeof W[me]<"u")}),{group:"room",name:"connect",level:"info",payload:I}}function z(W){return de(W,[{prop:"video",type:"object",transform:ne}])}function ne(W){return de(W,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:le},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function oe(W,K,I,R,B,ae){var fe={transports:[{type:"data-channel"}]};return Object.assign(W?{active_speaker:fe}:{},K?{network_quality:fe}:{},ae?{render_hints:fe}:{},B?{publisher_hints:fe}:{},I?{track_priority:fe}:{},R?{track_switch_off:fe}:{})}function ve(W){return de(W,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function le(W){var K=e.PRIORITY_HIGH,I=e.PRIORITY_LOW,R=e.PRIORITY_STANDARD;return de(W,[{prop:K,type:"object",transform:ve},{prop:I,type:"object",transform:ve},{prop:R,type:"object",transform:ve}])}function de(W,K){return K.reduce(function(I,R){var B,ae=R.prop,fe=R.type,me=R.payloadProp,we=me===void 0?ae:me,Le=R.transform,_e=Le===void 0?function(je){return je}:Le;return typeof W[ae]===fe?Object.assign((B={},B[we]=_e(W[ae]),B),I):I},{})}function ee(W){return{rules:[{type:W?"include":"exclude",all:!0}],revision:1}}function se(W){var K,I=(K={},K[n.recordingMediaLost]="recordings",K);return W.map(function(R){return I[R]}).filter(function(R){return!!R})}function ie(W,K){var I=Math.random();return W-K+Math.floor(2*K*I+.5)}function Z(W,K,I){return K<=W&&W<=I}function he(W){return r.guessBrowser()==="chrome"&&W.kind==="video"&&"displaySurface"in W.getSettings()}function ue(W){return W===void 0&&(W=10),new Promise(function(K){return setTimeout(K,W)})}function ye(W,K){return new Promise(function(I){W.addEventListener(K,function R(B){W.removeEventListener(K,R),I(B)})})}return ge.constants=s,ge.createBandwidthProfilePayload=z,ge.createMediaSignalingPayload=oe,ge.createMediaWarningsPayload=se,ge.createRoomConnectEventPayload=$,ge.createSubscribePayload=ee,ge.asLocalTrack=a,ge.asLocalTrackPublication=o,ge.capitalize=c,ge.deprecateEvents=d,ge.difference=v,ge.filterObject=u,ge.flatMap=y,ge.getPlatform=S,ge.getUserAgent=h,ge.hidePrivateProperties=U,ge.hidePrivateAndCertainPublicPropertiesInClass=G,ge.isDeepEqual=P,ge.isNonArrayObject=C,ge.inRange=Z,ge.makeUUID=L,ge.oncePerTick=T,ge.promiseFromEvents=b,ge.getOrNull=g,ge.defer=l,ge.delegateMethods=m,ge.proxyProperties=M,ge.legacyPromise=O,ge.buildLogLevels=x,ge.trackClass=E,ge.trackPublicationClass=q,ge.valueToJSON=Y,ge.withJitter=ie,ge.isChromeScreenShareTrack=he,ge.waitForSometime=ue,ge.waitForEvent=ye,ge}var $e={},zi;function un(){if(zi)return $e;zi=1;var k=qe(),p=k.flatMap,_=k.guessBrowser,s=null;function i(){if(typeof s=="boolean")return s;if(typeof RTCPeerConnection>"u")return s=!1,s;try{new RTCPeerConnection({sdpSemantics:"foo"}),s=!1}catch{s=!0}return s}var e=null;function r(){e=null}function t(){if(!e)if(typeof RTCPeerConnection<"u"&&"addTransceiver"in RTCPeerConnection.prototype){var P=new RTCPeerConnection;try{P.addTransceiver("audio"),e="unified"}catch{e="planb"}P.close()}else e="planb";return e}function n(P){return!P||!i()?t():{"plan-b":"planb","unified-plan":"unified"}[P]}function a(){return typeof RTCRtpTransceiver<"u"&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}function o(P){return{chrome:n(P),firefox:"unified",safari:a()}[_()]||null}function c(P,C){var M=C.match(new RegExp(P,"gm"))||[];return M.reduce(function(D,O){var x=O.match(new RegExp(P));return x?D.add(x[1]):D},new Set)}function d(P,C){return c(P,C)}function v(P){return d("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",P)}function u(P){return d("^a=msid:.+ +(.+) *$",P)}function y(P,C){var M="^a=ssrc:([0-9]+) +msid:[^ ]+ +"+C+" *$";return c(M,P)}function h(P,C,M){return C===void 0&&(C=".*"),M===void 0&&(M=".*"),P.split(`\r
m=`).slice(1).map(function(D){return"m="+D}).filter(function(D){var O=new RegExp("m="+C,"gm"),x=new RegExp("a="+M,"gm");return O.test(D)&&x.test(D)})}function S(P){return Array.from(c("^a=ssrc:([0-9]+) +.*$",P))}function L(P,C){var M=h(P),D=new RegExp("^a=msid:[^ ]+ +"+C+" *$","gm"),O=M.filter(function(x){return x.match(D)});return new Set(p(O,S))}function T(P,C,M){return new Map(Array.from(P(M)).map(function(D){return[D,C(M,D)]}))}function b(P){return T(v,y,P)}function g(P){return T(u,L,P)}function l(P,C,M){var D=P(M),O=new Map;D.forEach(function(q,U){if(!C.has(U)){C.set(U,q);return}var G=Array.from(C.get(U)),F=Array.from(q);G.forEach(function(N,A){var w=F[A];O.set(w,N);var j="^a=ssrc:"+w+" (.*)$",Q="a=ssrc:"+N+" $1";M=M.replace(new RegExp(j,"gm"),Q)})});var x="^(a=ssrc-group:[^ ]+ +)(.*)$",E=M.match(new RegExp(x,"gm"))||[];return E.forEach(function(q){var U=q.match(new RegExp(x));if(U){var G=U[1],F=U[2],N=F.split(" ").map(function(A){var w=O.get(A);return w||A}).join(" ");M=M.replace(U[0],G+N)}}),M}function f(P,C){return l(b,P,C)}function m(P,C){return l(g,P,C)}return $e.clearChromeCachedSdpFormat=r,$e.getSdpFormat=o,$e.getMediaSections=h,$e.getPlanBTrackIds=v,$e.getUnifiedPlanTrackIds=u,$e.getPlanBSSRCs=y,$e.getUnifiedPlanSSRCs=L,$e.updatePlanBTrackIdsToSSRCs=f,$e.updateUnifiedPlanTrackIdsToSSRCs=m,$e}var mt,Yi;function cu(){if(Yi)return mt;Yi=1;var k=mt&&mt.__values||function(O){var x=typeof Symbol=="function"&&Symbol.iterator,E=x&&O[x],q=0;if(E)return E.call(O);if(O&&typeof O.length=="number")return{next:function(){return O&&q>=O.length&&(O=void 0),{value:O&&O[q++],done:!O}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},p=mt&&mt.__read||function(O,x){var E=typeof Symbol=="function"&&O[Symbol.iterator];if(!E)return O;var q=E.call(O),U,G=[],F;try{for(;(x===void 0||x-- >0)&&!(U=q.next()).done;)G.push(U.value)}catch(N){F={error:N}}finally{try{U&&!U.done&&(E=q.return)&&E.call(q)}finally{if(F)throw F.error}}return G},_=qe(),s=_.flatMap,i=_.guessBrowser,e=_.guessBrowserVersion,r=un().getSdpFormat,t=i(),n=e(),a=t==="chrome",o=t==="firefox",c=t==="safari",d=a?n.major:null,v=32767;function u(O,x){return typeof O.get=="function"?O.get(x):O.find(function(E){return E.id===x})}function y(O,x,E){var q,U,G,F,N,A,w,j,Q,Y,$,z,ne,oe,ve,le,de,ee,se,ie,Z,he;E===void 0&&(E=!1);var ue;if(Array.isArray(O))ue=new Map(O.map(function(Ae){return[Ae.id||String(Math.random()),Ae]}));else if(O instanceof Map)ue=O;else if(typeof O=="object"&&O!==null){var ye=new Map;Object.keys(O).forEach(function(Ae){ye.set(Ae,O[Ae])}),ue=ye}else return new Map;if(!ue||!x)return new Map;var W=new Map,K=x.id,I=x.kind,R=null,B=null,ae=null;try{for(var fe=k(ue),me=fe.next();!me.done;me=fe.next()){var we=p(me.value,2),Le=we[0],_e=we[1];if(E&&_e.type==="inbound-rtp"&&_e.trackIdentifier===K){R=_e,B=Le,ae=_e.ssrc;break}else if(!E&&_e.type==="media-source"&&_e.trackIdentifier===K){R=_e,B=Le;break}else _e.type==="track"&&_e.trackIdentifier===K&&(R||(R=_e,B=Le))}}catch(Ae){q={error:Ae}}finally{try{me&&!me.done&&(U=fe.return)&&U.call(fe)}finally{if(q)throw q.error}}if(!R)if(E){var je=[];try{for(var He=k(ue),We=He.next();!We.done;We=He.next()){var ce=p(We.value,2),Le=ce[0],_e=ce[1];_e.type==="inbound-rtp"&&(_e.kind===I||_e.mediaType===I)&&je.push({id:Le,stat:_e})}}catch(Ae){G={error:Ae}}finally{try{We&&!We.done&&(F=He.return)&&F.call(He)}finally{if(G)throw G.error}}(je.length===1||je.length>1)&&(R=je[0].stat,B=je[0].id,ae=R.ssrc)}else try{for(var te=k(ue),V=te.next();!V.done;V=te.next()){var H=p(V.value,2),Le=H[0],_e=H[1];if(_e.type==="media-source"&&_e.kind===I){R=_e,B=Le;break}}}catch(Ae){N={error:Ae}}finally{try{V&&!V.done&&(A=te.return)&&A.call(te)}finally{if(N)throw N.error}}if(!R)return W;W.set(B,R);var J=new Set;if(E){if(R.codecId&&J.add(R.codecId),R.transportId&&J.add(R.transportId),R.remoteId&&J.add(R.remoteId),ae)try{for(var X=k(ue),re=X.next();!re.done;re=X.next()){var be=p(re.value,2),Le=be[0],_e=be[1];_e.type==="remote-outbound-rtp"&&_e.ssrc===ae&&J.add(Le)}}catch(Ae){w={error:Ae}}finally{try{re&&!re.done&&(j=X.return)&&j.call(X)}finally{if(w)throw w.error}}try{for(var Te=k(J),Ie=Te.next();!Ie.done;Ie=Te.next()){var Me=Ie.value;ue.has(Me)&&W.set(Me,ue.get(Me))}}catch(Ae){Q={error:Ae}}finally{try{Ie&&!Ie.done&&(Y=Te.return)&&Y.call(Te)}finally{if(Q)throw Q.error}}try{for(var Ee=k(ue),Re=Ee.next();!Re.done;Re=Ee.next()){var ke=p(Re.value,2),Le=ke[0],_e=ke[1];_e.type==="track"&&_e.trackIdentifier===K&&W.set(Le,_e)}}catch(Ae){$={error:Ae}}finally{try{Re&&!Re.done&&(z=Ee.return)&&z.call(Ee)}finally{if($)throw $.error}}}else{try{for(var xe=k(ue),Ve=xe.next();!Ve.done;Ve=xe.next()){var xt=p(Ve.value,2),Le=xt[0],_e=xt[1];if(_e.type==="outbound-rtp"&&_e.mediaSourceId===B){W.set(Le,_e),_e.codecId&&J.add(_e.codecId),_e.transportId&&J.add(_e.transportId);var $c=Le;try{for(var dn=(ve=void 0,k(ue)),Nt=dn.next();!Nt.done;Nt=dn.next()){var Ni=p(Nt.value,2),Kc=Ni[0],wn=Ni[1];wn.type==="remote-inbound-rtp"&&wn.localId===$c&&W.set(Kc,wn)}}catch(zc){ve={error:zc}}finally{try{Nt&&!Nt.done&&(le=dn.return)&&le.call(dn)}finally{if(ve)throw ve.error}}}}}catch(Ae){ne={error:Ae}}finally{try{Ve&&!Ve.done&&(oe=xe.return)&&oe.call(xe)}finally{if(ne)throw ne.error}}try{for(var fn=k(J),qt=fn.next();!qt.done;qt=fn.next()){var Me=qt.value;ue.has(Me)&&W.set(Me,ue.get(Me))}}catch(Ae){de={error:Ae}}finally{try{qt&&!qt.done&&(ee=fn.return)&&ee.call(fn)}finally{if(de)throw de.error}}}var Vt=null,qi=new Set;try{for(var vn=k(W.values()),Ft=vn.next();!Ft.done;Ft=vn.next()){var _e=Ft.value;_e.transportId&&qi.add(_e.transportId)}}catch(Ae){se={error:Ae}}finally{try{Ft&&!Ft.done&&(ie=vn.return)&&ie.call(vn)}finally{if(se)throw se.error}}try{for(var pn=k(qi),Bt=pn.next();!Bt.done;Bt=pn.next()){var En=Bt.value;if(ue.has(En)){var Ge=ue.get(En);W.set(En,Ge),Ge.selectedCandidatePairId&&(Vt=Ge.selectedCandidatePairId),Ge.localCertificateId&&ue.has(Ge.localCertificateId)&&W.set(Ge.localCertificateId,ue.get(Ge.localCertificateId)),Ge.remoteCertificateId&&ue.has(Ge.remoteCertificateId)&&W.set(Ge.remoteCertificateId,ue.get(Ge.remoteCertificateId))}}}catch(Ae){Z={error:Ae}}finally{try{Bt&&!Bt.done&&(he=pn.return)&&he.call(pn)}finally{if(Z)throw Z.error}}if(Vt&&ue.has(Vt)){var Ye=ue.get(Vt);W.set(Vt,Ye),Ye.localCandidateId&&ue.has(Ye.localCandidateId)&&W.set(Ye.localCandidateId,ue.get(Ye.localCandidateId)),Ye.remoteCandidateId&&ue.has(Ye.remoteCandidateId)&&W.set(Ye.remoteCandidateId,ue.get(Ye.remoteCandidateId))}return W}function h(O,x){return O&&typeof O.getStats=="function"?S(O,x):Promise.reject(new Error("Given PeerConnection does not support getStats"))}function S(O,x){var E=g(O,"audio","local"),q=g(O,"video","local"),U=g(O,"audio"),G=g(O,"video"),F={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},N=s([[E,"localAudioTrackStats",!1],[q,"localVideoTrackStats",!1],[U,"remoteAudioTrackStats",!0],[G,"remoteVideoTrackStats",!0]],function(A){var w=p(A,3),j=w[0],Q=w[1],Y=w[2];return j.map(function($){return f(O,$,Object.assign({isRemote:Y},x)).then(function(z){z.forEach(function(ne){ne.trackId=$.id,F[Q].push(ne)})})})});return Promise.all(N).then(function(){return L(O,x)}).then(function(A){return F.activeIceCandidatePair=A,F})}function L(O,x){return x===void 0&&(x={}),typeof x.testForChrome<"u"||a||typeof x.testForSafari<"u"||c?O.getStats().then(T):typeof x.testForFirefox<"u"||o?O.getStats().then(b):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}function T(O){var x=Array.from(O.values()).find(function(A){var w=A.nominated,j=A.type;return j==="candidate-pair"&&w});if(!x)return null;var E=u(O,x.localCandidateId),q=u(O,x.remoteCandidateId),U=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],G=U.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),F=E?G.reduce(function(A,w){var j=w.key,Q=w.type;return A[j]=typeof E[j]===Q?E[j]:j==="deleted"?!1:null,A},{}):null,N=q?U.reduce(function(A,w){var j=w.key,Q=w.type;return A[j]=typeof q[j]===Q?q[j]:null,A},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(A){return A==="inprogress"?"in-progress":A}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(A,w){var j=w.key,Q=w.type,Y=w.fixup;return A[j]=typeof x[j]===Q?Y?Y(x[j]):x[j]:null,A},{localCandidate:F,remoteCandidate:N})}function b(O){var x=Array.from(O.values()).find(function(w){var j=w.nominated,Q=w.type;return Q==="candidate-pair"&&j});if(!x)return null;var E=u(O,x.localCandidateId),q=u(O,x.remoteCandidateId),U=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],G=U.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),F={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},N=E?G.reduce(function(w,j){var Q=j.ffKeys,Y=j.key,$=j.type,z=Q&&Q.find(function(ne){return ne in E})||Y;return w[Y]=typeof E[z]===$?z==="candidateType"&&F[E[z]]||E[z]:z==="deleted"?!1:null,w},{}):null,A=q?U.reduce(function(w,j){var Q=j.ffKeys,Y=j.key,$=j.type,z=Q&&Q.find(function(ne){return ne in q})||Y;return w[Y]=typeof q[z]===$?z==="candidateType"&&F[q[z]]||q[z]:null,w},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(w,j){var Q=j.key,Y=j.type;return w[Q]=typeof x[Q]===Y?x[Q]:null,w},{localCandidate:N,remoteCandidate:A})}function g(O,x,E){var q=E==="local"?"getSenders":"getReceivers";if(O[q])return O[q]().map(function(F){var N=F.track;return N}).filter(function(F){return F&&F.kind===x});var U=E==="local"?"getLocalStreams":"getRemoteStreams",G=x==="audio"?"getAudioTracks":"getVideoTracks";return s(O[U](),function(F){return F[G]()})}function l(O,x){var E,q,U,G,F,N;if(!O||!x)return!1;if(O.getReceivers){var A=O.getReceivers();try{for(var w=k(A),j=w.next();!j.done;j=w.next()){var Q=j.value;if(Q.track&&Q.track.id===x.id)return!0}}catch(ee){E={error:ee}}finally{try{j&&!j.done&&(q=w.return)&&q.call(w)}finally{if(E)throw E.error}}}if(O.getRemoteStreams){var Y=O.getRemoteStreams();try{for(var $=k(Y),z=$.next();!z.done;z=$.next()){var ne=z.value,oe=ne.getTracks();try{for(var ve=(F=void 0,k(oe)),le=ve.next();!le.done;le=ve.next()){var de=le.value;if(de.id===x.id)return!0}}catch(ee){F={error:ee}}finally{try{le&&!le.done&&(N=ve.return)&&N.call(ve)}finally{if(F)throw F.error}}}}catch(ee){U={error:ee}}finally{try{z&&!z.done&&(G=$.return)&&G.call($)}finally{if(U)throw U.error}}}return!1}function f(O,x,E){return E===void 0&&(E={}),typeof E.testForChrome<"u"||a?m(O,x,E):typeof E.testForFirefox<"u"||o?P(O,x,E):typeof E.testForSafari<"u"||c?typeof E.testForSafari<"u"||r()==="unified"?m(O,x,E):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" "))):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}function m(O,x,E){var q=E.log;return d&&d<67?new Promise(function(U,G){O.getStats(function(F){U([C(F,x)])},null,G)}):O.getStats(x).then(function(U){return q.info("getStats by track successful"),M(U,E)}).catch(function(){return q.warn("getStats by track failed. Getting default stats"),O.getStats().then(function(U){q.info("getStats by default successful");var G=l(O,x);q.info("Starting filtering stats for "+(G?"remote":"local")+" track");var F=y(U,x,G);return q.info("Completed filtering stats for "+(G?"remote":"local")+" track"),M(F,E)})})}function P(O,x,E){return O.getStats(x).then(function(q){return[D(q,E)]})}function C(O,x){var E=O.result().find(function(U){return U.type==="ssrc"&&U.stat("googTrackId")===x.id}),q={};return E&&(q.timestamp=Math.round(Number(E.timestamp)),q=E.names().reduce(function(U,G){switch(G){case"googCodecName":U.codecName=E.stat(G);break;case"googRtt":U.roundTripTime=Number(E.stat(G));break;case"googJitterReceived":U.jitter=Number(E.stat(G));break;case"googFrameWidthInput":U.frameWidthInput=Number(E.stat(G));break;case"googFrameHeightInput":U.frameHeightInput=Number(E.stat(G));break;case"googFrameWidthSent":U.frameWidthSent=Number(E.stat(G));break;case"googFrameHeightSent":U.frameHeightSent=Number(E.stat(G));break;case"googFrameWidthReceived":U.frameWidthReceived=Number(E.stat(G));break;case"googFrameHeightReceived":U.frameHeightReceived=Number(E.stat(G));break;case"googFrameRateInput":U.frameRateInput=Number(E.stat(G));break;case"googFrameRateSent":U.frameRateSent=Number(E.stat(G));break;case"googFrameRateReceived":U.frameRateReceived=Number(E.stat(G));break;case"ssrc":U[G]=E.stat(G);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":U[G]=Number(E.stat(G));break}return U},q)),q}function M(O,x){var E=x.simulateExceptionWhileStandardizingStats,q=E===void 0?!1:E;if(q)throw new Error("Error while gathering stats");var U=null,G=[],F=null,N=null,A=null,w=null,j=null;O.forEach(function(ne){var oe=ne.type;switch(oe){case"inbound-rtp":U=ne;break;case"outbound-rtp":G.push(ne);break;case"media-source":j=ne;break;case"track":A=ne;break;case"codec":w=ne;break;case"remote-inbound-rtp":F=ne;break;case"remote-outbound-rtp":N=ne;break}});var Q=A?A.remoteSource:!j,Y=Q?[U]:G,$=[],z=Q?N:F;return Y.forEach(function(ne){var oe={},ve=[ne,j,A,w,z&&z.ssrc===ne.ssrc?z:null];function le(ce){var te=ve.find(function(V){return V&&typeof V[ce]<"u"})||null;return te?te[ce]:null}var de=le("ssrc");typeof de=="number"&&(oe.ssrc=String(de));var ee=le("timestamp");oe.timestamp=Math.round(ee);var se=le("mimeType");typeof se=="string"&&(se=se.split("/"),oe.codecName=se[se.length-1]);var ie=le("roundTripTime");typeof ie=="number"&&(oe.roundTripTime=Math.round(ie*1e3));var Z=le("jitter");typeof Z=="number"&&(oe.jitter=Math.round(Z*1e3));var he=le("frameWidth");typeof he=="number"&&(Q?oe.frameWidthReceived=he:(oe.frameWidthSent=he,oe.frameWidthInput=A?A.frameWidth:j.width));var ue=le("frameHeight");typeof ue=="number"&&(Q?oe.frameHeightReceived=ue:(oe.frameHeightSent=ue,oe.frameHeightInput=A?A.frameHeight:j.height));var ye=le("framesPerSecond");typeof ye=="number"&&(oe[Q?"frameRateReceived":"frameRateSent"]=ye);var W=le("bytesReceived");typeof W=="number"&&(oe.bytesReceived=W);var K=le("bytesSent");typeof K=="number"&&(oe.bytesSent=K);var I=le("packetsLost");typeof I=="number"&&(oe.packetsLost=I);var R=le("packetsReceived");typeof R=="number"&&(oe.packetsReceived=R);var B=le("packetsSent");typeof B=="number"&&(oe.packetsSent=B);var ae=le("audioLevel");typeof ae=="number"&&(ae=Math.round(ae*v),Q?oe.audioOutputLevel=ae:oe.audioInputLevel=ae);var fe=le("totalPacketSendDelay");typeof fe=="number"&&(oe.totalPacketSendDelay=fe);var me=le("totalEncodeTime");typeof me=="number"&&(oe.totalEncodeTime=me);var we=le("framesEncoded");typeof we=="number"&&(oe.framesEncoded=we);var Le=le("estimatedPlayoutTimestamp");typeof Le=="number"&&(oe.estimatedPlayoutTimestamp=Le);var _e=le("totalDecodeTime");typeof _e=="number"&&(oe.totalDecodeTime=_e);var je=le("framesDecoded");typeof je=="number"&&(oe.framesDecoded=je);var He=le("jitterBufferDelay");typeof He=="number"&&(oe.jitterBufferDelay=He);var We=le("jitterBufferEmittedCount");typeof We=="number"&&(oe.jitterBufferEmittedCount=We),$.push(oe)}),$}function D(O,x){O===void 0&&(O=new Map);var E=x.isRemote,q=x.simulateExceptionWhileStandardizingStats,U=q===void 0?!1:q;if(U)throw new Error("Error while gathering stats");var G=null,F=null;O.forEach(function(R){var B=R.isRemote,ae=R.remoteId,fe=R.type;if(!B)switch(fe){case"inbound-rtp":G=R,F=u(O,ae);break;case"outbound-rtp":F=R,G=u(O,ae);break}});var N=E?G:F,A=E?F:G;function w(R){return N&&typeof N[R]<"u"?N[R]:A&&typeof A[R]<"u"?A[R]:null}var j={},Q=w("timestamp");j.timestamp=Math.round(Q);var Y=w("ssrc");typeof Y=="number"&&(j.ssrc=String(Y));var $=w("bytesSent");typeof $=="number"&&(j.bytesSent=$);var z=w("packetsLost");typeof z=="number"&&(j.packetsLost=z);var ne=w("packetsSent");typeof ne=="number"&&(j.packetsSent=ne);var oe=w("roundTripTime");typeof oe=="number"&&(j.roundTripTime=Math.round(oe*1e3));var ve=w("jitter");typeof ve=="number"&&(j.jitter=Math.round(ve*1e3));var le=w("framerateMean");typeof le=="number"&&(j.frameRateSent=Math.round(le));var de=w("bytesReceived");typeof de=="number"&&(j.bytesReceived=de);var ee=w("packetsReceived");typeof ee=="number"&&(j.packetsReceived=ee);var se=w("framerateMean");typeof se=="number"&&(j.frameRateReceived=Math.round(se));var ie=w("totalPacketSendDelay");typeof ie=="number"&&(j.totalPacketSendDelay=ie);var Z=w("totalEncodeTime");typeof Z=="number"&&(j.totalEncodeTime=Z);var he=w("framesEncoded");typeof he=="number"&&(j.framesEncoded=he);var ue=w("estimatedPlayoutTimestamp");typeof ue=="number"&&(j.estimatedPlayoutTimestamp=ue);var ye=w("totalDecodeTime");typeof ye=="number"&&(j.totalDecodeTime=ye);var W=w("framesDecoded");typeof W=="number"&&(j.framesDecoded=W);var K=w("jitterBufferDelay");typeof K=="number"&&(j.jitterBufferDelay=K);var I=w("jitterBufferEmittedCount");return typeof I=="number"&&(j.jitterBufferEmittedCount=I),j}return mt=h,mt}var Rn,Ji;function uu(){if(Ji)return Rn;Ji=1;function k(p){return p===void 0&&(p={audio:!0,video:!0}),typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.getUserMedia=="function"?navigator.mediaDevices.getUserMedia(p):Promise.reject(new Error("getUserMedia is not supported"))}return Rn=k,Rn}var mn={exports:{}},Xi;function ic(){return Xi||(Xi=1,typeof MediaStream=="function"?mn.exports=MediaStream:mn.exports=function(){throw new Error("MediaStream is not supported")}),mn.exports}var yn={exports:{}},Zi;function lu(){return Zi||(Zi=1,typeof MediaStreamTrack=="function"?yn.exports=MediaStreamTrack:yn.exports=function(){throw new Error("MediaStreamTrack is not supported")}),yn.exports}var gn={exports:{}},ea;function du(){return ea||(ea=1,typeof RTCIceCandidate=="function"?gn.exports=RTCIceCandidate:gn.exports=function(){throw new Error("RTCIceCandidate is not supported")}),gn.exports}var yt={exports:{}},Ln,ta;function ac(){if(ta)return Ln;ta=1;var k=function(){function p(_){this.descriptionInitDict=_;var s=_&&_.type==="rollback"?null:new RTCSessionDescription(_);Object.defineProperties(this,{_description:{get:function(){return s}}})}return Object.defineProperty(p.prototype,"sdp",{get:function(){return this._description?this._description.sdp:this.descriptionInitDict.sdp},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"type",{get:function(){return this._description?this._description.type:this.descriptionInitDict.type},enumerable:!1,configurable:!0}),p}();return Ln=k,Ln}var bn={exports:{}},ra;function Ue(){if(ra)return bn.exports;ra=1;var k=typeof Reflect=="object"?Reflect:null,p=k&&typeof k.apply=="function"?k.apply:function(g,l,f){return Function.prototype.apply.call(g,l,f)},_;k&&typeof k.ownKeys=="function"?_=k.ownKeys:Object.getOwnPropertySymbols?_=function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:_=function(g){return Object.getOwnPropertyNames(g)};function s(b){console&&console.warn&&console.warn(b)}var i=Number.isNaN||function(g){return g!==g};function e(){e.init.call(this)}bn.exports=e,bn.exports.once=S,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._eventsCount=0,e.prototype._maxListeners=void 0;var r=10;function t(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(e,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(b){if(typeof b!="number"||b<0||i(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");r=b}}),e.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},e.prototype.setMaxListeners=function(g){if(typeof g!="number"||g<0||i(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this};function n(b){return b._maxListeners===void 0?e.defaultMaxListeners:b._maxListeners}e.prototype.getMaxListeners=function(){return n(this)},e.prototype.emit=function(g){for(var l=[],f=1;f<arguments.length;f++)l.push(arguments[f]);var m=g==="error",P=this._events;if(P!==void 0)m=m&&P.error===void 0;else if(!m)return!1;if(m){var C;if(l.length>0&&(C=l[0]),C instanceof Error)throw C;var M=new Error("Unhandled error."+(C?" ("+C.message+")":""));throw M.context=C,M}var D=P[g];if(D===void 0)return!1;if(typeof D=="function")p(D,this,l);else for(var O=D.length,x=u(D,O),f=0;f<O;++f)p(x[f],this,l);return!0};function a(b,g,l,f){var m,P,C;if(t(l),P=b._events,P===void 0?(P=b._events=Object.create(null),b._eventsCount=0):(P.newListener!==void 0&&(b.emit("newListener",g,l.listener?l.listener:l),P=b._events),C=P[g]),C===void 0)C=P[g]=l,++b._eventsCount;else if(typeof C=="function"?C=P[g]=f?[l,C]:[C,l]:f?C.unshift(l):C.push(l),m=n(b),m>0&&C.length>m&&!C.warned){C.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+C.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=b,M.type=g,M.count=C.length,s(M)}return b}e.prototype.addListener=function(g,l){return a(this,g,l,!1)},e.prototype.on=e.prototype.addListener,e.prototype.prependListener=function(g,l){return a(this,g,l,!0)};function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(b,g,l){var f={fired:!1,wrapFn:void 0,target:b,type:g,listener:l},m=o.bind(f);return m.listener=l,f.wrapFn=m,m}e.prototype.once=function(g,l){return t(l),this.on(g,c(this,g,l)),this},e.prototype.prependOnceListener=function(g,l){return t(l),this.prependListener(g,c(this,g,l)),this},e.prototype.removeListener=function(g,l){var f,m,P,C,M;if(t(l),m=this._events,m===void 0)return this;if(f=m[g],f===void 0)return this;if(f===l||f.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete m[g],m.removeListener&&this.emit("removeListener",g,f.listener||l));else if(typeof f!="function"){for(P=-1,C=f.length-1;C>=0;C--)if(f[C]===l||f[C].listener===l){M=f[C].listener,P=C;break}if(P<0)return this;P===0?f.shift():y(f,P),f.length===1&&(m[g]=f[0]),m.removeListener!==void 0&&this.emit("removeListener",g,M||l)}return this},e.prototype.off=e.prototype.removeListener,e.prototype.removeAllListeners=function(g){var l,f,m;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[g]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[g]),this;if(arguments.length===0){var P=Object.keys(f),C;for(m=0;m<P.length;++m)C=P[m],C!=="removeListener"&&this.removeAllListeners(C);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=f[g],typeof l=="function")this.removeListener(g,l);else if(l!==void 0)for(m=l.length-1;m>=0;m--)this.removeListener(g,l[m]);return this};function d(b,g,l){var f=b._events;if(f===void 0)return[];var m=f[g];return m===void 0?[]:typeof m=="function"?l?[m.listener||m]:[m]:l?h(m):u(m,m.length)}e.prototype.listeners=function(g){return d(this,g,!0)},e.prototype.rawListeners=function(g){return d(this,g,!1)},e.listenerCount=function(b,g){return typeof b.listenerCount=="function"?b.listenerCount(g):v.call(b,g)},e.prototype.listenerCount=v;function v(b){var g=this._events;if(g!==void 0){var l=g[b];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}e.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]};function u(b,g){for(var l=new Array(g),f=0;f<g;++f)l[f]=b[f];return l}function y(b,g){for(;g+1<b.length;g++)b[g]=b[g+1];b.pop()}function h(b){for(var g=new Array(b.length),l=0;l<g.length;++l)g[l]=b[l].listener||b[l];return g}function S(b,g){return new Promise(function(l,f){function m(C){b.removeListener(g,P),f(C)}function P(){typeof b.removeListener=="function"&&b.removeListener("error",m),l([].slice.call(arguments))}T(b,g,P,{once:!0}),g!=="error"&&L(b,m,{once:!0})})}function L(b,g,l){typeof b.on=="function"&&T(b,"error",g,l)}function T(b,g,l,f){if(typeof b.on=="function")f.once?b.once(g,l):b.on(g,l);else if(typeof b.addEventListener=="function")b.addEventListener(g,function m(P){f.once&&b.removeEventListener(g,m),l(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return bn.exports}var gt,na;function Oi(){if(na)return gt;na=1;var k=gt&&gt.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(o)throw o.error}}return a},p=gt&&gt.__spreadArray||function(i,e){for(var r=0,t=e.length,n=i.length;r<t;r++,n++)i[n]=e[r];return i},_=Ue().EventEmitter,s=function(){function i(){Object.defineProperties(this,{_eventEmitter:{value:new _}})}return i.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},i.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,p([],k(arguments)))},i.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,p([],k(arguments)))},i}();return gt=s,gt}var xn,ia;function oc(){if(ia)return xn;ia=1;var k=qe().defer,p={high:new Set(["low"]),low:new Set(["high"])},_=function(){function i(e){e===void 0&&(e="low");var r=e;Object.defineProperties(this,{_state:{set:function(t){var n=this;if(r!==t){r=t;var a=this._whenDeferreds.get(r);a.forEach(function(o){return o.resolve(n)}),a.clear()}},get:function(){return r}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])}})}return Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),i.prototype.lower=function(){return this.transition("low")},i.prototype.raise=function(){return this.transition("high")},i.prototype.transition=function(e){if(!p[this.state].has(e))throw s(this.state,e);return this._state=e,this},i.prototype.when=function(e){if(this.state===e)return Promise.resolve(this);if(!p[this.state].has(e))return Promise.reject(s(this.state,e));var r=k();return this._whenDeferreds.get(e).add(r),r.promise},i}();function s(i,e){return new Error('Cannot transition from "'+i+'" to "'+e+'"')}return xn=_,xn}var An,aa;function fu(){if(aa)return An;aa=1;var k=function(){function p(_){Object.defineProperties(this,{track:{enumerable:!0,value:_,writable:!0}})}return p}();return An=k,An}var Xe,oa;function vu(){if(oa)return Xe;oa=1;var k=Xe&&Xe.__extends||function(){var D=function(O,x){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,q){E.__proto__=q}||function(E,q){for(var U in q)Object.prototype.hasOwnProperty.call(q,U)&&(E[U]=q[U])},D(O,x)};return function(O,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");D(O,x);function E(){this.constructor=O}O.prototype=x===null?Object.create(x):(E.prototype=x.prototype,new E)}}(),p=Xe&&Xe.__read||function(D,O){var x=typeof Symbol=="function"&&D[Symbol.iterator];if(!x)return D;var E=x.call(D),q,U=[],G;try{for(;(O===void 0||O-- >0)&&!(q=E.next()).done;)U.push(q.value)}catch(F){G={error:F}}finally{try{q&&!q.done&&(x=E.return)&&x.call(E)}finally{if(G)throw G.error}}return U},_=Xe&&Xe.__spreadArray||function(D,O){for(var x=0,E=O.length,q=D.length;x<E;x++,q++)D[q]=O[x];return D},s=ac(),i=Oi(),e=oc(),r=ic(),t=fu(),n=un(),a=n.getSdpFormat,o=n.updatePlanBTrackIdsToSSRCs,c=n.updateUnifiedPlanTrackIdsToSSRCs,d=qe(),v=d.delegateMethods,u=d.interceptEvent,y=d.isIOSChrome,h=d.legacyPromise,S=d.proxyProperties,L=a()==="unified",T=function(D){k(O,D);function O(x,E){x===void 0&&(x={});var q=D.call(this)||this,U=Object.assign(x.iceTransportPolicy?{iceTransports:x.iceTransportPolicy}:{},x);u(q,"datachannel"),u(q,"signalingstatechange");var G=a(U.sdpSemantics),F=new RTCPeerConnection(U,E);return Object.defineProperties(q,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_localStream:{value:new r},_peerConnection:{value:F},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:G},_senders:{value:new Map},_signalingStateLatch:{value:new e},_tracksToSSRCs:{value:new Map,writable:!0}}),F.addEventListener("datachannel",function(N){C(N.channel),q.dispatchEvent(N)}),F.addEventListener("signalingstatechange",function(){for(var N=[],A=0;A<arguments.length;A++)N[A]=arguments[A];F.signalingState==="stable"&&(q._appliedTracksToSSRCs=new Map(q._tracksToSSRCs)),!q._pendingLocalOffer&&!q._pendingRemoteOffer&&q.dispatchEvent.apply(q,_([],p(N)))}),F.ontrack=function(){},typeof F.addTrack!="function"&&F.addStream(q._localStream),S(RTCPeerConnection.prototype,q,F),q}return Object.defineProperty(O.prototype,"localDescription",{get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"signalingState",{get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),O.prototype.addTrack=function(x){for(var E,q=[],U=1;U<arguments.length;U++)q[U-1]=arguments[U];if(typeof this._peerConnection.addTrack=="function")return(E=this._peerConnection).addTrack.apply(E,_([x],p(q)));if(this._peerConnection.signalingState==="closed")throw new Error("Cannot add MediaStreamTrack ["+x.id+`, 
        `+x.kind+"]: RTCPeerConnection is closed");var G=this._senders.get(x);if(G&&G.track)throw new Error("Cannot add MediaStreamTrack ['"+x.id+`, 
        `+x.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(x),this._peerConnection.addStream(this._localStream),G=new t(x),this._senders.set(x,G),G},O.prototype.removeTrack=function(x){if(this._peerConnection.signalingState==="closed")throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");if(typeof this._peerConnection.addTrack=="function")try{return this._peerConnection.removeTrack(x)}catch{}else{var E=x.track;if(!E)return;x=this._senders.get(E),x&&x.track&&(x.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(E),this._peerConnection.addStream(this._localStream))}},O.prototype.getSenders=function(){return typeof this._peerConnection.addTrack=="function"?this._peerConnection.getSenders():Array.from(this._senders.values())},O.prototype.addIceCandidate=function(x){for(var E=this,q=[],U=1;U<arguments.length;U++)q[U-1]=arguments[U];var G;return this.signalingState==="have-remote-offer"?G=this._signalingStateLatch.when("low").then(function(){return E._peerConnection.addIceCandidate(x)}):G=this._peerConnection.addIceCandidate(x),q.length>0?h.apply(void 0,_([G],p(q))):G},O.prototype.close=function(){this.signalingState!=="closed"&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},O.prototype.createAnswer=function(){for(var x=this,E=[],q=0;q<arguments.length;q++)E[q]=arguments[q];var U;return this._pendingRemoteOffer?U=this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return x._signalingStateLatch.lower(),x._peerConnection.createAnswer()}).then(function(G){return x._pendingRemoteOffer=null,x._rolledBackTracksToSSRCs.clear(),new s({type:"answer",sdp:M(x._sdpFormat,x._tracksToSSRCs,G.sdp)})},function(G){throw x._pendingRemoteOffer=null,G}):U=this._peerConnection.createAnswer().then(function(G){return x._rolledBackTracksToSSRCs.clear(),new s({type:"answer",sdp:M(x._sdpFormat,x._tracksToSSRCs,G.sdp)})}),E.length>1?h.apply(void 0,_([U],p(E))):U},O.prototype.createOffer=function(){for(var x=this,E=[],q=0;q<arguments.length;q++)E[q]=arguments[q];var U=p(E,3),G=U[0],F=U[1],N=U[2],A=N||G||{};if(y()){if(A.offerToReceiveVideo&&!this._audioTransceiver&&!(L&&l(this,"audio"))){delete A.offerToReceiveAudio;try{this._audioTransceiver=L?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(j){return Promise.reject(j)}}if(A.offerToReceiveVideo&&!this._videoTransceiver&&!(L&&l(this,"video"))){delete A.offerToReceiveVideo;try{this._videoTransceiver=L?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(j){return Promise.reject(j)}}}var w=this._peerConnection.createOffer(A).then(function(j){return x._rolledBackTracksToSSRCs.clear(),new s({type:j.type,sdp:M(x._sdpFormat,x._tracksToSSRCs,j.sdp)})});return E.length>1?h(w,G,F):w},O.prototype.createDataChannel=function(x,E){E=P(E);var q=this._peerConnection.createDataChannel(x,E);return C(q),q},O.prototype.setLocalDescription=function(){for(var x=[],E=0;E<arguments.length;E++)x[E]=arguments[E];var q=p(x,3),U=q[0],G=q[1],F=q[2];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var N=b(this,!0,U);return x.length>1?h(N,G,F):N},O.prototype.setRemoteDescription=function(){for(var x=[],E=0;E<arguments.length;E++)x[E]=arguments[E];var q=p(x,3),U=q[0],G=q[1],F=q[2];this._rolledBackTracksToSSRCs.clear();var N=b(this,!1,U);return x.length>1?h(N,G,F):N},O}(i);v(RTCPeerConnection.prototype,T.prototype,"_peerConnection");function b(D,O,x){function E(j){O?D._pendingLocalOffer=j:D._pendingRemoteOffer=j}function q(){O?D._pendingLocalOffer=null:D._pendingRemoteOffer=null}var U=O?D._pendingLocalOffer:D._pendingRemoteOffer,G=O?D._pendingRemoteOffer:D._pendingLocalOffer,F=O?"have-local-offer":"have-remote-offer",N=O?"setLocalDescription":"setRemoteDescription",A;if(!O&&G&&x.type==="answer")A=g(D,x);else if(x.type==="offer"){if(D.signalingState!==F&&D.signalingState!=="stable")return Promise.reject(new Error("Cannot set "+(O?"local":"remote")+" offer in state "+D.signalingState));!U&&D._signalingStateLatch.state==="low"&&D._signalingStateLatch.raise();var w=D.signalingState;E(f(x)),A=Promise.resolve(),D.signalingState!==w&&A.then(function(){return D.dispatchEvent(new Event("signalingstatechange"))})}else x.type==="rollback"&&(D.signalingState!==F?A=Promise.reject(new Error("Cannot rollback "+(O?"local":"remote")+" description in "+D.signalingState)):(q(),D._rolledBackTracksToSSRCs=new Map(D._tracksToSSRCs),D._tracksToSSRCs=new Map(D._appliedTracksToSSRCs),A=Promise.resolve(),A.then(function(){return D.dispatchEvent(new Event("signalingstatechange"))})));return A||D._peerConnection[N](f(x))}function g(D,O){var x=D._pendingLocalOffer;return D._peerConnection.setLocalDescription(x).then(function(){return D._pendingLocalOffer=null,D.setRemoteDescription(O)}).then(function(){D._signalingStateLatch.lower()})}function l(D,O){return!!D.getTransceivers().find(function(x){var E=x.receiver,q=E===void 0?{}:E,U=q.track,G=U===void 0?{}:U;return G.kind===O})}function f(D){return D instanceof s&&D._description?D._description:new RTCSessionDescription(D)}function m(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function P(D){return D=Object.assign({},D),m()&&"maxPacketLifeTime"in D&&(D.maxRetransmitTime=D.maxPacketLifeTime),D}function C(D){return Object.defineProperty(D,"maxRetransmits",{value:D.maxRetransmits===65535?null:D.maxRetransmits}),m()&&Object.defineProperty(D,"maxPacketLifeTime",{value:D.maxRetransmitTime===65535?null:D.maxRetransmitTime}),D}function M(D,O,x){return D==="unified"?c(O,x):o(O,x)}return Xe=T,Xe}var Mn,sa;function sc(){return sa||(sa=1,Mn=RTCSessionDescription),Mn}var Ze,ca;function pu(){if(ca)return Ze;ca=1;var k=Ze&&Ze.__extends||function(){var y=function(h,S){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,T){L.__proto__=T}||function(L,T){for(var b in T)Object.prototype.hasOwnProperty.call(T,b)&&(L[b]=T[b])},y(h,S)};return function(h,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");y(h,S);function L(){this.constructor=h}h.prototype=S===null?Object.create(S):(L.prototype=S.prototype,new L)}}(),p=Ze&&Ze.__read||function(y,h){var S=typeof Symbol=="function"&&y[Symbol.iterator];if(!S)return y;var L=S.call(y),T,b=[],g;try{for(;(h===void 0||h-- >0)&&!(T=L.next()).done;)b.push(T.value)}catch(l){g={error:l}}finally{try{T&&!T.done&&(S=L.return)&&S.call(L)}finally{if(g)throw g.error}}return b},_=Ze&&Ze.__spreadArray||function(y,h){for(var S=0,L=h.length,T=y.length;S<L;S++,T++)y[T]=h[S];return y},s=Oi(),i=sc(),e=un().updateUnifiedPlanTrackIdsToSSRCs,r=qe(),t=r.delegateMethods,n=r.interceptEvent,a=r.legacyPromise,o=r.proxyProperties,c=function(y){k(h,y);function h(S){var L=y.call(this)||this;n(L,"signalingstatechange");var T=new RTCPeerConnection(S);Object.defineProperties(L,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:T},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},peerIdentity:{enumerable:!0,value:Promise.resolve({idp:"",name:""})}});var b;return T.addEventListener("signalingstatechange",function(){for(var g=[],l=0;l<arguments.length;l++)g[l]=arguments[l];!L._rollingBack&&L.signalingState!==b&&(b=L.signalingState,L._isClosed?setTimeout(function(){return L.dispatchEvent.apply(L,_([],p(g)))}):L.dispatchEvent.apply(L,_([],p(g))))}),o(RTCPeerConnection.prototype,L,T),L}return Object.defineProperty(h.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"localDescription",{get:function(){return u(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),h.prototype.createAnswer=function(){for(var S=this,L=[],T=0;T<arguments.length;T++)L[T]=arguments[T];var b;return b=this._peerConnection.createAnswer().then(function(g){return v(S,g),u(g,S._initiallyNegotiatedDtlsRole)}),typeof L[0]=="function"?a.apply(void 0,_([b],p(L))):b},h.prototype.createOffer=function(){for(var S=this,L=[],T=0;T<arguments.length;T++)L[T]=arguments[T];var b=p(L,3),g=b[0],l=b[1],f=b[2],m=f||g||{},P;if(this.signalingState==="have-local-offer"||this.signalingState==="have-remote-offer"){var C=this.signalingState==="have-local-offer";P=d(this,C,function(){return S.createOffer(m)})}else P=this._peerConnection.createOffer(m);return P=P.then(function(M){return new i({type:M.type,sdp:e(S._tracksToSSRCs,M.sdp)})}),L.length>1?a(P,g,l):P},h.prototype.setLocalDescription=function(){for(var S,L=[],T=0;T<arguments.length;T++)L[T]=arguments[T];var b=p(L),g=b[0],l=b.slice(1),f;return g&&g.type==="answer"&&this.signalingState==="have-local-offer"&&(f=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),f?L.length>1?a.apply(void 0,_([f],p(l))):f:(S=this._peerConnection).setLocalDescription.apply(S,_([],p(L)))},h.prototype.setRemoteDescription=function(){for(var S=this,L=[],T=0;T<arguments.length;T++)L[T]=arguments[T];var b=p(L),g=b[0],l=b.slice(1),f;return g&&this.signalingState==="have-remote-offer"&&(g.type==="answer"?f=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):g.type==="offer"&&(f=d(this,!1,function(){return S._peerConnection.setRemoteDescription(g)}))),f||(f=this._peerConnection.setRemoteDescription(g)),f=f.then(function(){return v(S,g,!0)}),L.length>1?a.apply(void 0,_([f],p(l))):f},h.prototype.close=function(){this.signalingState!=="closed"&&(this._isClosed=!0,this._peerConnection.close())},h}(s);t(RTCPeerConnection.prototype,c.prototype,"_peerConnection");function d(y,h,S){var L=h?"setLocalDescription":"setRemoteDescription";return y._rollingBack=!0,y._peerConnection[L](new i({type:"rollback"})).then(S).then(function(T){return y._rollingBack=!1,T},function(T){throw y._rollingBack=!1,T})}function v(y,h,S){if(!(y._initiallyNegotiatedDtlsRole||h.type==="offer")){var L=h.sdp.match(/a=setup:([a-z]+)/);if(L){var T=L[1];y._initiallyNegotiatedDtlsRole=S?{active:"passive",passive:"active"}[T]:T}}}function u(y,h){return y&&y.type==="answer"&&h?new i({type:y.type,sdp:y.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+h)}):y}return Ze=c,Ze}var et,ua;function hu(){if(ua)return et;ua=1;var k=et&&et.__extends||function(){var b=function(g,l){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,m){f.__proto__=m}||function(f,m){for(var P in m)Object.prototype.hasOwnProperty.call(m,P)&&(f[P]=m[P])},b(g,l)};return function(g,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");b(g,l);function f(){this.constructor=g}g.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)}}(),p=et&&et.__read||function(b,g){var l=typeof Symbol=="function"&&b[Symbol.iterator];if(!l)return b;var f=l.call(b),m,P=[],C;try{for(;(g===void 0||g-- >0)&&!(m=f.next()).done;)P.push(m.value)}catch(M){C={error:M}}finally{try{m&&!m.done&&(l=f.return)&&l.call(f)}finally{if(C)throw C.error}}return P},_=et&&et.__spreadArray||function(b,g){for(var l=0,f=g.length,m=b.length;l<f;l++,m++)b[m]=g[l];return b},s=Oi(),i=oc(),e=un(),r=e.getSdpFormat,t=e.updatePlanBTrackIdsToSSRCs,n=e.updateUnifiedPlanTrackIdsToSSRCs,a=qe(),o=a.delegateMethods,c=a.interceptEvent,d=a.proxyProperties,v=r()==="unified",u=v?n:t,y=function(b){k(g,b);function g(l){var f=b.call(this)||this;c(f,"datachannel"),c(f,"iceconnectionstatechange"),c(f,"signalingstatechange"),c(f,"track");var m=new RTCPeerConnection(l);return Object.defineProperties(f,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:m},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new i},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0}}),m.addEventListener("datachannel",function(P){T(P.channel),f.dispatchEvent(P)}),m.addEventListener("iceconnectionstatechange",function(){for(var P=[],C=0;C<arguments.length;C++)P[C]=arguments[C];f._isClosed||f.dispatchEvent.apply(f,_([],p(P)))}),m.addEventListener("signalingstatechange",function(){for(var P=[],C=0;C<arguments.length;C++)P[C]=arguments[C];f._isClosed||(m.signalingState==="stable"&&(f._appliedTracksToSSRCs=new Map(f._tracksToSSRCs)),!f._pendingLocalOffer&&!f._pendingRemoteOffer&&f.dispatchEvent.apply(f,_([],p(P))))}),m.addEventListener("track",function(P){f._pendingRemoteOffer=null,f.dispatchEvent(P)}),d(RTCPeerConnection.prototype,f,m),f}return Object.defineProperty(g.prototype,"localDescription",{get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"iceConnectionState",{get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),g.prototype.addIceCandidate=function(l){var f=this;return this.signalingState==="have-remote-offer"?this._signalingStateLatch.when("low").then(function(){return f._peerConnection.addIceCandidate(l)}):this._peerConnection.addIceCandidate(l)},g.prototype.createOffer=function(l){var f=this;if(l=Object.assign({},l),l.offerToReceiveVideo&&!this._audioTransceiver&&!(v&&L(this,"audio"))){delete l.offerToReceiveAudio;try{this._audioTransceiver=v?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(m){return Promise.reject(m)}}if(l.offerToReceiveVideo&&!this._videoTransceiver&&!(v&&L(this,"video"))){delete l.offerToReceiveVideo;try{this._videoTransceiver=v?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(m){return Promise.reject(m)}}return this._peerConnection.createOffer(l).then(function(m){return f._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:m.type,sdp:u(f._tracksToSSRCs,m.sdp)})})},g.prototype.createAnswer=function(l){var f=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return f._signalingStateLatch.lower(),f._peerConnection.createAnswer()}).then(function(m){return f._pendingRemoteOffer=null,f._rolledBackTracksToSSRCs.clear(),v?new RTCSessionDescription({type:m.type,sdp:u(f._tracksToSSRCs,m.sdp)}):m},function(m){throw f._pendingRemoteOffer=null,m}):this._peerConnection.createAnswer(l).then(function(m){return f._rolledBackTracksToSSRCs.clear(),v?new RTCSessionDescription({type:m.type,sdp:u(f._tracksToSSRCs,m.sdp)}):m})},g.prototype.createDataChannel=function(l,f){var m=this._peerConnection.createDataChannel(l,f);return T(m),m},g.prototype.removeTrack=function(l){l.replaceTrack(null),this._peerConnection.removeTrack(l)},g.prototype.setLocalDescription=function(l){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),h(this,!0,l)},g.prototype.setRemoteDescription=function(l){return this._rolledBackTracksToSSRCs.clear(),h(this,!1,l)},g.prototype.close=function(){var l=this;this._isClosed||(this._isClosed=!0,this._peerConnection.close(),setTimeout(function(){l.dispatchEvent(new Event("iceconnectionstatechange")),l.dispatchEvent(new Event("signalingstatechange"))}))},g}(s);o(RTCPeerConnection.prototype,y.prototype,"_peerConnection");function h(b,g,l){function f(x){g?b._pendingLocalOffer=x:b._pendingRemoteOffer=x}function m(){g?b._pendingLocalOffer=null:b._pendingRemoteOffer=null}var P=g?b._pendingLocalOffer:b._pendingRemoteOffer,C=g?b._pendingRemoteOffer:b._pendingLocalOffer,M=g?"have-local-offer":"have-remote-offer",D=g?"setLocalDescription":"setRemoteDescription";if(!g&&C&&l.type==="answer")return S(b,l);if(l.type==="offer"){if(b.signalingState!==M&&b.signalingState!=="stable")return Promise.reject(new Error("Cannot set "+(g?"local":"remote")+`
        offer in state `+b.signalingState));!P&&b._signalingStateLatch.state==="low"&&b._signalingStateLatch.raise();var O=b.signalingState;return f(l),b.signalingState!==O?Promise.resolve().then(function(){return b.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}else if(l.type==="rollback")return b.signalingState!==M?Promise.reject(new Error(`Cannot rollback 
        `+(g?"local":"remote")+" description in "+b.signalingState)):(m(),b._rolledBackTracksToSSRCs=new Map(b._tracksToSSRCs),b._tracksToSSRCs=new Map(b._appliedTracksToSSRCs),Promise.resolve().then(function(){return b.dispatchEvent(new Event("signalingstatechange"))}));return b._peerConnection[D](l)}function S(b,g){var l=b._pendingLocalOffer;return b._peerConnection.setLocalDescription(l).then(function(){return b._pendingLocalOffer=null,b.setRemoteDescription(g)}).then(function(){return b._signalingStateLatch.lower()})}function L(b,g){return!!b.getTransceivers().find(function(l){var f=l.receiver,m=f===void 0?{}:f,P=m.track,C=P===void 0?{}:P;return C.kind===g})}function T(b){return Object.defineProperties(b,{maxPacketLifeTime:{value:b.maxPacketLifeTime===65535?null:b.maxPacketLifeTime},maxRetransmits:{value:b.maxRetransmits===65535?null:b.maxRetransmits}})}return et=y,et}var la;function _u(){if(la)return yt.exports;if(la=1,typeof RTCPeerConnection=="function"){var k=qe().guessBrowser;switch(k()){case"chrome":yt.exports=vu();break;case"firefox":yt.exports=pu();break;case"safari":yt.exports=hu();break;default:yt.exports=RTCPeerConnection;break}}else yt.exports=function(){throw new Error("RTCPeerConnection is not supported")};return yt.exports}var Mt={exports:{}},da;function mu(){if(da)return Mt.exports;if(da=1,typeof RTCSessionDescription=="function"){var k=qe().guessBrowser;switch(k()){case"chrome":Mt.exports=ac();break;case"firefox":Mt.exports=sc();break;default:Mt.exports=RTCSessionDescription;break}}else Mt.exports=function(){throw new Error("RTCSessionDescription is not supported")};return Mt.exports}var In,fa;function Ot(){if(fa)return In;fa=1;var k={};return Object.defineProperties(k,{getStats:{enumerable:!0,value:cu()},getUserMedia:{enumerable:!0,value:uu()},MediaStream:{enumerable:!0,value:ic()},MediaStreamTrack:{enumerable:!0,value:lu()},RTCIceCandidate:{enumerable:!0,value:du()},RTCPeerConnection:{enumerable:!0,value:_u()},RTCSessionDescription:{enumerable:!0,value:mu()}}),In=k,In}var Dn,va;function Ri(){return va||(va=1,Dn=function(p,_){if(p&&_)if(p.super_=_,typeof Object.create=="function")p.prototype=Object.create(_.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}});else{var s=function(){function i(){}return i}();s.prototype=_.prototype,p.prototype=new s,p.prototype.constructor=p}}),Dn}var Ut,pa;function Rt(){if(pa)return Ut;pa=1;var k=Ut&&Ut.__read||function(c,d){var v=typeof Symbol=="function"&&c[Symbol.iterator];if(!v)return c;var u=v.call(c),y,h=[],S;try{for(;(d===void 0||d-- >0)&&!(y=u.next()).done;)h.push(y.value)}catch(L){S={error:L}}finally{try{y&&!y.done&&(v=u.return)&&v.call(u)}finally{if(S)throw S.error}}return h};function p(){return/Android/.test(navigator.userAgent)}function _(){return!!(navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2)}function s(){return _()&&window.screen.width>=744&&(/Macintosh/i.test(navigator.userAgent)||/iPad/.test(navigator.userAgent)||/iPad/.test(navigator.platform))}function i(){return _()&&window.screen.width<=476&&(/Macintosh/i.test(navigator.userAgent)||/iPhone/.test(navigator.userAgent)||/iPhone/.test(navigator.platform))}function e(){return s()||i()}function r(){return/Mobi/.test(navigator.userAgent)}function t(c){return c==="chrome"&&/Edge/.test(navigator.userAgent)&&(typeof chrome>"u"||typeof chrome.runtime>"u")}function n(c){if(c!=="chrome")return null;if("brave"in navigator)return"brave";var d=o(navigator.userAgent),v=d.reduce(function(S,L){return S.replace(L,"")},navigator.userAgent),u=v.match(/[^\s]+/g)||[],y=k(u.map(function(S){return S.split("/")[0].toLowerCase()})),h=y.slice(2);return h.find(function(S){return!["chrome","mobile","safari"].includes(S)})||null}function a(c){return c!=="safari"?null:"brave"in navigator?"brave":["edge","edg"].find(function(d){return navigator.userAgent.toLowerCase().includes(d)})||null}function o(c){for(var d=[],v=[],u=0;u<c.length;u++)if(c[u]==="(")d.push(u);else if(c[u]===")"&&d.length>0){var y=d.pop();d.length===0&&v.push(c.substring(y,u+1))}return v}return Ut={isAndroid:p,isIOS:e,isIpad:s,isIphone:i,isMobile:r,isNonChromiumEdge:t,mobileWebKitBrowser:a,rebrandedChromeBrowser:n},Ut}var jn,ha;function cc(){if(ha)return jn;ha=1;function k(_){return _=typeof _=="number"?_:0,new Promise(function(s){return setTimeout(s,_)})}function p(_,s,i){i=typeof i=="number"?i:250;var e=_.createMediaStreamSource(s),r=_.createAnalyser();r.fftSize=2048,e.connect(r);var t=new Uint8Array(r.fftSize),n=!1;setTimeout(function(){n=!0},i);function a(){return n?Promise.resolve(!0):(r.getByteTimeDomainData(t),t.some(function(o){return o!==128&&o!==0})?Promise.resolve(!1):k().then(a))}return a().then(function(o){return e.disconnect(),o},function(o){throw e.disconnect(),o})}return jn=p,jn}var Nn,_a;function Tn(){if(_a)return Nn;_a=1;var k=typeof AudioContext<"u"?AudioContext:typeof webkitAudioContext<"u"?webkitAudioContext:null,p=function(){function _(s){s=Object.assign({AudioContext:k},s),Object.defineProperties(this,{_AudioContext:{value:s.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:_}})}return _.prototype.getOrCreate=function(s){if(!this._holders.has(s)&&(this._holders.add(s),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch{}return this._audioContext},_.prototype.release=function(s){this._holders.has(s)&&(this._holders.delete(s),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))},_}();return Nn=new p,Nn}var qn,ma;function uc(){if(ma)return qn;ma=1;var k=cc(),p=3,_=250;function s(i){var e=Tn(),r={},t=e.getOrCreate(r),n=p;function a(){return n--,k(t,i.srcObject,_).then(function(o){return o?n>0?a():!0:!1}).catch(function(){return!0})}return a().finally(function(){e.release(r)})}return qn=s,qn}var Vn,ya;function lc(){if(ya)return Vn;ya=1;var k=Ce().defer,p=function(){function _(){Object.defineProperties(this,{_audio:{value:k(),writable:!0},_video:{value:k(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return _.prototype.resolveDeferred=function(s){s==="audio"?this._audio.resolve():this._video.resolve()},_.prototype.startDeferred=function(s){s==="audio"?this._audio=k():this._video=k()},_.prototype.whenResolved=function(s){return s==="audio"?this._audio.promise:this._video.promise},_}();return Vn=new p,Vn}var Fn,ga;function ln(){if(ga)return Fn;ga=1;var k=Ue().EventEmitter,p=Ce().hidePrivateAndCertainPublicPropertiesInClass;return Fn=p(k,["domain"]),Fn}var Wt,ba;function Li(){if(ba)return Wt;ba=1;var k=Wt&&Wt.__extends||function(){var a=function(o,c){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(o,c)};return function(o,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(o,c);function d(){this.constructor=o}o.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}(),p=ln(),_=Ce(),s=_.buildLogLevels,i=_.valueToJSON,e=Oe().DEFAULT_LOG_LEVEL,r=ze(),t=0,n=function(a){k(o,a);function o(c,d,v){var u=this;v=Object.assign({name:c,log:null,logLevel:e},v),u=a.call(this)||this;var y=String(v.name),h=s(v.logLevel),S=v.log?v.log.createLog("media",u):new r("media",u,h,v.loggerName);return Object.defineProperties(u,{_instanceId:{value:++t},_log:{value:S},kind:{enumerable:!0,value:d},name:{enumerable:!0,value:y}}),u}return o.prototype.toJSON=function(){return i(this)},o}(p);return Wt=n,Wt}var Ht,ka;function dc(){if(ka)return Ht;ka=1;var k=Ht&&Ht.__extends||function(){var c=function(d,v){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,y){u.__proto__=y}||function(u,y){for(var h in y)Object.prototype.hasOwnProperty.call(y,h)&&(u[h]=y[h])},c(d,v)};return function(d,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");c(d,v);function u(){this.constructor=d}d.prototype=v===null?Object.create(v):(u.prototype=v.prototype,new u)}}(),p=Rt().isIOS,_=Ot().MediaStream,s=Ce(),i=s.waitForEvent,e=s.waitForSometime,r=lc(),t=Li(),n=function(c){k(d,c);function d(v,u){var y=this;u=Object.assign({playPausedElementsIfNotBackgrounded:p()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string"},u),y=c.call(this,v.id,v.kind,u)||this;var h=!1;if(u=Object.assign({MediaStream:_},u),typeof u.MediaStream!="function")throw new Error("MediaTrack received an invalid MediaStream constructor: "+u.MediaStream);return Object.defineProperties(y,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return h},set:function(S){h=S}},_playPausedElementsIfNotBackgrounded:{value:u.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:u.workaroundWebKitBug212780||u.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:u.MediaStream},_mapMediaElement:{value:u.mapMediaElement},_disposeMediaElement:{value:u.disposeMediaElement},isStarted:{enumerable:!0,get:function(){return h}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||v.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),y._initialize(),y}return d.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)},d.prototype._initialize=function(){var v=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack&&this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("ended",function u(){v._end(),v.mediaStreamTrack.removeEventListener("ended",u)}):this.mediaStreamTrack&&(this.mediaStreamTrack.onended=function(){v._end(),v.mediaStreamTrack.onended=null}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))},d.prototype._end=function(){this._log.debug("Ended"),this._dummyEl&&(this._dummyEl.remove(),this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl.oncanplay=null,this._dummyEl=null)},d.prototype.attach=function(v){var u=this;if(typeof v=="string"?v=this._selectElement(v):v||(v=this._createElement()),this._log.debug("Attempting to attach to element:",v),v=this._attach(v),this._shouldShimAttachedElements&&!this._elShims.has(v)){var y=this._playPausedElementsIfNotBackgrounded?function(){return a(v,u._log)}:null;this._elShims.set(v,o(v,y))}return v},d.prototype._attach=function(v,u){u===void 0&&(u=this.processedTrack||this.mediaStreamTrack);var y=v.srcObject;y instanceof this._MediaStream||(y=new this._MediaStream);var h=u.kind==="audio"?"getAudioTracks":"getVideoTracks";return y[h]().forEach(function(S){y.removeTrack(S)}),y.addTrack(u),this._mapMediaElement&&(this._log.debug("Mapping element using mapMediaElement before attaching media to element"),this._mapMediaElement(v)),v.srcObject=y,v.autoplay=!0,v.playsInline=!0,this._attachments.has(v)||this._attachments.add(v),v},d.prototype._selectElement=function(v){var u=document.querySelector(v);if(!u)throw new Error("Selector matched no element: "+v);return u},d.prototype._updateElementsMediaStreamTrack=function(){var v=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach(function(u){return v._attach(u)})},d.prototype._createElement=function(){return typeof document<"u"?document.createElement(this.kind):null},d.prototype.detach=function(v){var u;return typeof v=="string"?u=[this._selectElement(v)]:v?u=[v]:u=this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",u),this._detachElements(u),v?u[0]:u},d.prototype._detachElements=function(v){return v.map(this._detachElement.bind(this))},d.prototype._detachElement=function(v){if(!this._attachments.has(v))return v;var u=v.srcObject;if(u instanceof this._MediaStream&&u.removeTrack(this.processedTrack||this.mediaStreamTrack),this._disposeMediaElement&&(this._log.debug("Disposing element using disposeMediaElement after removing media from element"),this._disposeMediaElement(v)),this._attachments.delete(v),this._shouldShimAttachedElements&&this._elShims.has(v)){var y=this._elShims.get(v);y.unShim(),this._elShims.delete(v)}return v},d.prototype._getAllAttachedElements=function(){var v=[];return this._attachments.forEach(function(u){v.push(u)}),v},d}(t);function a(c,d){var v=c.tagName.toLowerCase();d.warn("Unintentionally paused:",c),Promise.race([i(document,"visibilitychange"),e(1e3)]).then(function(){document.visibilityState==="visible"&&r.whenResolved("audio").then(function(){return d.info("Playing unintentionally paused <"+v+"> element"),d.debug("Element:",c),c.play()}).then(function(){d.info("Successfully played unintentionally paused <"+v+"> element"),d.debug("Element:",c)}).catch(function(u){d.warn("Error while playing unintentionally paused <"+v+"> element:",{error:u,el:c})})})}function o(c,d){d===void 0&&(d=null);var v=c.pause,u=c.play,y=!1;c.pause=function(){return y=!0,v.call(c)},c.play=function(){return y=!1,u.call(c)};var h=d?function(){y||d()}:null;return h&&c.addEventListener("pause",h),{pausedIntentionally:function(){return y},unShim:function(){c.pause=v,c.play=u,h&&c.removeEventListener("pause",h)}}}return Ht=n,Ht}var Gt,Sa;function fc(){if(Sa)return Gt;Sa=1;var k=Gt&&Gt.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=dc(),_=function(s){k(i,s);function i(e,r){return s.call(this,e,r)||this}return i.prototype.attach=function(){return s.prototype.attach.apply(this,arguments)},i.prototype.detach=function(){return s.prototype.detach.apply(this,arguments)},i}(p);return Gt=_,Gt}var Bn,Ta;function vc(){if(Ta)return Bn;Ta=1;var k=null,p=3,_=50,s=250,i=50;function e(t){try{var n=k.getContext("2d");n.drawImage(t,0,0,i,_);var a=n.getImageData(0,0,i,_),o=a.data.filter(function(d,v){return(v+1)%4}),c=Math.max.apply(Math,o);return c===0}catch(d){return console.log("Error checking silence: ",d),!1}}function r(t){return k=k||document.createElement("canvas"),new Promise(function(n){var a=p;setTimeout(function o(){return a--,e(t)?a>0?setTimeout(o,s):n(!0):n(!1)},s)})}return Bn=r,Bn}var Un,wa;function xi(){if(wa)return Un;wa=1;var k=function(){function p(_){var s=this;_===void 0&&(_=1),Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){s._emitVisible(document.visibilityState==="visible")}}});for(var i=0;i<_;i++)this._listeners.push([])}return p.prototype.clear=function(){for(var _=this._listeners.length,s=0;s<_;s++)this._listeners[s]=[]},p.prototype._listenerCount=function(){return this._listeners.reduce(function(_,s){return _+s.length},0)},p.prototype._emitVisible=function(_){for(var s=this,i=Promise.resolve(),e=function(t){i=i.then(function(){return s._emitVisiblePhase(t,_)})},r=1;r<=this._listeners.length;r++)e(r);return i},p.prototype._emitVisiblePhase=function(_,s){var i=this._listeners[_-1];return Promise.all(i.map(function(e){var r=e(s);return r instanceof Promise?r:Promise.resolve(r)}))},p.prototype._start=function(){document.addEventListener("visibilitychange",this._onVisibilityChange)},p.prototype._stop=function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)},p.prototype.onVisibilityChange=function(_,s){if(typeof _!="number"||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);var i=this._listeners[_-1];return i.push(s),this._listenerCount()===1&&this._start(),this},p.prototype.offVisibilityChange=function(_,s){if(typeof _!="number"||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);var i=this._listeners[_-1],e=i.indexOf(s);return e!==-1&&(i.splice(e,1),this._listenerCount()===0&&this._stop()),this},p}();return Un=new k(2),Un}var Wn,Ea;function pc(){if(Ea)return Wn;Ea=1;var k=cc();function p(_,s,i,e,r){e=typeof e=="number"?e:3;var t=0,n=Tn(),a={},o=n.getOrCreate(a);function c(){return s(i).then(function(d){var v=i.audio?k(o,d,r).catch(function(u){return _.warn("Encountered an error while detecting silence",u),!0}):Promise.resolve(!1);return v.then(function(u){if(u){if(e<=0)return _.warn("Got a silent audio MediaStreamTrack. Normally we would try 	to get a new one, but we've run out of retries; returning it anyway."),d}else return _.info("Got a non-silent audio MediaStreamTrack; returning it."),d;return _.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++t+"."),d.getTracks().forEach(function(y){return y.stop()}),e--,c()})})}return c().then(function(d){return n.release(a),d},function(d){throw n.release(a),d})}return Wn=p,Wn}var tt,Pa;function hc(){if(Pa)return tt;Pa=1;var k=tt&&tt.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=tt&&tt.__read||function(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),a,o=[],c;try{for(;(r===void 0||r-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(d){c={error:d}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(c)throw c.error}}return o},_=tt&&tt.__spreadArray||function(e,r){for(var t=0,n=r.length,a=e.length;t<n;t++,a++)e[a]=r[t];return e},s=Ue().EventEmitter,i=function(e){k(r,e);function r(){var t=e.call(this)||this;return Object.defineProperties(t,{_queuedEvents:{value:new Map}}),t}return r.prototype.dequeue=function(t){var n=this,a=!0;if(!t)return this._queuedEvents.forEach(function(c,d){a=this.dequeue(d)&&a},this),a;var o=this._queuedEvents.get(t)||[];return this._queuedEvents.delete(t),o.reduce(function(c,d){return n.emit.apply(n,_([],p([t].concat(d))))&&c},a)},r.prototype.queue=function(){var t=[].slice.call(arguments);if(this.emit.apply(this,_([],p(t))))return!0;var n=t[0];return this._queuedEvents.has(n)||this._queuedEvents.set(n,[]),this._queuedEvents.get(n).push(t.slice(1)),!1},r}(s);return tt=i,tt}var Qt,Ca;function _c(){if(Ca)return Qt;Ca=1;var k=Qt&&Qt.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=hc(),_=function(s){k(i,s);function i(e,r){var t=s.call(this)||this;return Object.defineProperties(t,{id:{enumerable:!0,value:e},kind:{enumerable:!0,value:r}}),t}return i.prototype.stop=function(){this.emit("stopped")},i}(p);return Qt=_,Qt}var $t,Oa;function mc(){if(Oa)return $t;Oa=1;var k=$t&&$t.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=_c(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e,r.kind)||this;return Object.defineProperties(t,{_track:{value:r,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),t}return i.prototype.stop=function(){this.track.stop(),s.prototype.stop.call(this)},i}(p);return $t=_,$t}var bt,Ra;function yc(){if(Ra)return bt;Ra=1;var k=bt&&bt.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=bt&&bt.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(o)throw o.error}}return a},_=mc(),s=function(i){k(e,i);function e(r){var t=i.call(this,r.id,r)||this;return Object.defineProperties(t,{_clones:{value:new Set},_eventsToReemitters:{value:new Map([["mute",function(){return t.queue("muted")}],["unmute",function(){return t.queue("unmuted")}]])},_senders:{value:new Set},_senderToPublisherHintCallbacks:{value:new Map},isPublishing:{enumerable:!0,get:function(){return!!this._clones.size}},muted:{enumerable:!0,get:function(){return this._track.muted}}}),t._reemitMediaStreamTrackEvents(),t}return e.prototype._reemitMediaStreamTrackEvents=function(r){r===void 0&&(r=this._track);var t=this,n=t._eventsToReemitters,a=t._track;if(r.addEventListener?n.forEach(function(c,d){return r.addEventListener(d,c)}):n.forEach(function(c,d){r["on"+d]=c}),a!==r&&(n.forEach(function(c,d){return a.removeEventListener(d,c)}),a.muted!==r.muted)){var o=n.get(r.muted?"mute":"unmute");o()}},e.prototype.clone=function(){var r=new e(this.track.clone());return this._clones.add(r),r},e.prototype.removeClone=function(r){this._clones.delete(r)},e.prototype.setMediaStreamTrack=function(r){var t=this,n=Array.from(this._clones),a=Array.from(this._senders);return Promise.all(n.map(function(o){return o.setMediaStreamTrack(r.clone())}).concat(a.map(function(o){return t._replaceTrack(o,r)}))).finally(function(){t._reemitMediaStreamTrackEvents(r),t._track=r})},e.prototype.addSender=function(r,t){return this._senders.add(r),t&&this._senderToPublisherHintCallbacks.set(r,t),this},e.prototype.removeSender=function(r){return this._senders.delete(r),this._senderToPublisherHintCallbacks.delete(r),this},e.prototype.setPublisherHint=function(r){var t=p(Array.from(this._senderToPublisherHintCallbacks.values()),1),n=t[0];return n?n(r):Promise.resolve("COULD_NOT_APPLY_HINT")},e.prototype._replaceTrack=function(r,t){var n=this;return r.replaceTrack(t).then(function(a){return n.setPublisherHint(null).catch(function(){}),n.emit("replaced"),a})},e}(_);return bt=s,bt}var Kt,La;function gc(){if(La)return Kt;La=1;var k=Kt&&Kt.__extends||function(){var S=function(L,T){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,g){b.__proto__=g}||function(b,g){for(var l in g)Object.prototype.hasOwnProperty.call(g,l)&&(b[l]=g[l])},S(L,T)};return function(L,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");S(L,T);function b(){this.constructor=L}L.prototype=T===null?Object.create(T):(b.prototype=T.prototype,new b)}}(),p=Ot().getUserMedia,_=Rt().isIOS,s=Ce(),i=s.capitalize,e=s.defer,r=s.waitForSometime,t=s.waitForEvent,n=Oe().typeErrors.ILLEGAL_INVOKE,a=uc(),o=vc(),c=xi(),d=lc(),v=pc(),u=yc();function y(S){return function(L){k(T,L);function T(b,g){var l=this,f=_()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string";g=Object.assign({getUserMedia:p,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:f,gUMSilentTrackWorkaround:v},g);var m=new u(b),P=m.kind;return l=L.call(this,m,g)||this,Object.defineProperties(l,{_constraints:{value:typeof g[P]=="object"?g[P]:{},writable:!0},_getUserMedia:{value:g.getUserMedia},_gUMSilentTrackWorkaround:{value:g.gUMSilentTrackWorkaround},_eventsToReemitters:{value:new Map([["muted",function(){return l.emit("muted",l)}],["unmuted",function(){return l.emit("unmuted",l)}]])},_workaroundWebKitBug1208516:{value:g.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:g.isCreatedByCreateLocalTracks},_noiseCancellation:{value:g.noiseCancellation||null},_trackSender:{value:m},id:{enumerable:!0,value:m.id},isEnabled:{enumerable:!0,get:function(){return m.enabled}},isMuted:{enumerable:!0,get:function(){return m.muted}},isStopped:{enumerable:!0,get:function(){return m.readyState==="ended"}}}),l._workaroundWebKitBug1208516&&(l._workaroundWebKitBug1208516Cleanup=h(l)),l._reemitTrackSenderEvents(),l}return T.prototype._end=function(){var b=this;this._didCallEnd||(L.prototype._end.call(this),this._didCallEnd=!0,this._eventsToReemitters.forEach(function(g,l){return b._trackSender.removeListener(l,g)}),this.emit("stopped",this))},T.prototype._initialize=function(){this._didCallEnd&&(this._didCallEnd=!1),this._eventsToReemitters&&this._reemitTrackSenderEvents(),L.prototype._initialize.call(this)},T.prototype._reacquireTrack=function(b){var g,l=this,f=l._getUserMedia,m=l._gUMSilentTrackWorkaround,P=l._log,C=l.mediaStreamTrack.kind;P.info("Re-acquiring the MediaStreamTrack"),P.debug("Constraints:",b);var M=Object.assign({audio:!1,video:!1},(g={},g[C]=b,g)),D=this._workaroundWebKitBug1208516Cleanup?m(P,f,M):f(M);return D.then(function(O){return O.getTracks()[0]})},T.prototype._reemitTrackSenderEvents=function(){var b=this;this._eventsToReemitters.forEach(function(g,l){return b._trackSender.on(l,g)}),this._trackSender.dequeue("muted"),this._trackSender.dequeue("unmuted")},T.prototype._restart=function(b){var g=this,l=this._log;return b=b||this._constraints,this._stop(),this._reacquireTrack(b).catch(function(f){throw l.error("Failed to re-acquire the MediaStreamTrack:",{error:f,constraints:b}),f}).then(function(f){return l.info("Re-acquired the MediaStreamTrack"),l.debug("MediaStreamTrack:",f),g._constraints=Object.assign({},b),g._setMediaStreamTrack(f)})},T.prototype._setMediaStreamTrack=function(b){var g=this;return b.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then(function(){g._unprocessedTrack=b}):this._trackSender.setMediaStreamTrack(b).catch(function(l){g._log.warn("setMediaStreamTrack failed:",{error:l,mediaStreamTrack:b})})).then(function(){g._initialize(),g._getAllAttachedElements().forEach(function(l){return g._attach(l)})})},T.prototype._stop=function(){return this.mediaStreamTrack.stop(),this._end(),this},T.prototype.enable=function(b){return b=typeof b=="boolean"?b:!0,b!==this.mediaStreamTrack.enabled&&(this._log.info((b?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=b,this.emit(b?"enabled":"disabled",this)),this},T.prototype.disable=function(){return this.enable(!1)},T.prototype.restart=function(b){var g=this,l=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(n("restart","can only be called on a"+(" Local"+i(l)+"Track that is created using createLocalTracks")+(" or createLocal"+i(l)+"Track.")));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var f=this._restart(b);return this._workaroundWebKitBug1208516&&(f=f.finally(function(){g._workaroundWebKitBug1208516Cleanup=h(g)})),f},T.prototype.stop=function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()},T}(S)}function h(S){var L=S._log,T=S.kind,b=S._noiseCancellation,g={audio:a,video:o}[T],l=function(){return b?b.sourceTrack:S.mediaStreamTrack},f=S._dummyEl,m=l(),P=null;function C(){return f.play().then(function(){return g(f)}).then(function(U){return U?L.warn("Silence detected"):L.info("Non-silence detected"),U}).catch(function(U){L.warn("Failed to detect silence:",U)}).finally(function(){S.processedTrack||f.pause()})}function M(){var U=S._workaroundWebKitBug1208516Cleanup,G=S.isStopped,F=G&&!!U,N=l().muted;return Promise.resolve().then(function(){return document.visibilityState==="visible"&&!P&&(N||F||C())})}function D(){return Promise.race([t(m,"unmute"),r(50)]).then(function(){return M()}).then(function(U){U&&!P&&(P=e(),S._restart().finally(function(){f=S._dummyEl,E(),m=l(),x(),P.resolve(),P=null}).catch(function(F){L.error("failed to restart track: ",F)}));var G=P&&P.promise||Promise.resolve();return G.finally(function(){return d.resolveDeferred(T)})}).catch(function(U){L.error("error in maybeRestart: "+U.message)})}function O(){var U=S._log,G=S.kind;U.info("Muted"),U.debug("LocalMediaTrack:",S),d.startDeferred(G)}function x(){m.addEventListener?(m.addEventListener("ended",D),m.addEventListener("mute",O),m.addEventListener("unmute",D)):(m.onended=D,m.onmute=O,m.onunmute=D)}function E(){m.removeEventListener?(m.removeEventListener("ended",D),m.removeEventListener("mute",O),m.removeEventListener("unmute",D)):(m.onended=null,m.onmute=null,m.onunmute=null)}var q=function(U){return U?D():!1};return c.onVisibilityChange(1,q),x(),function(){c.offVisibilityChange(1,q),E()}}return Kt=y,Kt}var zt,xa;function yu(){if(xa)return zt;xa=1;var k=zt&&zt.__extends||function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(c[v]=d[v])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function c(){this.constructor=a}a.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}}(),p=Rt().isIOS,_=uc(),s=qe().isIOSChrome,i=fc(),e=gc(),r=e(i),t=function(n){k(a,n);function a(o,c){var d=this,v=c?.noiseCancellation||null;d=n.call(this,o,c)||this;var u=d._log,y=o.label,h=y===void 0?"":y,S=o.getSettings(),L=S.deviceId,T=L===void 0?"":L,b=S.groupId,g=b===void 0?"":b;return Object.defineProperties(d,{_currentDefaultDeviceInfo:{value:{deviceId:T,groupId:g,label:h},writable:!0},_enumerateDevices:{value:typeof c?.enumerateDevices=="function"?c.enumerateDevices:navigator.mediaDevices.enumerateDevices},_defaultDeviceCaptureMode:{value:(!p()||v)&&d._isCreatedByCreateLocalTracks&&typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.addEventListener=="function"&&(typeof c?.enumerateDevices=="function"||typeof navigator.mediaDevices.enumerateDevices=="function")?c?.defaultDeviceCaptureMode||"auto":"manual"},_onDeviceChange:{value:function(){d._enumerateDevices().then(function(l){var f=l.find(function(m){var P=m.deviceId,C=m.kind;return C==="audioinput"&&P!=="default"});f&&["deviceId","groupId"].some(function(m){return f[m]!==d._currentDefaultDeviceInfo[m]})&&(u.info("Default device changed, restarting the LocalAudioTrack"),u.debug('Old default device: "'+d._currentDefaultDeviceInfo.deviceId+'" => "'+d._currentDefaultDeviceInfo.label+'"'),u.debug('New default device: "'+f.deviceId+'" => "'+f.label+'"'),d._currentDefaultDeviceInfo=f,d._restartDefaultDevice().catch(function(m){return u.warn("Failed to restart: "+m.message)}))},function(l){u.warn("Failed to run enumerateDevices(): "+l.message)})}},_restartOnDefaultDeviceChangeCleanup:{value:null,writable:!0},noiseCancellation:{enumerable:!0,value:v,writable:!1}}),u.debug("defaultDeviceCaptureMode:",d._defaultDeviceCaptureMode),d._maybeRestartOnDefaultDeviceChange(),d}return a.prototype.toString=function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"},a.prototype.attach=function(o){return o=n.prototype.attach.call(this,o),o.muted=!0,o},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._maybeRestartOnDefaultDeviceChange=function(){var o=this,c=this,d=c._constraints,v=c._defaultDeviceCaptureMode,u=c._log,y=this.noiseCancellation?this.noiseCancellation.sourceTrack:this.mediaStreamTrack,h=y.getSettings().deviceId,S=function(T){return T!==h||T==="default"},L=function T(b){return b===void 0&&(b={}),typeof b=="string"?S(b):Array.isArray(b)?b.every(S):b.exact?T(b.exact):b.ideal?T(b.ideal):!0}(d.deviceId);v==="auto"&&L?this._restartOnDefaultDeviceChangeCleanup||(u.info("LocalAudioTrack will be restarted if the default device changes"),navigator.mediaDevices.addEventListener("devicechange",this._onDeviceChange),this._restartOnDefaultDeviceChangeCleanup=function(){u.info("Cleaning up the listener to restart the LocalAudioTrack if the default device changes"),navigator.mediaDevices.removeEventListener("devicechange",o._onDeviceChange),o._restartOnDefaultDeviceChangeCleanup=null}):(u.info("LocalAudioTrack will NOT be restarted if the default device changes"),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup())},a.prototype._reacquireTrack=function(o){var c=this;return this._log.debug("_reacquireTrack: ",o),this.noiseCancellation?this.noiseCancellation.reacquireTrack(function(){return n.prototype._reacquireTrack.call(c,o)}):n.prototype._reacquireTrack.call(this,o)},a.prototype._restartDefaultDevice=function(){var o=this,c=Object.assign({},this._constraints),d=Object.assign({},c,{deviceId:this._currentDefaultDeviceInfo.deviceId});return this.restart(d).then(function(){o._constraints=c,o._maybeRestartOnDefaultDeviceChange()})},a.prototype._setMediaStreamTrack=function(o){var c=this,d=this,v=d._log,u=d.noiseCancellation,y=n.prototype._setMediaStreamTrack.call(this,o);return s()&&u&&(v.debug("iOS Chrome detected, checking if the restarted Krisp audio is silent"),y=y.then(function(){return _(c._dummyEl)}).then(function(h){return v.debug("Krisp audio is "+(h?"silent, using source audio":"not silent")),h&&u.disablePermanently().then(function(){return n.prototype._setMediaStreamTrack.call(c,u.sourceTrack)})})),y},a.prototype.disable=function(){return n.prototype.disable.apply(this,arguments)},a.prototype.enable=function(){return n.prototype.enable.apply(this,arguments)},a.prototype.restart=function(){return n.prototype.restart.apply(this,arguments)},a.prototype.stop=function(){return this.noiseCancellation&&this.noiseCancellation.stop(),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup(),n.prototype.stop.apply(this,arguments)},a}(r);return zt=t,zt}var Hn,Aa;function gu(){if(Aa)return Hn;Aa=1;var k=Ri(),p=yu();function _(s,i){var e=new p(s,i);return Object.setPrototypeOf(e,_.prototype),e}return k(_,p),Hn=_,Hn}var Yt,Ma;function bu(){if(Ma)return Yt;Ma=1;var k=Yt&&Yt.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(o)throw o.error}}return a},p=Oe().DEFAULT_FRAME_RATE;function _(i,e){var r=k(i.srcObject.getVideoTracks(),1),t=r[0],n=t.getSettings().frameRate,a=n===void 0?p:n,o,c=new ReadableStream({start:function(v){o=setInterval(function(){return v.enqueue()},1e3/a)}}),d=new TransformStream({transform:function(){return e()}});return c.pipeThrough(d).pipeTo(new WritableStream).then(function(){}),function(){clearInterval(o)}}function s(i,e,r){var t=k(i.srcObject.getVideoTracks(),1),n=t[0],a=new MediaStreamTrackProcessor({track:n}).readable,o=new MediaStreamTrackGenerator({kind:"video"}),c=!1,d=new TransformStream({transform:function(v,u){var y=r==="videoframe"?e(v):Promise.resolve(v.close()).then(e);return y.finally(function(){c&&u.terminate()})}});return a.pipeThrough(d).pipeTo(o.writable).then(function(){}),function(){c=!0}}return Yt=typeof MediaStreamTrackGenerator=="function"&&typeof MediaStreamTrackProcessor=="function"?s:_,Yt}var Jt,Ia;function ku(){if(Ia)return Jt;Ia=1;var k=Jt&&Jt.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Ue().EventEmitter,_=Oe().DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,s=function(i){k(e,i);function e(r){var t=i.call(this)||this;return Object.defineProperties(t,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:r},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),t.on("add",function(n){t._lastStatsSaveTime=Date.now(),t._lastStatsPublishTime=Date.now(),t._processorInfo=n,t._stats=[],t._reemitEvent("add",t._getEventData())}),t.on("remove",function(){var n=t._getEventData();t._lastStatsSaveTime=null,t._lastStatsPublishTime=null,t._processorInfo=null,t._stats=null,t._reemitEvent("remove",n)}),t.on("start",function(){t._reemitEvent("start",t._getEventData())}),t.on("stop",function(n){t._reemitEvent("stop",Object.assign({message:n},t._getEventData()))}),t.on("stats",function(){return t._maybeEmitStats()}),t}return e.prototype._getEventData=function(){if(!this._processorInfo)return{};var r=this._processorInfo,t=r.processor,n=r.captureHeight,a=r.captureWidth,o=r.inputFrameRate,c=r.isRemoteVideoTrack,d=r.inputFrameBufferType,v=r.outputFrameBufferContextType,u={captureHeight:n,captureWidth:a,inputFrameRate:o,isRemoteVideoTrack:c,inputFrameBufferType:d,outputFrameBufferContextType:v};return u.name=t._name||"VideoProcessor",["assetsPath","blurFilterRadius","debounce","fitType","isSimdEnabled","maskBlurRadius","pipeline","version"].forEach(function(y){var h=t["_"+y];typeof h<"u"&&(u[y]=h)}),Object.keys(u).forEach(function(y){var h=u[y];typeof h=="boolean"&&(u[y]=h?"true":"false")}),u},e.prototype._maybeEmitStats=function(){if(!(!this._stats||!this._processorInfo)){var r=this._processorInfo.processor._benchmark;if(r){var t=Date.now();if(!(t-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:r.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach(function(c){n[c]=r.getAverageDelay(c)}),this._lastStatsSaveTime=t,this._stats.push(n),!(t-this._lastStatsPublishTime<_)){this._lastStatsPublishTime=t;var a=this._stats.splice(0),o=a.reduce(function(c,d,v){return Object.keys(n).forEach(function(u){c[u]||(c[u]=0),c[u]=(c[u]*v+d[u])/(v+1)}),c},{});Object.keys(o).forEach(function(c){o[c]=parseFloat(o[c].toFixed(2))}),this._reemitEvent("stats",Object.assign({},o,this._getEventData()))}}}}},e.prototype._reemitEvent=function(r,t){this._log.debug("VideoProcessor:"+r,t),this.emit("event",{name:r,data:t})},e}(p);return Jt=s,Jt}var Xt,Da;function bc(){if(Da)return Xt;Da=1;var k=Xt&&Xt.__extends||function(){var t=function(n,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])},t(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");t(n,a);function o(){this.constructor=n}n.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}}(),p=dc(),_=bu(),s=ku();qe().guessBrowser;var i=Oe().DEFAULT_FRAME_RATE,e=function(t){k(n,t);function n(a,o){var c=t.call(this,a,o)||this;return Object.defineProperties(c,{_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_processorOptions:{value:{},writable:!0},_stopCapture:{value:function(){},writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0}}),c._processorEventObserver=new(o.VideoProcessorEventObserver||s)(c._log),c}return n.prototype._checkIfCanCaptureFrames=function(a){a===void 0&&(a=!1);var o=!0,c="",d=this.mediaStreamTrack,v=d.enabled,u=d.readyState;return v||(o=!1,c="MediaStreamTrack is disabled"),u==="ended"&&(o=!1,c="MediaStreamTrack is ended"),this.processor||(o=!1,c="VideoProcessor not detected."),!this._attachments.size&&!a&&(o=!1,c="VideoTrack is not publishing and there is no attached element."),c&&this._log.debug(c),{canCaptureFrames:o,message:c}},n.prototype._captureFrames=function(){var a=this;if(this._isCapturing){this._log.debug("Ignoring captureFrames call. Capture is already in progress");return}if(!this._checkIfCanCaptureFrames().canCaptureFrames){this._isCapturing=!1,this._log.debug("Cannot capture frames. Ignoring captureFrames call.");return}this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var o=this._processorOptions.inputFrameBufferType;this._dummyEl.play().then(function(){var c=function(d){var v=a._checkIfCanCaptureFrames();if(!v.canCaptureFrames)return d&&d.close(),a._isCapturing=!1,a._stopCapture(),a._processorEventObserver.emit("stop",v.message),a._log.debug("Cannot capture frames. Stopping capturing frames."),Promise.resolve();var u=a.mediaStreamTrack.getSettings(),y=u.width,h=y===void 0?0:y,S=u.height,L=S===void 0?0:S;a._outputFrame&&a._outputFrame.width!==h&&(a._outputFrame.width=h,a._outputFrame.height=L),a._inputFrame&&(a._inputFrame.width!==h&&(a._inputFrame.width=h,a._inputFrame.height=L),a._inputFrame.getContext("2d").drawImage(a._dummyEl,0,0,h,L));var T=d||(["video","videoframe"].includes(o)?a._dummyEl:a._inputFrame),b=null;try{b=a.processor.processFrame(T,a._outputFrame)}catch(g){a._log.debug("Exception detected after calling processFrame.",g)}return(b instanceof Promise?b:Promise.resolve(b)).then(function(){a._outputFrame&&(typeof a.processedTrack.requestFrame=="function"&&a.processedTrack.requestFrame(),a._processorEventObserver.emit("stats"))})};a._stopCapture=_(a._dummyEl,c,o)}).catch(function(c){return a._log.error("Video element cannot be played",{error:c,track:a})})},n.prototype._initialize=function(){var a=this;t.prototype._initialize.call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){r(a,a._dummyEl)&&(a.dimensions.width=a._dummyEl.videoWidth,a.dimensions.height=a._dummyEl.videoHeight)},this._dummyEl.onresize=function(){r(a,a._dummyEl)&&(a.dimensions.width=a._dummyEl.videoWidth,a.dimensions.height=a._dummyEl.videoHeight,a.isStarted&&(a._log.debug("Dimensions changed:",a.dimensions),a.emit(n.DIMENSIONS_CHANGED,a)))})},n.prototype._restartProcessor=function(){var a=this.processor;if(a){var o=Object.assign({},this._processorOptions);this.removeProcessor(a),this.addProcessor(a,o)}},n.prototype._start=function(a){return this.dimensions.width=a.videoWidth,this.dimensions.height=a.videoHeight,this._log.debug("Dimensions:",this.dimensions),this.emit(n.DIMENSIONS_CHANGED,this),t.prototype._start.call(this,a)},n.prototype.addProcessor=function(a,o){var c=this;if(!a||typeof a.processFrame!="function")throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",a),this._unmuteHandler||(this._unmuteHandler=function(){c._log.debug("mediaStreamTrack unmuted"),c.processedTrack.muted&&(c._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),c._restartProcessor())},this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler):this.mediaStreamTrack.onunmute=this._unmuteHandler.bind(this)),this._processorOptions=o||{};var d=this._processorOptions,v=d.inputFrameBufferType,u=d.outputFrameBufferContextType;if(typeof OffscreenCanvas>"u"&&v==="offscreencanvas")throw new Error("OffscreenCanvas is not supported by this browser.");if(v&&v!=="videoframe"&&v!=="video"&&v!=="canvas"&&v!=="offscreencanvas")throw new Error("Invalid inputFrameBufferType of "+v);v||(v=typeof OffscreenCanvas>"u"?"canvas":"offscreencanvas");var y=this.mediaStreamTrack.getSettings(),h=y.width,S=h===void 0?0:h,L=y.height,T=L===void 0?0:L,b=y.frameRate,g=b===void 0?i:b;v==="offscreencanvas"&&(this._inputFrame=new OffscreenCanvas(S,T)),v==="canvas"&&(this._inputFrame=document.createElement("canvas")),this._inputFrame&&(this._inputFrame.width=S,this._inputFrame.height=T),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=S,this._outputFrame.height=T,u=u||"2d";var l=this._outputFrame.getContext(u);if(!l)throw new Error("Cannot get outputFrameBufferContextType: "+u+".");var f=typeof CanvasCaptureMediaStreamTrack<"u"&&CanvasCaptureMediaStreamTrack.prototype&&typeof CanvasCaptureMediaStreamTrack.prototype.requestFrame=="function"?0:void 0;return this.processedTrack=this._outputFrame.captureStream(f).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=a,this._processorEventObserver.emit("add",{processor:a,captureHeight:T,captureWidth:S,inputFrameRate:g,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack"),inputFrameBufferType:v,outputFrameBufferContextType:u}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this},n.prototype.attach=function(){var a=t.prototype.attach.apply(this,arguments);return this.processor&&this._captureFrames(),a},n.prototype.detach=function(){return t.prototype.detach.apply(this,arguments)},n.prototype.removeProcessor=function(a){if(!a)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(a!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",a),this._stopCapture(),this._stopCapture=function(){},this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._processorOptions={},this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this},n}(p);e.DIMENSIONS_CHANGED="dimensionsChanged";function r(t,n){return t.dimensions.width!==n.videoWidth||t.dimensions.height!==n.videoHeight}return Xt=e,Xt}var Zt,ja;function Su(){if(ja)return Zt;ja=1;var k=Zt&&Zt.__extends||function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(c[v]=d[v])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function c(){this.constructor=a}a.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}}(),p=Rt().isIOS,_=vc(),s=gc(),i=bc(),e=s(i),r=function(n){k(a,n);function a(o,c){var d=this;return c=Object.assign({workaroundSilentLocalVideo:p()&&typeof document<"u"&&typeof document.createElement=="function"},c),d=n.call(this,o,c)||this,Object.defineProperties(d,{_workaroundSilentLocalVideo:{value:c.workaroundSilentLocalVideo?t:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0}}),d._workaroundSilentLocalVideo&&(d._workaroundSilentLocalVideoCleanup=d._workaroundSilentLocalVideo(d,document)),d}return a.prototype.toString=function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"},a.prototype._checkIfCanCaptureFrames=function(){return n.prototype._checkIfCanCaptureFrames.call(this,this._trackSender.isPublishing)},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._setSenderMediaStreamTrack=function(o){var c=this,d=this.mediaStreamTrack,v=o?this.processedTrack:d;return this._trackSender.setMediaStreamTrack(v).catch(function(u){return c._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:u,mediaStreamTrack:v})}).then(function(){c._unprocessedTrack=o?d:null})},a.prototype.addProcessor=function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var o=n.prototype.addProcessor.apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),o):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")},a.prototype.removeProcessor=function(){var o=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var c=n.prototype.removeProcessor.apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then(function(){return o._updateElementsMediaStreamTrack()}),c},a.prototype.disable=function(){var o=n.prototype.disable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),o},a.prototype.enable=function(o){o===void 0&&(o=!0);var c=n.prototype.enable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=o,o&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),c},a.prototype.restart=function(){var o=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var c=n.prototype.restart.apply(this,arguments);return this.processor&&c.then(function(){o._restartProcessor()}),this._workaroundSilentLocalVideo&&c.finally(function(){o._workaroundSilentLocalVideoCleanup=o._workaroundSilentLocalVideo(o,document)}),c},a.prototype.stop=function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),n.prototype.stop.apply(this,arguments)},a}(e);function t(n,a){var o=n._log,c=n._dummyEl,d=n.mediaStreamTrack;function v(){n.isEnabled&&(o.info("Unmuted, checking silence"),c.play().then(function(){return _(c,a)}).then(function(u){if(!u){o.info("Non-silent frames detected, so no need to restart");return}return o.warn("Silence detected, restarting"),n._stop(),n._restart()}).catch(function(u){o.warn("Failed to detect silence and restart:",u)}).finally(function(){c=n._dummyEl,c&&!c.paused&&!n.processedTrack&&c.pause(),d.removeEventListener("unmute",v),d=n.mediaStreamTrack,d.addEventListener?d.addEventListener("unmute",v):d.onunmute=v}))}return d.addEventListener?d.addEventListener("unmute",v):d.onunmute=v,function(){d.removeEventListener?d.removeEventListener("unmute",v):d.onunmute=null}}return Zt=r,Zt}var Gn,Na;function Tu(){if(Na)return Gn;Na=1;var k=Ri(),p=Su();function _(s,i){var e=new p(s,i);return Object.setPrototypeOf(e,_.prototype),e}return k(_,p),Gn=_,Gn}var er,qa;function kc(){if(qa)return er;qa=1;var k=er&&er.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=_c(),_=function(s){k(i,s);function i(e,r,t,n){var a=s.call(this,e,"data")||this;return Object.defineProperties(a,{maxPacketLifeTime:{enumerable:!0,value:r},maxRetransmits:{enumerable:!0,value:t},ordered:{enumerable:!0,value:n}}),a}return i}(p);return er=_,er}var tr,Va;function wu(){if(Va)return tr;Va=1;var k=tr&&tr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=kc(),_=Ce().makeUUID,s=function(i){k(e,i);function e(r,t,n){var a=i.call(this,_(),r,t,n)||this;return Object.defineProperties(a,{_clones:{value:new Set},_dataChannels:{value:new Set}}),a}return e.prototype._addClone=function(r){this._clones.add(r)},e.prototype.removeClone=function(r){this._clones.delete(r)},e.prototype.addDataChannel=function(r){return this._dataChannels.add(r),this},e.prototype.clone=function(){var r=this,t=new e(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(t),t.once("stopped",function(){return r.removeClone(t)}),t},e.prototype.removeDataChannel=function(r){return this._dataChannels.delete(r),this},e.prototype.send=function(r){return this._dataChannels.forEach(function(t){try{t.send(r)}catch{}}),this._clones.forEach(function(t){try{t.send(r)}catch{}}),this},e.prototype.stop=function(){this._dataChannels.forEach(function(r){return r.close()}),this._clones.forEach(function(r){return r.stop()}),i.prototype.stop.call(this)},e}(p);return tr=s,tr}var rr,Fa;function Eu(){if(Fa)return rr;Fa=1;var k=rr&&rr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Li(),_=wu(),s=function(i){k(e,i);function e(r){var t=this;r=Object.assign({DataTrackSender:_,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},r);var n=r.DataTrackSender,a=new n(r.maxPacketLifeTime,r.maxRetransmits,r.ordered);return t=i.call(this,a.id,"data",r)||this,Object.defineProperties(t,{_trackSender:{value:a},id:{enumerable:!0,value:a.id},maxPacketLifeTime:{enumerable:!0,value:r.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:r.maxRetransmits},ordered:{enumerable:!0,value:r.ordered},reliable:{enumerable:!0,value:r.maxPacketLifeTime===null&&r.maxRetransmits===null}}),t}return e.prototype.send=function(r){this._trackSender.send(r)},e}(p);return rr=s,rr}var Qn,Ba;function Pu(){if(Ba)return Qn;Ba=1;var k=Ri(),p=Eu();function _(s){var i=new p(s);return Object.setPrototypeOf(i,_.prototype),i}return k(_,p),Qn=_,Qn}var $n,Ua;function It(){return Ua||(Ua=1,$n={LocalAudioTrack:gu(),LocalVideoTrack:Tu(),LocalDataTrack:Pu()}),$n}var Wa;function Cu(){if(Wa)return Fe;Wa=1;var k=Fe&&Fe.__assign||function(){return k=Object.assign||function(l){for(var f,m=1,P=arguments.length;m<P;m++){f=arguments[m];for(var C in f)Object.prototype.hasOwnProperty.call(f,C)&&(l[C]=f[C])}return l},k.apply(this,arguments)},p=Fe&&Fe.__awaiter||function(l,f,m,P){function C(M){return M instanceof m?M:new m(function(D){D(M)})}return new(m||(m=Promise))(function(M,D){function O(q){try{E(P.next(q))}catch(U){D(U)}}function x(q){try{E(P.throw(q))}catch(U){D(U)}}function E(q){q.done?M(q.value):C(q.value).then(O,x)}E((P=P.apply(l,f||[])).next())})},_=Fe&&Fe.__generator||function(l,f){var m={label:0,sent:function(){if(M[0]&1)throw M[1];return M[1]},trys:[],ops:[]},P,C,M,D;return D={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function O(E){return function(q){return x([E,q])}}function x(E){if(P)throw new TypeError("Generator is already executing.");for(;m;)try{if(P=1,C&&(M=E[0]&2?C.return:E[0]?C.throw||((M=C.return)&&M.call(C),0):C.next)&&!(M=M.call(C,E[1])).done)return M;switch(C=0,M&&(E=[E[0]&2,M.value]),E[0]){case 0:case 1:M=E;break;case 4:return m.label++,{value:E[1],done:!1};case 5:m.label++,C=E[1],E=[0];continue;case 7:E=m.ops.pop(),m.trys.pop();continue;default:if(M=m.trys,!(M=M.length>0&&M[M.length-1])&&(E[0]===6||E[0]===2)){m=0;continue}if(E[0]===3&&(!M||E[1]>M[0]&&E[1]<M[3])){m.label=E[1];break}if(E[0]===6&&m.label<M[1]){m.label=M[1],M=E;break}if(M&&m.label<M[2]){m.label=M[2],m.ops.push(E);break}M[2]&&m.ops.pop(),m.trys.pop();continue}E=f.call(l,m)}catch(q){E=[6,q],C=0}finally{P=M=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=Fe&&Fe.__read||function(l,f){var m=typeof Symbol=="function"&&l[Symbol.iterator];if(!m)return l;var P=m.call(l),C,M=[],D;try{for(;(f===void 0||f-- >0)&&!(C=P.next()).done;)M.push(C.value)}catch(O){D={error:O}}finally{try{C&&!C.done&&(m=P.return)&&m.call(P)}finally{if(D)throw D.error}}return M},i=Fe&&Fe.__spreadArray||function(l,f){for(var m=0,P=f.length,C=l.length;m<P;m++,C++)l[C]=f[m];return l};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.createLocalTracks=void 0;var e=su(),r=Ce().buildLogLevels,t=Ot(),n=t.getUserMedia,a=t.MediaStreamTrack,o=It(),c=o.LocalAudioTrack,d=o.LocalDataTrack,v=o.LocalVideoTrack,u=ze(),y=Oe(),h=y.DEFAULT_LOG_LEVEL,S=y.DEFAULT_LOGGER_NAME,L=y.typeErrors.INVALID_VALUE,T=pc(),b=0;function g(l){return p(this,void 0,void 0,function(){var f,m,P,C,M,D,O,x,E,q,U,G,F,N=this;return _(this,function(A){switch(A.label){case 0:if(f=!(l&&("audio"in l||"video"in l)),m=k({audio:f,getUserMedia:n,loggerName:S,logLevel:h,LocalAudioTrack:c,LocalDataTrack:d,LocalVideoTrack:v,MediaStreamTrack:a,Log:u,video:f},l),P="[createLocalTracks #"+ ++b+"]",C=r(m.logLevel),M=new m.Log("default",P,C,m.loggerName),D=Object.assign({log:M},m),delete D.name,m.audio===!1&&m.video===!1)return M.info("Neither audio nor video requested, so returning empty LocalTracks"),[2,[]];if(m.tracks)return M.info("Adding user-provided LocalTracks"),M.debug("LocalTracks:",m.tracks),[2,m.tracks];if(O={audio:typeof m.audio=="object"&&m.audio.name?{name:m.audio.name}:{defaultDeviceCaptureMode:"auto"},video:typeof m.video=="object"&&m.video.name?{name:m.video.name}:{}},O.audio.isCreatedByCreateLocalTracks=!0,O.video.isCreatedByCreateLocalTracks=!0,typeof m.audio=="object")if(typeof m.audio.workaroundWebKitBug1208516=="boolean"&&(O.audio.workaroundWebKitBug1208516=m.audio.workaroundWebKitBug1208516),"noiseCancellationOptions"in m.audio&&(x=m.audio.noiseCancellationOptions,delete m.audio.noiseCancellationOptions),!("defaultDeviceCaptureMode"in m.audio))O.audio.defaultDeviceCaptureMode="auto";else{if(["auto","manual"].every(function(w){return w!==m.audio.defaultDeviceCaptureMode}))throw L("CreateLocalAudioTrackOptions.defaultDeviceCaptureMode",["auto","manual"]);O.audio.defaultDeviceCaptureMode=m.audio.defaultDeviceCaptureMode}typeof m.video=="object"&&typeof m.video.workaroundWebKitBug1208516=="boolean"&&(O.video.workaroundWebKitBug1208516=m.video.workaroundWebKitBug1208516),typeof m.audio=="object"&&delete m.audio.name,typeof m.video=="object"&&delete m.video.name,E={audio:m.audio,video:m.video},q=typeof m.audio=="object"&&m.audio.workaroundWebKitBug180748,A.label=1;case 1:return A.trys.push([1,4,,5]),[4,q?T(M,m.getUserMedia,E):m.getUserMedia(E)];case 2:return U=A.sent(),G=i(i([],s(U.getAudioTracks())),s(U.getVideoTracks())),M.info("Call to getUserMedia successful; got tracks:",G),[4,Promise.all(G.map(function(w){return p(N,void 0,void 0,function(){var j,Q,Y;return _(this,function($){switch($.label){case 0:return w.kind==="audio"&&x?[4,e.applyNoiseCancellation(w,x,M)]:[3,2];case 1:return j=$.sent(),Q=j.cleanTrack,Y=j.noiseCancellation,[2,new D.LocalAudioTrack(Q,k(k(k({},O.audio),D),{noiseCancellation:Y}))];case 2:if(w.kind==="audio")return[2,new D.LocalAudioTrack(w,k(k({},O.audio),D))];$.label=3;case 3:return[2,new D.LocalVideoTrack(w,k(k({},O.video),D))]}})})}))];case 3:return[2,A.sent()];case 4:throw F=A.sent(),M.warn("Call to getUserMedia failed:",F),F;case 5:return[2]}})})}return Fe.createLocalTracks=g,Fe}var Be={},nr={},Ha;function Ou(){if(Ha)return nr;Ha=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.Timer=void 0;var k=function(){function p(){this._end=void 0,this.start()}return p.prototype.start=function(){return this._start=Date.now(),this},p.prototype.stop=function(){return this._end=Date.now(),this},p.prototype.getTimeMeasurement=function(){return{start:this._start,end:this._end,duration:this._end===void 0?void 0:this._end-this._start}},p}();return nr.Timer=k,nr}var kt={},Ga;function Ru(){if(Ga)return kt;Ga=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.mosToScore=kt.calculateMOS=void 0;var k=94.768;function p(s,i,e){var r=s+i*2+10,t=0;switch(!0){case r<160:t=k-r/40;break;case r<1e3:t=k-(r-120)/10;break}switch(!0){case e<=t/2.5:t=Math.max(t-e*2.5,6.52);break;default:t=0;break}var n=1+.035*t+7e-6*t*(t-60)*(100-t);return n}kt.calculateMOS=p;function _(s){var i=0;return s?s>4.2?i=5:s>4?i=4:s>3.6?i=3:s>3?i=2:i=1:i=0,i}return kt.mosToScore=_,kt}var Ke={},Qa;function Lu(){if(Qa)return Ke;Qa=1;var k=Ke&&Ke.__awaiter||function(t,n,a,o){function c(d){return d instanceof a?d:new a(function(v){v(d)})}return new(a||(a=Promise))(function(d,v){function u(S){try{h(o.next(S))}catch(L){v(L)}}function y(S){try{h(o.throw(S))}catch(L){v(L)}}function h(S){S.done?d(S.value):c(S.value).then(u,y)}h((o=o.apply(t,n||[])).next())})},p=Ke&&Ke.__generator||function(t,n){var a={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},o,c,d,v;return v={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function u(h){return function(S){return y([h,S])}}function y(h){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,c&&(d=h[0]&2?c.return:h[0]?c.throw||((d=c.return)&&d.call(c),0):c.next)&&!(d=d.call(c,h[1])).done)return d;switch(c=0,d&&(h=[h[0]&2,d.value]),h[0]){case 0:case 1:d=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,c=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(d=a.trys,!(d=d.length>0&&d[d.length-1])&&(h[0]===6||h[0]===2)){a=0;continue}if(h[0]===3&&(!d||h[1]>d[0]&&h[1]<d[3])){a.label=h[1];break}if(h[0]===6&&a.label<d[1]){a.label=d[1],d=h;break}if(d&&a.label<d[2]){a.label=d[2],a.ops.push(h);break}d[2]&&a.ops.pop(),a.trys.pop();continue}h=n.call(t,a)}catch(S){h=[6,S],c=0}finally{o=d=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},_=Ke&&Ke.__read||function(t,n){var a=typeof Symbol=="function"&&t[Symbol.iterator];if(!a)return t;var o=a.call(t),c,d=[],v;try{for(;(n===void 0||n-- >0)&&!(c=o.next()).done;)d.push(c.value)}catch(u){v={error:u}}finally{try{c&&!c.done&&(a=o.return)&&a.call(o)}finally{if(v)throw v.error}}return d};Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.getCombinedConnectionStats=void 0;function s(t,n,a,o){var c=[];return t.forEach(function(d){(o.length===0||o.includes(d.type))&&(a.length===0||a.includes(d.kind))&&typeof d[n]=="number"&&c.push(d[n])}),c}function i(t){var n=t.publisher,a=t.subscriber;return k(this,void 0,void 0,function(){var o,c,d,v,u,y,h,S,L,T,b,g,l,f,m;return p(this,function(P){switch(P.label){case 0:return[4,Promise.all([n,a].map(function(C){return C.getStats()}))];case 1:return o=_.apply(void 0,[P.sent(),2]),c=o[0],d=o[1],v=s(d,"timestamp",["audio"],["inbound-rtp"]),u=v.length>0?v[0]:0,y=s(d,"jitter",["audio"],["inbound-rtp"]).reduce(function(C,M){return Math.max(C,M)},0),h=s(d,"packetsReceived",["audio","video"],["inbound-rtp"]).reduce(function(C,M){return C+M},0),S=s(d,"packetsLost",["audio","video"],["inbound-rtp"]).reduce(function(C,M){return C+M},0),L=s(c,"roundTripTime",["audio","video"],["remote-inbound-rtp"]).reduce(function(C,M){return Math.max(C,M)},0),T=s(d,"currentRoundTripTime",[],["candidate-pair"]).reduce(function(C,M){return Math.max(C,M)},0),b=(T||L)*1e3,g=s(c,"bytesSent",[],["candidate-pair"]).reduce(function(C,M){return C+M},0),l=s(d,"bytesReceived",[],["candidate-pair"]).reduce(function(C,M){return C+M},0),f=r(d),m=[],d.forEach(function(C){(C.type==="local-candidate"||C.type==="remote-candidate")&&m.push(e(C))}),[2,{timestamp:u,jitter:y,packets:h,packetsLost:S,roundTripTime:b,bytesSent:g,bytesReceived:l,selectedIceCandidatePairStats:f,iceCandidateStats:m}]}})})}Ke.getCombinedConnectionStats=i;function e(t){var n=[{key:"transportId",type:"string"},{key:"candidateType",type:"string"},{key:"port",altKeys:["portNumber"],type:"number"},{key:"address",altKeys:["ip","ipAddress"],type:"string"},{key:"priority",type:"number"},{key:"protocol",altKeys:["transport"],type:"string"},{key:"url",type:"string"},{key:"relayProtocol",type:"string"}];return n.reduce(function(a,o){var c=[o.key];o.altKeys&&(c=c.concat(o.altKeys));var d=c.find(function(v){return v in t});return d&&typeof t[d]===o.type&&(a[o.key]=t[d]),a},{})}function r(t){var n=null,a=[];t.forEach(function(u){u.type==="transport"&&u.selectedCandidatePairId?n=u.selectedCandidatePairId:u.type==="candidate-pair"&&a.push(u)});var o=a.find(function(u){return u.selected||n&&u.id===n});if(!o)return null;var c=o,d=t.get(c.localCandidateId),v=t.get(c.remoteCandidateId);return!d||!v?null:{localCandidate:e(d),remoteCandidate:e(v)}}return Ke}var ir={},rt,$a;function Dt(){if($a)return rt;$a=1;var k=rt&&rt.__extends||function(){var d=function(v,u){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,h){y.__proto__=h}||function(y,h){for(var S in h)Object.prototype.hasOwnProperty.call(h,S)&&(y[S]=h[S])},d(v,u)};return function(v,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");d(v,u);function y(){this.constructor=v}v.prototype=u===null?Object.create(u):(y.prototype=u.prototype,new y)}}(),p=rt&&rt.__read||function(d,v){var u=typeof Symbol=="function"&&d[Symbol.iterator];if(!u)return d;var y=u.call(d),h,S=[],L;try{for(;(v===void 0||v-- >0)&&!(h=y.next()).done;)S.push(h.value)}catch(T){L={error:T}}finally{try{h&&!h.done&&(u=y.return)&&u.call(y)}finally{if(L)throw L.error}}return S},_=rt&&rt.__spreadArray||function(d,v){for(var u=0,y=v.length,h=d.length;u<y;u++,h++)d[h]=v[u];return d},s=Ue().EventEmitter,i=Ce(),e=function(d){k(v,d);function v(u,y){var h=d.call(this)||this,S=null,L=u;return y=o(y),Object.defineProperties(h,{_lock:{get:function(){return S},set:function(T){S=T}},_reachableStates:{value:n(y)},_state:{get:function(){return L},set:function(T){L=T}},_states:{value:y},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return S!==null}},state:{enumerable:!0,get:function(){return L}}}),h.on("stateChanged",function(T){h._whenDeferreds.forEach(function(b){b.when(T,b.resolve,b.reject)})}),h}return v.prototype._whenPromise=function(u){var y=this;if(typeof u!="function")return Promise.reject(new Error("when() executor must be a function"));var h=i.defer();return h.when=u,this._whenDeferreds.add(h),h.promise.then(function(S){return y._whenDeferreds.delete(h),S},function(S){throw y._whenDeferreds.delete(h),S})},v.prototype.bracket=function(u,y){var h,S=this;function L(T){if(S.hasLock(h)&&S.releaseLockCompletely(h),T)throw T}return this.takeLock(u).then(function(b){return h=b,y(h)}).then(function(b){return L(),b},L)},v.prototype.hasLock=function(u){return this._lock===u},v.prototype.preempt=function(u,y,h){if(!r(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');var S;this.isLocked&&(S=this._lock,this._lock=null);var L=null;y&&(L=this.takeLockSync(y));var T=L?null:this.takeLockSync("preemption");return this.transition(u,L||T,h),S&&S.resolve(),T&&this.releaseLock(T),L},v.prototype.releaseLock=function(u){if(this.isLocked){if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock")}else throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");u.depth===0?(this._lock=null,u.resolve()):u.depth--},v.prototype.releaseLockCompletely=function(u){if(this.isLocked){if(!this.hasLock(u))throw new Error("Could not release the lock for "+u.name+" because "+this._lock.name+" has the lock")}else throw new Error("Could not release the lock for "+u.name+" because the StateMachine is not locked");u.depth=0,this._lock=null,u.resolve()},v.prototype.takeLock=function(u){var y=this;if(typeof u=="object"){var h=u;return new Promise(function(T){T(y.takeLockSync(h))})}var S=u;if(this.isLocked){var L=this.takeLock.bind(this,S);return this._lock.promise.then(L)}return Promise.resolve(this.takeLockSync(S))},v.prototype.takeLockSync=function(u){var y=typeof u=="string"?null:u,h=y?y.name:u;if(y&&!this.hasLock(y)||!y&&this.isLocked)throw new Error("Could not take the lock for "+h+" because the lock for "+this._lock.name+" was not released");if(y)return y.depth++,y;var S=t(h);return this._lock=S,S},v.prototype.transition=function(u,y,h){if(h=h||[],this.isLocked)if(y){if(!this.hasLock(y))throw new Error("Could not transition using the key for "+y.name+" because "+this._lock.name+" has the lock")}else throw new Error("You must provide the key in order to transition");else if(y)throw new Error("Key provided for "+y.name+", but the StateMachine was not locked (possibly due to preemption)");if(!r(this._states,this.state,u))throw new Error('Cannot transition from "'+this.state+'" to "'+u+'"');this._state=u,this.emit.apply(this,_([],p(["stateChanged",u].concat(h))))},v.prototype.tryTransition=function(u,y,h){try{this.transition(u,y,h)}catch{return!1}return!0},v.prototype.when=function(u){var y=this;return this.state===u?Promise.resolve(this):r(this._reachableStates,this.state,u)?this._whenPromise(function(h,S,L){h===u?S(y):r(y._reachableStates,h,u)||L(c(h,u))}):Promise.reject(c(this.state,u))},v}(s);function r(d,v,u){return d.get(v).has(u)}function t(d){var v=i.defer();return v.name=d,v.depth=0,v}function n(d){return Array.from(d.keys()).reduce(function(v,u){return v.set(u,a(d,u))},new Map)}function a(d,v,u){return u=u||new Set,d.get(v).forEach(function(y){u.has(y)||(u.add(y),a(d,y,u).forEach(u.add,u))}),u}function o(d){var v=new Map;for(var u in d)v.set(u,new Set(d[u]));return v}function c(d,v){return new Error('"'+v+'" cannot be reached from "'+d+'"')}return rt=e,rt}var Kn,Ka;function xu(){if(Ka)return Kn;Ka=1;var k=function(){function p(_,s){var i=this;s=Object.assign({navigator,window},s);var e=s.navigator,r=e.connection||{type:null},t=r.type,n=r.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var d=t!==i.type&&i.isOnline;t=i.type,d&&_()}},_target:{value:r}}:{_events:{value:["online"]},_listener:{value:_},_target:{value:s.window}},a=n._events,o=n._listener,c=n._target;Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return typeof e.onLine=="boolean"?e.onLine:!0}},type:{enumerable:!0,get:function(){return r.type||null}},_listener:o,_events:a,_target:c})}return p.prototype.start=function(){var _=this;this._events.forEach(function(s){_._target.addEventListener(s,_._listener)})},p.prototype.stop=function(){var _=this;this._events.forEach(function(s){_._target.removeEventListener(s,_._listener)})},p}();return Kn=k,Kn}var zn,za;function Lt(){if(za)return zn;za=1;var k=function(){function p(_,s,i){i===void 0&&(i=!0),Object.defineProperties(this,{_delay:{value:s,writable:!0},_fn:{value:_},_timeout:{value:null,writable:!0}}),i&&this.start()}return Object.defineProperty(p.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isSet",{get:function(){return!!this._timeout},enumerable:!1,configurable:!0}),p.prototype.setDelay=function(_){this._delay=_},p.prototype.start=function(){var _=this;this.isSet||(this._timeout=setTimeout(function(){var s=_._fn;_.clear(),s()},this._delay))},p.prototype.clear=function(){clearTimeout(this._timeout),this._timeout=null},p.prototype.reset=function(){this.clear(),this.start()},p}();return zn=k,zn}var Yn,Ya;function Sc(){return Ya||(Ya=1,Yn=WebSocket),Yn}var nt,Ja;function Tc(){if(Ja)return nt;Ja=1;var k=nt&&nt.__extends||function(){var G=function(F,N){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,w){A.__proto__=w}||function(A,w){for(var j in w)Object.prototype.hasOwnProperty.call(w,j)&&(A[j]=w[j])},G(F,N)};return function(F,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");G(F,N);function A(){this.constructor=F}F.prototype=N===null?Object.create(N):(A.prototype=N.prototype,new A)}}(),p=nt&&nt.__read||function(G,F){var N=typeof Symbol=="function"&&G[Symbol.iterator];if(!N)return G;var A=N.call(G),w,j=[],Q;try{for(;(F===void 0||F-- >0)&&!(w=A.next()).done;)j.push(w.value)}catch(Y){Q={error:Y}}finally{try{w&&!w.done&&(N=A.return)&&N.call(A)}finally{if(Q)throw Q.error}}return j},_=nt&&nt.__spreadArray||function(G,F){for(var N=0,A=F.length,w=G.length;N<A;N++,w++)G[w]=F[N];return G},s=Dt(),i=Ce(),e=i.buildLogLevels,r=i.makeUUID,t=ze(),n=xu(),a=Lt(),o=0,c={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},d={closed:"close",open:"open",waiting:"waiting"},v=2,u=3,y=3,h=5e3,S=15e3,L=5e3,T=200,b=1e3,g=3e3,l=3001,f=3002,m=3003,P=3004,C=3005,M=3006,D=3007,O=globalThis,x=O.WebSocket?O.WebSocket:Sc(),E={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},q=new Map([[g,E.TIMEOUT],[l,E.TIMEOUT],[f,E.FAILED],[m,E.FAILED],[P,E.TIMEOUT],[M,E.BUSY],[D,E.TIMEOUT]]),U=function(G){k(F,G);function F(N,A){var w=G.call(this,"early",c)||this;A=Object.assign({helloBody:null,maxConsecutiveFailedHellos:y,maxConsecutiveMissedHeartbeats:u,requestedHeartbeatTimeout:h,openTimeout:S,welcomeTimeout:L,Log:t,WebSocket:x},A);var j=e(A.logLevel),Q=new A.Log("default",w,j,A.loggerName),Y=A.networkMonitor?new n(function(){var z=Y.type,ne="Network changed"+(z?" to "+z:"");Q.debug(ne),w._close({code:P,reason:ne})}):null;Object.defineProperties(w,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:A.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:A.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++o},_log:{value:Q},_messageQueue:{value:[]},_networkMonitor:{value:Y},_options:{value:A},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:N},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var $={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return w.on("stateChanged",function(z){for(var ne=[],oe=1;oe<arguments.length;oe++)ne[oe-1]=arguments[oe];z in d&&w.emit.apply(w,_([d[z]],p(ne)));var ve={name:z,group:"signaling",level:$[w.state]};if(z==="closed"){var le=p(ne,1),de=le[0];ve.payload={reason:de},ve.level=de===E.LOCAL?"info":"error"}w._eventObserver.emit("event",ve)}),w._eventObserver.emit("event",{name:w.state,group:"signaling",level:$[w.state]}),w._connect(),w}return F.prototype.toString=function(){return"[TwilioConnection #"+this._instanceId+": "+this._ws.url+"]"},F.prototype._close=function(N){var A=N.code,w=N.reason;if(this.state!=="closed"){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&A!==C&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var j=this._log;A===b?(j.debug("Closed"),this.transition("closed",null,[E.LOCAL])):(j.warn("Closed: "+A+" - "+w),A!==C&&this.transition("closed",null,[q.get(A)||E.REMOTE]));var Q=this._ws.readyState,Y=this._options.WebSocket;Q!==Y.CLOSING&&Q!==Y.CLOSED&&this._ws.close(A,w)}},F.prototype._connect=function(){var N=this,A=this._log;if(this.state==="waiting")this.transition("early");else if(this.state!=="early"){A.warn('Unexpected state "'+this.state+'" for connecting to the TCMP server.');return}this._ws=new this._options.WebSocket(this._serverUrl);var w=this._ws;A.debug("Created a new WebSocket:",w),w.addEventListener("close",function(Q){return N._close(Q)});var j=this._options.openTimeout;this._openTimeout=new a(function(){var Q="Failed to open in "+j+" ms";N._close({code:D,reason:Q})},j),w.addEventListener("open",function(){A.debug("WebSocket opened:",w),N._openTimeout.clear(),N._startHandshake(),N._networkMonitor&&N._networkMonitor.start()}),w.addEventListener("message",function(Q){A.debug("Incoming: "+Q.data);try{Q=JSON.parse(Q.data)}catch(Y){N.emit("error",Y);return}switch(Q.type){case"bad":N._handleBad(Q);break;case"busy":N._handleBusy(Q);break;case"bye":break;case"msg":N._handleMessage(Q);case"heartbeat":N._handleHeartbeat();break;case"welcome":N._handleWelcome(Q);break;default:N._log.debug("Unknown message type: "+Q.type),N.emit("error",new Error("Unknown message type: "+Q.type));break}})},F.prototype._handleBad=function(N){var A=N.reason,w=this._log;if(!["connecting","open"].includes(this.state)){w.warn('Unexpected state "'+this.state+'" for handling a "bad" message from the TCMP server.');return}if(this.state==="connecting"){w.warn("Closing: "+f+" - "+A),this._close({code:f,reason:A});return}w.debug("Error: "+A),this.emit("error",new Error(A))},F.prototype._handleBusy=function(N){var A=this,w=N.cookie,j=N.keepAlive,Q=N.retryAfter,Y=this._log;if(!["connecting","waiting"].includes(this.state)){Y.warn('Unexpected state "'+this.state+'" for handling a "busy" message from the TCMP server.');return}this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var $=Q<0?'Received terminal "busy" message':'Received "busy" message, retrying after '+Q+" ms";if(Q<0){Y.warn("Closing: "+M+" - "+$),this._close({code:M,reason:$});return}var z=this._options.maxConsecutiveFailedHellos;this._hellosLeft=z,this._cookie=w||null,j?(Y.warn($),this._busyWaitTimeout=new a(function(){return A._startHandshake()},Q)):(Y.warn("Closing: "+C+" - "+$),this._close({code:C,reason:$}),this._busyWaitTimeout=new a(function(){return A._connect()},Q)),this.transition("waiting",null,[j,Q])},F.prototype._handleHeartbeat=function(){if(this.state!=="open"){this._log.warn('Unexpected state "'+this.state+'" for handling a "heartbeat" message from the TCMP server.');return}this._heartbeatTimeout.reset()},F.prototype._handleHeartbeatTimeout=function(){if(this.state==="open"){var N=this._log,A=this._options.maxConsecutiveMissedHeartbeats;N.debug("Consecutive heartbeats missed: "+A);var w="Missed "+A+' "heartbeat" messages';N.warn("Closing: "+l+" - "+w),this._close({code:l,reason:w})}},F.prototype._handleMessage=function(N){var A=N.body;if(this.state!=="open"){this._log.warn('Unexpected state "'+this.state+'" for handling a "msg" message from the TCMP server.');return}this.emit("message",A)},F.prototype._handleWelcome=function(N){var A=this,w=N.negotiatedTimeout,j=this._log;if(!["connecting","waiting"].includes(this.state)){j.warn('Unexpected state "'+this.state+'" for handling a "welcome" message from the TCMP server.');return}this.state==="waiting"&&(j.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var Q=this._options.maxConsecutiveMissedHeartbeats,Y=w*Q,$=w-T;this._welcomeTimeout.clear(),this._heartbeatTimeout=new a(function(){return A._handleHeartbeatTimeout()},Y),this._messageQueue.splice(0).forEach(function(z){return A._send(z)}),this._sendHeartbeatTimeout=new a(function(){return A._sendHeartbeat()},$),this.transition("open")},F.prototype._handleWelcomeTimeout=function(){if(this.state==="connecting"){var N=this._log;if(this._hellosLeft<=0){var A="All handshake attempts failed";N.warn("Closing: "+g+" - "+A),this._close({code:g,reason:A});return}var w=this._options.maxConsecutiveFailedHellos;N.warn("Handshake attempt "+(w-this._hellosLeft)+" failed"),this._startHandshake()}},F.prototype._send=function(N){var A=this._ws.readyState,w=this._options.WebSocket;if(A===w.OPEN){var j=JSON.stringify(N);this._log.debug("Outgoing: "+j);try{this._ws.send(j),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch{var Q="Failed to send message";this._log.warn("Closing: "+m+" - "+Q),this._close({code:m,reason:Q})}}},F.prototype._sendHeartbeat=function(){this.state!=="closed"&&this._send({type:"heartbeat"})},F.prototype._sendHello=function(){var N=this._options,A=N.helloBody,w=N.requestedHeartbeatTimeout,j={id:r(),timeout:w,type:"hello",version:v};this._cookie&&(j.cookie=this._cookie),A&&(j.body=A),this._send(j)},F.prototype._sendOrEnqueue=function(N){var A=this;if(this.state!=="closed"){var w=this.state==="open"?function(j){return A._send(j)}:function(j){return A._messageQueue.push(j)};w(N)}},F.prototype._startHandshake=function(){var N=this;if(["early","waiting"].includes(this.state)&&this.transition("connecting"),this.state==="connecting"){this._hellosLeft--,this._sendHello();var A=this._options.welcomeTimeout;this._welcomeTimeout=new a(function(){return N._handleWelcomeTimeout()},A)}},F.prototype.close=function(){this.state!=="closed"&&(this._sendOrEnqueue({type:"bye"}),this._close({code:b,reason:"Normal"}))},F.prototype.sendMessage=function(N){this._sendOrEnqueue({body:N,type:"msg"})},F}(s);return U.CloseReason=E,nt=U,nt}var pe={},it,Xa;function Au(){if(Xa)return it;Xa=1;var k=it&&it.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=it&&it.__read||function(i,e){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var t=r.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)a.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=t.return)&&r.call(t)}finally{if(o)throw o.error}}return a},_=it&&it.__spreadArray||function(i,e){for(var r=0,t=e.length,n=i.length;r<t;r++,n++)i[n]=e[r];return i},s=function(i){k(e,i);function e(r){var t=this,n=[].slice.call(arguments,1);t=i.apply(this,_([],p(n)))||this,Object.setPrototypeOf(t,e.prototype);var a=Error.apply(t,n);return a.name="TwilioError",Object.defineProperty(t,"code",{value:r,enumerable:!0}),Object.getOwnPropertyNames(a).forEach(function(o){Object.defineProperty(this,o,{value:a[o],enumerable:!0})},t),t}return e.prototype.toString=function(){var r=this.message?": "+this.message:"";return this.name+" "+this.code+r},e}(Error);return it=s,it}var Za;function ht(){if(Za)return pe;Za=1;var k=pe&&pe.__extends||function(){var I=function(R,B){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ae,fe){ae.__proto__=fe}||function(ae,fe){for(var me in fe)Object.prototype.hasOwnProperty.call(fe,me)&&(ae[me]=fe[me])},I(R,B)};return function(R,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");I(R,B);function ae(){this.constructor=R}R.prototype=B===null?Object.create(B):(ae.prototype=B.prototype,new ae)}}(),p=Au(),_={};pe.createTwilioError=function(R,B){return R=typeof R=="number"?R:0,B=typeof B=="string"&&B?B:"Unknown error",_[R]?new _[R]:new p(R,B)};var s=function(I){k(R,I);function R(){var B=I.call(this,20101,"Invalid Access Token")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.AccessTokenInvalidError=s,Object.defineProperty(_,20101,{value:s});var i=function(I){k(R,I);function R(){var B=I.call(this,20102,"Invalid Access Token header")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.AccessTokenHeaderInvalidError=i,Object.defineProperty(_,20102,{value:i});var e=function(I){k(R,I);function R(){var B=I.call(this,20103,"Invalid Access Token issuer/subject")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.AccessTokenIssuerInvalidError=e,Object.defineProperty(_,20103,{value:e});var r=function(I){k(R,I);function R(){var B=I.call(this,20104,"Access Token expired or expiration date invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.AccessTokenExpiredError=r,Object.defineProperty(_,20104,{value:r});var t=function(I){k(R,I);function R(){var B=I.call(this,20105,"Access Token not yet valid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.AccessTokenNotYetValidError=t,Object.defineProperty(_,20105,{value:t});var n=function(I){k(R,I);function R(){var B=I.call(this,20106,"Invalid Access Token grants")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.AccessTokenGrantsInvalidError=n,Object.defineProperty(_,20106,{value:n});var a=function(I){k(R,I);function R(){var B=I.call(this,20107,"Invalid Access Token signature")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.AccessTokenSignatureInvalidError=a,Object.defineProperty(_,20107,{value:a});var o=function(I){k(R,I);function R(){var B=I.call(this,53e3,"Signaling connection error")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.SignalingConnectionError=o,Object.defineProperty(_,53e3,{value:o});var c=function(I){k(R,I);function R(){var B=I.call(this,53001,"Signaling connection disconnected")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.SignalingConnectionDisconnectedError=c,Object.defineProperty(_,53001,{value:c});var d=function(I){k(R,I);function R(){var B=I.call(this,53002,"Signaling connection timed out")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.SignalingConnectionTimeoutError=d,Object.defineProperty(_,53002,{value:d});var v=function(I){k(R,I);function R(){var B=I.call(this,53003,"Client received an invalid signaling message")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.SignalingIncomingMessageInvalidError=v,Object.defineProperty(_,53003,{value:v});var u=function(I){k(R,I);function R(){var B=I.call(this,53004,"Client sent an invalid signaling message")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.SignalingOutgoingMessageInvalidError=u,Object.defineProperty(_,53004,{value:u});var y=function(I){k(R,I);function R(){var B=I.call(this,53006,"Video server is busy")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.SignalingServerBusyError=y,Object.defineProperty(_,53006,{value:y});var h=function(I){k(R,I);function R(){var B=I.call(this,53100,"Room name is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomNameInvalidError=h,Object.defineProperty(_,53100,{value:h});var S=function(I){k(R,I);function R(){var B=I.call(this,53101,"Room name is too long")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomNameTooLongError=S,Object.defineProperty(_,53101,{value:S});var L=function(I){k(R,I);function R(){var B=I.call(this,53102,"Room name contains invalid characters")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomNameCharsInvalidError=L,Object.defineProperty(_,53102,{value:L});var T=function(I){k(R,I);function R(){var B=I.call(this,53103,"Unable to create Room")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomCreateFailedError=T,Object.defineProperty(_,53103,{value:T});var b=function(I){k(R,I);function R(){var B=I.call(this,53104,"Unable to connect to Room")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomConnectFailedError=b,Object.defineProperty(_,53104,{value:b});var g=function(I){k(R,I);function R(){var B=I.call(this,53105,"Room contains too many Participants")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomMaxParticipantsExceededError=g,Object.defineProperty(_,53105,{value:g});var l=function(I){k(R,I);function R(){var B=I.call(this,53106,"Room not found")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomNotFoundError=l,Object.defineProperty(_,53106,{value:l});var f=function(I){k(R,I);function R(){var B=I.call(this,53107,"MaxParticipants is out of range")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomMaxParticipantsOutOfRangeError=f,Object.defineProperty(_,53107,{value:f});var m=function(I){k(R,I);function R(){var B=I.call(this,53108,"RoomType is not valid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomTypeInvalidError=m,Object.defineProperty(_,53108,{value:m});var P=function(I){k(R,I);function R(){var B=I.call(this,53109,"Timeout is out of range")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomTimeoutOutOfRangeError=P,Object.defineProperty(_,53109,{value:P});var C=function(I){k(R,I);function R(){var B=I.call(this,53110,"StatusCallbackMethod is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomStatusCallbackMethodInvalidError=C,Object.defineProperty(_,53110,{value:C});var M=function(I){k(R,I);function R(){var B=I.call(this,53111,"StatusCallback is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomStatusCallbackInvalidError=M,Object.defineProperty(_,53111,{value:M});var D=function(I){k(R,I);function R(){var B=I.call(this,53112,"Status is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomStatusInvalidError=D,Object.defineProperty(_,53112,{value:D});var O=function(I){k(R,I);function R(){var B=I.call(this,53113,"Room exists")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomRoomExistsError=O,Object.defineProperty(_,53113,{value:O});var x=function(I){k(R,I);function R(){var B=I.call(this,53114,"Room creation parameter(s) incompatible with the Room type")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomInvalidParametersError=x,Object.defineProperty(_,53114,{value:x});var E=function(I){k(R,I);function R(){var B=I.call(this,53115,"MediaRegion is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomMediaRegionInvalidError=E,Object.defineProperty(_,53115,{value:E});var q=function(I){k(R,I);function R(){var B=I.call(this,53116,"There are no media servers available in the MediaRegion")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomMediaRegionUnavailableError=q,Object.defineProperty(_,53116,{value:q});var U=function(I){k(R,I);function R(){var B=I.call(this,53117,"The subscription operation requested is not supported for the Room type")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomSubscriptionOperationNotSupportedError=U,Object.defineProperty(_,53117,{value:U});var G=function(I){k(R,I);function R(){var B=I.call(this,53118,"Room completed")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomCompletedError=G,Object.defineProperty(_,53118,{value:G});var F=function(I){k(R,I);function R(){var B=I.call(this,53124,"The AudioOnly flag is not supported for the Room type")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomAudioOnlyFlagNotSupportedError=F,Object.defineProperty(_,53124,{value:F});var N=function(I){k(R,I);function R(){var B=I.call(this,53125,"The track kind is not supported by the Room")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.RoomTrackKindNotSupportedError=N,Object.defineProperty(_,53125,{value:N});var A=function(I){k(R,I);function R(){var B=I.call(this,53200,"Participant identity is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.ParticipantIdentityInvalidError=A,Object.defineProperty(_,53200,{value:A});var w=function(I){k(R,I);function R(){var B=I.call(this,53201,"Participant identity is too long")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.ParticipantIdentityTooLongError=w,Object.defineProperty(_,53201,{value:w});var j=function(I){k(R,I);function R(){var B=I.call(this,53202,"Participant identity contains invalid characters")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.ParticipantIdentityCharsInvalidError=j,Object.defineProperty(_,53202,{value:j});var Q=function(I){k(R,I);function R(){var B=I.call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.ParticipantMaxTracksExceededError=Q,Object.defineProperty(_,53203,{value:Q});var Y=function(I){k(R,I);function R(){var B=I.call(this,53204,"Participant not found")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.ParticipantNotFoundError=Y,Object.defineProperty(_,53204,{value:Y});var $=function(I){k(R,I);function R(){var B=I.call(this,53205,"Participant disconnected because of duplicate identity")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.ParticipantDuplicateIdentityError=$,Object.defineProperty(_,53205,{value:$});var z=function(I){k(R,I);function R(){var B=I.call(this,53300,"Track is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.TrackInvalidError=z,Object.defineProperty(_,53300,{value:z});var ne=function(I){k(R,I);function R(){var B=I.call(this,53301,"Track name is invalid")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.TrackNameInvalidError=ne,Object.defineProperty(_,53301,{value:ne});var oe=function(I){k(R,I);function R(){var B=I.call(this,53302,"Track name is too long")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.TrackNameTooLongError=oe,Object.defineProperty(_,53302,{value:oe});var ve=function(I){k(R,I);function R(){var B=I.call(this,53303,"Track name contains invalid characters")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.TrackNameCharsInvalidError=ve,Object.defineProperty(_,53303,{value:ve});var le=function(I){k(R,I);function R(){var B=I.call(this,53304,"Track name is duplicated")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.TrackNameIsDuplicatedError=le,Object.defineProperty(_,53304,{value:le});var de=function(I){k(R,I);function R(){var B=I.call(this,53305,"The server has reached capacity and cannot fulfill this request")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.TrackServerTrackCapacityReachedError=de,Object.defineProperty(_,53305,{value:de});var ee=function(I){k(R,I);function R(){var B=I.call(this,53400,"Client is unable to create or apply a local media description")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.MediaClientLocalDescFailedError=ee,Object.defineProperty(_,53400,{value:ee});var se=function(I){k(R,I);function R(){var B=I.call(this,53401,"Server is unable to create or apply a local media description")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.MediaServerLocalDescFailedError=se,Object.defineProperty(_,53401,{value:se});var ie=function(I){k(R,I);function R(){var B=I.call(this,53402,"Client is unable to apply a remote media description")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.MediaClientRemoteDescFailedError=ie,Object.defineProperty(_,53402,{value:ie});var Z=function(I){k(R,I);function R(){var B=I.call(this,53403,"Server is unable to apply a remote media description")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.MediaServerRemoteDescFailedError=Z,Object.defineProperty(_,53403,{value:Z});var he=function(I){k(R,I);function R(){var B=I.call(this,53404,"No supported codec")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.MediaNoSupportedCodecError=he,Object.defineProperty(_,53404,{value:he});var ue=function(I){k(R,I);function R(){var B=I.call(this,53405,"Media connection failed or Media activity ceased")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.MediaConnectionError=ue,Object.defineProperty(_,53405,{value:ue});var ye=function(I){k(R,I);function R(){var B=I.call(this,53407,"Media connection failed due to DTLS handshake failure")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.MediaDTLSTransportFailedError=ye,Object.defineProperty(_,53407,{value:ye});var W=function(I){k(R,I);function R(){var B=I.call(this,53500,"Unable to acquire configuration")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);pe.ConfigurationAcquireFailedError=W,Object.defineProperty(_,53500,{value:W});var K=function(I){k(R,I);function R(){var B=I.call(this,53501,"Unable to acquire TURN credentials")||this;return Object.setPrototypeOf(B,R.prototype),B}return R}(p);return pe.ConfigurationAcquireTurnFailedError=K,Object.defineProperty(_,53501,{value:K}),pe}var eo;function Mu(){if(eo)return ir;eo=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.getTurnCredentials=void 0;var k=Tc(),p=Oe().ICE_VERSION,_=ht(),s=_.createTwilioError,i=_.SignalingConnectionError,e=Ue();function r(t,n){return new Promise(function(a,o){var c=new e.EventEmitter,d={networkMonitor:null,eventObserver:c,helloBody:{edge:"roaming",preflight:!0,token:t,type:"ice",version:p}},v=new k(n,d),u=!1;v.once("close",function(){u||(u=!0,o(new i))}),v.on("message",function(y){var h=y.code,S=y.message,L=y.ice_servers,T=y.type;(T==="iced"||T==="error")&&!u&&(u=!0,T==="iced"?a(L):o(s(h,S)),v.close())})})}return ir.getTurnCredentials=r,ir}var at={},to;function Iu(){if(to)return at;to=1;var k=at&&at.__read||function(s,i){var e=typeof Symbol=="function"&&s[Symbol.iterator];if(!e)return s;var r=e.call(s),t,n=[],a;try{for(;(i===void 0||i-- >0)&&!(t=r.next()).done;)n.push(t.value)}catch(o){a={error:o}}finally{try{t&&!t.done&&(e=r.return)&&e.call(r)}finally{if(a)throw a.error}}return n},p=at&&at.__spreadArray||function(s,i){for(var e=0,r=i.length,t=s.length;e<r;e++,t++)s[t]=i[e];return s};Object.defineProperty(at,"__esModule",{value:!0}),at.makeStat=void 0;function _(s){if(s&&s.length){var i=Math.min.apply(Math,p([],k(s))),e=Math.max.apply(Math,p([],k(s))),r=s.reduce(function(t,n){return t+n},0)/s.length;return{min:i,max:e,average:r}}return null}return at.makeStat=_,at}var ar={},ro;function Du(){if(ro)return ar;ro=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.syntheticAudio=void 0;function k(){var p=Tn(),_={},s=p.getOrCreate(_),i=s.createOscillator(),e=i.connect(s.createMediaStreamDestination());i.start();var r=e.stream.getAudioTracks()[0],t=r.stop;return r.stop=function(){t.call(r),p.release(_)},r}return ar.syntheticAudio=k,ar}var or={},no;function ju(){if(no)return or;no=1,Object.defineProperty(or,"__esModule",{value:!0}),or.syntheticVideo=void 0;function k(p){var _=p===void 0?{}:p,s=_.width,i=s===void 0?640:s,e=_.height,r=e===void 0?480:e,t=Object.assign(document.createElement("canvas"),{width:i,height:r}),n=t.getContext("2d");n.fillStyle="green",n.fillRect(0,0,t.width,t.height);var a=!1;requestAnimationFrame(function v(){if(!a){var u=Math.round(Math.random()*255),y=Math.round(Math.random()*255),h=Math.round(Math.random()*255),S=Math.round(Math.random()*255);n.fillStyle="rgba("+u+", "+y+", "+h+", "+S+")",n.fillRect(Math.random()*i,Math.random()*r,50,50),requestAnimationFrame(v)}});var o=t.captureStream(30),c=o.getTracks()[0],d=c.stop;return c.stop=function(){a=!0,d.call(c)},c}return or.syntheticVideo=k,or}var Jn,io;function wc(){if(io)return Jn;io=1;var k=function(){function p(){Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return p.prototype.get=function(){var _=this._samples,s=_[1].denominator-_[0].denominator||1/0,i=_[1].numerator-_[0].numerator;return i/s},p.prototype.putSample=function(_,s){var i=this._samples;i.shift(),i.push({denominator:s,numerator:_})},p}();return Jn=k,Jn}var sr,ao;function Ec(){if(ao)return sr;ao=1;var k=sr&&sr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=Ue().EventEmitter,_=["signaling","room","media","quality","video-processor","preflight"],s=["debug","error","info","warning"],i=function(e){k(r,e);function r(t,n,a,o){o===void 0&&(o=null);var c=e.call(this)||this;return c.on("event",function(d){var v=d.name,u=d.group,y=d.level,h=d.payload;if(typeof v!="string")throw a.error("Unexpected name: ",v),new Error("Unexpected name: ",v);if(!_.includes(u))throw a.error("Unexpected group: ",u),new Error("Unexpected group: ",u);if(!s.includes(y))throw a.error("Unexpected level: ",y),new Error("Unexpected level: ",y);var S=Date.now(),L=S-n,T=Object.assign({elapsedTime:L,level:y},h||{});t.publish(u,v,T);var b=Object.assign({elapsedTime:L,group:u,level:y,name:v,timestamp:S},h?{payload:h}:{}),g={debug:"debug",error:"error",info:"info",warning:"warn"}[y];a[g]("event",b),o&&u==="signaling"&&o.emit("event",b)}),c}return r}(p);return sr=i,sr}var St,oo;function Pc(){if(oo)return St;oo=1;var k=St&&St.__extends||function(){var T=function(b,g){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,f){l.__proto__=f}||function(l,f){for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(l[m]=f[m])},T(b,g)};return function(b,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");T(b,g);function l(){this.constructor=b}b.prototype=g===null?Object.create(g):(l.prototype=g.prototype,new l)}}(),p=St&&St.__assign||function(){return p=Object.assign||function(T){for(var b,g=1,l=arguments.length;g<l;g++){b=arguments[g];for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(T[f]=b[f])}return T},p.apply(this,arguments)},_=Ue().EventEmitter,s=Ce().getUserAgent,i=5,e=50,r=1e3,t=globalThis,n=t.WebSocket?t.WebSocket:Sc(),a=Oe(),o=a.hardwareDevicePublisheriPad,c=a.hardwareDevicePublisheriPhone,d=Ce(),v=Rt(),u=function(T){k(b,T);function b(g,l,f,m,P,C){var M=T.call(this)||this;return C=Object.assign({gateway:h(m,P)+"/v1/VideoEvents",maxReconnectAttempts:i,reconnectIntervalMs:e,userAgent:s(),WebSocket:n},C),Object.defineProperties(M,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:d.defer()},_reconnectAttemptsLeft:{value:C.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:C.WebSocket}}),M._readyToConnect.promise.then(function(D){var O=D.roomSid,x=D.participantSid,E=M;M.on("disconnected",function q(U){if(E._session=null,U&&E._reconnectAttemptsLeft>0){E.emit("reconnecting"),L(E,g,l,f,O,x,C);return}E.removeListener("disconnected",q)}),y(M,g,l,f,O,x,C)}).catch(function(){}),M}return b.prototype.connect=function(g,l){this._readyToConnect.resolve({roomSid:g,participantSid:l})},b.prototype._publish=function(g){g.session=this._session,this._ws.send(JSON.stringify(g))},b.prototype.disconnect=function(){if(this._ws===null||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch{}return this.emit("disconnected"),!0},b.prototype.publish=function(g,l,f){if(this._ws!==null&&(this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED))return!1;var m=typeof this._session=="string"?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue);return m({group:g,name:l,payload:f,timestamp:Date.now(),type:"event",version:1}),!0},b}(_);function y(T,b,g,l,f,m,P){T._connectTimestamp=Date.now(),T._reconnectAttemptsLeft--,T._ws=new P.WebSocket(P.gateway);var C=T._ws;C.addEventListener("close",function(M){if(M.code===r){T.emit("disconnected");return}T.emit("disconnected",new Error("WebSocket Error "+M.code+": "+M.reason))}),C.addEventListener("message",function(M){S(T,JSON.parse(M.data),P)}),C.addEventListener("open",function(){var M={type:"connect",token:b,version:1};M.publisher={name:g,sdkVersion:l,userAgent:P.userAgent,participantSid:m,roomSid:f},v.isIpad()?M.publisher=p(p({},M.publisher),o):v.isIphone()&&(M.publisher=p(p({},M.publisher),c)),C.send(JSON.stringify(M))})}function h(T,b){return T==="prod"?"wss://sdkgw."+b+".twilio.com":"wss://sdkgw."+T+"-"+b+".twilio.com"}function S(T,b,g){switch(b.type){case"connected":T._session=b.session,T._reconnectAttemptsLeft=g.maxReconnectAttempts,T._eventQueue.splice(0).forEach(T._publish,T),T.emit("connected");break;case"error":T._ws.close(),T.emit("disconnected",new Error(b.message));break}}function L(T,b,g,l,f,m,P){var C=Date.now()-T._connectTimestamp,M=P.reconnectIntervalMs-C;if(M>0){setTimeout(function(){y(T,b,g,l,f,m,P)},M);return}y(T,b,g,l,f,m,P)}return St=u,St}var so;function Nu(){if(so)return Be;so=1;var k=Be&&Be.__extends||function(){var U=function(G,F){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,A){N.__proto__=A}||function(N,A){for(var w in A)Object.prototype.hasOwnProperty.call(A,w)&&(N[w]=A[w])},U(G,F)};return function(G,F){if(typeof F!="function"&&F!==null)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");U(G,F);function N(){this.constructor=G}G.prototype=F===null?Object.create(F):(N.prototype=F.prototype,new N)}}(),p=Be&&Be.__assign||function(){return p=Object.assign||function(U){for(var G,F=1,N=arguments.length;F<N;F++){G=arguments[F];for(var A in G)Object.prototype.hasOwnProperty.call(G,A)&&(U[A]=G[A])}return U},p.apply(this,arguments)},_=Be&&Be.__awaiter||function(U,G,F,N){function A(w){return w instanceof F?w:new F(function(j){j(w)})}return new(F||(F=Promise))(function(w,j){function Q(z){try{$(N.next(z))}catch(ne){j(ne)}}function Y(z){try{$(N.throw(z))}catch(ne){j(ne)}}function $(z){z.done?w(z.value):A(z.value).then(Q,Y)}$((N=N.apply(U,G||[])).next())})},s=Be&&Be.__generator||function(U,G){var F={label:0,sent:function(){if(w[0]&1)throw w[1];return w[1]},trys:[],ops:[]},N,A,w,j;return j={next:Q(0),throw:Q(1),return:Q(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function Q($){return function(z){return Y([$,z])}}function Y($){if(N)throw new TypeError("Generator is already executing.");for(;F;)try{if(N=1,A&&(w=$[0]&2?A.return:$[0]?A.throw||((w=A.return)&&w.call(A),0):A.next)&&!(w=w.call(A,$[1])).done)return w;switch(A=0,w&&($=[$[0]&2,w.value]),$[0]){case 0:case 1:w=$;break;case 4:return F.label++,{value:$[1],done:!1};case 5:F.label++,A=$[1],$=[0];continue;case 7:$=F.ops.pop(),F.trys.pop();continue;default:if(w=F.trys,!(w=w.length>0&&w[w.length-1])&&($[0]===6||$[0]===2)){F=0;continue}if($[0]===3&&(!w||$[1]>w[0]&&$[1]<w[3])){F.label=$[1];break}if($[0]===6&&F.label<w[1]){F.label=w[1],w=$;break}if(w&&F.label<w[2]){F.label=w[2],F.ops.push($);break}w[2]&&F.ops.pop(),F.trys.pop();continue}$=G.call(U,F)}catch(z){$=[6,z],A=0}finally{N=w=0}if($[0]&5)throw $[1];return{value:$[0]?$[1]:void 0,done:!0}}};Object.defineProperty(Be,"__esModule",{value:!0}),Be.runPreflight=Be.PreflightTest=void 0;var i=Oe(),e=Ou(),r=Ru(),t=Lu(),n=Mu(),a=Iu(),o=Du(),c=ju(),d=Ce(),v=Oe().WS_SERVER,u=ze(),y=ln(),h=wc(),S=Ec(),L=Pc(),T=rc(),b=T.createSID,g=T.sessionSID,l=ht(),f=l.SignalingConnectionTimeoutError,m=l.MediaConnectionError,P=1e3,C=10*P,M={mediaAcquired:"mediaAcquired",connected:"connected",mediaSubscribed:"mediaSubscribed",mediaStarted:"mediaStarted",dtlsConnected:"dtlsConnected",peerConnectionConnected:"peerConnectionConnected",iceConnected:"iceConnected"};function D(U){return U!==null&&typeof U<"u"}var O=0,x=function(U){k(G,U);function G(F,N){var A=U.call(this)||this;A._testTiming=new e.Timer,A._dtlsTiming=new e.Timer,A._iceTiming=new e.Timer,A._peerConnectionTiming=new e.Timer,A._mediaTiming=new e.Timer,A._connectTiming=new e.Timer,A._sentBytesMovingAverage=new h,A._packetLossMovingAverage=new h,A._progressEvents=[],A._receivedBytesMovingAverage=new h;var w=N,j=w.environment,Q=j===void 0?"prod":j,Y=w.region,$=Y===void 0?"gll":Y,z=w.duration,ne=z===void 0?C:z,oe=w.wsServer||v(Q,$);return A._log=new u("default",A,i.DEFAULT_LOG_LEVEL,i.DEFAULT_LOGGER_NAME),A._testDuration=ne,A._instanceId=O++,A._testTiming.start(),A._runPreflightTest(F,Q,oe),A}return G.prototype.toString=function(){return"[Preflight #"+this._instanceId+"]"},G.prototype.stop=function(){this._stopped=!0},G.prototype._generatePreflightReport=function(F){return this._testTiming.stop(),{testTiming:this._testTiming.getTimeMeasurement(),networkTiming:{dtls:this._dtlsTiming.getTimeMeasurement(),ice:this._iceTiming.getTimeMeasurement(),peerConnection:this._peerConnectionTiming.getTimeMeasurement(),connect:this._connectTiming.getTimeMeasurement(),media:this._mediaTiming.getTimeMeasurement()},stats:{jitter:a.makeStat(F?.jitter),rtt:a.makeStat(F?.rtt),packetLoss:a.makeStat(F?.packetLoss)},selectedIceCandidatePairStats:F?F.selectedIceCandidatePairStats:null,iceCandidateStats:F?F.iceCandidateStats:[],progressEvents:this._progressEvents,mos:a.makeStat(F?.mos)}},G.prototype._executePreflightStep=function(F,N,A){return _(this,void 0,void 0,function(){var w,j,Q,Y,$;return s(this,function(z){switch(z.label){case 0:if(this._log.debug("Executing step: ",F),w=this._testDuration+10*P,this._stopped)throw new Error("stopped");j=Promise.resolve().then(N),Q=null,Y=new Promise(function(ne,oe){Q=setTimeout(function(){oe(A||new Error(F+" timeout."))},w)}),z.label=1;case 1:return z.trys.push([1,,3,4]),[4,Promise.race([Y,j])];case 2:return $=z.sent(),[2,$];case 3:return Q!==null&&clearTimeout(Q),[7];case 4:return[2]}})})},G.prototype._collectNetworkTimings=function(F){var N=this;return new Promise(function(A){var w;F.addEventListener("iceconnectionstatechange",function(){F.iceConnectionState==="checking"&&N._iceTiming.start(),F.iceConnectionState==="connected"&&(N._iceTiming.stop(),N._updateProgress(M.iceConnected),(!w||w&&w.state==="connected")&&A())}),F.addEventListener("connectionstatechange",function(){F.connectionState==="connecting"&&N._peerConnectionTiming.start(),F.connectionState==="connected"&&(N._peerConnectionTiming.stop(),N._updateProgress(M.peerConnectionConnected))});var j=F.getSenders(),Q=j.map(function(Y){return Y.transport}).find(D);typeof Q<"u"&&(w=Q,w.addEventListener("statechange",function(){w.state==="connecting"&&N._dtlsTiming.start(),w.state==="connected"&&(N._dtlsTiming.stop(),N._updateProgress(M.dtlsConnected),F.iceConnectionState==="connected"&&A())}))})},G.prototype._setupInsights=function(F){var N=F.token,A=F.environment,w=A===void 0?i.DEFAULT_ENVIRONMENT:A,j=F.realm,Q=j===void 0?i.DEFAULT_REALM:j,Y={},$=new L(N,i.SDK_NAME,i.SDK_VERSION,w,Q,Y);$.connect("PREFLIGHT_ROOM_SID","PREFLIGHT_PARTICIPANT");var z=new S($,Date.now(),this._log),ne=void 0;return{reportToInsights:function(oe){var ve,le,de=oe.report,ee=de.stats.jitter||ne,se=de.stats.rtt||ne,ie=de.stats.packetLoss||ne,Z=de.mos||ne,he=new Map;de.iceCandidateStats.forEach(function(W){if(W.candidateType&&W.protocol){var K=he.get(W.candidateType)||[];K.indexOf(W.protocol)<0&&K.push(W.protocol),he.set(W.candidateType,K)}});var ue=JSON.stringify(Object.fromEntries(he)),ye={name:"report",group:"preflight",level:de.error?"error":"info",payload:{sessionSID:g,preflightSID:b("PF"),progressEvents:JSON.stringify(de.progressEvents),testTiming:de.testTiming,dtlsTiming:de.networkTiming.dtls,iceTiming:de.networkTiming.ice,peerConnectionTiming:de.networkTiming.peerConnection,connectTiming:de.networkTiming.connect,mediaTiming:de.networkTiming.media,selectedLocalCandidate:(ve=de.selectedIceCandidatePairStats)===null||ve===void 0?void 0:ve.localCandidate,selectedRemoteCandidate:(le=de.selectedIceCandidatePairStats)===null||le===void 0?void 0:le.remoteCandidate,iceCandidateStats:ue,jitterStats:ee,rttStats:se,packetLossStats:ie,mosStats:Z,error:de.error}};z.emit("event",ye),setTimeout(function(){return $.disconnect()},2e3)}}},G.prototype._runPreflightTest=function(F,N,A){return _(this,void 0,void 0,function(){var w,j,Q,Y,$,z,ne,oe,ve,le,de,ee,se=this;return s(this,function(ie){switch(ie.label){case 0:w=[],j=[],Q=this._setupInsights({token:F,environment:N}).reportToInsights,ie.label=1;case 1:return ie.trys.push([1,8,9,10]),Y=[],[4,this._executePreflightStep("Acquire media",function(){return[o.syntheticAudio(),c.syntheticVideo({width:640,height:480})]})];case 2:return w=ie.sent(),this._updateProgress(M.mediaAcquired),this.emit("debug",{localTracks:w}),this._connectTiming.start(),[4,this._executePreflightStep("Get turn credentials",function(){return n.getTurnCredentials(F,A)},new f)];case 3:return $=ie.sent(),this._connectTiming.stop(),this._updateProgress(M.connected),z=new RTCPeerConnection({iceServers:$,iceTransportPolicy:"relay",bundlePolicy:"max-bundle"}),ne=new RTCPeerConnection({iceServers:$,bundlePolicy:"max-bundle"}),j.push(z),j.push(ne),this._mediaTiming.start(),[4,this._executePreflightStep("Setup Peer Connections",function(){return _(se,void 0,void 0,function(){var Z,he,ue,ye;return s(this,function(W){switch(W.label){case 0:return z.addEventListener("icecandidate",function(K){return K.candidate&&ne.addIceCandidate(K.candidate)}),ne.addEventListener("icecandidate",function(K){return K.candidate&&z.addIceCandidate(K.candidate)}),w.forEach(function(K){return z.addTrack(K)}),Z=new Promise(function(K){var I=[];ne.addEventListener("track",function(R){I.push(R.track),I.length===w.length&&K(I)})}),[4,z.createOffer()];case 1:return he=W.sent(),ue=he,[4,z.setLocalDescription(ue)];case 2:return W.sent(),[4,ne.setRemoteDescription(ue)];case 3:return W.sent(),[4,ne.createAnswer()];case 4:return ye=W.sent(),[4,ne.setLocalDescription(ye)];case 5:return W.sent(),[4,z.setRemoteDescription(ye)];case 6:return W.sent(),[4,this._collectNetworkTimings(z)];case 7:return W.sent(),[2,Z]}})})},new m)];case 4:return oe=ie.sent(),this.emit("debug",{remoteTracks:oe}),oe.forEach(function(Z){Z.addEventListener("ended",function(){return se._log.warn(Z.kind+":ended")}),Z.addEventListener("mute",function(){return se._log.warn(Z.kind+":muted")}),Z.addEventListener("unmute",function(){return se._log.warn(Z.kind+":unmuted")})}),this._updateProgress(M.mediaSubscribed),[4,this._executePreflightStep("Wait for tracks to start",function(){return new Promise(function(Z){var he=document.createElement("video");he.autoplay=!0,he.playsInline=!0,he.muted=!0,he.srcObject=new MediaStream(oe),Y.push(he),se.emit("debugElement",he),he.oncanplay=Z})},new m)];case 5:return ie.sent(),this._mediaTiming.stop(),this._updateProgress(M.mediaStarted),[4,this._executePreflightStep("Collect stats for duration",function(){return se._collectRTCStatsForDuration(se._testDuration,E(),z,ne)})];case 6:return ve=ie.sent(),[4,this._executePreflightStep("Generate report",function(){return se._generatePreflightReport(ve)})];case 7:return le=ie.sent(),Q({report:le}),this.emit("completed",le),[3,10];case 8:return de=ie.sent(),ee=this._generatePreflightReport(),Q({report:p(p({},ee),{error:de?.toString()})}),this.emit("failed",de,ee),[3,10];case 9:return j.forEach(function(Z){return Z.close()}),w.forEach(function(Z){return Z.stop()}),[7];case 10:return[2]}})})},G.prototype._collectRTCStats=function(F,N,A){return _(this,void 0,void 0,function(){var w,j,Q,Y,$,z,ne,oe,ve,le,de,ee,se,ie;return s(this,function(Z){switch(Z.label){case 0:return[4,t.getCombinedConnectionStats({publisher:N,subscriber:A})];case 1:return w=Z.sent(),j=w.timestamp,Q=w.bytesSent,Y=w.bytesReceived,$=w.packets,z=w.packetsLost,ne=w.roundTripTime,oe=w.jitter,ve=w.selectedIceCandidatePairStats,le=w.iceCandidateStats,de=F.jitter.length>0,F.jitter.push(oe),F.rtt.push(ne),this._sentBytesMovingAverage.putSample(Q,j),this._receivedBytesMovingAverage.putSample(Y,j),this._packetLossMovingAverage.putSample(z,$),de&&(F.outgoingBitrate.push(this._sentBytesMovingAverage.get()*1e3*8),F.incomingBitrate.push(this._receivedBytesMovingAverage.get()*1e3*8),ee=this._packetLossMovingAverage.get(),se=Math.min(100,ee*100),F.packetLoss.push(se),ie=r.calculateMOS(ne,oe,ee),F.mos.push(ie)),F.selectedIceCandidatePairStats||(F.selectedIceCandidatePairStats=ve),F.iceCandidateStats.length===0&&(F.iceCandidateStats=le),[2]}})})},G.prototype._collectRTCStatsForDuration=function(F,N,A,w){return _(this,void 0,void 0,function(){var j,Q,Y;return s(this,function($){switch($.label){case 0:return j=Date.now(),Q=Math.min(1e3,F),[4,d.waitForSometime(Q)];case 1:return $.sent(),[4,this._collectRTCStats(N,A,w)];case 2:return $.sent(),Y=F-(Date.now()-j),Y>0?[4,this._collectRTCStatsForDuration(Y,N,A,w)]:[3,4];case 3:N=$.sent(),$.label=4;case 4:return[2,N]}})})},G.prototype._updateProgress=function(F){var N=Date.now()-this._testTiming.getTimeMeasurement().start;this._progressEvents.push({duration:N,name:F}),this.emit("progress",F)},G}(y);Be.PreflightTest=x;function E(){return{mos:[],jitter:[],rtt:[],outgoingBitrate:[],incomingBitrate:[],packetLoss:[],selectedIceCandidatePairStats:null,iceCandidateStats:[]}}function q(U,G){G===void 0&&(G={});var F=new x(U,G);return F}return Be.runPreflight=q,Be}var Tt,co;function Ai(){if(co)return Tt;co=1;var k=Tt&&Tt.__read||function(s,i){var e=typeof Symbol=="function"&&s[Symbol.iterator];if(!e)return s;var r=e.call(s),t,n=[],a;try{for(;(i===void 0||i-- >0)&&!(t=r.next()).done;)n.push(t.value)}catch(o){a={error:o}}finally{try{t&&!t.done&&(e=r.return)&&e.call(r)}finally{if(a)throw a.error}}return n},p=Tt&&Tt.__spreadArray||function(s,i){for(var e=0,r=i.length,t=s.length;e<r;e++,t++)s[t]=i[e];return s},_=function(){function s(i,e){var r=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:e}}),Object.defineProperty(this,"_promise",{value:new Promise(function(t,n){i(function(a){r._isCancelable=!1,t(a)},function(a){r._isCancelable=!1,n(a)},function(){return r._isCanceled})})})}return s.reject=function(i){return new s(function(r,t){t(i)},function(){})},s.resolve=function(i){return new s(function(r){r(i)},function(){})},s.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},s.prototype.catch=function(){var i=[].slice.call(arguments),e=this._promise;return new s(function(t,n){e.catch.apply(e,p([],k(i))).then(t,n)},this._onCancel)},s.prototype.then=function(){var i=[].slice.call(arguments),e=this._promise;return new s(function(t,n){e.then.apply(e,p([],k(i))).then(t,n)},this._onCancel)},s.prototype.finally=function(){var i=[].slice.call(arguments),e=this._promise;return new s(function(t,n){e.finally.apply(e,p([],k(i))).then(t,n)},this._onCancel)},s}();return Tt=_,Tt}var Xn,uo;function qu(){if(uo)return Xn;uo=1;var k=Ai();function p(_,s,i,e){var r,t=new Error("Canceled");return new k(function(a,o,c){var d;_(function(u){return c()?k.reject(t):(d=s(u),i(d).then(function(h){if(c())throw t;return r=h(),r}))}).then(function(u){if(c())throw u.disconnect(),t;a(e(d,u))}).catch(function(u){o(u)})},function(){r&&r.cancel()})}return Xn=p,Xn}var cr,lo;function Vu(){if(lo)return cr;lo=1;var k=cr&&cr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(s){k(i,s);function i(e,r){var t=s.call(this)||this;return e=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},e),Object.defineProperties(t,{maxAudioBitrate:{value:e.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:e.maxVideoBitrate,writable:!0},adaptiveSimulcast:{value:r}}),t}return i.prototype.toJSON=function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}},i.prototype.update=function(e){var r=this;e=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},e);var t=["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,a){return r[a]!==e[a]&&(r[a]=e[a],n=!0),n},!1);t&&this.emit("changed")},i}(p);return cr=_,cr}var ur={},fo;function Cc(){if(fo)return ur;fo=1;var k=Ce().isNonArrayObject,p=Oe(),_=p.typeErrors,s=p.clientTrackSwitchOffControl,i=p.videoContentPreferencesMode,e=p.subscriptionMode,r=p.trackPriority,t=p.trackSwitchOffMode;function n(d){var v=o(d,"options.bandwidthProfile");return!d||v||(v=o(d.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(i)},{prop:"dominantSpeakerPriority",values:Object.values(r)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(e)},{prop:"clientTrackSwitchOffControl",values:Object.values(s)},{prop:"trackSwitchOffMode",values:Object.values(t)}]),v)?v:d.video?"maxTracks"in d.video&&"clientTrackSwitchOffControl"in d.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in d.video&&"contentPreferencesMode"in d.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):c(d.video.renderDimensions):null}function a(d,v){if(!(d instanceof v.LocalAudioTrack||d instanceof v.LocalDataTrack||d instanceof v.LocalVideoTrack||d instanceof v.MediaStreamTrack))throw _.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}function o(d,v,u){return u===void 0&&(u=[]),typeof d>"u"?null:d===null||!k(d)?_.INVALID_TYPE(v,"object"):u.reduce(function(y,h){var S=h.prop,L=h.type,T=h.values;if(y||!(S in d))return y;var b=d[S];return L&&typeof b!==L||L==="number"&&isNaN(b)?_.INVALID_TYPE(v+"."+S,L):Array.isArray(T)&&!T.includes(b)?_.INVALID_VALUE(v+"."+S,T):y},null)}function c(d){var v="options.bandwidthProfile.video.renderDimensions",u=o(d,v);return d?u||Object.values(r).reduce(function(y,h){return y||o(d[h],v+"."+h,[{prop:"height",type:"number"},{prop:"width",type:"number"}])},null):u}return ur.validateBandwidthProfile=n,ur.validateLocalTrack=a,ur.validateObject=o,ur}var lr,vo;function Oc(){if(vo)return lr;vo=1;var k=lr&&lr.__extends||function(){var a=function(o,c){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(o,c)};return function(o,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(o,c);function d(){this.constructor=o}o.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}(),p=ln(),_=Ce(),s=_.buildLogLevels,i=_.valueToJSON,e=Oe().DEFAULT_LOG_LEVEL,r=ze(),t=0,n=function(a){k(o,a);function o(c,d,v){var u=a.call(this)||this;v=Object.assign({logLevel:e},v);var y=s(v.logLevel);return Object.defineProperties(u,{_instanceId:{value:t++},_log:{value:v.log?v.log.createLog("default",u):new r("default",u,y,v.loggerName)},trackName:{enumerable:!0,value:c},trackSid:{enumerable:!0,value:d}}),u}return o.prototype.toJSON=function(){return i(this)},o.prototype.toString=function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"},o}(p);return lr=n,lr}var ot,po;function Mi(){if(po)return ot;po=1;var k=ot&&ot.__extends||function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(c[v]=d[v])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function c(){this.constructor=a}a.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}}(),p=ot&&ot.__read||function(n,a){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var c=o.call(n),d,v=[],u;try{for(;(a===void 0||a-- >0)&&!(d=c.next()).done;)v.push(d.value)}catch(y){u={error:y}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(u)throw u.error}}return v},_=ot&&ot.__spreadArray||function(n,a){for(var o=0,c=a.length,d=n.length;o<c;o++,d++)n[d]=a[o];return n},s=Oc(),i=Oe(),e=i.typeErrors,r=i.trackPriority,t=function(n){k(a,n);function a(o,c,d,v){var u=n.call(this,c.name,o.sid,v)||this;return Object.defineProperties(u,{_reemitSignalingEvent:{value:function(){for(var y=[],h=0;h<arguments.length;h++)y[h]=arguments[h];return u.emit.apply(u,_([y&&y.length?"warning":"warningsCleared"],p(y)))}},_reemitTrackEvent:{value:function(){return u.emit(u.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:o},_unpublish:{value:d},isTrackEnabled:{enumerable:!0,get:function(){return this.track.kind==="data"?!0:this.track.isEnabled}},kind:{enumerable:!0,value:c.kind},priority:{enumerable:!0,get:function(){return o.updatedPriority}},track:{enumerable:!0,value:c}}),["disabled","enabled"].forEach(function(y){return c.on(y,u._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(y){return o.on(y,u._reemitSignalingEvent)}),u}return a.prototype.toString=function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},a.prototype.setPriority=function(o){var c=Object.values(r);if(!c.includes(o))throw e.INVALID_VALUE("priority",c);return this._signaling.setPriority(o),this},a.prototype.unpublish=function(){var o=this;return["disabled","enabled"].forEach(function(c){return o.track.removeListener(c,o._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(c){return o._signaling.removeListener(c,o._reemitSignalingEvent)}),this._unpublish(this),this},a}(s);return ot=t,ot}var dr,ho;function Fu(){if(ho)return dr;ho=1;var k=dr&&dr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mi(),_=function(s){k(i,s);function i(e,r,t,n){return s.call(this,e,r,t,n)||this}return i.prototype.toString=function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return dr=_,dr}var fr,_o;function Bu(){if(_o)return fr;_o=1;var k=fr&&fr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mi(),_=function(s){k(i,s);function i(e,r,t,n){return s.call(this,e,r,t,n)||this}return i.prototype.toString=function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return fr=_,fr}var vr,mo;function Uu(){if(mo)return vr;mo=1;var k=vr&&vr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mi(),_=function(s){k(i,s);function i(e,r,t,n){return s.call(this,e,r,t,n)||this}return i.prototype.toString=function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return vr=_,vr}var st,yo;function Rc(){if(yo)return st;yo=1;var k=st&&st.__extends||function(){var o=function(c,d){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,u){v.__proto__=u}||function(v,u){for(var y in u)Object.prototype.hasOwnProperty.call(u,y)&&(v[y]=u[y])},o(c,d)};return function(c,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");o(c,d);function v(){this.constructor=c}c.prototype=d===null?Object.create(d):(v.prototype=d.prototype,new v)}}(),p=st&&st.__read||function(o,c){var d=typeof Symbol=="function"&&o[Symbol.iterator];if(!d)return o;var v=d.call(o),u,y=[],h;try{for(;(c===void 0||c-- >0)&&!(u=v.next()).done;)y.push(u.value)}catch(S){h={error:S}}finally{try{u&&!u.done&&(d=v.return)&&d.call(v)}finally{if(h)throw h.error}}return y},_=st&&st.__spreadArray||function(o,c){for(var d=0,v=c.length,u=o.length;d<v;d++,u++)o[u]=c[d];return o},s=Oe(),i=s.typeErrors,e=s.trackPriority,r=Rt().isIOS,t=xi();function n(o){return function(c){k(d,c);function d(v,u,y,h,S,L,T){var b=this;return T=Object.assign({workaroundWebKitBug212780:r()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string"},T),b=c.call(this,u,T)||this,Object.defineProperties(b,{_isEnabled:{value:y,writable:!0},_isSwitchedOff:{value:h,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:S},_setRenderHint:{value:function(g){b._log.debug("updating render hint:",g),L(g)}},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:v},_workaroundWebKitBug212780:{value:T.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),b}return d.prototype.setPriority=function(v){var u=_([null],p(Object.values(e)));if(!u.includes(v))throw i.INVALID_VALUE("priority",u);return this._priority!==v&&(this._priority=v,this._setPriority(v)),this},d.prototype._setEnabled=function(v){this._isEnabled!==v&&(this._isEnabled=v,this.emit(this._isEnabled?"enabled":"disabled",this))},d.prototype._setSwitchedOff=function(v){this._isSwitchedOff!==v&&(this._isSwitchedOff=v,this.emit(v?"switchedOff":"switchedOn",this))},d.prototype.attach=function(v){var u=c.prototype.attach.call(this,v);return this.mediaStreamTrack.enabled!==!0&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||a(this)),u},d.prototype.detach=function(v){var u=c.prototype.detach.call(this,v);return this._attachments.size===0&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),u},d}(o)}function a(o){var c=o._log,d=o.kind;function v(u){u&&o._attachments.forEach(function(y){var h=o._elShims.get(y),S=y.paused&&h&&!h.pausedIntentionally();S&&(c.info("Playing inadvertently paused <"+d+"> element"),c.debug("Element:",y),c.debug("RemoteMediaTrack:",o),y.play().then(function(){c.info("Successfully played inadvertently paused <"+d+"> element"),c.debug("Element:",y),c.debug("RemoteMediaTrack:",o)}).catch(function(L){c.warn("Error while playing inadvertently paused <"+d+"> element:",{err:L,el:y,remoteMediaTrack:o})}))})}return t.onVisibilityChange(2,v),function(){t.offVisibilityChange(2,v)}}return st=n,st}var pr,go;function Wu(){if(go)return pr;go=1;var k=pr&&pr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=fc(),_=Rc(),s=_(p),i=function(e){k(r,e);function r(t,n,a,o,c,d,v){return e.call(this,t,n,a,o,c,d,v)||this}return r.prototype.toString=function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"},r.prototype._start=function(){e.prototype._start.call(this),this._dummyEl&&(this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl=null)},r.prototype.setPriority=function(t){return e.prototype.setPriority.call(this,t)},r}(s);return pr=i,pr}var hr,bo;function Ii(){if(bo)return hr;bo=1;var k=hr&&hr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Oc(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e.name,e.sid,r)||this;Object.defineProperties(t,{_signaling:{value:e},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return e.isEnabled}},kind:{enumerable:!0,value:e.kind},publishPriority:{enumerable:!0,get:function(){return e.priority}},track:{enumerable:!0,get:function(){return this._track}}});var n=e.error,a=e.isEnabled,o=e.isSwitchedOff,c=e.priority;return e.on("updated",function(){if(n!==e.error){n=e.error,t.emit("subscriptionFailed",e.error);return}a!==e.isEnabled&&(a=e.isEnabled,t.track&&t.track._setEnabled(e.isEnabled),t.emit(e.isEnabled?"trackEnabled":"trackDisabled")),o!==e.isSwitchedOff&&(t._log.debug(t.trackSid+": "+(o?"OFF":"ON")+" => "+(e.isSwitchedOff?"OFF":"ON")),o=e.isSwitchedOff,t.track?(t.track._setSwitchedOff(e.isSwitchedOff),t.emit(o?"trackSwitchedOff":"trackSwitchedOn",t.track)):o&&t._log.warn("Track was not subscribed when switched Off.")),c!==e.priority&&(c=e.priority,t.emit("publishPriorityChanged",c))}),t}return i.prototype.toString=function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i.prototype._subscribed=function(e){!this._track&&e&&(this._track=e,this.emit("subscribed",e))},i.prototype._unsubscribe=function(){if(this._track){var e=this._track;this._track=null,this.emit("unsubscribed",e)}},i}(p);return hr=_,hr}var _r,ko;function Hu(){if(ko)return _r;ko=1;var k=_r&&_r.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ii(),_=function(s){k(i,s);function i(e,r){return s.call(this,e,r)||this}return i.prototype.toString=function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return _r=_,_r}var ct,So;function Gu(){if(So)return ct;So=1;var k=ct&&ct.__extends||function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(c[v]=d[v])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function c(){this.constructor=a}a.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}}(),p=ct&&ct.__read||function(n,a){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var c=o.call(n),d,v=[],u;try{for(;(a===void 0||a-- >0)&&!(d=c.next()).done;)v.push(d.value)}catch(y){u={error:y}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(u)throw u.error}}return v},_=ct&&ct.__spreadArray||function(n,a){for(var o=0,c=a.length,d=n.length;o<c;o++,d++)n[d]=a[o];return n},s=Li(),i=Oe(),e=i.typeErrors,r=i.trackPriority,t=function(n){k(a,n);function a(o,c,d){var v=n.call(this,c.id,"data",d)||this;return Object.defineProperties(v,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:c.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:c.maxRetransmits},ordered:{enumerable:!0,value:c.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:c.maxPacketLifeTime===null&&c.maxRetransmits===null},sid:{enumerable:!0,value:o}}),c.on("message",function(u){v.emit("message",u,v)}),v}return a.prototype.setPriority=function(o){var c=_([null],p(Object.values(r)));if(!c.includes(o))throw e.INVALID_VALUE("priority",c);return this._priority=o,this},a.prototype._setEnabled=function(){},a.prototype._setSwitchedOff=function(o){this._isSwitchedOff!==o&&(this._isSwitchedOff=o,this.emit(o?"switchedOff":"switchedOn",this))},a}(s);return ct=t,ct}var mr,To;function Qu(){if(To)return mr;To=1;var k=mr&&mr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ii(),_=function(s){k(i,s);function i(e,r){return s.call(this,e,r)||this}return i.prototype.toString=function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return mr=_,mr}var yr,wo;function $u(){if(wo)return yr;wo=1;var k=yr&&yr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=function(){function i(e){Object.defineProperties(this,{_callback:{value:e}})}return i.prototype.observe=function(){},i.prototype.unobserve=function(){},i.prototype.makeVisible=function(e){var r=this._makeFakeEntry(e,!0);this._callback([r])},i.prototype.makeInvisible=function(e){var r=this._makeFakeEntry(e,!1);this._callback([r])},i.prototype._makeFakeEntry=function(e,r){return{target:e,isIntersecting:r}},i}(),_=function(i){k(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e}(p),s=function(i){k(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.resize=function(r){var t=this._makeFakeEntry(r,!0);this._callback([t])},e}(p);return yr={NullIntersectionObserver:_,NullResizeObserver:s,NullObserver:p},yr}var wt,Eo;function Ku(){if(Eo)return wt;Eo=1;var k=wt&&wt.__extends||function(){var u=function(y,h){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,L){S.__proto__=L}||function(S,L){for(var T in L)Object.prototype.hasOwnProperty.call(L,T)&&(S[T]=L[T])},u(y,h)};return function(y,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");u(y,h);function S(){this.constructor=y}y.prototype=h===null?Object.create(h):(S.prototype=h.prototype,new S)}}(),p=wt&&wt.__read||function(u,y){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var S=h.call(u),L,T=[],b;try{for(;(y===void 0||y-- >0)&&!(L=S.next()).done;)T.push(L.value)}catch(g){b={error:g}}finally{try{L&&!L.done&&(h=S.return)&&h.call(S)}finally{if(b)throw b.error}}return T},_=Rc(),s=bc(),i=xi(),e=$u().NullObserver,r=Lt(),t=_(s),n=50,a=function(u){k(y,u);function y(h,S,L,T,b,g,l){var f=this;return l=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},l),l=Object.assign({IntersectionObserver:typeof IntersectionObserver>"u"||l.clientTrackSwitchOffControl!=="auto"?e:IntersectionObserver,ResizeObserver:typeof ResizeObserver>"u"||l.contentPreferencesMode!=="auto"?e:ResizeObserver},l),f=u.call(this,h,S,L,T,b,g,l)||this,Object.defineProperties(f,{_enableDocumentVisibilityTurnOff:{value:l.enableDocumentVisibilityTurnOff===!0&&l.clientTrackSwitchOffControl==="auto"},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:l.clientTrackSwitchOffControl},_contentPreferencesMode:{value:l.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_elToPipCallbacks:{value:new WeakMap},_elToPipWindows:{value:new WeakMap},_turnOffTimer:{value:new r(function(){f._setRenderHint({enabled:!1})},n,!1)},_resizeObserver:{value:new l.ResizeObserver(function(m){var P=m.find(function(C){return!f._invisibleElements.has(C.target)});P&&d(f)})},_intersectionObserver:{value:new l.IntersectionObserver(function(m){var P=!1;m.forEach(function(C){var M=!f._invisibleElements.has(C.target);M!==C.isIntersecting&&(C.isIntersecting?(f._log.debug("intersectionObserver detected: Off => On"),f._invisibleElements.delete(C.target)):(f._log.debug("intersectionObserver detected: On => Off"),f._invisibleElements.add(C.target)),P=!0)}),P&&(c(f),d(f))},{threshold:.25})}}),f}return y.prototype._start=function(h){var S=u.prototype._start.call(this,h);return c(this),S},y.prototype.switchOn=function(){if(this._clientTrackSwitchOffControl!=="manual")throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this},y.prototype.switchOff=function(){if(this._clientTrackSwitchOffControl!=="manual")throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this},y.prototype.setContentPreferences=function(h){if(this._contentPreferencesMode!=="manual")throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return h.renderDimensions&&this._setRenderHint({renderDimensions:h.renderDimensions}),this},y.prototype._unObservePip=function(h){var S=this._elToPipCallbacks.get(h);S&&(h.removeEventListener("enterpictureinpicture",S.onEnterPip),h.removeEventListener("leavepictureinpicture",S.onLeavePip),this._elToPipCallbacks.delete(h))},y.prototype._observePip=function(h){var S=this,L=this._elToPipCallbacks.get(h);if(!L){var T=function(l){return S._onEnterPip(l,h)},b=function(l){return S._onLeavePip(l,h)},g=function(l){return S._onResizePip(l,h)};h.addEventListener("enterpictureinpicture",T),h.addEventListener("leavepictureinpicture",b),this._elToPipCallbacks.set(h,{onEnterPip:T,onLeavePip:b,onResizePip:g})}},y.prototype._onEnterPip=function(h,S){this._log.debug("onEnterPip");var L=h.pictureInPictureWindow;this._elToPipWindows.set(S,L);var T=this._elToPipCallbacks.get(S).onResizePip;L.addEventListener("resize",T),c(this)},y.prototype._onLeavePip=function(h,S){this._log.debug("onLeavePip"),this._elToPipWindows.delete(S);var L=this._elToPipCallbacks.get(S).onResizePip,T=h.pictureInPictureWindow;T.removeEventListener("resize",L),c(this)},y.prototype._onResizePip=function(){d(this)},y.prototype.attach=function(h){var S=u.prototype.attach.call(this,h);return this._clientTrackSwitchOffControl==="auto"&&this._invisibleElements.add(S),this._intersectionObserver.observe(S),this._resizeObserver.observe(S),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||v(this)),this._observePip(S),S},y.prototype.detach=function(h){var S=this,L=u.prototype.detach.call(this,h),T=Array.isArray(L)?L:[L];return T.forEach(function(b){S._intersectionObserver.unobserve(b),S._resizeObserver.unobserve(b),S._invisibleElements.delete(b),S._unObservePip(b)}),this._attachments.size===0&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),c(this),d(this),L},y.prototype.addProcessor=function(){return u.prototype.addProcessor.apply(this,arguments)},y.prototype.removeProcessor=function(){return u.prototype.removeProcessor.apply(this,arguments)},y.prototype.toString=function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"},y.prototype.setPriority=function(h){return u.prototype.setPriority.call(this,h)},y}(t);function o(u){if(!("documentPictureInPicture"in globalThis))return!1;var y=globalThis.documentPictureInPicture.window;if(!y)return!1;var h=new WeakSet(y.document.querySelectorAll("video"));return u._getAllAttachedElements().some(function(S){return h.has(S)})}function c(u){if(u._clientTrackSwitchOffControl==="auto"){var y=u._getAllAttachedElements().filter(function(L){return!u._invisibleElements.has(L)}),h=u._getAllAttachedElements().filter(function(L){return u._elToPipWindows.has(L)}),S=h.length>0||o(u)||document.visibilityState==="visible"&&y.length>0;S===!0?(u._turnOffTimer.clear(),u._setRenderHint({enabled:!0})):u._turnOffTimer.isSet||u._turnOffTimer.start()}}function d(u){if(u._contentPreferencesMode==="auto"){var y=u._getAllAttachedElements().filter(function(f){return!u._invisibleElements.has(f)}),h=u._getAllAttachedElements().map(function(f){var m=u._elToPipWindows.get(f);return m?{clientHeight:m.height,clientWidth:m.width}:{clientHeight:0,clientWidth:0}}),S=y.concat(h);if(S.length>0){var L=p(S.sort(function(f,m){return m.clientHeight+m.clientWidth-f.clientHeight-f.clientWidth-1}),1),T=L[0],b=T.clientHeight,g=T.clientWidth,l={height:b,width:g};u._setRenderHint({renderDimensions:l})}}}function v(u){function y(){c(u)}return i.onVisibilityChange(1,y),function(){i.offVisibilityChange(1,y)}}return wt=a,wt}var gr,Po;function zu(){if(Po)return gr;Po=1;var k=gr&&gr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ii(),_=function(s){k(i,s);function i(e,r){return s.call(this,e,r)||this}return i.prototype.toString=function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},i}(p);return gr=_,gr}var ut,Co;function Lc(){if(Co)return ut;Co=1;var k=ut&&ut.__extends||function(){var S=function(L,T){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,g){b.__proto__=g}||function(b,g){for(var l in g)Object.prototype.hasOwnProperty.call(g,l)&&(b[l]=g[l])},S(L,T)};return function(L,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");S(L,T);function b(){this.constructor=L}L.prototype=T===null?Object.create(T):(b.prototype=T.prototype,new b)}}(),p=ut&&ut.__read||function(S,L){var T=typeof Symbol=="function"&&S[Symbol.iterator];if(!T)return S;var b=T.call(S),g,l=[],f;try{for(;(L===void 0||L-- >0)&&!(g=b.next()).done;)l.push(g.value)}catch(m){f={error:m}}finally{try{g&&!g.done&&(T=b.return)&&T.call(b)}finally{if(f)throw f.error}}return l},_=ut&&ut.__spreadArray||function(S,L){for(var T=0,b=L.length,g=S.length;T<b;T++,g++)S[g]=L[T];return S},s=ln(),i=Wu(),e=Hu(),r=Gu(),t=Qu(),n=Ku(),a=zu(),o=Ce(),c=0,d=function(S){k(L,S);function L(T,b){var g=S.call(this)||this;b=Object.assign({RemoteAudioTrack:i,RemoteAudioTrackPublication:e,RemoteDataTrack:r,RemoteDataTrackPublication:t,RemoteVideoTrack:n,RemoteVideoTrackPublication:a,tracks:[]},b);var l=v(b.tracks),f=b.log.createLog("default",g),m=new Map(l.audioTracks),P=new Map(l.dataTracks),C=new Map(l.tracks),M=new Map(l.videoTracks);return Object.defineProperties(g,{_RemoteAudioTrack:{value:b.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:b.RemoteAudioTrackPublication},_RemoteDataTrack:{value:b.RemoteDataTrack},_RemoteDataTrackPublication:{value:b.RemoteDataTrackPublication},_RemoteVideoTrack:{value:b.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:b.RemoteVideoTrackPublication},_audioTracks:{value:m},_dataTracks:{value:P},_instanceId:{value:++c},_clientTrackSwitchOffControl:{value:b.clientTrackSwitchOffControl},_contentPreferencesMode:{value:b.contentPreferencesMode},_log:{value:f},_signaling:{value:T},_tracks:{value:C},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:M},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return T.identity}},networkQualityLevel:{enumerable:!0,get:function(){return T.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return T.networkQualityStats}},sid:{enumerable:!0,get:function(){return T.sid}},state:{enumerable:!0,get:function(){return T.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map},_MediaStream:{value:b.MediaStream},_mapMediaElement:{value:b.mapMediaElement},_disposeMediaElement:{value:b.disposeMediaElement}}),g._tracks.forEach(y.bind(null,g)),T.on("networkQualityLevelChanged",function(){return g.emit("networkQualityLevelChanged",g.networkQualityLevel,g.networkQualityStats&&(g.networkQualityStats.audio||g.networkQualityStats.video)?g.networkQualityStats:null)}),u(g,T),f.info("Created a new Participant"+(g.identity?": "+g.identity:"")),g}return L.prototype._getTrackEvents=function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]},L.prototype._getTrackPublicationEvents=function(){return[]},L.prototype.toString=function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"},L.prototype._addTrack=function(T,b){var g=this._log;if(this._tracks.has(b))return null;this._tracks.set(b,T);var l={audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[T.kind];return l.set(b,T),y(this,T,b),g.info("Added a new "+o.trackClass(T)+":",b),g.debug(o.trackClass(T)+":",T),T},L.prototype._addTrackPublication=function(T){var b=this._log;if(this.tracks.has(T.trackSid))return null;this.tracks.set(T.trackSid,T);var g={audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[T.kind];return g.set(T.trackSid,T),h(this,T),b.info("Added a new "+o.trackPublicationClass(T)+":",T.trackSid),b.debug(o.trackPublicationClass(T)+":",T),T},L.prototype._handleTrackSignalingEvents=function(){var T=this,b=T._log,g=T._clientTrackSwitchOffControl,l=T._contentPreferencesMode,f=T._MediaStream,m=T._mapMediaElement,P=T._disposeMediaElement,C=this;if(this.state==="disconnected")return;var M=this._RemoteAudioTrack,D=this._RemoteAudioTrackPublication,O=this._RemoteVideoTrack,x=this._RemoteVideoTrackPublication,E=this._RemoteDataTrack,q=this._RemoteDataTrackPublication,U=this._signaling;function G(w){var j={audio:D,data:q,video:x}[w.kind],Q=new j(w,{log:b});C._addTrackPublication(Q);var Y=w.isSubscribed;Y&&N(w),C._trackSignalingUpdatedEventCallbacks.set(w.sid,function(){if(Y!==w.isSubscribed){if(Y=w.isSubscribed,Y){N(w);return}A(w)}}),w.on("updated",C._trackSignalingUpdatedEventCallbacks.get(w.sid))}function F(w){w.isSubscribed&&w.setTrackTransceiver(null);var j=C._trackSignalingUpdatedEventCallbacks.get(w.sid);j&&(w.removeListener("updated",j),C._trackSignalingUpdatedEventCallbacks.delete(w.sid));var Q=C.tracks.get(w.sid);Q&&C._removeTrackPublication(Q)}function N(w){var j=w.isEnabled,Q=w.name,Y=w.kind,$=w.sid,z=w.trackTransceiver,ne=w.isSwitchedOff,oe={audio:M,video:O,data:E}[Y],ve=C.tracks.get($);if(!(!oe||Y!==z.kind)){var le={log:b,name:Q,clientTrackSwitchOffControl:g,contentPreferencesMode:l,mapMediaElement:m,disposeMediaElement:P};f&&(le.MediaStream=f);var de=function(ie){return U.updateSubscriberTrackPriority($,ie)},ee=function(ie){w.isSubscribed&&U.updateTrackRenderHint($,ie)},se=Y==="data"?new oe($,z,le):new oe($,z,j,ne,de,ee,le);C._addTrack(se,ve,z.id)}}function A(w){var j=p(Array.from(C._tracks.entries()).find(function(z){var ne=p(z,2),oe=ne[1];return oe.sid===w.sid}),2),Q=j[0],Y=j[1],$=C.tracks.get(w.sid);Y&&C._removeTrack(Y,$,Q)}U.on("trackAdded",G),U.on("trackRemoved",F),U.tracks.forEach(G),U.on("stateChanged",function w(j){j==="disconnected"?(b.debug("Removing event listeners"),U.removeListener("stateChanged",w),U.removeListener("trackAdded",G),U.removeListener("trackRemoved",F)):j==="connected"&&(b.info("reconnected"),setTimeout(function(){return C.emit("reconnected")},0))})},L.prototype._removeTrack=function(T,b){if(!this._tracks.has(b))return null;this._tracks.delete(b);var g={audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[T.kind];g.delete(b);var l=this._trackEventReemitters.get(b)||new Map;l.forEach(function(m,P){T.removeListener(P,m)});var f=this._log;return f.info("Removed a "+o.trackClass(T)+":",b),f.debug(o.trackClass(T)+":",T),T},L.prototype._removeTrackPublication=function(T){if(T=this.tracks.get(T.trackSid),!T)return null;this.tracks.delete(T.trackSid);var b={audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[T.kind];b.delete(T.trackSid);var g=this._trackPublicationEventReemitters.get(T.trackSid)||new Map;g.forEach(function(f,m){T.removeListener(m,f)});var l=this._log;return l.info("Removed a "+o.trackPublicationClass(T)+":",T.trackSid),l.debug(o.trackPublicationClass(T)+":",T),T},L.prototype.toJSON=function(){return o.valueToJSON(this)},L}(s);function v(S){var L=S.map(function(l){return[l.id,l]}),T=L.filter(function(l){return l[1].kind==="audio"}),b=L.filter(function(l){return l[1].kind==="video"}),g=L.filter(function(l){return l[1].kind==="data"});return{audioTracks:T,dataTracks:g,tracks:L,videoTracks:b}}function u(S,L){var T=S._log;S.state!=="disconnected"&&L.on("stateChanged",function b(g){T.debug("Transitioned to state:",g),S.emit(g,S),g==="disconnected"&&(T.debug("Removing Track event reemitters"),L.removeListener("stateChanged",b),S._tracks.forEach(function(l){var f=S._trackEventReemitters.get(l.id);l&&f&&f.forEach(function(m,P){l.removeListener(P,m)})}),L.tracks.forEach(function(l){var f=S._tracks.get(l.id),m=S._trackEventReemitters.get(l.id);f&&m&&m.forEach(function(P,C){f.removeListener(C,P)})}),S._trackEventReemitters.clear(),S.tracks.forEach(function(l){S._trackPublicationEventReemitters.get(l.trackSid).forEach(function(f,m){l.removeListener(m,f)})}),S._trackPublicationEventReemitters.clear())})}function y(S,L,T){var b=new Map;S.state!=="disconnected"&&(S._getTrackEvents().forEach(function(g){var l=g[0],f=g[1];b.set(l,function(){var m=[f].concat([].slice.call(arguments));return S.emit.apply(S,_([],p(m)))}),L.on(l,b.get(l))}),S._trackEventReemitters.set(T,b))}function h(S,L){var T=new Map;S.state!=="disconnected"&&(S._getTrackPublicationEvents().forEach(function(b){var g=p(b,2),l=g[0],f=g[1];T.set(l,function(){for(var m=[],P=0;P<arguments.length;P++)m[P]=arguments[P];S.emit.apply(S,_(_([f],p(m)),[L]))}),L.on(l,T.get(l))}),S._trackPublicationEventReemitters.set(L.trackSid,T))}return ut=d,ut}var br,Oo;function Yu(){if(Oo)return br;Oo=1;var k=br&&br.__extends||function(){var b=function(g,l){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,m){f.__proto__=m}||function(f,m){for(var P in m)Object.prototype.hasOwnProperty.call(m,P)&&(f[P]=m[P])},b(g,l)};return function(g,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");b(g,l);function f(){this.constructor=g}g.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)}}(),p=Ot().MediaStreamTrack,_=Ce(),s=_.asLocalTrack,i=_.asLocalTrackPublication,e=_.trackClass,r=Oe(),t=r.typeErrors,n=r.trackPriority,a=Cc().validateLocalTrack,o=It(),c=o.LocalAudioTrack,d=o.LocalDataTrack,v=o.LocalVideoTrack,u=Fu(),y=Bu(),h=Uu(),S=Lc(),L=function(b){k(g,b);function g(l,f,m){var P=this;m=Object.assign({LocalAudioTrack:c,LocalVideoTrack:v,LocalDataTrack:d,MediaStreamTrack:p,LocalAudioTrackPublication:u,LocalVideoTrackPublication:h,LocalDataTrackPublication:y,shouldStopLocalTracks:!1,tracks:f},m);var C=m.shouldStopLocalTracks?new Set(f.filter(function(M){return M.kind!=="data"})):new Set;return P=b.call(this,l,m)||this,Object.defineProperties(P,{_eventObserver:{value:m.eventObserver},_LocalAudioTrack:{value:m.LocalAudioTrack},_LocalDataTrack:{value:m.LocalDataTrack},_LocalVideoTrack:{value:m.LocalVideoTrack},_MediaStreamTrack:{value:m.MediaStreamTrack},_LocalAudioTrackPublication:{value:m.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:m.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:m.LocalVideoTrackPublication},_tracksToStop:{value:C},signalingRegion:{enumerable:!0,get:function(){return l.signalingRegion}}}),P._handleTrackSignalingEvents(),P}return g.prototype._addTrack=function(l,f,m){var P=b.prototype._addTrack.call(this,l,f);return P&&this.state!=="disconnected"&&this._addLocalTrack(l,m),P},g.prototype._addLocalTrack=function(l,f){var m,P=(m=l.noiseCancellation)===null||m===void 0?void 0:m.vendor;this._signaling.addTrack(l._trackSender,l.name,f,P),this._log.info("Added a new "+e(l,!0)+":",l.id),this._log.debug(e(l,!0)+":",l)},g.prototype._removeTrack=function(l,f){var m=b.prototype._removeTrack.call(this,l,f);return m&&this.state!=="disconnected"&&(this._signaling.removeTrack(l._trackSender),this._log.info("Removed a "+e(l,!0)+":",l.id),this._log.debug(e(l,!0)+":",l)),m},g.prototype._getTrackEvents=function(){return b.prototype._getTrackEvents.call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])},g.prototype.toString=function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},g.prototype._handleTrackSignalingEvents=function(){var l=this,f=this._log;if(this.state!=="disconnected"){var m=function(D){var O=l._signaling.getPublication(D._trackSender);O&&(O.disable(),f.debug("Disabled the "+e(D,!0)+":",D.id))},P=function(D){var O=l._signaling.getPublication(D._trackSender);O&&(O.enable(),f.debug("Enabled the "+e(D,!0)+":",D.id))},C=function(D){var O=l._signaling.getPublication(D._trackSender);return O&&O.stop(),O},M=function(D){f.debug("Transitioned to state:",D),D==="disconnected"?(f.debug("Removing LocalTrack event listeners"),l._signaling.removeListener("stateChanged",M),l.removeListener("trackDisabled",m),l.removeListener("trackEnabled",P),l.removeListener("trackStopped",C),l._tracks.forEach(function(O){var x=C(O);x&&O._trackSender.removeClone(x._trackTransceiver)}),f.info("LocalParticipant disconnected. Stopping "+l._tracksToStop.size+" automatically-acquired LocalTracks"),l._tracksToStop.forEach(function(O){O.stop()})):D==="connected"&&(f.info("reconnected"),setTimeout(function(){return l.emit("reconnected")},0))};this.on("trackDisabled",m),this.on("trackEnabled",P),this.on("trackStopped",C),this._signaling.on("stateChanged",M),this._tracks.forEach(function(D){l._addLocalTrack(D,n.PRIORITY_STANDARD),l._getOrCreateLocalTrackPublication(D).catch(function(O){f.warn("Failed to get or create LocalTrackPublication for "+D+":",O)})})}},g.prototype._getOrCreateLocalTrackPublication=function(l){var f=T(this.tracks,l);if(f)return Promise.resolve(f);var m=this._log,P=this,C=this._signaling.getPublication(l._trackSender);return C?new Promise(function(M,D){function O(){var x=C.error;if(x){C.removeListener("updated",O),m.warn("Failed to publish the "+e(l,!0)+": "+x.message),P._removeTrack(l,l.id),setTimeout(function(){P.emit("trackPublicationFailed",x,l)}),D(x);return}if(!P._tracks.has(l.id)){C.removeListener("updated",O),D(new Error("The "+l+" was unpublished"));return}var E=C.sid;if(E){C.removeListener("updated",O);var q={log:m,LocalAudioTrackPublication:P._LocalAudioTrackPublication,LocalDataTrackPublication:P._LocalDataTrackPublication,LocalVideoTrackPublication:P._LocalVideoTrackPublication};f=T(P.tracks,l);var U=function(A){return P.emit("trackWarning",A,f)},G=function(){return P.emit("trackWarningsCleared",f)},F=function(A){f.removeListener("trackWarning",U),f.removeListener("trackWarningsCleared",G),P.unpublishTrack(A.track)};f||(f=i(l,C,F,q),P._addTrackPublication(f)),f.on("warning",U),f.on("warningsCleared",G);var N=P._signaling.state;(N==="connected"||N==="connecting")&&(l._processorEventObserver&&l._processorEventObserver.on("event",function(A){P._eventObserver.emit("event",{name:A.name,payload:A.data,group:"video-processor",level:"info"})}),l.processedTrack&&(l._captureFrames(),l._setSenderMediaStreamTrack(!0))),N==="connected"&&setTimeout(function(){P.emit("trackPublished",f)}),M(f)}}C.on("updated",O)}):Promise.reject(new Error("Unexpected error: The "+l+" cannot be published"))},g.prototype.publishTrack=function(l,f){var m=T(this.tracks,l);if(m)return Promise.resolve(m);f=Object.assign({log:this._log,priority:n.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},f);var P;try{P=s(l,f)}catch(x){return Promise.reject(x)}var C=P.noiseCancellation,M=this._signaling.audioProcessors;C&&!M.includes(C.vendor)&&(this._log.warn(C.vendor+" is not supported in this room. disabling it permanently"),C.disablePermanently());var D=Object.values(n);if(!D.includes(f.priority))return Promise.reject(t.INVALID_VALUE("LocalTrackPublishOptions.priority",D));var O=this._addTrack(P,P.id,f.priority)||this._tracks.get(P.id);return this._getOrCreateLocalTrackPublication(O)},g.prototype.publishTracks=function(l){if(!Array.isArray(l))throw t.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(l.map(this.publishTrack,this))},g.prototype.setBandwidthProfile=function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")},g.prototype.setNetworkQualityConfiguration=function(l){if(typeof l!="object"||l===null)throw t.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach(function(f){if(f in l&&(typeof l[f]!="number"||isNaN(l[f])))throw t.INVALID_TYPE("networkQualityConfiguration."+f,"number")}),this._signaling.setNetworkQualityConfiguration(l),this},g.prototype.setParameters=function(l){if(typeof l<"u"&&typeof l!="object")throw t.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");if(l){if(this._signaling.getParameters().adaptiveSimulcast&&l.maxVideoBitrate)throw t.INVALID_TYPE("encodingParameters",'encodingParameters.maxVideoBitrate is not compatible with "preferredVideoCodecs=auto"');["maxAudioBitrate","maxVideoBitrate"].forEach(function(f){if(typeof l[f]<"u"&&typeof l[f]!="number"&&l[f]!==null)throw t.INVALID_TYPE("encodingParameters."+f,"number, null or undefined")})}else l===null&&(l={maxAudioBitrate:null,maxVideoBitrate:null});return this._signaling.setParameters(l),this},g.prototype.unpublishTrack=function(l){a(l,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var f=this._tracks.get(l.id);if(!f)return null;var m=this._signaling.getPublication(f._trackSender);if(m.publishFailed(new Error("The "+f+" was unpublished")),f=this._removeTrack(f,f.id),!f)return null;var P=T(this.tracks,f);return P&&this._removeTrackPublication(P),P},g.prototype.unpublishTracks=function(l){var f=this;if(!Array.isArray(l))throw t.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return l.reduce(function(m,P){var C=f.unpublishTrack(P);return C?m.concat(C):m},[])},g}(S);function T(b,g){return Array.from(b.values()).find(function(l){return l.track===g||l.track.mediaStreamTrack===g})||null}return br=L,br}var Zn,Ro;function Ju(){if(Ro)return Zn;Ro=1;var k=function(){function p(){Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return p.prototype.connect=function(){},p.prototype.disconnect=function(){return this._connected?(this._connected=!1,!0):!1},p.prototype.publish=function(){return this._connected},p}();return Zn=k,Zn}var Et,Lo;function Xu(){if(Lo)return Et;Lo=1;var k=Et&&Et.__extends||function(){var a=function(o,c){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(o,c)};return function(o,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(o,c);function d(){this.constructor=o}o.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}(),p=Et&&Et.__read||function(a,o){var c=typeof Symbol=="function"&&a[Symbol.iterator];if(!c)return a;var d=c.call(a),v,u=[],y;try{for(;(o===void 0||o-- >0)&&!(v=d.next()).done;)u.push(v.value)}catch(h){y={error:h}}finally{try{v&&!v.done&&(c=d.return)&&c.call(d)}finally{if(y)throw y.error}}return u},_=Ue().EventEmitter,s=Oe(),i=s.DEFAULT_NQ_LEVEL_LOCAL,e=s.DEFAULT_NQ_LEVEL_REMOTE,r=s.MAX_NQ_LEVEL,t=Ce().inRange,n=function(a){k(o,a);function o(c){var d=a.call(this)||this;return c=Object.assign({local:i,remote:e},c),Object.defineProperties(d,{local:{value:t(c.local,i,r)?c.local:i,writable:!0},remote:{value:t(c.remote,e,r)?c.remote:e,writable:!0}}),d}return o.prototype.update=function(c){var d=this;c=Object.assign({local:this.local,remote:this.remote},c),[["local",i,3],["remote",e,3]].forEach(function(v){var u=p(v,3),y=u[0],h=u[1],S=u[2];d[y]=typeof c[y]=="number"&&t(c[y],h,S)?c[y]:h})},o}(_);return Et=n,Et}var lt,xo;function Zu(){if(xo)return lt;xo=1;var k=lt&&lt.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=lt&&lt.__read||function(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),a,o=[],c;try{for(;(r===void 0||r-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(d){c={error:d}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(c)throw c.error}}return o},_=lt&&lt.__spreadArray||function(e,r){for(var t=0,n=r.length,a=e.length;t<n;t++,a++)e[a]=r[t];return e},s=Lc(),i=function(e){k(r,e);function r(t,n){var a=e.call(this,t,n)||this;return a._handleTrackSignalingEvents(),a.once("disconnected",a._unsubscribeTracks.bind(a)),a}return r.prototype.toString=function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},r.prototype._addTrack=function(t,n,a){return e.prototype._addTrack.call(this,t,a)?(n._subscribed(t),this.emit("trackSubscribed",t,n),t):null},r.prototype._addTrackPublication=function(t){var n=e.prototype._addTrackPublication.call(this,t);return n?(this.emit("trackPublished",n),n):null},r.prototype._getTrackPublicationEvents=function(){return _(_([],p(e.prototype._getTrackPublicationEvents.call(this))),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]])},r.prototype._unsubscribeTracks=function(){var t=this;this.tracks.forEach(function(n){if(n.isSubscribed){var a=n.track;n._unsubscribe(),t.emit("trackUnsubscribed",a,n)}})},r.prototype._removeTrack=function(t,n,a){var o=this._tracks.get(a);return o?(e.prototype._removeTrack.call(this,o,a),n._unsubscribe(),this.emit("trackUnsubscribed",o,n),o):null},r.prototype._removeTrackPublication=function(t){this._signaling.clearTrackHint(t.trackSid);var n=e.prototype._removeTrackPublication.call(this,t);return n?(this.emit("trackUnpublished",n),n):null},r}(s);return lt=i,lt}var ei,Ao;function xc(){if(Ao)return ei;Ao=1;var k=function(){function p(_,s){if(typeof _!="string")throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:_,enumerable:!0},trackSid:{value:s.trackSid,enumerable:!0},timestamp:{value:s.timestamp,enumerable:!0},ssrc:{value:s.ssrc,enumerable:!0},packetsLost:{value:typeof s.packetsLost=="number"?s.packetsLost:null,enumerable:!0},codec:{value:typeof s.codecName=="string"?s.codecName:null,enumerable:!0}})}return p}();return ei=k,ei}var kr,Mo;function Ac(){if(Mo)return kr;Mo=1;var k=kr&&kr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=xc(),_=function(s){k(i,s);function i(e,r,t){var n=s.call(this,e,r)||this;return Object.defineProperties(n,{bytesSent:{value:typeof r.bytesSent=="number"?r.bytesSent:t?0:null,enumerable:!0},packetsSent:{value:typeof r.packetsSent=="number"?r.packetsSent:t?0:null,enumerable:!0},roundTripTime:{value:typeof r.roundTripTime=="number"?r.roundTripTime:t?0:null,enumerable:!0}}),n}return i}(p);return kr=_,kr}var Sr,Io;function el(){if(Io)return Sr;Io=1;var k=Sr&&Sr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ac(),_=function(s){k(i,s);function i(e,r,t){var n=s.call(this,e,r,t)||this;return Object.defineProperties(n,{audioLevel:{value:typeof r.audioInputLevel=="number"?r.audioInputLevel:null,enumerable:!0},jitter:{value:typeof r.jitter=="number"?r.jitter:null,enumerable:!0}}),n}return i}(p);return Sr=_,Sr}var Tr,Do;function tl(){if(Do)return Tr;Do=1;var k=Tr&&Tr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ac(),_=function(s){k(i,s);function i(e,r,t){var n=s.call(this,e,r,t)||this,a=null;typeof r.frameWidthInput=="number"&&typeof r.frameHeightInput=="number"&&(a={},Object.defineProperties(a,{width:{value:r.frameWidthInput,enumerable:!0},height:{value:r.frameHeightInput,enumerable:!0}}));var o=null;return typeof r.frameWidthSent=="number"&&typeof r.frameHeightSent=="number"&&(o={},Object.defineProperties(o,{width:{value:r.frameWidthSent,enumerable:!0},height:{value:r.frameHeightSent,enumerable:!0}})),Object.defineProperties(n,{captureDimensions:{value:a,enumerable:!0},dimensions:{value:o,enumerable:!0},captureFrameRate:{value:typeof r.frameRateInput=="number"?r.frameRateInput:null,enumerable:!0},frameRate:{value:typeof r.frameRateSent=="number"?r.frameRateSent:null,enumerable:!0}}),n}return i}(p);return Tr=_,Tr}var wr,jo;function Mc(){if(jo)return wr;jo=1;var k=wr&&wr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=xc(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e,r)||this;return Object.defineProperties(t,{bytesReceived:{value:typeof r.bytesReceived=="number"?r.bytesReceived:null,enumerable:!0},packetsReceived:{value:typeof r.packetsReceived=="number"?r.packetsReceived:null,enumerable:!0}}),t}return i}(p);return wr=_,wr}var Er,No;function rl(){if(No)return Er;No=1;var k=Er&&Er.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mc(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e,r)||this;return Object.defineProperties(t,{audioLevel:{value:typeof r.audioOutputLevel=="number"?r.audioOutputLevel:null,enumerable:!0},jitter:{value:typeof r.jitter=="number"?r.jitter:null,enumerable:!0}}),t}return i}(p);return Er=_,Er}var Pr,qo;function nl(){if(qo)return Pr;qo=1;var k=Pr&&Pr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Mc(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e,r)||this,n=null;return typeof r.frameWidthReceived=="number"&&typeof r.frameHeightReceived=="number"&&(n={},Object.defineProperties(n,{width:{value:r.frameWidthReceived,enumerable:!0},height:{value:r.frameHeightReceived,enumerable:!0}})),Object.defineProperties(t,{dimensions:{value:n,enumerable:!0},frameRate:{value:typeof r.frameRateReceived=="number"?r.frameRateReceived:null,enumerable:!0}}),t}return i}(p);return Pr=_,Pr}var ti,Vo;function Ic(){if(Vo)return ti;Vo=1;var k=el(),p=tl(),_=rl(),s=nl(),i=function(){function e(r,t,n){if(typeof r!="string")throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:r,enumerable:!0},localAudioTrackStats:{value:t.localAudioTrackStats.map(function(a){return new k(a.trackId,a,n)}),enumerable:!0},localVideoTrackStats:{value:t.localVideoTrackStats.map(function(a){return new p(a.trackId,a,n)}),enumerable:!0},remoteAudioTrackStats:{value:t.remoteAudioTrackStats.map(function(a){return new _(a.trackId,a)}),enumerable:!0},remoteVideoTrackStats:{value:t.remoteVideoTrackStats.map(function(a){return new s(a.trackId,a)}),enumerable:!0}})}return e}();return ti=i,ti}var dt,Fo;function il(){if(Fo)return dt;Fo=1;var k=dt&&dt.__extends||function(){var S=function(L,T){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,g){b.__proto__=g}||function(b,g){for(var l in g)Object.prototype.hasOwnProperty.call(g,l)&&(b[l]=g[l])},S(L,T)};return function(L,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");S(L,T);function b(){this.constructor=L}L.prototype=T===null?Object.create(T):(b.prototype=T.prototype,new b)}}(),p=dt&&dt.__read||function(S,L){var T=typeof Symbol=="function"&&S[Symbol.iterator];if(!T)return S;var b=T.call(S),g,l=[],f;try{for(;(L===void 0||L-- >0)&&!(g=b.next()).done;)l.push(g.value)}catch(m){f={error:m}}finally{try{g&&!g.done&&(T=b.return)&&T.call(b)}finally{if(f)throw f.error}}return l},_=dt&&dt.__spreadArray||function(S,L){for(var T=0,b=L.length,g=S.length;T<b;T++,g++)S[g]=L[T];return S},s=ln(),i=Zu(),e=Ic(),r=Ce(),t=r.flatMap,n=r.valueToJSON,a=0,o=function(S){k(L,S);function L(T,b,g){var l=S.call(this)||this,f=g.log.createLog("default",l),m=new Map;return Object.defineProperties(l,{_log:{value:f},_clientTrackSwitchOffControl:{value:g.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:g.contentPreferencesMode||"disabled"},_instanceId:{value:++a},_options:{value:g},_participants:{value:m},_signaling:{value:b},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(b.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return b.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:T},name:{enumerable:!0,value:b.name},participants:{enumerable:!0,value:m},sid:{enumerable:!0,value:b.sid},state:{enumerable:!0,get:function(){return b.state}},mediaRegion:{enumerable:!0,value:b.mediaRegion}}),u(l,T),y(l,b.recording),h(l,b),c(l),f.info("Created a new Room:",l.name),f.debug("Initial RemoteParticipants:",Array.from(l._participants.values())),l}return L.prototype.toString=function(){return"[Room #"+this._instanceId+": "+this.sid+"]"},L.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},L.prototype.getStats=function(){var T=this;return this._signaling.getStats().then(function(b){return Array.from(b).map(function(g){var l=p(g,2),f=l[0],m=l[1];return new e(f,Object.assign({},m,{localAudioTrackStats:d(T,m.localAudioTrackStats),localVideoTrackStats:d(T,m.localVideoTrackStats)}))})})},L.prototype.refreshInactiveMedia=function(){var T=this.localParticipant.tracks,b=Array.from(T.values()).filter(function(P){var C=P.track.kind;return C!=="data"}).map(function(P){var C=P.track;return C}),g=t(this.participants,function(P){return Array.from(P.tracks.values())}).filter(function(P){var C=P.track;return C&&C.kind!=="data"}).map(function(P){var C=P.track;return C}),l=b.concat(g),f=new Event("unmute");b.forEach(function(P){var C=P.isMuted,M=P.mediaStreamTrack;C&&M.dispatchEvent(f)});var m=new Event("pause");return l.forEach(function(P){var C=P._attachments,M=P._elShims;return C.forEach(function(D){var O=M.get(D),x=D.paused&&O&&!O.pausedIntentionally();x&&D.dispatchEvent(m)})}),this},L.prototype.toJSON=function(){return n(this)},L}(s);function c(S){var L=S.localParticipant._signaling.audioProcessors;S.localParticipant.audioTracks.forEach(function(T){var b=T.track,g=b.noiseCancellation;g&&!L.includes(g.vendor)&&(S._log.warn(g.vendor+" is not supported in this room. disabling it permanently"),g.disablePermanently())})}function d(S,L){var T=S.localParticipant._signaling;return L.reduce(function(b,g){var l=T.tracks.get(g.trackId),f=T.getSender(l);return f?[Object.assign({},g,{trackId:f.id})].concat(b):b},[])}function v(S,L){var T=S._log,b=S._clientTrackSwitchOffControl,g=S._contentPreferencesMode,l=S._options,f=l.MediaStream,m=l.mapMediaElement,P=l.disposeMediaElement,C=new i(L,{log:T,clientTrackSwitchOffControl:b,contentPreferencesMode:g,MediaStream:f,mapMediaElement:m,disposeMediaElement:P});T.info("A new RemoteParticipant connected:",C),S._participants.set(C.sid,C),S.emit("participantConnected",C);var M=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map(function(D){var O=p(Array.isArray(D)?D:[D,D],2),x=O[0],E=O[1];function q(){var U=[].slice.call(arguments);U.unshift(E),U.push(C),S.emit.apply(S,_([],p(U)))}return C.on(x,q),[x,q]});C.once("disconnected",function(){var O=S.dominantSpeaker;T.info("RemoteParticipant disconnected:",C),S._participants.delete(C.sid),M.forEach(function(x){C.removeListener(x[0],x[1])}),S.emit("participantDisconnected",C),C===O&&S.emit("dominantSpeakerChanged",S.dominantSpeaker)})}function u(S,L){var T=["trackWarning","trackWarningsCleared"].map(function(b){return{eventName:b,handler:function(){for(var g=[],l=0;l<arguments.length;l++)g[l]=arguments[l];return S.emit.apply(S,_([b],p(_(_([],p(g)),[L]))))}}});T.forEach(function(b){var g=b.eventName,l=b.handler;return L.on(g,l)}),S.once("disconnected",function(){return T.forEach(function(b){var g=b.eventName,l=b.handler;return L.removeListener(g,l)})})}function y(S,L){L.on("updated",function(){var b=L.isEnabled;S._log.info("Recording "+(b?"started":"stopped")),S.emit("recording"+(b?"Started":"Stopped"))})}function h(S,L){var T=S._log;T.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),L.participants.forEach(v.bind(null,S)),T.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),L.on("participantConnected",v.bind(null,S)),L.on("dominantSpeakerChanged",function(){return S.emit("dominantSpeakerChanged",S.dominantSpeaker)}),L.on("stateChanged",function b(g,l){switch(T.info("Transitioned to state:",g),g){case"disconnected":S.participants.forEach(function(f){f._unsubscribeTracks()}),S.emit(g,S,l),S.localParticipant.tracks.forEach(function(f){f.unpublish()}),L.removeListener("stateChanged",b);break;case"reconnecting":setTimeout(function(){return S.emit("reconnecting",l)},0);break;default:setTimeout(function(){return S.emit("reconnected")},0)}})}return dt=o,dt}var ri,Bo;function Dc(){if(Bo)return ri;Bo=1;var k=function(){function p(_){Object.defineProperties(this,{_min:{value:_.min||100},_max:{value:_.max||1e4},_jitter:{value:_.jitter>0&&_.jitter<=1?_.jitter:0},_factor:{value:_.factor||2},_attempts:{value:0,writable:!0},_duration:{enumerable:!1,get:function(){var s=this._min*Math.pow(this._factor,this._attempts);if(this._jitter){var i=Math.random(),e=Math.floor(i*this._jitter*s);s=(Math.floor(i*10)&1)===0?s-e:s+e}return Math.min(s,this._max)|0}},_timeoutID:{value:null,writable:!0}})}return p.prototype.backoff=function(_){var s=this,i=this._duration;this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._timeoutID=setTimeout(function(){s._attempts++,_()},i)},p.prototype.reset=function(){this._attempts=0,this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},p}();return ri=k,ri}var Ne={},Cr,Uo;function al(){if(Uo)return Cr;Uo=1;var k=Cr&&Cr.__read||function(v,u){var y=typeof Symbol=="function"&&v[Symbol.iterator];if(!y)return v;var h=y.call(v),S,L=[],T;try{for(;(u===void 0||u-- >0)&&!(S=h.next()).done;)L.push(S.value)}catch(b){T={error:b}}finally{try{S&&!S.done&&(y=h.return)&&y.call(h)}finally{if(T)throw T.error}}return L},p=Ce(),_=p.difference,s=p.flatMap;function i(){var v=4294967295;return String(Math.floor(Math.random()*v))}var e=function(){function v(u,y,h){Object.defineProperties(this,{cName:{enumerable:!0,value:h},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:y},trackId:{enumerable:!0,value:u}})}return v.prototype.addSimulcastSSRCs=function(){if(!this.isSimulcastEnabled){var u=[i(),i()];u.forEach(function(y){this.primarySSRCs.add(y)},this),this.rtxPairs.size&&u.forEach(function(y){this.rtxPairs.set(i(),y)},this)}},v.prototype.addSSRC=function(u,y,h){y?this.rtxPairs.set(u,y):this.primarySSRCs.add(u),this.isSimulcastEnabled=this.isSimulcastEnabled||h},v.prototype.toSdpLines=function(u){var y=this,h=u?[]:Array.from(this.rtxPairs.entries()).map(function(l){return l.reverse()}),S=Array.from(this.primarySSRCs.values()),L=h.length?s(h):S,T=s(L,function(l){return["a=ssrc:"+l+" cname:"+y.cName,"a=ssrc:"+l+" msid:"+y.streamId+" "+y.trackId]}),b=h.map(function(l){return"a=ssrc-group:FID "+l.join(" ")}),g=["a=ssrc-group:SIM "+S.join(" ")];return b.concat(T).concat(g)},v}();function r(v,u){var y=v.match(new RegExp(u,"gm"))||[];return y.map(function(h){var S=h.match(new RegExp(u))||[];return S.slice(1)})}function t(v){var u="^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$";return new Set(s(r(v,u)))}function n(v,u,y){var h="a=ssrc:"+u+" "+y+":(.+)";return v.match(new RegExp(h))[1]}function a(v){var u="^a=ssrc-group:FID ([0-9]+) ([0-9]+)$";return new Map(r(v,u).map(function(y){return y.reverse()}))}function o(v){var u=k(s(r(v,"^a=msid:(.+) (.+)$")),2),y=u[0],h=u[1],S=s(r(v,"^a=ssrc:(.+) cname:.+$"));return S.map(function(L){return[L,y,h]})}function c(v){var u=t(v),y=a(v),h=o(v);return h.reduce(function(S,L){var T=L[0],b=L[1],g=L[2],l=S.get(g)||new e(g,b,n(v,T,"cname")),f=y.get(T)||null;return l.addSSRC(T,f,u.has(T)),S.set(g,l)},new Map)}function d(v,u){var y=c(v),h=Array.from(y.keys()),S=Array.from(u.keys()),L=_(h,S),T=_(S,h),b=s(L,function(M){return y.get(M)});b.forEach(function(M){M.addSimulcastSSRCs(),u.set(M.trackId,M)}),S=Array.from(u.keys());var g=_(S,T),l=s(g,function(M){return u.get(M)}),f=!v.match(/a=rtpmap:[0-9]+ rtx/),m=s(l,function(M){return M.toSdpLines(f)}),P=s(new Set(v.split(`\r
`).concat(m))),C="a=x-google-flag:conference";return v.match(C)||P.push(C),P.join(`\r
`)}return Cr=d,Cr}var Wo;function Di(){if(Wo)return Ne;Wo=1;var k=Ne&&Ne.__read||function(M,D){var O=typeof Symbol=="function"&&M[Symbol.iterator];if(!O)return M;var x=O.call(M),E,q=[],U;try{for(;(D===void 0||D-- >0)&&!(E=x.next()).done;)q.push(E.value)}catch(G){U={error:G}}finally{try{E&&!E.done&&(O=x.return)&&O.call(x)}finally{if(U)throw U.error}}return q},p=Ce(),_=p.difference,s=p.flatMap,i=al(),e={0:"PCMU",8:"PCMA"};function r(M){return Array.from(n(M)).reduce(function(D,O){var x=O[0],E=O[1],q=D.get(E)||[];return D.set(E,q.concat(x))},new Map)}function t(M){return c(M).reduce(function(D,O){var x=o(O);return x?D.set(x,O):D},new Map)}function n(M){return d(M).reduce(function(D,O){var x=new RegExp("a=rtpmap:"+O+" ([^/]+)"),E=M.match(x),q=E?E[1].toLowerCase():e[O]?e[O].toLowerCase():"";return D.set(O,q)},new Map)}function a(M,D){var O=new RegExp("^a=fmtp:"+M+" (.+)$","m"),x=D.match(O);return x&&x[1].split(";").reduce(function(E,q){var U=k(q.split("="),2),G=U[0],F=U[1];return E[G]=isNaN(F)?F:parseInt(F,10),E},{})}function o(M){var D=M.match(/^a=mid:(.+)$/m);return D&&D[1]}function c(M,D,O){return M.replace(/\r\n\r\n$/,`\r
`).split(`\r
m=`).slice(1).map(function(x){return"m="+x}).filter(function(x){var E=new RegExp("m="+(D||".*"),"gm"),q=new RegExp("a="+(O||".*"),"gm");return E.test(x)&&q.test(x)})}function d(M){var D=M.split(`\r
`)[0],O=D.match(/([0-9]+)/g);return O?O.slice(1).map(function(x){return parseInt(x,10)}):[]}function v(M,D){D=D.map(function(q){var U=q.codec;return U.toLowerCase()});var O=s(D,function(q){return M.get(q)||[]}),x=_(Array.from(M.keys()),D),E=s(x,function(q){return M.get(q)});return O.concat(E)}function u(M,D){var O=D.split(`\r
`),x=O[0],E=O.slice(1);return x=x.replace(/([0-9]+\s?)+$/,M.join(" ")),[x].concat(E).join(`\r
`)}function y(M,D,O){var x=c(M),E=M.split(`\r
m=`)[0];return[E].concat(x.map(function(q){if(!/^m=(audio|video)/.test(q))return q;var U=q.match(/^m=(audio|video)/)[1],G=r(q),F=U==="audio"?D:O,N=v(G,F),A=u(N,q),w=G.get("pcma")||[],j=G.get("pcmu")||[],Q=U==="audio"?new Set(w.concat(j)):new Set;return Q.has(N[0])?A.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):A})).join(`\r
`)}function h(M,D){var O=c(M),x=M.split(`\r
m=`)[0];return[x].concat(O.map(function(E){if(E=E.replace(/\r\n$/,""),!/^m=video/.test(E))return E;var q=r(E),U=d(E),G=new Set(q.get("vp8")||[]),F=U.some(function(N){return G.has(N)});return F?i(E,D):E})).concat("").join(`\r
`)}function S(M,D,O,x,E){var q=O.get(M)||[];if(q.length<=1)return q;var U=a(D,E);if(!U)return q;var G=q.find(function(F){var N=a(F,x);return N&&Object.keys(U).every(function(A){return U[A]===N[A]})});return typeof G=="number"?[G]:q}function L(M,D,O){if(!/^m=(audio|video)/.test(M))return M;var x=o(M),E=x&&D.get(x);if(!E)return M;var q=n(E),U=r(M),G=s(Array.from(q),function(w){var j=k(w,2),Q=j[0],Y=j[1];return Y!=="rtx"&&!O.includes(Y)?S(Y,Q,U,M,E):[]}),F=U.get("rtx")||[];G=G.concat(F.filter(function(w){var j=a(w,M);return j&&G.includes(j.apt)}));var N=M.split(`\r
`).filter(function(w){var j=w.match(/^a=(rtpmap|fmtp|rtcp-fb):(.+) .+$/),Q=j&&j[2];return!j||Q&&G.includes(parseInt(Q,10))}),A=d(M).filter(function(w){return G.includes(w)});return u(A,N.join(`\r
`))}function T(M,D){var O=c(M),x=M.split(`\r
m=`)[0],E=t(D);return[x].concat(O.map(function(q){return L(q,E,[])})).join(`\r
`)}function b(M,D,O,x){x===void 0&&(x=!1);var E=t(O),q=t(D),U=c(M),G=M.split(`\r
m=`)[0];return[G].concat(U.map(function(F){if(F=F.replace(/\r\n$/,""),!/^m=video/.test(F))return F;var N=F.match(/^a=mid:(.+)$/m),A=N&&N[1];if(!A)return F;var w=E.get(A),j=n(w),Q=d(w),Y=Q.length&&j.get(Q[0])==="vp8",$=x||!Y;return $?q.get(A).replace(/\r\n$/,""):F})).concat("").join(`\r
`)}function g(M,D,O){var x=Array.from(O).reduce(function(E,q){var U=k(q,2),G=U[0],F=U[1],N=c(M,G,"send(only|recv)"),A=N.map(o).filter(function(w){return!D.has(w)});return A.forEach(function(w,j){return E.set(w,F[j])}),E},new Map);return l(M,x)}function l(M,D){var O=c(M),x=M.split(`\r
m=`)[0];return[x].concat(O.map(function(E){if(!/^m=(audio|video)/.test(E))return E;var q=o(E);if(!q)return E;var U=D.get(q);if(!U)return E;var G=(E.match(/^a=msid:(.+)$/m)||[])[1];if(!G)return E;var F=k(G.split(" "),2),N=F[0],A=F[1],w=new RegExp("msid:"+N+(A?" "+A:"")+"$","gm");return E.replace(w,"msid:"+N+" "+U)})).join(`\r
`)}function f(M,D){return M.split(`\r
`).filter(function(O){return!D.find(function(x){return new RegExp("a=ssrc:.*"+x+":","g").test(O)})}).join(`\r
`)}function m(M){var D=c(M),O=M.split(`\r
m=`)[0];return[O].concat(D.map(function(x){if(!/^m=video/.test(x))return x;var E=r(x),q=E.get("rtx");if(!q)return x;var U=new Set(d(x));q.forEach(function(A){return U.delete(A)});var G=x.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),F=G&&G[1],N=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(F?[new RegExp("^a=ssrc:"+F+" .+$")]:[]);return x=x.split(`\r
`).filter(function(A){return N.every(function(w){return!w.test(A)})}).join(`\r
`),u(Array.from(U),x)})).join(`\r
`)}function P(M,D){var O=Object.entries(D).map(function(x){var E=k(x,2),q=E[0],U=E[1];return q+"="+U}).join(";");return"a=fmtp:"+M+" "+O}function C(M,D){var O=c(M),x=M.split(`\r
m=`)[0];return D=D||O.filter(function(E){return/^m=audio/.test(E)}).map(o),[x].concat(O.map(function(E){if(!/^m=audio/.test(E))return E;var q=r(E),U=q.get("opus");if(!U)return E;var G=a(U,E);if(!G)return E;var F=P(U,G),N=new RegExp(F),A=o(E);D.includes(A)?G.usedtx=1:delete G.usedtx;var w=P(U,G);return E.replace(N,w)})).join(`\r
`)}return Ne.addOrRewriteNewTrackIds=g,Ne.addOrRewriteTrackIds=l,Ne.createCodecMapForMediaSection=r,Ne.createPtToCodecName=n,Ne.disableRtx=m,Ne.enableDtxForOpus=C,Ne.filterLocalCodecs=T,Ne.getMediaSections=c,Ne.removeSSRCAttributes=f,Ne.revertSimulcast=b,Ne.setCodecPreferences=y,Ne.setSimulcast=h,Ne}var ni,Ho;function ol(){if(Ho)return ni;Ho=1;var k=function(){function p(_){_=Object.assign({getKey:function(i){return i},getValue:function(i){return i},isLessThanOrEqualTo:function(i,e){return i<=e}},_),Object.defineProperties(this,{_getKey:{value:_.getKey},_getValue:{value:_.getValue},_isLessThanOrEqualTo:{value:_.isLessThanOrEqualTo},_map:{value:new Map}})}return p.prototype.toMap=function(){return new Map(this._map)},p.prototype.updateAndFilter=function(_){return _.filter(this.update,this)},p.prototype.update=function(_){var s=this._getKey(_),i=this._getValue(_);return this._map.has(s)&&this._isLessThanOrEqualTo(i,this._map.get(s))?!1:(this._map.set(s,i),!0)},p}();return ni=k,ni}var ii,Go;function sl(){if(Go)return ii;Go=1;var k=ol(),p=function(){function _(){Object.defineProperties(this,{_filter:{value:new k({getKey:function(i){return i.ufrag},isLessThanOrEqualTo:function(i,e){return i.revision<=e.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return _.prototype.setUfrag=function(s){this._ufrag=s;var i=this._filter.toMap().get(s);return i?i.candidates:[]},_.prototype.update=function(s){s.candidates=s.candidates||[];var i=this._filter.toMap().get(s.ufrag),e=i?i.candidates:[];return this._filter.update(s)&&this._ufrag===s.ufrag?s.candidates.slice(e.length):[]},_}();return ii=p,ii}var ai,Qo;function cl(){if(Qo)return ai;Qo=1;var k=Oe(),p=k.ICE_ACTIVITY_CHECK_PERIOD_MS,_=k.ICE_INACTIVITY_THRESHOLD_MS,s=function(){function i(e,r){r=Object.assign({activityCheckPeriodMs:p,inactivityThresholdMs:_},r),Object.defineProperties(this,{_activityCheckPeriodMs:{value:r.activityCheckPeriodMs},_inactivityThresholdMs:{value:r.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:e},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return i.prototype._getActivePairStat=function(e){var r=Array.from(e.values()),t=r.find(function(n){return n.type==="candidate-pair"&&n.nominated});return t||{bytesReceived:0,timestamp:Math.round(new Date().getTime())}},i.prototype._getIceConnectionStats=function(){var e=this;return this._peerConnection.getStats().then(function(r){return e._getActivePairStat(r)}).catch(function(){return null})},i.prototype._scheduleInactivityCallback=function(e){var r=this;e&&this._onIceConnectionStateChanged===null?(this._onIceConnectionStateChanged=function(){r._peerConnection.iceConnectionState==="disconnected"&&e()},this._peerConnection.addEventListener?this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=this._onIceConnectionStateChanged):!e&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener?this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=null,this._onIceConnectionStateChanged=null)},i.prototype.start=function(e){var r=this;this.stop(),this._timer=setInterval(function(){r._getIceConnectionStats().then(function(t){t&&((!r._lastActivity||r._lastActivity.bytesReceived!==t.bytesReceived)&&(r._lastActivity=t,r._scheduleInactivityCallback(null)),t.timestamp-r._lastActivity.timestamp>=r._inactivityThresholdMs&&(r._peerConnection.iceConnectionState==="disconnected"?e():r._onIceConnectionStateChanged===null&&r._scheduleInactivityCallback(e)))})},this._activityCheckPeriodMs)},i.prototype.stop=function(){this._scheduleInactivityCallback(null),this._timer!==null&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)},i}();return ai=s,ai}var Or,$o;function ul(){if($o)return Or;$o=1;var k=Or&&Or.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(s){k(i,s);function i(e){var r=s.call(this)||this;return Object.defineProperties(r,{_dataChannel:{value:e},_messageQueue:{value:[]}}),e.addEventListener("open",function(){r._messageQueue.splice(0).forEach(function(t){return r._publish(t)})}),e.addEventListener("message",function(t){var n=t.data;try{var a=JSON.parse(n);r.emit("message",a)}catch{}}),r.publish({type:"ready"}),r}return i.prototype._publish=function(e){var r=JSON.stringify(e);try{this._dataChannel.send(r)}catch{}},i.prototype.publish=function(e){var r=this._dataChannel;return r.readyState==="closing"||r.readyState==="closed"?!1:r.readyState==="connecting"?(this._messageQueue.push(e),!0):(this._publish(e),!0)},i}(p);return Or=_,Or}var Rr,Ko;function ll(){if(Ko)return Rr;Ko=1;var k=Rr&&Rr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=kc(),_=ul(),s=function(i){k(e,i);function e(r){var t=i.call(this,r.label,r.maxPacketLifeTime,r.maxRetransmits,r.ordered)||this;return Object.defineProperties(t,{_dataChannel:{value:r}}),r.binaryType="arraybuffer",r.addEventListener("message",function(n){t.emit("message",n.data)}),r.addEventListener("close",function(){t.emit("close")}),t}return e.prototype.stop=function(){this._dataChannel.close(),i.prototype.stop.call(this)},e.prototype.toDataTransport=function(){return new _(this._dataChannel)},e}(p);return Rr=s,Rr}var Lr,zo;function dl(){if(zo)return Lr;zo=1;var k=Lr&&Lr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=mc(),_=function(s){k(i,s);function i(e,r){return s.call(this,e,r)||this}return i}(p);return Lr=_,Lr}var oi,Yo;function fl(){if(Yo)return oi;Yo=1;var k=Di().getMediaSections,p=function(){function _(){Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return _.prototype.match=function(s){return this._midsToTrackIds.get(s.transceiver.mid)||null},_.prototype.update=function(s){var i=k(s,"(audio|video)");this._midsToTrackIds=i.reduce(function(e,r){var t=r.match(/^a=mid:(.+)$/m)||[],n=r.match(/^a=msid:.+ (.+)$/m)||[],a=t[1],o=n[1];return a&&o?e.set(a,o):e},this._midsToTrackIds)},_}();return oi=p,oi}var si,Jo;function vl(){if(Jo)return si;Jo=1;var k=Ot().RTCSessionDescription,p=Di(),_=p.createPtToCodecName,s=p.getMediaSections;function i(u){var y={type:u.type};return u.type!=="rollback"&&(y.sdp=e(u.sdp)),new k(y)}function e(u){var y=s(u),h=u.split(`\r
m=`)[0];return[h].concat(y.map(r)).join(`\r
`)}function r(u){var y=_(u);u=t(u,y);var h=n(y),S=h.get("rtx")||new Set,L=new Set,T=a(u,y,S,L),b=o(T,L),g=Array.from(L),l=["h264","vp8","vp9"],f=l.reduce(function(m,P){var C=h.get(P)||new Set;return Array.from(C).reduce(function(M,D){return b.has(D)?M:M.add(D)},m)},new Set);return f.forEach(function(m){if(g.length){var P=g.shift();u=c(u,P),u=v(u,P,m)}}),g.forEach(function(m){u=c(u,m),u=d(u,m)}),u}function t(u,y){return Array.from(y.keys()).reduce(function(h,S){var L=new RegExp("^a=rtpmap:"+S+" rtx.+$","gm");return(h.match(L)||[]).slice(y.get(S)==="rtx"?1:0).reduce(function(T,b){var g=new RegExp(`\r
`+b),l=new RegExp(`\r
a=fmtp:`+S+" apt=[0-9]+");return T.replace(g,"").replace(l,"")},h)},u)}function n(u){var y=new Map;return u.forEach(function(h,S){var L=y.get(h)||new Set;return y.set(h,L.add(S))}),y}function a(u,y,h,S){return Array.from(h).reduce(function(L,T){var b=new RegExp("a=fmtp:"+T+" apt=(\\d+)"),g=u.match(b);if(!g)return S.add(T),L;var l=Number.parseInt(g[1]);if(!y.has(l))return S.add(T),L;var f=y.get(l);return f==="rtx"?(S.add(T),L):L.set(T,l)},new Map)}function o(u,y){var h=Array.from(u).reduce(function(S,L){var T=L[0],b=L[1],g=S.get(b)||new Set;return S.set(b,g.add(T))},new Map);return Array.from(h).reduce(function(S,L){var T=L[0],b=Array.from(L[1]);return b.length>1?(b.forEach(function(g){y.add(g)}),S):S.set(T,b[0])},new Map)}function c(u,y){var h=new RegExp("a=fmtp:"+y+`.*\r
`,"gm");return u.replace(h,"")}function d(u,y){var h=new RegExp("a=rtpmap:"+y+`.*\r
`,"gm");return u.replace(h,"")}function v(u,y,h){return u.endsWith(`\r
`)?u+"a=fmtp:"+y+" apt="+h+`\r
`:u+`\r
a=fmtp:`+y+" apt="+h}return si=i,si}var ft,Xo;function pl(){if(Xo)return ft;Xo=1;var k=ft&&ft.__extends||function(){var ce=function(te,V){return ce=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(H,J){H.__proto__=J}||function(H,J){for(var X in J)Object.prototype.hasOwnProperty.call(J,X)&&(H[X]=J[X])},ce(te,V)};return function(te,V){if(typeof V!="function"&&V!==null)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");ce(te,V);function H(){this.constructor=te}te.prototype=V===null?Object.create(V):(H.prototype=V.prototype,new H)}}(),p=ft&&ft.__read||function(ce,te){var V=typeof Symbol=="function"&&ce[Symbol.iterator];if(!V)return ce;var H=V.call(ce),J,X=[],re;try{for(;(te===void 0||te-- >0)&&!(J=H.next()).done;)X.push(J.value)}catch(be){re={error:be}}finally{try{J&&!J.done&&(V=H.return)&&V.call(H)}finally{if(re)throw re.error}}return X},_=ft&&ft.__spreadArray||function(ce,te){for(var V=0,H=te.length,J=ce.length;V<H;V++,J++)ce[J]=te[V];return ce},s=Dc(),i=Ot(),e=i.RTCIceCandidate,r=i.RTCPeerConnection,t=i.RTCSessionDescription,n=i.getStats,a=qe(),o=Oe(),c=o.DEFAULT_ICE_GATHERING_TIMEOUT_MS,d=o.DEFAULT_LOG_LEVEL,v=o.DEFAULT_SESSION_TIMEOUT_SEC,u=o.iceRestartBackoffConfig,y=Di(),h=y.addOrRewriteNewTrackIds,S=y.addOrRewriteTrackIds,L=y.createCodecMapForMediaSection,T=y.disableRtx,b=y.enableDtxForOpus,g=y.filterLocalCodecs,l=y.getMediaSections,f=y.removeSSRCAttributes,m=y.revertSimulcast,P=y.setCodecPreferences,C=y.setSimulcast,M=Lt(),D=ht(),O=D.MediaClientLocalDescFailedError,x=D.MediaClientRemoteDescFailedError,E=Ce(),q=E.buildLogLevels,U=E.getPlatform,G=E.isChromeScreenShareTrack,F=E.oncePerTick,N=E.defer,A=sl(),w=cl(),j=ll(),Q=dl(),Y=Dt(),$=ze(),z=fl(),ne=vl(),oe=a.guessBrowser(),ve=U(),le=/android/.test(ve),de=oe==="chrome",ee=oe==="firefox",se=oe==="safari",ie=0,Z={open:["closed","updating"],updating:["closed","open"],closed:[]},he=function(ce){k(te,ce);function te(V,H,J,X){var re=ce.call(this,"open",Z)||this;X=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:G,iceServers:[],logLevel:d,offerOptions:{},revertSimulcast:m,sessionTimeout:v*1e3,setCodecPreferences:P,setSimulcast:C,Backoff:s,IceConnectionMonitor:w,RTCIceCandidate:e,RTCPeerConnection:r,RTCSessionDescription:t,Timeout:M},X);var be=I(Object.assign({},X,X.rtcConfiguration)),Te=q(X.logLevel),Ie=X.RTCPeerConnection;X.enableDscp===!0&&(X.chromeSpecificConstraints=X.chromeSpecificConstraints||{},X.chromeSpecificConstraints.optional=X.chromeSpecificConstraints.optional||[],X.chromeSpecificConstraints.optional.push({googDscp:!0}));var Me=X.log?X.log.createLog("webrtc",re):new $("webrtc",re,Te,X.loggerName),Ee=new Ie(be,X.chromeSpecificConstraints);X.dummyAudioMediaStreamTrack&&Ee.addTrack(X.dummyAudioMediaStreamTrack),Object.defineProperties(re,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_enableDscp:{value:X.enableDscp},_encodingParameters:{value:H},_isChromeScreenShareTrack:{value:X.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new X.Timeout(function(){return re._handleIceGatheringTimeout()},c,!1)},_iceRestartBackoff:{value:new X.Backoff(u)},_instanceId:{value:++ie},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_log:{value:Me},_eventObserver:{value:X.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_rtpNewSenders:{value:new Set},_iceConnectionMonitor:{value:new X.IceConnectionMonitor(Ee)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:X.offerOptions},_onEncodingParametersChanged:{value:F(function(){re._needsAnswer||je(re)})},_peerConnection:{value:Ee},_preferredAudioCodecs:{value:J.audio},_preferredVideoCodecs:{value:J.video},_shouldApplyDtx:{value:J.audio.every(function(ke){var xe=ke.codec;return xe!=="opus"})||J.audio.some(function(ke){var xe=ke.codec,Ve=ke.dtx;return xe==="opus"&&Ve})},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new X.Timeout(function(){Me.debug("ICE reconnect timed out"),re.close()},X.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new A},_setCodecPreferences:{value:ee&&le&&J.video[0]&&J.video[0].codec.toLowerCase()!=="h264"?function(ke){return ke}:X.setCodecPreferences},_setSimulcast:{value:X.setSimulcast},_revertSimulcast:{value:X.revertSimulcast},_RTCIceCandidate:{value:X.RTCIceCandidate},_RTCPeerConnection:{value:X.RTCPeerConnection},_RTCSessionDescription:{value:X.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},_mediaTrackSenderToPublisherHints:{value:new Map},id:{enumerable:!0,value:V}}),H.on("changed",re._onEncodingParametersChanged),Ee.addEventListener("connectionstatechange",re._handleConnectionStateChange.bind(re)),Ee.addEventListener("datachannel",re._handleDataChannelEvent.bind(re)),Ee.addEventListener("icecandidate",re._handleIceCandidateEvent.bind(re)),Ee.addEventListener("iceconnectionstatechange",re._handleIceConnectionStateChange.bind(re)),Ee.addEventListener("icegatheringstatechange",re._handleIceGatheringStateChange.bind(re)),Ee.addEventListener("signalingstatechange",re._handleSignalingStateChange.bind(re)),Ee.addEventListener("track",re._handleTrackEvent.bind(re));var Re=re;return re.on("stateChanged",function ke(xe){xe==="closed"&&(Re.removeListener("stateChanged",ke),Re._dataChannels.forEach(function(Ve,xt){Re.removeDataTrackSender(xt)}))}),re}return te.prototype.toString=function(){return"[PeerConnectionV2 #"+this._instanceId+": "+this.id+"]"},te.prototype.setEffectiveAdaptiveSimulcast=function(V){this._log.debug("Setting setEffectiveAdaptiveSimulcast: ",V),this._preferredVideoCodecs.forEach(function(H){"adaptiveSimulcast"in H&&(H.adaptiveSimulcast=V)})},Object.defineProperty(te.prototype,"_shouldApplySimulcast",{get:function(){if(!de&&!se)return!1;var V=this._preferredVideoCodecs.some(function(H){return H.codec.toLowerCase()==="vp8"&&H.simulcast&&H.adaptiveSimulcast!==!1});return V},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"connectionState",{get:function(){return this.iceConnectionState==="failed"?"failed":this._peerConnection.connectionState||this.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"iceConnectionState",{get:function(){return this._isIceConnectionInactive&&this._peerConnection.iceConnectionState==="disconnected"||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"isApplicationSectionNegotiated",{get:function(){return this._peerConnection.signalingState!=="closed"?this._peerConnection.localDescription?l(this._peerConnection.localDescription.sdp,"application").length>0:!1:!0},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"_isAdaptiveSimulcastEnabled",{get:function(){var V=this._preferredVideoCodecs.find(function(H){return"adaptiveSimulcast"in H});return V&&V.adaptiveSimulcast===!0},enumerable:!1,configurable:!0}),te.prototype._maybeUpdateEncodings=function(V,H,J){if(J===void 0&&(J=!1),V.kind!=="video"||V.readyState==="ended")return!1;var X=V.getSettings(),re=X.height,be=X.width;if(typeof re!="number"||typeof be!="number")return!1;var Te=a.guessBrowser();return Te==="safari"||Te==="chrome"&&this._isAdaptiveSimulcastEnabled?(this._updateEncodings(V,H,J),!0):!1},te.prototype._updateEncodings=function(V,H,J){if(this._isChromeScreenShareTrack(V)){var X=[{scaleResolutionDownBy:1},{scaleResolutionDownBy:1}];H.forEach(function(ke,xe){var Ve=X[xe];Ve?(ke.scaleResolutionDownBy=Ve.scaleResolutionDownBy,J&&delete ke.active):(ke.active=!1,delete ke.scaleResolutionDownBy)})}else{var re=V.getSettings(),be=re.width,Te=re.height,Ie=[{pixels:960*540,maxActiveLayers:3},{pixels:480*270,maxActiveLayers:2},{pixels:0,maxActiveLayers:1}],Me=be*Te,Ee=Ie.find(function(ke){return Me>=ke.pixels}),Re=Math.min(H.length,Ee.maxActiveLayers);H.forEach(function(ke,xe){var Ve=xe<Re;Ve?(ke.scaleResolutionDownBy=1<<Re-xe-1,J&&(ke.active=!0)):(ke.active=!1,delete ke.scaleResolutionDownBy)})}this._log.debug("_updateEncodings:",H.map(function(ke,xe){var Ve=ke.active,xt=ke.scaleResolutionDownBy;return"["+xe+": "+Ve+", "+(xt||0)+"]"}).join(", "))},te.prototype._addIceCandidate=function(V){var H=this;return Promise.resolve().then(function(){return V=new H._RTCIceCandidate(V),H._peerConnection.addIceCandidate(V)}).catch(function(J){H._log.warn("Failed to add RTCIceCandidate "+(V?'"'+V.candidate+'"':"null")+": "+J.message)})},te.prototype._addIceCandidates=function(V){return Promise.all(V.map(this._addIceCandidate,this)).then(function(){})},te.prototype._addOrUpdateTransceiver=function(V){var H=this,J=fe(this,V.kind);if(J&&J.sender){var X=J.sender.track?J.sender.track.id:null;return X&&this._log.warn("Reusing transceiver: "+J.mid+"] "+X+" => "+V.id),this._replaceTrackPromises.set(J,J.sender.replaceTrack(V).then(function(){J.direction="sendrecv"},function(){}).finally(function(){H._replaceTrackPromises.delete(J)})),J}return this._peerConnection.addTransceiver(V,{})},te.prototype._checkIceBox=function(V){var H=K(V);if(!H)return Promise.resolve();var J=this._remoteCandidates.setUfrag(H);return this._addIceCandidates(J)},te.prototype._answer=function(V){var H=this;return Promise.resolve().then(function(){return H._negotiationRole||(H._negotiationRole="answerer"),H._setRemoteDescription(V)}).catch(function(){throw new x}).then(function(){return H._peerConnection.createAnswer()}).then(function(J){ee?J=new H._RTCSessionDescription({sdp:T(J.sdp),type:J.type}):J=ne(J);var X=f(J.sdp,["mslabel","label"]);if(H._shouldApplySimulcast){var re=X;X=H._setSimulcast(re,H._trackIdsToAttributes),X=H._revertSimulcast(X,re,V.sdp)}return X=X.replace(/42e015/g,"42e01f"),H._setLocalDescription({type:J.type,sdp:X})}).then(function(){return H._checkIceBox(V)}).then(function(){return H._queuedDescription&&H._updateDescription(H._queuedDescription)}).then(function(){return H._queuedDescription=null,H._maybeReoffer(H._peerConnection.localDescription)}).catch(function(J){var X=J instanceof x?J:new O;throw H._publishMediaWarning({message:"Failed to _answer",code:X.code,error:J}),X})},te.prototype._close=function(){return this._iceConnectionMonitor.stop(),this._peerConnection.signalingState!=="closed"?(this._peerConnection.close(),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0):!1},te.prototype._handleConnectionStateChange=function(){this.emit("connectionStateChanged")},te.prototype._handleDataChannelEvent=function(V){var H=this,J=V.channel,X=new j(J);this._dataTrackReceivers.add(X),J.addEventListener("close",function(){H._dataTrackReceivers.delete(X)}),this.emit("trackAdded",X)},te.prototype._handleGlare=function(V){var H=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return H._trackIdsToAttributes=new Map(H._appliedTrackIdsToAttributes),H._setLocalDescription({type:"rollback"})}).then(function(){return H._needsAnswer=!1,H._answer(V)}).then(function(J){return J?Promise.resolve():H._offer()})},te.prototype._publishMediaWarning=function(V){var H=V.message,J=V.code,X=V.error,re=V.sdp;this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:H,code:J,context:JSON.stringify({error:X.message,sdp:re})}})},te.prototype._handleIceCandidateEvent=function(V){V.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(V.candidate));var H={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};V.candidate||(H.ice.complete=!0),this._isIceLite&&V.candidate||(H.ice.revision=this._localCandidatesRevision++,this.emit("candidates",H))},te.prototype._handleIceConnectionStateChange=function(){var V=this,H=this._peerConnection.iceConnectionState,J=["connected","completed"].includes(H),X=this._log;X.debug('ICE connection state is "'+H+'"'),J&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),this._lastIceConnectionState!=="failed"&&H==="failed"&&!this._shouldRestartIce&&!this._isRestartingIce?(X.warn("ICE failed"),this._initiateIceRestartBackoff()):["disconnected","failed"].includes(this._lastIceConnectionState)&&J&&X.debug("ICE reconnected"),H==="connected"?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start(function(){V._iceConnectionMonitor.stop(),!V._shouldRestartIce&&!V._isRestartingIce&&(X.warn("ICE Connection Monitor detected inactivity"),V._isIceConnectionInactive=!0,V._initiateIceRestartBackoff(),V.emit("iceConnectionStateChanged"),V.emit("connectionStateChanged"))})):["disconnected","completed"].includes(H)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=H,this.emit("iceConnectionStateChanged")},te.prototype._handleIceGatheringTimeout=function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")},te.prototype._handleIceGatheringStateChange=function(){var V=this._peerConnection.iceGatheringState,H=this._log;H.debug('ICE gathering state is "'+V+'"');var J=this._iceGatheringTimeout,X=J.delay,re=J.isSet;V==="gathering"&&!this._didGenerateLocalCandidates&&!re&&(H.debug("Starting ICE gathering timeout: "+X),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())},te.prototype._handleSignalingStateChange=function(){this._peerConnection.signalingState==="stable"&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))},te.prototype._handleTrackEvent=function(V){var H=this,J=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher=this._trackMatcher||new z,this._trackMatcher.update(J);var X=V.track,re=this._trackMatcher.match(V)||X.id,be=new Q(re,X);this._mediaTrackReceivers.forEach(function(Te){Te.track.id===be.track.id&&H._mediaTrackReceivers.delete(Te)}),this._mediaTrackReceivers.add(be),X.addEventListener?X.addEventListener("ended",function(){return H._mediaTrackReceivers.delete(be)}):X.onended=function(){return H._mediaTrackReceivers.delete(be)},this.emit("trackAdded",be)},te.prototype._initiateIceRestart=function(){if(this._peerConnection.signalingState!=="closed"){var V=this._log;V.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var H=this._iceReconnectTimeout,J=H.delay,X=H.isSet;X||(V.debug("Starting ICE reconnect timeout: "+J),this._iceReconnectTimeout.start()),this.offer().catch(function(re){V.error("offer failed in _initiateIceRestart with: "+re.message)})}},te.prototype._initiateIceRestartBackoff=function(){var V=this;this._peerConnection.signalingState==="closed"||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff(function(){return V._initiateIceRestart()}))},te.prototype._maybeReoffer=function(V){var H=this._shouldOffer;if(V&&V.sdp){var J=this._peerConnection.getSenders().filter(function(Ie){return Ie.track});H=["audio","video"].reduce(function(Ie,Me){var Ee=l(V.sdp,Me,"(sendrecv|sendonly)"),Re=J.filter(R.bind(null,Me));return Ie||Ee.length<Re.length},H);var X=this._dataChannels.size>0,re=l(V.sdp,"application").length>0,be=X&&!re;H=H||be}var Te=H?this._offer():Promise.resolve();return Te.then(function(){return H})},te.prototype._offer=function(){var V=this,H=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,H.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then(function(){return V._peerConnection.createOffer(H)}).catch(function(J){var X=new O;throw V._publishMediaWarning({message:"Failed to create offer",code:X.code,error:J}),X}).then(function(J){ee?J=new V._RTCSessionDescription({sdp:T(J.sdp),type:J.type}):J=ne(J);var X=f(J.sdp,["mslabel","label"]);X=V._peerConnection.remoteDescription?g(X,V._peerConnection.remoteDescription.sdp):X;var re=V._setCodecPreferences(X,V._preferredAudioCodecs,V._preferredVideoCodecs);return V._shouldOffer=!1,V._negotiationRole||(V._negotiationRole="offerer"),V._shouldApplySimulcast&&(V._localDescriptionWithoutSimulcast={type:"offer",sdp:re},re=V._setSimulcast(re,V._trackIdsToAttributes)),V._setLocalDescription({type:"offer",sdp:re})})},te.prototype._getMediaTrackSenderId=function(V){var H=Array.from(this._rtpSenders.keys()).find(function(J){var X=J.track.id;return X===V});return H?H.id:V},te.prototype._addOrRewriteLocalTrackIds=function(V){var H=this,J=this._peerConnection.getTransceivers(),X=J.filter(function(Re){var ke=Re.sender,xe=Re.stopped;return!xe&&ke&&ke.track}),re=X.filter(function(Re){var ke=Re.mid;return ke}),be=new Map(re.map(function(Re){var ke=Re.mid,xe=Re.sender;return[ke,H._getMediaTrackSenderId(xe.track.id)]})),Te=S(V.sdp,be),Ie=X.filter(function(Re){var ke=Re.mid;return!ke}),Me=new Map(["audio","video"].map(function(Re){return[Re,Ie.filter(function(ke){var xe=ke.sender;return xe.track.kind===Re}).map(function(ke){var xe=ke.sender;return H._getMediaTrackSenderId(xe.track.id)})]})),Ee=h(Te,be,Me);return new this._RTCSessionDescription({sdp:Ee,type:V.type})},te.prototype._rollbackAndApplyOffer=function(V){var H=this;return this._setLocalDescription({type:"rollback"}).then(function(){return H._setLocalDescription(V)})},te.prototype._setLocalDescription=function(V){var H=this;return V.type!=="rollback"&&this._shouldApplyDtx&&(V=new this._RTCSessionDescription({sdp:b(V.sdp),type:V.type})),this._peerConnection.setLocalDescription(V).catch(function(J){H._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+V.type+'" failed with the error "'+J.message+'".',J);var X=new O,re={message:'Calling setLocalDescription with an RTCSessionDescription of type "'+V.type+'" failed',code:X.code,error:J};throw V.sdp&&(H._log.warn("The SDP was "+V.sdp),re.sdp=V.sdp),H._publishMediaWarning(re),X}).then(function(){V.type!=="rollback"&&(H._localDescription=H._addOrRewriteLocalTrackIds(V),H._shouldApplyDtx&&(H._localDescription=new H._RTCSessionDescription({sdp:b(H._localDescription.sdp,[]),type:H._localDescription.type})),H._localCandidates=[],V.type==="offer"?H._descriptionRevision++:V.type==="answer"&&(H._lastStableDescriptionRevision=H._descriptionRevision,_e(H)),H._localUfrag=K(V),H.emit("description",H.getState()))})},te.prototype._setRemoteDescription=function(V){var H=this;return V.sdp&&(V.sdp=this._setCodecPreferences(V.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),this._shouldApplyDtx?V.sdp=b(V.sdp):V.sdp=b(V.sdp,[]),ee&&(V.sdp=B(V.sdp)),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(V.sdp))),V=new this._RTCSessionDescription(V),Promise.resolve().then(function(){if(V.type==="answer"&&H._localDescriptionWithoutSimulcast){var J=H._preferredVideoCodecs.find(function(be){return"adaptiveSimulcast"in be}),X=!!J&&J.adaptiveSimulcast===!1,re=H._revertSimulcast(H._localDescription.sdp,H._localDescriptionWithoutSimulcast.sdp,V.sdp,X);if(H._localDescriptionWithoutSimulcast=null,re!==H._localDescription.sdp)return H._rollbackAndApplyOffer({type:H._localDescription.type,sdp:re})}}).then(function(){return H._peerConnection.setRemoteDescription(V)}).then(function(){V.type==="answer"&&(H._isRestartingIce&&(H._log.debug("An ICE restart was in-progress and is now completed"),H._isRestartingIce=!1),_e(H))},function(J){throw H._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+V.type+'" failed with the error "'+J.message+'".',J),V.sdp&&H._log.warn("The SDP was "+V.sdp),J})},te.prototype._updateDescription=function(V){var H=this;switch(V.type){case"answer":case"pranswer":if(V.revision!==this._descriptionRevision||this._peerConnection.signalingState!=="have-local-offer")return Promise.resolve();this._descriptionRevision=V.revision;break;case"close":return this._close();case"create-offer":return V.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=V,Promise.resolve()):(this._descriptionRevision=V.revision,this._offer());case"offer":return V.revision<=this._lastStableDescriptionRevision||this._peerConnection.signalingState==="closed"?Promise.resolve():this._peerConnection.signalingState==="have-local-offer"?this._needsAnswer&&this._lastStableDescriptionRevision===0?(this._queuedDescription=V,Promise.resolve()):(this._descriptionRevision=V.revision,this._handleGlare(V)):(this._descriptionRevision=V.revision,this._answer(V).then(function(){}))}var J=V.revision;return Promise.resolve().then(function(){return H._setRemoteDescription(V)}).catch(function(X){var re=new x;throw H._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'+V.type+'" failed',code:re.code,error:X,sdp:V.sdp}),re}).then(function(){return H._lastStableDescriptionRevision=J,H._needsAnswer=!1,H._checkIceBox(V)}).then(function(){return H._queuedDescription&&H._updateDescription(H._queuedDescription)}).then(function(){return H._queuedDescription=null,H._maybeReoffer(H._peerConnection.localDescription).then(function(){})})},te.prototype._updateIce=function(V){var H=this._remoteCandidates.update(V);return this._addIceCandidates(H)},te.prototype.addDataTrackSender=function(V){if(!this._dataChannels.has(V))try{var H={ordered:V.ordered};V.maxPacketLifeTime!==null&&(H.maxPacketLifeTime=V.maxPacketLifeTime),V.maxRetransmits!==null&&(H.maxRetransmits=V.maxRetransmits);var J=this._peerConnection.createDataChannel(V.id,H);V.addDataChannel(J),this._dataChannels.set(V,J)}catch(X){this._log.warn('Error creating an RTCDataChannel for DataTrack "'+V.id+'": '+X.message)}},te.prototype._handleQueuedPublisherHints=function(){var V=this;this._peerConnection.signalingState==="stable"&&this._mediaTrackSenderToPublisherHints.forEach(function(H,J){var X=H.deferred,re=H.encodings;V._mediaTrackSenderToPublisherHints.delete(J),V._setPublisherHint(J,re).then(function(be){return X.resolve(be)}).catch(function(be){return X.reject(be)})})},te.prototype._setPublisherHint=function(V,H){var J=this;if(ee)return Promise.resolve("COULD_NOT_APPLY_HINT");if(this._mediaTrackSenderToPublisherHints.has(V)){var X=this._mediaTrackSenderToPublisherHints.get(V);X.deferred.resolve("REQUEST_SKIPPED"),this._mediaTrackSenderToPublisherHints.delete(V)}var re=this._rtpSenders.get(V);if(!re)return this._log.warn("Could not apply publisher hint because RTCRtpSender was not found"),Promise.resolve("UNKNOWN_TRACK");if(this._peerConnection.signalingState==="closed")return this._log.warn('Could not apply publisher hint because signalingState was "closed"'),Promise.resolve("COULD_NOT_APPLY_HINT");if(this._peerConnection.signalingState!=="stable"){this._log.debug("Queuing up publisher hint because signalingState:",this._peerConnection.signalingState);var be=N();return this._mediaTrackSenderToPublisherHints.set(V,{deferred:be,encodings:H}),be.promise}var Te=re.getParameters();return H!==null&&H.forEach(function(Ie){var Me=Ie.enabled,Ee=Ie.layer_index;Te.encodings.length>Ee?(J._log.debug("layer:"+Ee+", active:"+Te.encodings[Ee].active+" => "+Me),Te.encodings[Ee].active=Me):J._log.warn("invalid layer:"+Ee+", active:"+Me)}),this._maybeUpdateEncodings(re.track,Te.encodings,H===null),re.setParameters(Te).then(function(){return"OK"}).catch(function(Ie){return J._log.error("Failed to apply publisher hints:",Ie),"COULD_NOT_APPLY_HINT"})},te.prototype.addMediaTrackSender=function(V){var H=this;if(!(this._peerConnection.signalingState==="closed"||this._rtpSenders.has(V))){var J=this._addOrUpdateTransceiver(V.track),X=J.sender;V.addSender(X,function(re){return H._setPublisherHint(V,re)}),this._rtpNewSenders.add(X),this._rtpSenders.set(V,X)}},te.prototype.close=function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))},te.prototype.getTrackReceivers=function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))},te.prototype.getState=function(){if(!this._localDescription)return null;var V=this._localDescription.type==="answer"?this._lastStableDescriptionRevision:this._descriptionRevision,H={type:this._localDescription.type,revision:V};return this._localDescription.sdp&&(H.sdp=this._localDescription.sdp),{description:H,id:this.id}},te.prototype.offer=function(){var V=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(H){V.transition("updating",H);var J=V._needsAnswer||V._isRestartingIce?Promise.resolve():V._offer();return J.then(function(){V.tryTransition("open",H)},function(X){throw V.tryTransition("open",H),X})})},te.prototype.removeDataTrackSender=function(V){var H=this._dataChannels.get(V);H&&(V.removeDataChannel(H),this._dataChannels.delete(V),H.close())},te.prototype.removeMediaTrackSender=function(V){var H=this._rtpSenders.get(V);if(H){if(this._peerConnection.signalingState!=="closed"&&this._peerConnection.removeTrack(H),V.removeSender(H),this._mediaTrackSenderToPublisherHints.has(V)){var J=this._mediaTrackSenderToPublisherHints.get(V);J.deferred.resolve("UNKNOWN_TRACK"),this._mediaTrackSenderToPublisherHints.delete(V)}this._rtpNewSenders.delete(H),this._rtpSenders.delete(V)}},te.prototype.setConfiguration=function(V){typeof this._peerConnection.setConfiguration=="function"&&this._peerConnection.setConfiguration(I(V))},te.prototype.setIceReconnectTimeout=function(V){return this._iceReconnectTimeout.setDelay(V),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this},te.prototype.update=function(V){var H=this;return this.bracket("updating",function(J){if(H.state==="closed")return Promise.resolve();H.transition("updating",J);var X=[];return V.ice&&X.push(H._updateIce(V.ice)),V.description&&X.push(H._updateDescription(V.description)),Promise.all(X).then(function(){H.tryTransition("open",J)},function(re){throw H.tryTransition("open",J),re})})},te.prototype.getStats=function(){var V=this;return n(this._peerConnection,{log:this._log}).then(function(H){return W(V,H)})},te}(Y);function ue(ce,te){var V=ce._getMediaTrackSenderId(te.trackId);return Object.assign(te,{trackId:V})}function ye(ce,te){var V=_([],p(ce._mediaTrackReceivers)).find(function(J){return J.track.id===te.trackId}),H=V?V.id:null;return Object.assign(te,{trackId:H})}function W(ce,te){return Object.assign(te,{remoteAudioTrackStats:te.remoteAudioTrackStats.map(function(V){return ye(ce,V)}),remoteVideoTrackStats:te.remoteVideoTrackStats.map(function(V){return ye(ce,V)}),localAudioTrackStats:te.localAudioTrackStats.map(function(V){return ue(ce,V)}),localVideoTrackStats:te.localVideoTrackStats.map(function(V){return ue(ce,V)})})}function K(ce){if(ce.sdp){var te=ce.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(te)return te[1]}return null}function I(ce){return ce===void 0&&(ce={}),Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},ce)}function R(ce,te){var V=te.track;return V&&V.kind===ce&&V.readyState!=="ended"}function B(ce){return ce.replace(/a=msid:[^ ]+ /g,"a=msid:- ")}function ae(ce,te){return!ce.stopped&&!te._replaceTrackPromises.has(ce)&&["inactive","recvonly"].includes(ce.direction)}function fe(ce,te){var V={audio:ce._preferredAudioCodecs.map(function(re){var be=re.codec;return be.toLowerCase()}),video:ce._preferredVideoCodecs.map(function(re){var be=re.codec;return be.toLowerCase()})}[te],H=ce._recycledTransceivers[te],J=V.find(function(re){return ce._localCodecs.has(re)});if(!J)return H.shift();var X=H.find(function(re){var be=ce._remoteCodecMaps.get(re.mid);return be&&be.has(J)});return X&&H.splice(H.indexOf(X),1),X}function me(ce){var te=ce._peerConnection.localDescription;!te||!te.sdp||l(te.sdp).forEach(function(V){var H=L(V);H.forEach(function(J,X){return ce._localCodecs.add(X)})})}function we(ce){var te=ce._peerConnection.remoteDescription;!te||!te.sdp||l(te.sdp).forEach(function(V){var H=V.match(/^a=mid:(.+)$/m);if(!(!H||!H[1])){var J=H[1],X=L(V);ce._remoteCodecMaps.set(J,X)}})}function Le(ce){ce._recycledTransceivers.audio=[],ce._recycledTransceivers.video=[],ce._peerConnection.getTransceivers().forEach(function(te){if(ae(te,ce)){var V=te.receiver.track;ce._recycledTransceivers[V.kind].push(te)}})}function _e(ce){Le(ce),me(ce),we(ce),je(ce).then(function(){ce._handleQueuedPublisherHints()})}function je(ce){var te=ce._encodingParameters,V=te.maxAudioBitrate,H=te.maxVideoBitrate,J=new Map([["audio",V],["video",H]]),X=[];return ce._peerConnection.getSenders().filter(function(re){return re.track}).forEach(function(re){var be=J.get(re.track.kind),Te=re.getParameters();be===null||be===0?He(Te):ce._isChromeScreenShareTrack(re.track)?ce._log.warn("Not setting maxBitrate for "+re.track.kind+" Track "+re.track.id+" because it appears to be screen share track: "+re.track.label):We(Te,be),!ee&&Te.encodings.length>0&&(re.track.kind==="audio"?Te.encodings[0].priority="high":ce._isChromeScreenShareTrack(re.track)&&(Te.encodings[0].priority="medium"),ce._enableDscp&&(Te.encodings[0].networkPriority="high"));var Ie=ce._rtpNewSenders.has(re);ce._maybeUpdateEncodings(re.track,Te.encodings,Ie),ce._rtpNewSenders.delete(re);var Me=re.setParameters(Te).catch(function(Ee){ce._log.warn("Error while setting encodings parameters for "+re.track.kind+" Track "+re.track.id+": "+(Ee.message||Ee.name))});X.push(Me)}),Promise.all(X)}function He(ce){Array.isArray(ce.encodings)&&ce.encodings.forEach(function(te){return delete te.maxBitrate})}function We(ce,te){ee?ce.encodings=[{maxBitrate:te}]:ce.encodings.forEach(function(V){V.maxBitrate=te})}return ft=he,ft}var vt,Zo;function hl(){if(Zo)return vt;Zo=1;var k=vt&&vt.__extends||function(){var l=function(f,m){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,C){P.__proto__=C}||function(P,C){for(var M in C)Object.prototype.hasOwnProperty.call(C,M)&&(P[M]=C[M])},l(f,m)};return function(f,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");l(f,m);function P(){this.constructor=f}f.prototype=m===null?Object.create(m):(P.prototype=m.prototype,new P)}}(),p=vt&&vt.__read||function(l,f){var m=typeof Symbol=="function"&&l[Symbol.iterator];if(!m)return l;var P=m.call(l),C,M=[],D;try{for(;(f===void 0||f-- >0)&&!(C=P.next()).done;)M.push(C.value)}catch(O){D={error:O}}finally{try{C&&!C.done&&(m=P.return)&&m.call(P)}finally{if(D)throw D.error}}return M},_=vt&&vt.__spreadArray||function(l,f){for(var m=0,P=f.length,C=l.length;m<P;m++,C++)l[C]=f[m];return l},s=qe().guessBrowser,i=pl(),e=yc(),r=hc(),t=Ce(),n=ht().MediaConnectionError,a=s()==="firefox",o=function(l){k(f,l);function f(m,P,C){var M=l.call(this)||this;C=Object.assign({audioContextFactory:a?Tn():null,PeerConnectionV2:i},C);var D=C.audioContextFactory?C.audioContextFactory.getOrCreate(M):null,O=D?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(M,{_audioContextFactory:{value:C.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:t.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:D?new e(c(D)):null},_encodingParameters:{value:m},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:O},_peerConnections:{value:new Map},_preferredCodecs:{value:P},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:C.PeerConnectionV2}}),M}return f.prototype.setEffectiveAdaptiveSimulcast=function(m){this._peerConnections.forEach(function(P){return P.setEffectiveAdaptiveSimulcast(m)}),this._preferredCodecs.video.forEach(function(P){"adaptiveSimulcast"in P&&(P.adaptiveSimulcast=m)})},Object.defineProperty(f.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"iceConnectionState",{get:function(){return this._iceConnectionState},enumerable:!1,configurable:!0}),f.prototype._closeAbsentPeerConnections=function(m){var P=new Set(m.map(function(C){return C.id}));return this._peerConnections.forEach(function(C){P.has(C.id)||C._close()}),this},f.prototype._getConfiguration=function(){return this._configurationDeferred.promise},f.prototype._getOrCreate=function(m,P){var C=this,M=this,D=this._peerConnections.get(m);if(!D){var O=this._PeerConnectionV2,x=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},P);try{D=new O(m,this._encodingParameters,this._preferredCodecs,x)}catch{throw new n}this._peerConnections.set(D.id,D),D.on("candidates",this.queue.bind(this,"candidates")),D.on("description",this.queue.bind(this,"description")),D.on("trackAdded",this.queue.bind(this,"trackAdded")),D.on("stateChanged",function E(q){q==="closed"&&(D.removeListener("stateChanged",E),M._dataTrackSenders.forEach(function(U){return D.removeDataTrackSender(U)}),M._mediaTrackSenders.forEach(function(U){return D.removeMediaTrackSender(U)}),M._peerConnections.delete(D.id),M._closedPeerConnectionIds.add(D.id),g(M),b(M))}),D.on("connectionStateChanged",function(){return g(C)}),D.on("iceConnectionStateChanged",function(){return b(C)}),this._dataTrackSenders.forEach(D.addDataTrackSender,D),this._mediaTrackSenders.forEach(D.addMediaTrackSender,D),b(this)}return D},f.prototype.close=function(){return this._peerConnections.forEach(function(m){m.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),b(this),this},f.prototype.createAndOffer=function(){var m=this;return this._getConfiguration().then(function(P){var C;do C=t.makeUUID();while(m._peerConnections.has(C));return m._getOrCreate(C,P)}).then(function(P){return P.offer()}).then(function(){return m})},f.prototype.getTrackReceivers=function(){return t.flatMap(this._peerConnections,function(m){return m.getTrackReceivers()})},f.prototype.getStates=function(){var m=[];return this._peerConnections.forEach(function(P){var C=P.getState();C&&m.push(C)}),m},f.prototype.setConfiguration=function(m){return this._configuration&&(this._configurationDeferred=t.defer(),this._peerConnections.forEach(function(P){P.setConfiguration(m)})),this._configuration=m,this._configurationDeferred.resolve(m),this},f.prototype.setIceReconnectTimeout=function(m){return this._sessionTimeout===null&&(this._peerConnections.forEach(function(P){P.setIceReconnectTimeout(m)}),this._sessionTimeout=m),this},f.prototype.setTrackSenders=function(m){var P=new Set(m.filter(function(D){return D.kind==="data"})),C=new Set(m.filter(function(D){return D&&(D.kind==="audio"||D.kind==="video")})),M=u(this,P,C);return this._dataTrackSenders=P,this._mediaTrackSenders=C,d(this,M),this},f.prototype.update=function(m,P){var C=this;return P===void 0&&(P=!1),P&&this._closeAbsentPeerConnections(m),this._getConfiguration().then(function(M){return Promise.all(m.map(function(D){if(C._closedPeerConnectionIds.has(D.id))return null;var O=C._getOrCreate(D.id,M);return O.update(D)}))}).then(function(){return C})},f.prototype.getStats=function(){var m=Array.from(this._peerConnections.values());return Promise.all(m.map(function(P){return P.getStats().then(function(C){return[P.id,C]})})).then(function(P){return new Map(P)})},f}(r);function c(l){var f=l.createMediaStreamDestination();return f.stream.getAudioTracks()[0]}function d(l,f){(f.data.add.size||f.data.remove.size||f.media.add.size||f.media.remove.size)&&l._peerConnections.forEach(function(m){f.data.remove.forEach(m.removeDataTrackSender,m),f.media.remove.forEach(m.removeMediaTrackSender,m),f.data.add.forEach(m.addDataTrackSender,m),f.media.add.forEach(m.addMediaTrackSender,m),(f.media.add.size||f.media.remove.size||f.data.add.size&&!m.isApplicationSectionNegotiated)&&m.offer()})}function v(l,f){var m=t.difference(f,l._dataTrackSenders),P=t.difference(l._dataTrackSenders,f);return{add:m,remove:P}}function u(l,f,m){return{data:v(l,f),media:y(l,m)}}function y(l,f){var m=t.difference(f,l._mediaTrackSenders),P=t.difference(l._mediaTrackSenders,f);return{add:m,remove:P}}var h={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3},S;function L(){return Object.keys(h).reduce(function(l,f){var m;return Object.assign(l,(m={},m[h[f]]=f,m))},{})}function T(l){return l.length?(S=S||L(),l.reduce(function(f,m){return S[Math.max(h[f],h[m])]})):"new"}function b(l){l._lastIceConnectionState=l.iceConnectionState,l._iceConnectionState=T(_([],p(l._peerConnections.values())).map(function(f){return f.iceConnectionState})),l.iceConnectionState!==l._lastIceConnectionState&&l.emit("iceConnectionStateChanged")}function g(l){l._lastConnectionState=l.connectionState,l._connectionState=T(_([],p(l._peerConnections.values())).map(function(f){return f.connectionState})),l.connectionState!==l._lastConnectionState&&l.emit("connectionStateChanged")}return vt=o,vt}var xr,es;function jt(){if(es)return xr;es=1;var k=xr&&xr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Ue(),_=0,s=function(i){k(e,i);function e(r,t,n){var a=i.call(this)||this;return Object.defineProperties(a,{_instanceId:{value:_++},channel:{value:t},_log:{value:n.log.createLog("default",a)},_getReceiver:{value:r},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),a}return Object.defineProperty(e.prototype,"isSetup",{get:function(){return!!this._receiverPromise},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"[MediaSignaling #"+this._instanceId+":"+this.channel+"]"},e.prototype.setup=function(r){var t=this;this._teardown(),this._log.info("setting up msp transport for id:",r);var n=this._getReceiver(r).then(function(a){if(a.kind!=="data"&&t._log.error("Expected a DataTrackReceiver"),t._receiverPromise===n){try{t._transport=a.toDataTransport(),t.emit("ready",t._transport)}catch(o){t._log.error("Failed to toDataTransport: "+o.message)}a.once("close",function(){return t._teardown()})}});this._receiverPromise=n},e.prototype._teardown=function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))},e}(p);return xr=s,xr}var Ar,ts;function _l(){if(ts)return Ar;ts=1;var k=Ar&&Ar.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jt(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e,"active_speaker",r)||this;return Object.defineProperties(t,{_loudestParticipantSid:{value:null,writable:!0}}),t.on("ready",function(n){n.on("message",function(a){switch(a.type){case"active_speaker":t._setLoudestParticipantSid(a.participant);break}})}),t}return Object.defineProperty(i.prototype,"loudestParticipantSid",{get:function(){return this._loudestParticipantSid},enumerable:!1,configurable:!0}),i.prototype._setLoudestParticipantSid=function(e){this.loudestParticipantSid!==e&&(this._loudestParticipantSid=e,this.emit("updated"))},i}(p);return Ar=_,Ar}var ci,rs;function ml(){if(rs)return ci;rs=1;var k=function(){function p(_,s,i,e){Object.defineProperties(this,{availableSend:{enumerable:!0,value:i},recv:{enumerable:!0,value:s},rtt:{enumerable:!0,value:e},send:{enumerable:!0,value:_}})}return p.of=function(_,s){var i=(s.timestamp-_.timestamp)/1e3,e=s.bytesSent-_.bytesSent,r=s.bytesReceived-_.bytesReceived,t=i>0?e/i*8:0,n=i>0?r/i*8:0,a=s.availableOutgoingBitrate,o=s.currentRoundTripTime;return new p(t,n,a,o)},p}();return ci=k,ci}var ui,ns;function yl(){if(ns)return ui;ns=1;var k=ml(),p=function(){function _(){Object.defineProperties(this,{lastReport:{enumerable:!0,value:new k(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return _.prototype.next=function(s){var i=this.lastStats;if(this.lastStats=s,i){var e=i.id===s.id?k.of(i,s):new k(0,0);this.lastReport=e}return this.lastReport},_}();return ui=p,ui}var li,is;function jc(){if(is)return li;is=1;function k(p){return p=p.filter(function(_){return typeof _=="number"}),p.length<1?void 0:p.reduce(function(_,s){return s+_})/p.length}return li=k,li}var di,as;function Nc(){if(as)return di;as=1;var k=function(){function p(_,s,i){Object.defineProperties(this,{id:{enumerable:!0,value:_},trackId:{enumerable:!0,value:s},bitrate:{enumerable:!0,value:i}})}return p}();return di=k,di}var fi,os;function qc(){if(os)return fi;os=1;function k(p){return p.reduce(function(_,s){return typeof s=="number"?s+_:_},0)}return fi=k,fi}var Mr,ss;function Vc(){if(ss)return Mr;ss=1;var k=Mr&&Mr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=jc(),_=Nc(),s=qc(),i=function(e){k(r,e);function r(t,n,a,o,c,d,v){var u=e.call(this,t,n,a)||this,y=c>0?o/c:0;return Object.defineProperties(u,{deltaPacketsLost:{enumerable:!0,value:o},deltaPacketsReceived:{enumerable:!0,value:c},fractionLost:{enumerable:!0,value:d},jitter:{enumerable:!0,value:v},phonyFractionLost:{enumerable:!0,value:y}}),u}return r.of=function(t,n,a){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var o=(a.timestamp-n.timestamp)/1e3,c=a.bytesReceived-n.bytesReceived,d=o>0?c/o*8:0,v=Math.max(a.packetsLost-n.packetsLost,0),u=a.packetsReceived-n.packetsReceived,y=a.fractionLost,h=a.jitter;return new r(n.id,t,d,v,u,y,h)},r.summarize=function(t){var n=t.map(function(d){return d.summarize()}),a=s(n.map(function(d){return d.bitrate})),o=p(n.map(function(d){return d.fractionLost})),c=p(n.map(function(d){return d.jitter}));return{bitrate:a,fractionLost:o,jitter:c}},r.prototype.summarize=function(){return{bitrate:this.bitrate,fractionLost:typeof this.fractionLost=="number"?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}},r}(_);return Mr=i,Mr}var Ir,cs;function Fc(){if(cs)return Ir;cs=1;var k=Ir&&Ir.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=jc(),_=Nc(),s=qc(),i=function(e){k(r,e);function r(t,n,a,o){var c=e.call(this,t,n,a)||this;return Object.defineProperties(c,{rtt:{enumerable:!0,value:o}}),c}return r.of=function(t,n,a,o){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var c=(a.timestamp-n.timestamp)/1e3,d=a.bytesSent-n.bytesSent,v=c>0?d/c*8:0,u=o&&typeof o.roundTripTime=="number"?o.roundTripTime/1e3:void 0;return new r(n.id,t,v,u)},r.summarize=function(t){var n=s(t.map(function(o){return o.bitrate})),a=p(t.map(function(o){return o.rtt}));return{bitrate:n,rtt:a}},r}(_);return Ir=i,Ir}var vi,us;function gl(){if(us)return vi;us=1;var k=Vc(),p=Fc(),_=function(){function s(i,e,r){Object.defineProperties(this,{ice:{enumerable:!0,value:i},audio:{enumerable:!0,value:e},video:{enumerable:!0,value:r}})}return s.prototype.summarize=function(){var i=this.audio.send.concat(this.video.send),e=p.summarize(i),r=this.audio.recv.concat(this.video.recv),t=k.summarize(r);return{ice:this.ice,send:e,recv:t,audio:{send:p.summarize(this.audio.send),recv:k.summarize(this.audio.recv)},video:{send:p.summarize(this.video.send),recv:k.summarize(this.video.recv)}}},s}();return vi=_,vi}var pi,ls;function Bc(){if(ls)return pi;ls=1;var k=function(){function p(_,s,i){Object.defineProperties(this,{id:{enumerable:!0,value:_,writable:!0},trackId:{enumerable:!0,value:s,writable:!0},lastStats:{enumerable:!0,value:i,writable:!0}})}return p}();return pi=k,pi}var Dr,ds;function bl(){if(ds)return Dr;ds=1;var k=Dr&&Dr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Vc(),_=Bc(),s=function(i){k(e,i);function e(r,t){var n=i.call(this,t.id,r,t)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return e.prototype.next=function(r,t){var n=this.lastStats;this.lastStats=t,this.trackId=r;var a=p.of(r,n,t);return this.lastReport=a,a},e}(_);return Dr=s,Dr}var jr,fs;function kl(){if(fs)return jr;fs=1;var k=jr&&jr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Bc(),_=Fc(),s=function(i){k(e,i);function e(r,t){var n=i.call(this,t.id,r,t)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return e.prototype.next=function(r,t,n){var a=this.lastStats;this.lastStats=t,this.trackId=r;var o=_.of(r,a,t,n);return this.lastReport=o,o},e}(p);return jr=s,jr}var pt,vs;function Sl(){if(vs)return pt;vs=1;var k=pt&&pt.__read||function(f,m){var P=typeof Symbol=="function"&&f[Symbol.iterator];if(!P)return f;var C=P.call(f),M,D=[],O;try{for(;(m===void 0||m-- >0)&&!(M=C.next()).done;)D.push(M.value)}catch(x){O={error:x}}finally{try{M&&!M.done&&(P=C.return)&&P.call(C)}finally{if(O)throw O.error}}return D},p=pt&&pt.__spreadArray||function(f,m){for(var P=0,C=m.length,M=f.length;P<C;P++,M++)f[M]=m[P];return f},_=pt&&pt.__values||function(f){var m=typeof Symbol=="function"&&Symbol.iterator,P=m&&f[m],C=0;if(P)return P.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")},s=qe().guessBrowser,i=yl(),e=gl(),r=bl(),t=kl(),n=function(){function f(m){Object.defineProperties(this,{pc:{enumerable:!0,value:m},ice:{enumerable:!0,value:new i},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return f.prototype.next=function(){var m=this,P=s()==="firefox"?g(this):l(this);return P.then(function(){var C=p([],k(m.audio.send.values())),M=p([],k(m.video.send.values())),D=p([],k(m.audio.recv.values())),O=p([],k(m.video.recv.values())),x=new e(m.ice.lastReport,{send:C.map(function(E){return E.lastReport}).filter(function(E){return E}),recv:D.map(function(E){return E.lastReport}).filter(function(E){return E})},{send:M.map(function(E){return E.lastReport}).filter(function(E){return E}),recv:O.map(function(E){return E.lastReport}).filter(function(E){return E})});return m.lastReport=x,x})},f}();function a(f){return Promise.all(f.map(function(m){var P=m.track.id;return m.getStats().then(function(C){var M,D;try{for(var O=_(C.values()),x=O.next();!x.done;x=O.next()){var E=x.value;E.type==="inbound-rtp"&&(E.id=P+"-"+E.id)}}catch(q){M={error:q}}finally{try{x&&!x.done&&(D=O.return)&&D.call(O)}finally{if(M)throw M.error}}return[P,C]})})).then(function(m){return new Map(m)})}function o(f,m,P,C,M){var D=m[C.mediaType];if(!M){var O=P.get(C.trackId);O&&(M=O.trackIdentifier)}if(D&&M){if(D.has(C.id))return D.get(C.id);var x=new f(M,C);D.set(C.id,x)}return null}function c(f){return{audio:f.audio.send,video:f.video.send}}function d(f){return{audio:f.audio.recv,video:f.video.recv}}function v(f,m,P,C){return o(t,c(f),m,P,C)}function u(f,m,P,C){return o(r,d(f),m,P,C)}function y(f){return{audio:new Set(f.audio.send.keys()),video:new Set(f.video.send.keys())}}function h(f){return{audio:new Set(f.audio.recv.keys()),video:new Set(f.video.recv.keys())}}function S(f,m,P,C){var M,D;try{for(var O=_(m.values()),x=O.next();!x.done;x=O.next()){var E=x.value;if(E.type==="outbound-rtp"&&!E.isRemote){if(s()!=="firefox"&&!E.trackId)continue;var q=P[E.mediaType];q&&q.delete(E.id);var U=v(f,m,E,C);if(U){var G=m.get(E.remoteId);U.next(C||U.trackId,E,G)}}}}catch(F){M={error:F}}finally{try{x&&!x.done&&(D=O.return)&&D.call(O)}finally{if(M)throw M.error}}}function L(f,m,P,C){var M,D;try{for(var O=_(m.values()),x=O.next();!x.done;x=O.next()){var E=x.value;if(E.type==="inbound-rtp"&&!E.isRemote){var q=P[E.mediaType];q&&q.delete(E.id);var U=u(f,m,E,C);U&&U.next(C||U.trackId,E)}}}catch(G){M={error:G}}finally{try{x&&!x.done&&(D=O.return)&&D.call(O)}finally{if(M)throw M.error}}}function T(f,m){var P=function(M){var D=f[M],O=m[M];O.forEach(function(x){return D.delete(x)})};for(var C in m)P(C)}function b(f,m){var P,C,M,D,O;try{for(var x=_(m.values()),E=x.next();!E.done;E=x.next()){var q=E.value;q.type==="transport"&&(O=m.get(q.selectedCandidatePairId))}}catch(F){P={error:F}}finally{try{E&&!E.done&&(C=x.return)&&C.call(x)}finally{if(P)throw P.error}}if(O){f.next(O);return}try{for(var U=_(m.values()),G=U.next();!G.done;G=U.next()){var q=G.value;q.type==="candidate-pair"&&q.nominated&&(!("selected"in q)||q.selected)&&f.next(q)}}catch(F){M={error:F}}finally{try{G&&!G.done&&(D=U.return)&&D.call(U)}finally{if(M)throw M.error}}}function g(f){var m=f.pc.getTransceivers().filter(function(C){return C.currentDirection&&C.currentDirection.match(/send/)&&C.sender.track}).map(function(C){return C.sender}),P=f.pc.getTransceivers().filter(function(C){return C.currentDirection&&C.currentDirection.match(/recv/)}).map(function(C){return C.receiver});return Promise.all([a(m),a(P),f.pc.getStats()]).then(function(C){var M=k(C,3),D=M[0],O=M[1],x=M[2],E=c(f),q=y(f);D.forEach(function(F,N){return S(f,F,q,N)}),T(E,q);var U=d(f),G=h(f);O.forEach(function(F,N){return L(f,F,G,N)}),T(U,G),b(f.ice,x)})}function l(f){return f.pc.getStats().then(function(m){var P=c(f),C=y(f);S(f,m,C),T(P,C);var M=d(f),D=h(f);L(f,m,D),T(M,D),b(f.ice,m)})}return pt=n,pt}var Pt,ps;function Tl(){if(ps)return Pt;ps=1;var k=Pt&&Pt.__extends||function(){var r=function(t,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(a[c]=o[c])},r(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");r(t,n);function a(){this.constructor=t}t.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),p=Pt&&Pt.__read||function(r,t){var n=typeof Symbol=="function"&&r[Symbol.iterator];if(!n)return r;var a=n.call(r),o,c=[],d;try{for(;(t===void 0||t-- >0)&&!(o=a.next()).done;)c.push(o.value)}catch(v){d={error:v}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(d)throw d.error}}return c},_=Ue(),s=Sl(),i=function(r){k(t,r);function t(n,a){var o=r.call(this)||this;return Object.defineProperties(o,{_factories:{value:new WeakMap},_manager:{value:n},_signaling:{value:a}}),a.on("updated",function(){return o.emit("updated")}),o}return Object.defineProperty(t.prototype,"level",{get:function(){return this._signaling.level},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"levels",{get:function(){return this._signaling.levels},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteLevels",{get:function(){return this._signaling.remoteLevels},enumerable:!1,configurable:!0}),t.prototype.start=function(){var n=this;this.stop();var a=setTimeout(function(){n._timeout===a&&e(n).then(function(o){if(n._timeout===a){if(o.length){var c=p(o,1),d=c[0];n._signaling.put(d)}n.start()}})},200);this._timeout=a},t.prototype.stop=function(){clearTimeout(this._timeout),this._timeout=null},t}(_);function e(r){var t=r._manager._peerConnections?Array.from(r._manager._peerConnections.values()):[],n=t.map(function(c){return c._peerConnection}).filter(function(c){return c.signalingState!=="closed"}),a=n.map(function(c){if(r._factories.has(c))return r._factories.get(c);var d=new s(c);return r._factories.set(c,d),d}),o=a.map(function(c){return c.next().catch(function(){return null})});return Promise.all(o).then(function(c){return c.filter(function(d){return d}).map(function(d){return d.summarize()})})}return Pt=i,Pt}var hi,hs;function wl(){if(hs)return hi;hs=1;var k=Ce().defer,p=function(){function _(){Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return _.prototype.put=function(s){this._hasValue=!0,this._value=s;var i=this._deferreds.shift();return i&&i.resolve(s),this},_.prototype.take=function(){var s=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var i=k();return this._deferreds.push(i),i.promise.then(function(e){return s._hasValue=!1,e})},_}();return hi=p,hi}var Nr,_s;function El(){if(_s)return Nr;_s=1;var k=Nr&&Nr.__extends||function(){var t=function(n,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])},t(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");t(n,a);function o(){this.constructor=n}n.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}}(),p=jt(),_=wl(),s=Lt(),i=5e3,e=function(t){k(n,t);function n(a,o,c){var d=t.call(this,a,"network_quality",c)||this;return Object.defineProperties(d,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new _},_resendTimer:{value:new s(function(){d._resendTimer.setDelay(d._resendTimer.delay*1.5),d._sendNetworkQualityInputs()},i,!1)},_networkQualityReportLevels:{get:function(){return{reportLevel:o.local,remoteReportLevel:o.remote}}}}),d.on("ready",function(v){v.on("message",function(u){switch(d._log.debug("Incoming: ",u),u.type){case"network_quality":d._handleNetworkQualityMessage(u);break}})}),d._sendNetworkQualityInputs(),d}return Object.defineProperty(n.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remoteLevels",{get:function(){return this._remoteLevels},enumerable:!1,configurable:!0}),n.prototype._handleNetworkQualityMessage=function(a){var o=this,c=!1,d=null,v=a?a.local:null;typeof v=="number"?(d=v,this._levels=null):typeof v=="object"&&v&&(this._levels=v,d=typeof v.level=="number"?v.level:Math.min(v.audio.send,v.audio.recv,v.video.send,v.video.recv)),d!==null&&this.level!==d&&(this._level=d,c=!0),this._remoteLevels=a&&a.remotes?a.remotes.reduce(function(u,y){var h=o._remoteLevels.get(y.sid)||{};return h.level!==y.level&&(c=!0),u.set(y.sid,y)},new Map):this._remoteLevels,c&&this.emit("updated"),this._resendTimer.setDelay(i),this._resendTimer.isSet&&setTimeout(function(){return o._sendNetworkQualityInputs()},1e3)},n.prototype._sendNetworkQualityInputs=function(){var a=this;return this._resendTimer.clear(),this._networkQualityInputs.take().then(function(o){a._transport&&a._transport.publish(r(o,a._networkQualityReportLevels))}).finally(function(){a._resendTimer.start()})},n.prototype.put=function(a){this._networkQualityInputs.put(a)},n}(p);function r(t,n){return Object.assign({type:"network_quality"},t,n)}return Nr=e,Nr}var qr,ms;function Uc(){if(ms)return qr;ms=1;var k=qr&&qr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(s){k(i,s);function i(){var e=s.call(this)||this;return Object.defineProperties(e,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),e}return i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return e=typeof e=="boolean"?e:!0,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},i}(p);return qr=_,qr}var Vr,ys;function Pl(){if(ys)return Vr;ys=1;var k=Vr&&Vr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Uc(),_=function(s){k(i,s);function i(){var e=s.call(this)||this;return Object.defineProperties(e,{_revision:{value:1,writable:!0}}),e}return i.prototype.update=function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.is_recording))},i}(p);return Vr=_,Vr}var Fr,gs;function Wc(){if(gs)return Fr;gs=1;var k=Fr&&Fr.__extends||function(){var y=function(h,S){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,T){L.__proto__=T}||function(L,T){for(var b in T)Object.prototype.hasOwnProperty.call(T,b)&&(L[b]=T[b])},y(h,S)};return function(h,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");y(h,S);function L(){this.constructor=h}h.prototype=S===null?Object.create(S):(L.prototype=S.prototype,new L)}}(),p=Uc(),_=Dt(),s=Lt(),i=Ce().buildLogLevels,e=Oe().DEFAULT_LOG_LEVEL,r=ze(),t=ht(),n=t.MediaConnectionError,a=t.MediaDTLSTransportFailedError,o=t.SignalingConnectionDisconnectedError,c=0,d={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},v=function(y){k(h,y);function h(S,L,T,b){var g=this;b=Object.assign({logLevel:e,RecordingSignaling:p,Timeout:s},b);var l=i(b.logLevel);g=y.call(this,"connected",d)||this;var f=b.RecordingSignaling,m=new b.Timeout(function(){g._disconnect(g._reconnectingError)},b.sessionTimeout,!1);return Object.defineProperties(g,{_instanceId:{value:c++},_log:{value:b.log?b.log.createLog("default",g):new r("default",g,l,b.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:b},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:m},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:S},name:{enumerable:!0,value:T},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new f},sid:{enumerable:!0,value:L}}),g.on("connectionStateChanged",function(){g.connectionState==="failed"&&!["disconnected","failed"].includes(g.iceConnectionState)&&g._disconnect(new a)}),g.on("iceConnectionStateChanged",function(){return u(g)}),g.on("signalingConnectionStateChanged",function(){return u(g)}),setTimeout(function(){return u(g)}),g}return h.prototype._disconnect=function(S){return this.state!=="disconnected"?(this.preempt("disconnected",null,[S]),!0):!1},h.prototype.toString=function(){return"[RoomSignaling #"+this._instanceId+": "+(this.localParticipant?this.localParticipant.sid:"null")+"]"},h.prototype.connectParticipant=function(S){var L=this;return S.state==="disconnected"||this.participants.has(S.sid)?!1:(this.participants.set(S.sid,S),S.on("stateChanged",function T(b){b==="disconnected"&&(S.removeListener("stateChanged",T),L.participants.delete(S.sid),L.emit("participantDisconnected",S))}),this.emit("participantConnected",S),!0)},h.prototype.disconnect=function(){return this._disconnect()},h.prototype.setDominantSpeaker=function(S){this.dominantSpeakerSid=S,this.emit("dominantSpeakerChanged")},h}(_);function u(y){if(y.state==="disconnected"||y.signalingConnectionState==="disconnected"){y._sessionTimeout.clear();return}var h;y.signalingConnectionState==="reconnecting"?h=y.signalingConnectionState:y.iceConnectionState==="failed"?(y._mediaConnectionIsReconnecting=!0,h="reconnecting"):y.iceConnectionState==="new"||y.iceConnectionState==="checking"?h=y._mediaConnectionIsReconnecting?"reconnecting":"connected":(y._mediaConnectionIsReconnecting=!1,y._reconnectingError=null,y._sessionTimeout.clear(),h="connected"),h!==y.state&&(h==="reconnecting"?(y._reconnectingError=y.signalingConnectionState==="reconnecting"?new o:new n,y._sessionTimeout.start(),y.preempt(h,null,[y._reconnectingError])):y.preempt(h))}return Fr=v,Fr}var _i,bs;function Cl(){if(bs)return _i;bs=1;var k=function(){function p(_){var s=_.actual,i=s===void 0?null:s,e=_.available,r=e===void 0?null:e,t=_.level,n=t===void 0?null:t;Object.defineProperties(this,{actual:{value:i,enumerable:!0},available:{value:r,enumerable:!0},level:{value:n,enumerable:!0}})}return p}();return _i=k,_i}var mi,ks;function Ol(){if(ks)return mi;ks=1;var k=function(){function p(_){var s=_.fractionLost,i=s===void 0?null:s,e=_.level,r=e===void 0?null:e;Object.defineProperties(this,{fractionLost:{value:i,enumerable:!0},level:{value:r,enumerable:!0}})}return p}();return mi=k,mi}var yi,Ss;function Rl(){if(Ss)return yi;Ss=1;var k=function(){function p(_){var s=_.jitter,i=s===void 0?null:s,e=_.rtt,r=e===void 0?null:e,t=_.level,n=t===void 0?null:t;Object.defineProperties(this,{jitter:{value:i,enumerable:!0},rtt:{value:r,enumerable:!0},level:{value:n,enumerable:!0}})}return p}();return yi=k,yi}var gi,Ts;function Hc(){if(Ts)return gi;Ts=1;var k=Cl(),p=Ol(),_=Rl(),s=function(){function i(e){var r=e.bandwidth,t=r===void 0?null:r,n=e.fractionLost,a=n===void 0?null:n,o=e.latency,c=o===void 0?null:o;Object.defineProperties(this,{bandwidth:{value:t?new k(t):null,enumerable:!0},fractionLost:{value:a?new p(a):null,enumerable:!0},latency:{value:c?new _(c):null,enumerable:!0}})}return i}();return gi=s,gi}var Br,ws;function Ll(){if(ws)return Br;ws=1;var k=Br&&Br.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Hc(),_=function(s){k(i,s);function i(e){return s.call(this,e)||this}return i}(p);return Br=_,Br}var Ur,Es;function xl(){if(Es)return Ur;Es=1;var k=Ur&&Ur.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Hc(),_=function(s){k(i,s);function i(e){return s.call(this,e)||this}return i}(p);return Ur=_,Ur}var bi,Ps;function Gc(){if(Ps)return bi;Ps=1;var k=Ll(),p=xl(),_=function(){function s(i){var e=i.send,r=i.recv,t=i.sendStats,n=t===void 0?null:t,a=i.recvStats,o=a===void 0?null:a;Object.defineProperties(this,{send:{value:e,enumerable:!0},recv:{value:r,enumerable:!0},sendStats:{value:n?new k(n):null,enumerable:!0},recvStats:{value:o?new p(o):null,enumerable:!0}})}return s}();return bi=_,bi}var Wr,Cs;function Al(){if(Cs)return Wr;Cs=1;var k=Wr&&Wr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Gc(),_=function(s){k(i,s);function i(e){return s.call(this,e)||this}return i}(p);return Wr=_,Wr}var Hr,Os;function Ml(){if(Os)return Hr;Os=1;var k=Hr&&Hr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Gc(),_=function(s){k(i,s);function i(e){return s.call(this,e)||this}return i}(p);return Hr=_,Hr}var ki,Rs;function Il(){if(Rs)return ki;Rs=1;var k=Al(),p=Ml(),_=function(){function s(i){var e=i.level,r=i.audio,t=i.video;Object.defineProperties(this,{level:{value:e,enumerable:!0},audio:{value:r?new k(r):null,enumerable:!0},video:{value:t?new p(t):null,enumerable:!0}})}return s}();return ki=_,ki}var Gr,Ls;function ji(){if(Ls)return Gr;Ls=1;var k=Gr&&Gr.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=Dt(),_=Il(),s={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},i=function(e){k(r,e);function r(){var t=e.call(this,"connecting",s)||this;return Object.defineProperties(t,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),t}return Object.defineProperty(r.prototype,"networkQualityLevel",{get:function(){return this._networkQualityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"networkQualityStats",{get:function(){return this._networkQualityStats},enumerable:!1,configurable:!0}),r.prototype.addTrack=function(t){return this.tracks.set(t.id||t.sid,t),this.emit("trackAdded",t),this},r.prototype.disconnect=function(){return this.state!=="disconnected"?(this.preempt("disconnected"),!0):!1},r.prototype.removeTrack=function(t){var n=this.tracks.get(t.id||t.sid);return this.tracks.delete(t.id||t.sid),n&&this.emit("trackRemoved",t),n||null},r.prototype.setNetworkQualityLevel=function(t,n){this._networkQualityLevel!==t&&(this._networkQualityLevel=t,this._networkQualityStats=n&&(n.audio||n.video)?new _(n):null,this.emit("networkQualityLevelChanged"))},r.prototype.connect=function(t,n){return this.state==="connecting"||this.state==="reconnecting"?(this._sid||(this._sid=t),this._identity||(this._identity=n),this.preempt("connected"),!0):!1},r.prototype.reconnecting=function(){return this.state==="connecting"||this.state==="connected"?(this.preempt("reconnecting"),!0):!1},r}(p);return Gr=i,Gr}var Qr,xs;function Dl(){if(xs)return Qr;xs=1;var k=Qr&&Qr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=ji(),_=function(s){k(i,s);function i(e,r){var t=s.call(this)||this;return t.connect(e,r),t}return i}(p);return Qr=_,Qr}var $r,As;function Qc(){if(As)return $r;As=1;var k=$r&&$r.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Ue().EventEmitter,_=function(s){k(i,s);function i(e,r,t,n){var a=s.call(this)||this,o=null;return Object.defineProperties(a,{_error:{value:null,writable:!0},_isEnabled:{value:t,writable:!0},_priority:{value:n,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return o},set:function(c){o===null&&(o=c)}},kind:{enumerable:!0,value:r},name:{enumerable:!0,value:e}}),a}return Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackTransceiver",{get:function(){return this._trackTransceiver},enumerable:!1,configurable:!0}),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return e=typeof e=="boolean"?e:!0,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},i.prototype.setTrackTransceiver=function(e){return e=e||null,this.trackTransceiver!==e&&(this._trackTransceiver=e,this.emit("updated")),this},i.prototype.setSid=function(e){return this.sid===null&&(this._sid=e,this.emit("updated")),this},i}(p);return $r=_,$r}var Kr,Ms;function jl(){if(Ms)return Kr;Ms=1;var k=Kr&&Kr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=Qc(),_=function(s){k(i,s);function i(e,r,t,n,a,o){var c=s.call(this,r,t,n,a)||this;return Object.defineProperties(c,{_isSwitchedOff:{value:o,writable:!0}}),c.setSid(e),c}return Object.defineProperty(i.prototype,"isSubscribed",{get:function(){return!!this.trackTransceiver},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSwitchedOff",{get:function(){return this._isSwitchedOff},enumerable:!1,configurable:!0}),i.prototype.subscribeFailed=function(e){return this.error||(this._error=e,this.emit("updated")),this},i.prototype.setPriority=function(e){return this._priority!==e&&(this._priority=e,this.emit("updated")),this},i.prototype.setSwitchedOff=function(e){return this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit("updated")),this},i}(p);return Kr=_,Kr}var zr,Is;function Nl(){if(Is)return zr;Is=1;var k=zr&&zr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jl(),_=function(s){k(i,s);function i(e,r){return s.call(this,e.sid,e.name,e.kind,e.enabled,e.priority,r)||this}return i.prototype.update=function(e){return this.enable(e.enabled),this.setPriority(e.priority),this},i}(p);return zr=_,zr}var Yr,Ds;function ql(){if(Ds)return Yr;Ds=1;var k=Yr&&Yr.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Dl(),_=Nl(),s=function(i){k(e,i);function e(r,t,n,a,o,c){var d=i.call(this,r.sid,r.identity)||this;return c=Object.assign({RemoteTrackPublicationV2:_},c),Object.defineProperties(d,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:c.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:t},updateSubscriberTrackPriority:{value:function(v,u){return n(v,u)}},updateTrackRenderHint:{value:function(v,u){return a(v,u)}},clearTrackHint:{value:function(v){return o(v)}},revision:{enumerable:!0,get:function(){return this._revision}}}),d.update(r)}return e.prototype._getOrCreateTrack=function(r){var t=this._RemoteTrackPublicationV2,n=this.tracks.get(r.sid);if(!n){var a=this._getInitialTrackSwitchOffState(r.sid);n=new t(r,a),this.addTrack(n)}return n},e.prototype.update=function(r){var t=this;if(this.revision!==null&&r.revision<=this.revision)return this;this._revision=r.revision;var n=new Set;switch(r.tracks.forEach(function(a){var o=t._getOrCreateTrack(a);o.update(a),n.add(o)}),this.tracks.forEach(function(a){n.has(a)||t.removeTrack(a)}),r.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity);break}return this},e}(p);return Yr=s,Yr}var Jr,js;function Vl(){if(js)return Jr;js=1;var k=Jr&&Jr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jt(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e,"track_priority",r)||this;return Object.defineProperties(t,{_enqueuedPriorityUpdates:{value:new Map}}),t.on("ready",function(n){Array.from(t._enqueuedPriorityUpdates.keys()).forEach(function(a){n.publish({type:"track_priority",track:a,subscribe:t._enqueuedPriorityUpdates.get(a)})})}),t}return i.prototype.sendTrackPriorityUpdate=function(e,r,t){if(r!=="subscribe")throw new Error("only subscribe priorities are supported, found: "+r);this._enqueuedPriorityUpdates.set(e,t),this._transport&&this._transport.publish({type:"track_priority",track:e,subscribe:t})},i}(p);return Jr=_,Jr}var Xr,Ns;function Fl(){if(Ns)return Xr;Ns=1;var k=Xr&&Xr.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=jt(),_=function(s){k(i,s);function i(e,r){var t=s.call(this,e,"track_switch_off",r)||this;return t.on("ready",function(n){n.on("message",function(a){switch(a.type){case"track_switch_off":t._setTrackSwitchOffUpdates(a.off||[],a.on||[]);break}})}),t}return i.prototype._setTrackSwitchOffUpdates=function(e,r){this.emit("updated",e,r)},i}(p);return Xr=_,Xr}var Zr,qs;function Bl(){if(qs)return Zr;qs=1;var k=Zr&&Zr.__extends||function(){var t=function(n,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])},t(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");t(n,a);function o(){this.constructor=n}n.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}}(),p=jt(),_=Lt(),s=Ce().isDeepEqual,i=2e3,e=1,r=function(t){k(n,t);function n(a,o){var c=t.call(this,a,"render_hints",o)||this;return Object.defineProperties(c,{_trackSidsToRenderHints:{value:new Map},_responseTimer:{value:new _(function(){c._sendAllHints(),c._responseTimer.setDelay(c._responseTimer.delay*2)},i,!1)}}),c.on("ready",function(d){d.on("message",function(v){switch(c._log.debug("Incoming: ",v),v.type){case"render_hints":c._processHintResults(v&&v.subscriber&&v.subscriber.hints||[]);break;default:c._log.warn("Unknown message type: ",v.type);break}}),c._sendAllHints()}),c}return n.prototype._sendAllHints=function(){var a=this;Array.from(this._trackSidsToRenderHints.keys()).forEach(function(o){var c=a._trackSidsToRenderHints.get(o);c.renderDimensions&&(c.isDimensionDirty=!0),"enabled"in c&&(c.isEnabledDirty=!0)}),this._sendHints()},n.prototype._processHintResults=function(a){var o=this;this._responseTimer.clear(),this._responseTimer.setDelay(i),a.forEach(function(c){c.result!=="OK"&&o._log.debug("Server error processing hint:",c)}),this._sendHints()},n.prototype._sendHints=function(){var a=this;if(!(!this._transport||this._responseTimer.isSet)){var o=[];if(Array.from(this._trackSidsToRenderHints.keys()).forEach(function(d){var v=a._trackSidsToRenderHints.get(d);if(v.isEnabledDirty||v.isDimensionDirty){var u={track:d};v.isEnabledDirty&&(u.enabled=v.enabled,v.isEnabledDirty=!1),v.isDimensionDirty&&(u.render_dimensions=v.renderDimensions,v.isDimensionDirty=!1),o.push(u)}}),o.length>0){var c={type:"render_hints",subscriber:{id:e++,hints:o}};this._log.debug("Outgoing: ",c),this._transport.publish(c),this._responseTimer.start()}}},n.prototype.setTrackHint=function(a,o){var c=this._trackSidsToRenderHints.get(a)||{isEnabledDirty:!1,isDimensionDirty:!1};"enabled"in o&&c.enabled!==o.enabled&&(c.enabled=!!o.enabled,c.isEnabledDirty=!0),o.renderDimensions&&!s(o.renderDimensions,c.renderDimensions)&&(c.renderDimensions=o.renderDimensions,c.isDimensionDirty=!0),this._trackSidsToRenderHints.set(a,c),this._sendHints()},n.prototype.clearTrackHint=function(a){this._trackSidsToRenderHints.delete(a)},n}(p);return Zr=r,Zr}var en,Vs;function Ul(){if(Vs)return en;Vs=1;var k=en&&en.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=jt(),_=1,s=function(i){k(e,i);function e(r,t){var n=i.call(this,r,"publisher_hints",t)||this;return n.on("ready",function(a){n._log.debug("publisher_hints transport ready:",a),a.on("message",function(o){switch(n._log.debug("Incoming: ",o),o.type){case"publisher_hints":o.publisher&&o.publisher.hints&&o.publisher.id&&n._processPublisherHints(o.publisher.hints,o.publisher.id);break;default:n._log.warn("Unknown message type: ",o.type);break}})}),n}return e.prototype.sendTrackReplaced=function(r){var t=r.trackSid;if(this._transport){var n={type:"client_reset",track:t,id:_++};this._log.debug("Outgoing: ",n),this._transport.publish(n)}},e.prototype.sendHintResponse=function(r){var t=r.id,n=r.hints;if(this._transport){var a={type:"publisher_hints",id:t,hints:n};this._log.debug("Outgoing: ",a),this._transport.publish(a)}},e.prototype._processPublisherHints=function(r,t){try{this.emit("updated",r,t)}catch(n){this._log.error("error processing hints:",n)}},e}(p);return en=s,en}var Ct,Fs;function Wl(){if(Fs)return Ct;Fs=1;var k=Ct&&Ct.__extends||function(){var N=function(A,w){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,Q){j.__proto__=Q}||function(j,Q){for(var Y in Q)Object.prototype.hasOwnProperty.call(Q,Y)&&(j[Y]=Q[Y])},N(A,w)};return function(A,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");N(A,w);function j(){this.constructor=A}A.prototype=w===null?Object.create(w):(j.prototype=w.prototype,new j)}}(),p=Ct&&Ct.__read||function(N,A){var w=typeof Symbol=="function"&&N[Symbol.iterator];if(!w)return N;var j=w.call(N),Q,Y=[],$;try{for(;(A===void 0||A-- >0)&&!(Q=j.next()).done;)Y.push(Q.value)}catch(z){$={error:z}}finally{try{Q&&!Q.done&&(w=j.return)&&w.call(j)}finally{if($)throw $.error}}return Y},_=_l(),s=Tl(),i=El(),e=Pl(),r=Wc(),t=ql(),n=Ic(),a=Vl(),o=Fl(),c=Bl(),d=Ul(),v=Ce(),u=v.constants.DEFAULT_SESSION_TIMEOUT_SEC,y=v.createBandwidthProfilePayload,h=v.defer,S=v.difference,L=v.filterObject,T=v.flatMap,b=v.oncePerTick,g=wc(),l=ht().createTwilioError,f=1e4,m=function(N){k(A,N);function A(w,j,Q,Y,$){var z=this;j.options=Object.assign({session_timeout:u},j.options),$=Object.assign({DominantSpeakerSignaling:_,NetworkQualityMonitor:s,NetworkQualitySignaling:i,RecordingSignaling:e,RemoteParticipantV2:t,TrackPrioritySignaling:a,TrackSwitchOffSignaling:o,bandwidthProfile:null,sessionTimeout:j.options.session_timeout*1e3,statsPublishIntervalMs:f},$),w.setBandwidthProfile($.bandwidthProfile);var ne=j.options,oe=ne.signaling_region,ve=ne.audio_processors,le=ve===void 0?[]:ve;w.setSignalingRegion(oe),le.includes("krisp")&&le.push("rnnoise"),w.setAudioProcessors(le),Y.setIceReconnectTimeout($.sessionTimeout),z=N.call(this,w,j.sid,j.name,$)||this;var de=function(se){return z._getTrackReceiver(se)},ee=z._log;return Object.defineProperties(z,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:$.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:w.bandwidthProfileRevision,writable:!0},_mediaStatesWarningsRevision:{value:0,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:w.networkQualityConfiguration},_peerConnectionManager:{value:Y},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:$.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new $.DominantSpeakerSignaling(de,{log:ee})},_networkQualitySignaling:{value:new $.NetworkQualitySignaling(de,w.networkQualityConfiguration,{log:ee})},_renderHintsSignaling:{value:new c(de,{log:ee})},_publisherHintsSignaling:{value:new d(de,{log:ee})},_trackPrioritySignaling:{value:new $.TrackPrioritySignaling(de,{log:ee})},_trackSwitchOffSignaling:{value:new $.TrackSwitchOffSignaling(de,{log:ee})},_pendingSwitchOffStates:{value:new Map},_transport:{value:Q},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:j.options.media_region||null}}),z._initTrackSwitchOffSignaling(),z._initDominantSpeakerSignaling(),z._initNetworkQualityMonitorSignaling(),z._initPublisherHintSignaling(),D(z,w),O(z,Y),x(z,Q),E(z,Q,$.statsPublishIntervalMs),z._update(j),z._peerConnectionManager.setEffectiveAdaptiveSimulcast(z._publisherHintsSignaling.isSetup),z}return Object.defineProperty(A.prototype,"connectionState",{get:function(){return this._peerConnectionManager.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"signalingConnectionState",{get:function(){return this._transport.state==="syncing"?"reconnecting":this._transport.state},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"iceConnectionState",{get:function(){return this._peerConnectionManager.iceConnectionState},enumerable:!1,configurable:!0}),A.prototype._deleteTrackReceiverDeferred=function(w){return this._trackReceiverDeferreds.delete(w)},A.prototype._getOrCreateTrackReceiverDeferred=function(w){var j=this._trackReceiverDeferreds.get(w)||h(),Q=this._peerConnectionManager.getTrackReceivers(),Y=Q.find(function($){return $.id===w&&$.readyState!=="ended"});return Y?j.resolve(Y):this._trackReceiverDeferreds.set(w,j),j},A.prototype._addTrackReceiver=function(w){var j=this._getOrCreateTrackReceiverDeferred(w.id);return j.resolve(w),this},A.prototype._disconnect=function(w){var j=N.prototype._disconnect.call(this,w);return j&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(Q){Q.publishFailed(w||new Error("LocalParticipant disconnected"))}),j},A.prototype._getTrackReceiver=function(w){var j=this;return this._getOrCreateTrackReceiverDeferred(w).promise.then(function(Q){return j._deleteTrackReceiverDeferred(w),Q})},A.prototype._getInitialTrackSwitchOffState=function(w){var j=this._pendingSwitchOffStates.get(w)||!1;return this._pendingSwitchOffStates.delete(w),j&&this._log.warn("["+w+"] was initially switched off! "),j},A.prototype._getTrackSidsToTrackSignalings=function(){var w=T(this.participants,function(j){return Array.from(j.tracks)});return new Map(w)},A.prototype._getOrCreateRemoteParticipant=function(w){var j=this,Q=this._RemoteParticipantV2,Y=this.participants.get(w.sid),$=this;return Y||(Y=new Q(w,function(z){return j._getInitialTrackSwitchOffState(z)},function(z,ne){return j._trackPrioritySignaling.sendTrackPriorityUpdate(z,"subscribe",ne)},function(z,ne){return j._renderHintsSignaling.setTrackHint(z,ne)},function(z){return j._renderHintsSignaling.clearTrackHint(z)}),Y.on("stateChanged",function z(ne){ne==="disconnected"&&(Y.removeListener("stateChanged",z),$.participants.delete(Y.sid),$._disconnectedParticipantRevisions.set(Y.sid,Y.revision))}),this.connectParticipant(Y)),Y},A.prototype._getState=function(){return{participant:this.localParticipant.getState()}},A.prototype._maybeAddBandwidthProfile=function(w){var j=this.localParticipant,Q=j.bandwidthProfile,Y=j.bandwidthProfileRevision;return Q&&this._lastBandwidthProfileRevision<Y?(this._lastBandwidthProfileRevision=Y,Object.assign({bandwidth_profile:y(Q)},w)):w},A.prototype._publishNewLocalParticipantState=function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))},A.prototype._publishPeerConnectionState=function(w){this._transport.publish(Object.assign({peer_connections:[w]},this._getState()))},A.prototype._update=function(w){var j=this;if(w.subscribed&&w.subscribed.revision>this._subscribedRevision){this._subscribedRevision=w.subscribed.revision,w.subscribed.tracks.forEach(function($){$.id?(j._subscriptionFailures.delete($.sid),j._subscribed.set($.sid,$.id)):$.error&&!j._subscriptionFailures.has($.sid)&&j._subscriptionFailures.set($.sid,$.error)});var Q=new Set(w.subscribed.tracks.filter(function($){return!!$.id}).map(function($){return $.sid}));this._subscribed.forEach(function($,z){Q.has(z)||j._subscribed.delete(z)})}var Y=new Set;return(w.participants||[]).forEach(function($){if($.sid!==j.localParticipant.sid){var z=j._disconnectedParticipantRevisions.get($.sid);if(!(z&&$.revision<=z)){z&&j._disconnectedParticipantRevisions.delete($.sid);var ne=j._getOrCreateRemoteParticipant($);ne.update($),Y.add(ne)}}}),w.type==="synced"&&this.participants.forEach(function($){Y.has($)||$.disconnect()}),q(this),w.peer_connections&&this._peerConnectionManager.update(w.peer_connections,w.type==="synced"),w.recording&&this.recording.update(w.recording),w.published&&w.published.revision>this._publishedRevision&&(this._publishedRevision=w.published.revision,w.published.tracks.forEach(function($){$.sid&&j._published.set($.id,$.sid)}),this.localParticipant.update(w.published)),w.participant&&this.localParticipant.connect(w.participant.sid,w.participant.identity),[this._dominantSpeakerSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling,this._publisherHintsSignaling].forEach(function($){var z=$.channel;!$.isSetup&&w.media_signaling&&w.media_signaling[z]&&w.media_signaling[z].transport&&w.media_signaling[z].transport.type==="data-channel"&&$.setup(w.media_signaling[z].transport.label)}),w.type==="warning"&&w.states&&w.states.revision>this._mediaStatesWarningsRevision&&(this._mediaStatesWarningsRevision=w.states.revision,this.localParticipant.updateMediaStates(w.states)),this},A.prototype._initPublisherHintSignaling=function(){var w=this;this._publisherHintsSignaling.on("updated",function(Q,Y){Promise.all(Q.map(function($){return w.localParticipant.setPublisherHint($.track,$.encodings).then(function(z){return{track:$.track,result:z}})})).then(function($){w._publisherHintsSignaling.sendHintResponse({id:Y,hints:$})})});var j=function(Q){Q.kind==="video"&&Q.trackTransceiver.on("replaced",function(){w._publisherHintsSignaling.sendTrackReplaced({trackSid:Q.sid})})};Array.from(this.localParticipant.tracks.values()).forEach(function(Q){return j(Q)}),this.localParticipant.on("trackAdded",function(Q){return j(Q)})},A.prototype._initTrackSwitchOffSignaling=function(){var w=this;this._trackSwitchOffSignaling.on("updated",function(j,Q){try{w._log.debug("received trackSwitch: ",{tracksOn:Q,tracksOff:j});var Y=new Map;Q.forEach(function($){return Y.set($,!0)}),j.forEach(function($){Y.get($)&&w._log.warn($+" is DUPLICATED in both tracksOff and tracksOn list"),Y.set($,!1)}),w.participants.forEach(function($){$.tracks.forEach(function(z){var ne=Y.get(z.sid);typeof ne<"u"&&(z.setSwitchedOff(!ne),Y.delete(z.sid))})}),Y.forEach(function($,z){return w._pendingSwitchOffStates.set(z,!$)})}catch($){w._log.error("error processing track switch off:",$)}})},A.prototype._initDominantSpeakerSignaling=function(){var w=this;this._dominantSpeakerSignaling.on("updated",function(){return w.setDominantSpeaker(w._dominantSpeakerSignaling.loudestParticipantSid)})},A.prototype._initNetworkQualityMonitorSignaling=function(){var w=this;this._networkQualitySignaling.on("ready",function(){var j=new w._NetworkQualityMonitor(w._peerConnectionManager,w._networkQualitySignaling);w._networkQualityMonitor=j,j.on("updated",function(){w.iceConnectionState!=="failed"&&(w.localParticipant.setNetworkQualityLevel(j.level,j.levels),w.participants.forEach(function(Q){var Y=j.remoteLevels.get(Q.sid);Y&&Q.setNetworkQualityLevel(Y.level,Y)}))}),j.start()}),this._networkQualitySignaling.on("teardown",function(){return w._teardownNetworkQualityMonitor()})},A.prototype._teardownNetworkQualityMonitor=function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)},A.prototype.getStats=function(){var w=this;return this._peerConnectionManager.getStats().then(function(j){return new Map(Array.from(j).map(function(Q){var Y=p(Q,2),$=Y[0],z=Y[1];return[$,Object.assign({},z,{localAudioTrackStats:C(w,z.localAudioTrackStats),localVideoTrackStats:C(w,z.localVideoTrackStats),remoteAudioTrackStats:M(w,z.remoteAudioTrackStats),remoteVideoTrackStats:M(w,z.remoteVideoTrackStats)})]}))})},A}(r);function P(N,A){return A.reduce(function(w,j){var Q=N.get(j.trackId);return Q?[Object.assign({},j,{trackSid:Q})].concat(w):w},[])}function C(N,A){return P(N._published,A)}function M(N,A){var w=new Map(Array.from(N._subscribed.entries()).map(function(j){var Q=p(j,2),Y=Q[0],$=Q[1];return[$,Y]}));return P(w,A)}function D(N,A){var w=b(function(){N._publishNewLocalParticipantState()}),j=b(function(){var Q=T(A.tracks,function(Y){return Y.trackTransceiver});N._peerConnectionManager.setTrackSenders(Q)});A.on("trackAdded",j),A.on("trackRemoved",j),A.on("updated",w),N.on("stateChanged",function Q(Y){Y==="disconnected"&&(A.removeListener("trackAdded",j),A.removeListener("trackRemoved",j),A.removeListener("updated",w),N.removeListener("stateChanged",Q),A.disconnect())}),N.on("signalingConnectionStateChanged",function(){var Q=N.localParticipant,Y=N.signalingConnectionState,$=Q.identity,z=Q.sid;switch(Y){case"connected":Q.connect(z,$);break;case"reconnecting":Q.reconnecting();break}})}function O(N,A){A.on("description",function(j){N._publishPeerConnectionState(j)}),A.dequeue("description"),A.on("candidates",function(j){N._publishPeerConnectionState(j)}),A.dequeue("candidates"),A.on("trackAdded",N._addTrackReceiver.bind(N)),A.dequeue("trackAdded"),A.getTrackReceivers().forEach(N._addTrackReceiver,N),A.on("connectionStateChanged",function(){N.emit("connectionStateChanged")}),A.on("iceConnectionStateChanged",function(){N.emit("iceConnectionStateChanged"),N.iceConnectionState==="failed"&&(N.localParticipant.networkQualityLevel!==null&&N.localParticipant.setNetworkQualityLevel(0),N.participants.forEach(function(w){w.networkQualityLevel!==null&&w.setNetworkQualityLevel(0)}))})}function x(N,A){A.on("message",N._update.bind(N)),A.on("stateChanged",function w(j,Q){j==="disconnected"&&(N.state!=="disconnected"&&N._disconnect(Q),A.removeListener("stateChanged",w)),N.emit("signalingConnectionStateChanged")})}function E(N,A,w){var j=new Map,Q=!1,Y=setInterval(function(){N.getStats().then(function($){Q=!Q,$.forEach(function(z,ne){var oe=new n(ne,z,!0);A.publishEvent("quality","stats-report","info",{audioTrackStats:oe.remoteAudioTrackStats.map(function(ee,se){return G(ee,z.remoteAudioTrackStats[se],j)}),localAudioTrackStats:oe.localAudioTrackStats.map(function(ee,se){return U(ee,z.localAudioTrackStats[se],j)}),localVideoTrackStats:oe.localVideoTrackStats.map(function(ee,se){return U(ee,z.localVideoTrackStats[se],j)}),peerConnectionId:oe.peerConnectionId,videoTrackStats:oe.remoteVideoTrackStats.map(function(ee,se){return G(ee,z.remoteVideoTrackStats[se],j)})});var ve=T(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],function(ee){return oe[ee].map(function(se){var ie=se.ssrc,Z=se.trackSid;return Z+"+"+ie})}),le=S(Array.from(j.keys()),ve);if(le.forEach(function(ee){return j.delete(ee)}),Q){var de=F(z.activeIceCandidatePair,oe.peerConnectionId);A.publishEvent("quality","active-ice-candidate-pair","info",de)}})},function(){})},w);N.on("stateChanged",function $(z){z==="disconnected"&&(clearInterval(Y),N.removeListener("stateChanged",$))})}function q(N){var A=N._getTrackSidsToTrackSignalings();N._subscriptionFailures.forEach(function(w,j){var Q=A.get(j);Q&&(N._subscriptionFailures.delete(j),Q.subscribeFailed(l(w.code,w.message)))}),A.forEach(function(w){var j=N._subscribed.get(w.sid);(!j||w.isSubscribed&&w.trackTransceiver.id!==j)&&w.setTrackTransceiver(null),j&&N._getTrackReceiver(j).then(function(Q){return w.setTrackTransceiver(Q)})})}function U(N,A,w){var j=A.framesEncoded,Q=A.packetsSent,Y=A.totalEncodeTime,$=A.totalPacketSendDelay,z=Object.assign({},N),ne=N.trackSid+"+"+N.ssrc,oe=w.get(ne)||new Map;if(typeof Y=="number"&&typeof j=="number"){var ve=oe.get("avgEncodeDelay")||new g;ve.putSample(Y*1e3,j),z.avgEncodeDelay=Math.round(ve.get()),oe.set("avgEncodeDelay",ve)}if(typeof $=="number"&&typeof Q=="number"){var le=oe.get("avgPacketSendDelay")||new g;le.putSample($*1e3,Q),z.avgPacketSendDelay=Math.round(le.get()),oe.set("avgPacketSendDelay",le)}return w.set(ne,oe),z}function G(N,A,w){var j=A.estimatedPlayoutTimestamp,Q=A.framesDecoded,Y=A.jitterBufferDelay,$=A.jitterBufferEmittedCount,z=A.totalDecodeTime,ne=Object.assign({},N),oe=N.trackSid+"+"+N.ssrc,ve=w.get(oe)||new Map;if(typeof j=="number"&&(ne.estimatedPlayoutTimestamp=j),typeof Q=="number"&&typeof z=="number"){var le=ve.get("avgDecodeDelay")||new g;le.putSample(z*1e3,Q),ne.avgDecodeDelay=Math.round(le.get()),ve.set("avgDecodeDelay",le)}if(typeof Y=="number"&&typeof $=="number"){var de=ve.get("avgJitterBufferDelay")||new g;de.putSample(Y*1e3,$),ne.avgJitterBufferDelay=Math.round(de.get()),ve.set("avgJitterBufferDelay",de)}return w.set(oe,ve),ne}function F(N,A){return N=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:A,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},L(N||{},null)),N.localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},L(N.localCandidate||{},null)),N.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},L(N.remoteCandidate||{},null)),N}return Ct=m,Ct}var tn,Bs;function Hl(){if(Bs)return tn;Bs=1;var k=tn&&tn.__extends||function(){var O=function(x,E){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,U){q.__proto__=U}||function(q,U){for(var G in U)Object.prototype.hasOwnProperty.call(U,G)&&(q[G]=U[G])},O(x,E)};return function(x,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");O(x,E);function q(){this.constructor=x}x.prototype=E===null?Object.create(E):(q.prototype=E.prototype,new q)}}(),p=Dt(),_=Tc(),s=Dc(),i=Oe().reconnectBackoffConfig,e=Lt(),r=Oe(),t=r.SDK_NAME,n=r.SDK_VERSION,a=r.SDP_FORMAT,o=Ce(),c=o.createBandwidthProfilePayload,d=o.createMediaSignalingPayload,v=o.createMediaWarningsPayload,u=o.createSubscribePayload,y=o.getUserAgent,h=o.isNonArrayObject,S=ht(),L=S.createTwilioError,T=S.RoomCompletedError,b=S.SignalingConnectionError,g=S.SignalingServerBusyError,l=1,f=2,m={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},P=function(O){k(x,O);function x(E,q,U,G,F,N){var A=this;return N=Object.assign({Backoff:s,TwilioConnection:_,iceServers:null,trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:y()},N),A=O.call(this,"connecting",m)||this,Object.defineProperties(A,{_accessToken:{value:q},_automaticSubscription:{value:N.automaticSubscription},_bandwidthProfile:{value:N.bandwidthProfile},_dominantSpeaker:{value:N.dominantSpeaker},_adaptiveSimulcast:{value:N.adaptiveSimulcast},_eventObserver:{value:N.eventObserver,writable:!1},_renderHints:{value:N.renderHints},_iceServersStatus:{value:Array.isArray(N.iceServers)?"overrode":"acquire"},_localParticipant:{value:U},_name:{value:E},_networkQuality:{value:h(N.networkQuality)||N.networkQuality},_notifyWarnings:{value:N.notifyWarnings},_options:{value:N},_peerConnectionManager:{value:G},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:new N.Backoff(i)},_session:{value:null,writable:!0},_trackPriority:{value:N.trackPriority},_trackSwitchOff:{value:N.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:N.userAgent},_wsServer:{value:F}}),D(A),A}return x.prototype._createConnectOrSyncOrDisconnectMessage=function(){if(this.state==="connected")return null;if(this.state==="disconnected")return{session:this._session,type:"disconnect",version:f};var E={connecting:"connect",syncing:"sync"}[this.state],q={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:E,version:f};return q.type==="connect"?(q.ice_servers=this._iceServersStatus,q.publisher={name:t,sdk_version:n,user_agent:this._userAgent},this._bandwidthProfile&&(q.bandwidth_profile=c(this._bandwidthProfile)),this._notifyWarnings&&(q.participant.media_warnings=v(this._notifyWarnings)),q.media_signaling=d(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._adaptiveSimulcast,this._renderHints),q.subscribe=u(this._automaticSubscription),q.format=a,q.token=this._accessToken):q.type==="sync"?(q.session=this._session,q.token=this._accessToken):q.type==="update"&&(q.session=this._session),q},x.prototype._createIceMessage=function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:l}},x.prototype._sendConnectOrSyncOrDisconnectMessage=function(){var E=this._createConnectOrSyncOrDisconnectMessage();E&&this._twilioConnection.sendMessage(E)},x.prototype.disconnect=function(E){return this.state!=="disconnected"?(this.preempt("disconnected",null,[E]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),!0):!1},x.prototype.publish=function(E){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:f},E)),!0;case"connecting":case"syncing":return this._updatesToSend.push(E),!0;case"disconnected":default:return!1}},x.prototype.publishEvent=function(E,q,U,G){this._eventObserver.emit("event",{group:E,name:q,level:U,payload:G})},x.prototype.sync=function(){return this.state==="connected"?(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0):!1},x.prototype._setSession=function(E,q){this._session=E,this._sessionTimeoutMS=q*1e3},x.prototype._getReconnectTimer=function(){var E=this;return this._sessionTimeoutMS===0?null:(this._sessionTimer||(this._sessionTimer=new e(function(){E._sessionTimer&&(E._sessionTimeoutMS=0)},this._sessionTimeoutMS)),new Promise(function(q){E._reconnectBackoff.backoff(q)}))},x.prototype._clearReconnectTimer=function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)},x}(p);function C(O){return Array.from(O.reduce(function(x,E){var q=x.get(E.id)||E;return(!q.description&&E.description||q.description&&E.description&&E.description.revision>q.description.revision)&&(q.description=E.description),(!q.ice&&E.ice||q.ice&&E.ice&&E.ice.revision>q.ice.revision)&&(q.ice=E.ice),x.set(q.id,q),x},new Map).values())}function M(O){return O.reduce(function(x,E){return(!x.participant&&E.participant||x.participant&&E.participant&&E.participant.revision>x.participant.revision)&&(x.participant=E.participant),!x.peer_connections&&E.peer_connections?x.peer_connections=C(E.peer_connections):x.peer_connections&&E.peer_connections&&(x.peer_connections=C(x.peer_connections.concat(E.peer_connections))),x},{})}function D(O){function x(){if(O.state!=="disconnected"){O._twilioConnection&&O._twilioConnection.removeListener("message",q);var A=O._iceServersStatus,w=O._options,j=O._wsServer,Q=O.state,Y=w.TwilioConnection,$=new Y(j,Object.assign({helloBody:Q==="connecting"&&A==="acquire"?O._createIceMessage():O._createConnectOrSyncOrDisconnectMessage()},w));$.once("close",function(z){z===Y.CloseReason.LOCAL?E():E(new Error(z))}),$.on("message",q),O._twilioConnection=$}}function E(A){if(O.state!=="disconnected"){if(!A){O.disconnect();return}var w=O._getReconnectTimer();if(!w){var j=A.message===_.CloseReason.BUSY?new g:new b;O.disconnect(j);return}O.state==="connected"&&O.preempt("syncing"),w.then(x)}}function q(A){if(O.state!=="disconnected"){if(A.type==="error"){O.disconnect(L(A.code,A.message));return}switch(O.state){case"connected":switch(A.type){case"connected":case"synced":case"update":case"warning":O.emit("message",A);return;case"disconnected":O.disconnect(A.status==="completed"?new T:null);return;default:return}case"connecting":switch(A.type){case"iced":O._options.onIced(A.ice_servers).then(function(){O._sendConnectOrSyncOrDisconnectMessage()});return;case"connected":O._setSession(A.session,A.options.session_timeout),O.emit("connected",A),O.preempt("connected");return;case"synced":case"update":O._updatesReceived.push(A);return;case"disconnected":O.disconnect(A.status==="completed"?new T:null);return;default:return}case"syncing":switch(A.type){case"connected":case"update":O._updatesReceived.push(A);return;case"synced":O._clearReconnectTimer(),O.emit("message",A),O.preempt("connected");return;case"disconnected":O.disconnect(A.status==="completed"?new T:null);return;default:return}default:return}}}O.on("stateChanged",function A(w){switch(w){case"connected":{var j=O._updatesToSend.splice(0);j.length&&O.publish(M(j)),O._updatesReceived.splice(0).forEach(function(Q){return O.emit("message",Q)});return}case"disconnected":O._twilioConnection.removeListener("message",q),O.removeListener("stateChanged",A);return;case"syncing":return;default:return}});var U=O._options,G=O._iceServersStatus,F=U.iceServers,N=U.onIced;G==="overrode"?N(F).then(x):x()}return tn=P,tn}var Si,Us;function Gl(){if(Us)return Si;Us=1;var k=Ai(),p=hl(),_=Wl(),s=Hl(),i=ht(),e=i.SignalingConnectionDisconnectedError,r=i.SignalingIncomingMessageInvalidError,t=Ce(),n=t.flatMap,a=t.createRoomConnectEventPayload;function o(c,d,v,u,y,h){h=Object.assign({PeerConnectionManager:p,RoomV2:_,Transport:s},h);var S=y.video[0]&&y.video[0].adaptiveSimulcast===!0,L=h.PeerConnectionManager,T=h.RoomV2,b=h.Transport,g=h.iceServers,l=h.log,f=new L(u,y,h),m=n(v.tracks,function(D){return[D.trackTransceiver]});f.setTrackSenders(m);var P=new Error("Canceled"),C,M=new k(function(D,O,x){var E=function(se){return x()?(O(P),Promise.reject(P)):(l.debug("Got ICE servers:",se),h.iceServers=se,f.setConfiguration(h),f.createAndOffer().then(function(){if(x())throw O(P),P;l.debug("createAndOffer() succeeded."),f.dequeue("description")}).catch(function(ie){throw l.error("createAndOffer() failed:",ie),O(ie),ie}))},q=h.automaticSubscription,U=h.bandwidthProfile,G=h.dominantSpeaker,F=h.environment,N=h.eventObserver,A=h.loggerName,w=h.logLevel,j=h.name,Q=h.networkMonitor,Y=h.networkQuality,$=h.notifyWarnings,z=h.realm,ne=h.sdpSemantics,oe=!!U,ve=!!U,le=!!U&&(h.clientTrackSwitchOffControl!=="disabled"||h.contentPreferencesMode!=="disabled"),de=Object.assign({adaptiveSimulcast:S,automaticSubscription:q,dominantSpeaker:G,environment:F,eventObserver:N,loggerName:A,logLevel:w,networkMonitor:Q,networkQuality:Y,notifyWarnings:$,iceServers:g,onIced:E,realm:z,renderHints:le,sdpSemantics:ne,trackPriority:oe,trackSwitchOff:ve},U?{bandwidthProfile:U}:{});C=new b(j,c,v,f,d,de);var ee=a(h);N.emit("event",ee),C.once("connected",function(se){if(l.debug("Transport connected:",se),x()){O(P);return}var ie=se.participant;if(!ie){O(new r);return}D(new T(v,se,C,f,h))}),C.once("stateChanged",function(se,ie){se==="disconnected"?(C=null,O(ie||new e)):l.debug("Transport state changed:",se)})},function(){C&&(C.disconnect(),C=null)});return M.catch(function(){C&&(C.disconnect(),C=null),f.close()}),M}return Si=o,Si}var rn,Ws;function Ql(){if(Ws)return rn;Ws=1;var k=rn&&rn.__extends||function(){var s=function(i,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])},s(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),p=ji(),_=function(s){k(i,s);function i(){var e=s.call(this)||this;return Object.defineProperties(e,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),e}return i.prototype.addTrack=function(e,r,t,n){n===void 0&&(n=null);var a=this._createLocalTrackPublicationSignaling(e,r,t,n);return this._trackSendersToPublications.set(e,a),this._publicationsToTrackSenders.set(a,e),s.prototype.addTrack.call(this,a),this},i.prototype.getPublication=function(e){return this._trackSendersToPublications.get(e)||null},i.prototype.getSender=function(e){return this._publicationsToTrackSenders.get(e)||null},i.prototype.removeTrack=function(e){var r=this._trackSendersToPublications.get(e);if(!r)return null;this._trackSendersToPublications.delete(e),this._publicationsToTrackSenders.delete(r);var t=s.prototype.removeTrack.call(this,r);return t&&r.stop(),r},i}(p);return rn=_,rn}var nn,Hs;function $l(){if(Hs)return nn;Hs=1;var k=nn&&nn.__extends||function(){var i=function(e,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},i(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),p=Qc(),_=function(i){k(e,i);function e(r,t,n){var a=this,o=r.clone();r.kind!=="data"&&(o.track.enabled=r.track.enabled),r=o;var c=r.kind==="data"?!0:r.track.enabled;return a=i.call(this,t,r.kind,c,n)||this,a.setTrackTransceiver(r),Object.defineProperties(a,{_updatedPriority:{value:n,writable:!0},id:{enumerable:!0,value:r.id}}),a}return Object.defineProperty(e.prototype,"updatedPriority",{get:function(){return this._updatedPriority},enumerable:!1,configurable:!0}),e.prototype.enable=function(r){return r=typeof r=="boolean"?r:!0,this.trackTransceiver.track.enabled=r,i.prototype.enable.call(this,r)},e.prototype.publishFailed=function(r){return s(this,r)&&this.emit("updated"),this},e.prototype.setPriority=function(r){return this._updatedPriority!==r&&(this._updatedPriority=r,this.emit("updated")),this},e.prototype.setSid=function(r){return this._error?this:i.prototype.setSid.call(this,r)},e.prototype.stop=function(){this.trackTransceiver.stop()},e}(p);function s(i,e){return i._sid!==null||i._error?!1:(i._error=e,!0)}return nn=_,nn}var an,Gs;function Kl(){if(Gs)return an;Gs=1;var k=an&&an.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=$l(),_=nc(),s=ht().createTwilioError,i=function(e){k(r,e);function r(t,n,a,o,c){var d=e.call(this,t,n,a)||this;return Object.defineProperties(d,{_log:{value:c.log.createLog("default",d)},_mediaStates:{value:{recordings:null},writable:!0},_noiseCancellationVendor:{value:o}}),d}return r.prototype.getState=function(){var t={enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority};return this._noiseCancellationVendor&&(t.audio_processor=this._noiseCancellationVendor),t},r.prototype.toString=function(){return"[LocalTrackPublicationV2: "+this.sid+"]"},r.prototype.update=function(t){switch(t.state){case"ready":this.setSid(t.sid);break;case"failed":{var n=t.error;this.publishFailed(s(n.code,n.message));break}}return this},r.prototype.updateMediaStates=function(t){if(!t||!t.recordings||this._mediaStates.recordings===t.recordings)return this;switch(this._mediaStates.recordings=t.recordings,this._mediaStates.recordings){case"OK":this._log.info("Warnings have cleared."),this.emit("warningsCleared");break;case"NO_MEDIA":this._log.warn("Recording media lost."),this.emit("warning",_.recordingMediaLost);break;default:this._log.warn("Unknown media state detected: "+this._mediaStates.recordings);break}return this},r}(p);return an=i,an}var on,Qs;function zl(){if(Qs)return on;Qs=1;var k=on&&on.__extends||function(){var a=function(o,c){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var u in v)Object.prototype.hasOwnProperty.call(v,u)&&(d[u]=v[u])},a(o,c)};return function(o,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(o,c);function d(){this.constructor=o}o.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}(),p=Ql(),_=Kl(),s=Oe().DEFAULT_LOG_LEVEL,i=ze(),e=Ce(),r=e.buildLogLevels,t=e.isDeepEqual,n=function(a){k(o,a);function o(c,d,v){var u=this;v=Object.assign({logLevel:s,LocalTrackPublicationV2:_},v),u=a.call(this)||this;var y=r(v.logLevel);return Object.defineProperties(u,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:c},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:v.LocalTrackPublicationV2},_log:{value:v.log?v.log.createLog("default",u):new i("default",u,y,v.loggerName)},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},audioProcessors:{value:[],writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:d},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),u}return o.prototype.toString=function(){return"[LocalParticipantSignaling: "+this.sid+"]"},o.prototype.setSignalingRegion=function(c){this._signalingRegion||(this._signalingRegion=c)},o.prototype.setBandwidthProfile=function(c){t(this._bandwidthProfile,c)||(this._bandwidthProfile=JSON.parse(JSON.stringify(c)),this._bandwidthProfileRevision++,this.didUpdate())},o.prototype.setAudioProcessors=function(c){this.audioProcessors=c},o.prototype.getParameters=function(){return this._encodingParameters},o.prototype.setParameters=function(c){return this._encodingParameters.update(c),this},o.prototype.update=function(c){return this._publishedRevision>=c.revision?this:(this._publishedRevision=c.revision,c.tracks.forEach(function(d){var v=this.tracks.get(d.id);v&&v.update(d)},this),this)},o.prototype.updateMediaStates=function(c){return!c||!c.tracks?this:(Array.from(this.tracks.values()).forEach(function(d){var v=c.tracks[d.sid];v&&d.updateMediaStates(v)}),this)},o.prototype._createLocalTrackPublicationSignaling=function(c,d,v,u){return new this._LocalTrackPublicationV2(c,d,v,u,{log:this._log})},o.prototype.addTrack=function(c,d,v,u){var y=this;a.prototype.addTrack.call(this,c,d,v,u);var h=this.getPublication(c),S=h.isEnabled,L=h.updatedPriority,T=function(){(S!==h.isEnabled||L!==h.updatedPriority)&&(y.didUpdate(),S=h.isEnabled,L=h.updatedPriority)};return h.on("updated",T),this._removeListener(h),this._removeListeners.set(h,function(){return h.removeListener("updated",T)}),this.didUpdate(),this},o.prototype._removeListener=function(c){var d=this._removeListeners.get(c);d&&d()},o.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(c){return c.getState()})}},o.prototype.didUpdate=function(){this._revision++,this.emit("updated")},o.prototype.removeTrack=function(c){var d=a.prototype.removeTrack.call(this,c);return d&&(c.removeClone(d.trackTransceiver),this._removeListener(d),this.didUpdate()),d},o.prototype.setNetworkQualityConfiguration=function(c){this.networkQualityConfiguration.update(c)},o.prototype.setPublisherHint=function(c,d){var v=Array.from(this.tracks.values()).find(function(u){return u.sid===c});return v?v.trackTransceiver.setPublisherHint(d):(this._log.warn("track:"+c+" not found"),Promise.resolve("UNKNOWN_TRACK"))},o}(p);return on=n,on}var sn,$s;function Yl(){if($s)return sn;$s=1;var k=sn&&sn.__extends||function(){var r=function(t,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(a[c]=o[c])},r(t,n)};return function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");r(t,n);function a(){this.constructor=t}t.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}}(),p=ji(),_=Wc(),s=Dt(),i={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},e=function(r){k(t,r);function t(){return r.call(this,"closed",i)||this}return t.prototype._close=function(n){return this.transition("closing",n),this.transition("closed",n),Promise.resolve(this)},t.prototype._connect=function(n,a,o,c,d){n.connect("PA00000000000000000000000000000000","test");var v="RM00000000000000000000000000000000",u=Promise.resolve(new _(n,v,d));return u.cancel=function(){},u},t.prototype._open=function(n){return this.transition("opening",n),this.transition("open",n),Promise.resolve(this)},t.prototype.close=function(){var n=this;return this.bracket("close",function(a){switch(n.state){case"closed":return n;case"open":return n._close(a);default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},t.prototype.connect=function(n,a,o,c,d){var v=this;return this.bracket("connect",function u(y){switch(v.state){case"closed":return v._open(y).then(u.bind(null,y));case"open":return v.releaseLockCompletely(y),v._connect(n,a,o,c,d);default:throw new Error('Unexpected Signaling state "'+v.state+'"')}})},t.prototype.createLocalParticipantSignaling=function(){return new p},t.prototype.open=function(){var n=this;return this.bracket("open",function(a){switch(n.state){case"closed":return n._open(a);case"open":return n;default:throw new Error('Unexpected Signaling state "'+n.state+'"')}})},t}(s);return sn=e,sn}var cn,Ks;function Jl(){if(Ks)return cn;Ks=1;var k=cn&&cn.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),p=Gl(),_=zl(),s=Yl(),i=function(e){k(r,e);function r(t,n){var a=this;return n=Object.assign({createCancelableRoomSignalingPromise:p},n),a=e.call(this)||this,Object.defineProperties(a,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:t}}),a}return r.prototype._connect=function(t,n,a,o,c){return c=Object.assign({},this._options,c),this._createCancelableRoomSignalingPromise.bind(null,n,this._wsServer,t,a,o,c)},r.prototype.createLocalParticipantSignaling=function(t,n){return new _(t,n)},r}(s);return cn=i,cn}var Ti,zs;function Xl(){if(zs)return Ti;zs=1;var k=Ot().MediaStreamTrack,p=qe(),_=p.guessBrowser,s=p.guessBrowserVersion,i=p.isCodecSupported,e=qu(),r=Vu(),t=Yu(),n=Pc(),a=Ju(),o=It(),c=o.LocalAudioTrack,d=o.LocalDataTrack,v=o.LocalVideoTrack,u=Xu(),y=il(),h=Jl(),S=Ce(),L=S.asLocalTrack,T=S.buildLogLevels,b=S.filterObject,g=S.isNonArrayObject,l=Oe(),f=l.DEFAULT_ENVIRONMENT,m=l.DEFAULT_LOG_LEVEL,P=l.DEFAULT_LOGGER_NAME,C=l.DEFAULT_REALM,M=l.DEFAULT_REGION,D=l.WS_SERVER,O=l.SDK_NAME,x=l.SDK_VERSION,E=l.typeErrors,q=Ai(),U=Ec(),G=ze(),F=Cc().validateBandwidthProfile,N=_()==="safari"&&s(),A=0,w=!1,j=!1;if(N){var Q=N.major,Y=N.minor;j=Q<12||Q===12&&Y<1}var $=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),z=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function ne(ie,Z){if(typeof Z>"u"&&(Z={}),!g(Z))return q.reject(E.INVALID_TYPE("options","object"));var he=Z.Log||G,ue=Z.loggerName||P,ye=Z.logLevel||m,W=T(ye),K="[connect #"+ ++A+"]",I;try{I=new he("default",K,W,ue)}catch(H){return q.reject(H)}oe(Z,I,$);var R=Z.preferredVideoCodecs==="auto";if(R&&(Z.preferredVideoCodecs=[{codec:"VP8",simulcast:!0,adaptiveSimulcast:!0}]),Z.maxVideoBitrate&&R)return I.error('ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'),q.reject(E.ILLEGAL_INVOKE("connect",'ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'));Z=Object.assign({automaticSubscription:!0,dominantSpeaker:!1,enableDscp:!1,environment:f,eventListener:null,insights:!0,LocalAudioTrack:c,LocalDataTrack:d,LocalParticipant:t,LocalVideoTrack:v,Log:he,MediaStreamTrack:k,loggerName:ue,logLevel:ye,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:C,region:M,signaling:h},b(Z));var B={};typeof Z.wsServerInsights=="string"&&(B.gateway=Z.wsServerInsights);var ae=Z.insights?n:a,fe=new ae(ie,O,x,Z.environment,Z.realm,B),me=D(Z.environment,Z.region),we=new U(fe,Date.now(),I,Z.eventListener);if(Z=Object.assign({eventObserver:we,wsServer:me},Z),Z.log=I,j&&!w&&I.logLevel!=="error"&&I.logLevel!=="off"&&(w=!0,I.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),typeof ie!="string")return q.reject(E.INVALID_TYPE("token","string"));var Le=Object.assign({},Z);if(delete Le.name,"tracks"in Z){if(!Array.isArray(Z.tracks))return q.reject(E.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{Z.tracks=Z.tracks.map(function(H){return L(H,Le)})}catch(H){return q.reject(H)}}var _e=F(Z.bandwidthProfile);if(_e)return q.reject(_e);Z.clientTrackSwitchOffControl="disabled",Z.contentPreferencesMode="disabled",Z.bandwidthProfile&&(Z.clientTrackSwitchOffControl="auto",Z.contentPreferencesMode="auto",Z.bandwidthProfile.video&&(oe(Z.bandwidthProfile.video,I,z),"maxTracks"in Z.bandwidthProfile.video?Z.clientTrackSwitchOffControl="disabled":Z.bandwidthProfile.video.clientTrackSwitchOffControl==="manual"?Z.clientTrackSwitchOffControl="manual":Z.clientTrackSwitchOffControl="auto","renderDimensions"in Z.bandwidthProfile.video?Z.contentPreferencesMode="disabled":Z.bandwidthProfile.video.contentPreferencesMode==="manual"?Z.contentPreferencesMode="manual":Z.contentPreferencesMode="auto"));var je=Z.signaling,He=new je(Z.wsServer,Z);I.info("Connecting to a Room"),I.debug("Options:",Z);var We=new r({maxAudioBitrate:Z.maxAudioBitrate,maxVideoBitrate:Z.maxVideoBitrate},R),ce={audio:Z.preferredAudioCodecs.map(se),video:Z.preferredVideoCodecs.map(se)},te=new u(g(Z.networkQuality)?Z.networkQuality:{});["audio","video"].forEach(function(H){return ce[H].forEach(function(J){var X=J.codec;return i(X,H).then(function(re){return!re&&I.warn("The preferred "+H+' codec "'+X+'" will be ignored as it is not supported by the browser.')})})});var V=e(ee.bind(null,Z),ve.bind(null,He,I,We,te,Z),de.bind(null,ie,Z,He,We,ce),le.bind(null,Z));return V.then(function(H){return fe.connect(H.sid,H.localParticipant.sid),I.info("Connected to Room:",H.toString()),I.info("Room name:",H.name),I.debug("Room:",H),H.once("disconnected",function(){return fe.disconnect()}),H},function(H){fe.disconnect(),V._isCanceled?I.info("Attempt to connect to a Room was canceled"):I.info("Error while connecting to a Room:",H)}),V}function oe(ie,Z,he){he.forEach(function(ue){var ye=ue.didWarn,W=ue.name,K=ue.newName,I=ue.shouldDelete;W in ie&&typeof ie[W]<"u"&&(K&&I&&(ie[K]=ie[W]),I&&delete ie[W],!ye&&!["error","off"].includes(Z.level)&&(Z.warn('The ConnectOptions "'+W+'" is '+(K?'deprecated and scheduled for removal. Please use "'+K+'" instead.':"no longer applicable and will be ignored.")),ue.didWarn=!0))})}function ve(ie,Z,he,ue,ye,W){var K=ie.createLocalParticipantSignaling(he,ue);return Z.debug("Creating a new LocalParticipant:",K),new ye.LocalParticipant(K,W,ye)}function le(ie,Z,he){var ue=new y(Z,he,ie),ye=ie.log;return ye.debug("Creating a new Room:",ue),he.on("stateChanged",function W(K){K==="disconnected"&&(ye.info("Disconnected from Room:",ue.toString()),he.removeListener("stateChanged",W))}),ue}function de(ie,Z,he,ue,ye,W){return Z.log.debug("Creating a new RoomSignaling"),he.connect(W._signaling,ie,ue,ye,Z)}function ee(ie,Z){var he=ie.log;return ie.shouldStopLocalTracks=!ie.tracks,ie.shouldStopLocalTracks?he.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(he.info("Getting LocalTracks"),he.debug("Options:",ie)),ie.createLocalTracks(ie).then(function(ye){var W=Z(ye);return W.catch(function(){ie.shouldStopLocalTracks&&(he.info("The automatically acquired LocalTracks will now be stopped"),ye.forEach(function(I){I.stop()}))}),W})}function se(ie){var Z=typeof ie=="string"?{codec:ie}:ie;switch(Z.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},Z);case"vp8":return Object.assign({simulcast:!1},Z);default:return Z}}return Ti=ne,Ti}var wi,Ys;function Js(){if(Ys)return wi;Ys=1;var k=Oe(),p=k.DEFAULT_LOG_LEVEL,_=k.DEFAULT_LOGGER_NAME;function s(r,t){t=Object.assign({loggerName:_,logLevel:p},t);var n={};n.loggerName=t.loggerName,n.logLevel=t.logLevel,delete t.loggerName,delete t.logLevel;var a=["getUserMedia","enumerateDevices","MediaStream","mapMediaElement","disposeMediaElement"];a.forEach(function(c){c in t&&(n[c]=t[c],delete t[c])});var o=t.createLocalTracks;return delete t.createLocalTracks,n[r]=Object.keys(t).length>0?t:!0,o(n).then(function(c){return c[0]})}function i(r){return s("audio",r)}function e(r){return s("video",r)}return wi={audio:i,video:e},wi}var Ei,Xs;function Zl(){if(Xs)return Ei;Xs=1;var k=qe(),p=k.guessBrowser,_=k.support,s=un().getSdpFormat,i=Rt(),e=i.isAndroid,r=i.isMobile,t=i.isNonChromiumEdge,n=i.rebrandedChromeBrowser,a=i.mobileWebKitBrowser,o=["crios","edg","edge","electron","headlesschrome"],c=["chrome","firefox"],d=["chrome","safari"],v=[];function u(){var y=p();if(!y)return!1;var h=n(y),S=a(y),L=e()?c:d;return!!y&&_()&&s()==="unified"&&(!h||o.includes(h))&&!t(y)&&(!S||v.includes(S))&&(!r()||L.includes(y))}return Ei=u,Ei}var Pi=kn.exports,Zs;function ed(){if(Zs)return kn.exports;Zs=1;var k=Pi&&Pi.__assign||function(){return k=Object.assign||function(v){for(var u,y=1,h=arguments.length;y<h;y++){u=arguments[y];for(var S in u)Object.prototype.hasOwnProperty.call(u,S)&&(v[S]=u[S])}return v},k.apply(this,arguments)};Object.defineProperty(Pi,"__esModule",{value:!0});var p=Cu(),_=Nu(),s={connect:Xl(),createLocalAudioTrack:Js().audio,createLocalVideoTrack:Js().video,isSupported:Zl()(),version:tc.version,Logger:ec(),LocalAudioTrack:It().LocalAudioTrack,LocalDataTrack:It().LocalDataTrack,LocalVideoTrack:It().LocalVideoTrack};function i(v,u){var y=k({createLocalTracks:p.createLocalTracks},u);return s.connect(v,y)}function e(v){var u=k({createLocalTracks:p.createLocalTracks},v);return s.createLocalAudioTrack(u)}function r(v){var u=k({createLocalTracks:p.createLocalTracks},v);return s.createLocalVideoTrack(u)}var t=s.isSupported,n=s.version,a=s.Logger,o=s.LocalAudioTrack,c=s.LocalVideoTrack,d=s.LocalDataTrack;return kn.exports={connect:i,createLocalAudioTrack:e,createLocalVideoTrack:r,createLocalTracks:p.createLocalTracks,runPreflight:_.runPreflight,isSupported:t,version:n,Logger:a,LocalAudioTrack:o,LocalVideoTrack:c,LocalDataTrack:d},kn.exports}var td=ed();const Ci=Yc(td),rd=({content:k,onContentChange:p,isOpen:_,theme:s})=>{const i=`notepad-container ${_?"open":""} ${s}`;return Se.jsxs("div",{className:i,children:[Se.jsx("h3",{className:"notepad-header",children:"Shared Notes"}),Se.jsx("textarea",{value:k,onChange:e=>p(e.target.value),placeholder:"Type your shared notes here...",className:"notepad-textarea"})]})},nd=({transcript:k})=>Se.jsxs("div",{className:"transcript-container-overlay",children:[Se.jsx("h3",{className:"transcript-header",children:"Live Transcript"}),Se.jsx("div",{className:"transcript-content",children:Se.jsx("p",{children:k})})]}),id=({startTime:k})=>{const[p,_]=Pe.useState(0);Pe.useEffect(()=>{const t=setInterval(()=>_(Date.now()-k),1e3);return()=>clearInterval(t)},[k]);const s=Math.floor(p/1e3),i=Math.floor(s/60),e=s%60;let r="text-green-500";return i>=45&&(r="text-yellow-500"),i>=55&&(r="text-red-500"),Se.jsxs("div",{className:`font-mono text-lg font-bold ${r}`,children:[String(i).padStart(2,"0"),":",String(e).padStart(2,"0")]})},od=()=>{const{theme:k}=Jc(),{sessionId:p}=Xc(),{token:_,user:s}=Zc(),i=eu(),[e,r]=Pe.useState(null),[t,n]=Pe.useState(null),[a,o]=Pe.useState({message:"Initializing...",type:"info"}),[c,d]=Pe.useState(null),[v,u]=Pe.useState([]),[y,h]=Pe.useState(null),S=Pe.useRef(null),L=Pe.useRef(null),[T,b]=Pe.useState(!1),[g,l]=Pe.useState(""),[f,m]=Pe.useState(!1),[P,C]=Pe.useState(!1),[M,D]=Pe.useState(!1),[O,x]=Pe.useState(!1),[E,q]=Pe.useState(""),U=Pe.useRef(null),G=Pe.useRef(null),[F,N]=Pe.useState(!1),[A,w]=Pe.useState(!1),j=Pe.useRef(!1),Q=Pe.useCallback(ee=>y?ee.identity===y.mentor.id?y.mentor.profile?.name||"Mentor":y.mentee&&ee.identity===y.mentee.id?y.mentee.profile?.name||ee.identity:y.participants&&y.participants.find(ie=>ie.mentee?.id===ee.identity)?.mentee?.profile?.name||ee.identity:ee.identity,[y]),Y=({participant:ee})=>{const se=Pe.useRef(null),ie=Pe.useRef(null);return Pe.useEffect(()=>{const Z=ue=>{ue.kind==="video"?se.current?.appendChild(ue.attach()):ue.kind==="audio"&&ie.current?.appendChild(ue.attach())},he=ue=>{ue.detach().forEach(ye=>ye.remove())};return ee.on("trackSubscribed",Z),ee.on("trackUnsubscribed",he),ee.tracks.forEach(ue=>{ue.track&&Z(ue.track)}),()=>{ee.removeAllListeners()}},[ee]),Se.jsxs("div",{className:"video-participant-container",children:[Se.jsx("div",{ref:se,className:"video-feed"}),Se.jsx("div",{ref:ie}),Se.jsx("div",{className:"video-label",children:Q(ee)})]})};Pe.useEffect(()=>{if(!p||!_)return;o({message:"Authenticating...",type:"connecting"}),(async()=>{try{const[se,ie]=await Promise.all([hn.get(`/sessions/${p}`,{headers:{Authorization:`Bearer ${_}`}}),hn.post(`/sessions/${p}/call-token`,{},{headers:{Authorization:`Bearer ${_}`}})]);h(se.data),r(ie.data.videoToken),o({message:"Ready to join session.",type:"info"})}catch(se){console.error("Error fetching session data or token:",se),o({message:"Error: Could not authenticate for call. Please ensure you are a participant.",type:"error"})}})()},[p,_]),Pe.useEffect(()=>{if(!e)return;let ee=null,se=null;return o({message:"Joining room...",type:"connecting"}),Ci.connect(e,{name:p,audio:!0,video:!0}).then(ie=>{ee=ie,n(ie),o({message:"Joined room. Waiting for other participant(s)...",type:"success"}),S.current&&(S.current.innerHTML="",ie.localParticipant.tracks.forEach(ue=>{ue.track&&ue.track.kind==="video"&&S.current?.appendChild(ue.track.attach())})),u(Array.from(ie.participants.values()));const Z=ue=>{u(ye=>[...ye,ue]),o({message:"A participant has joined!",type:"success"}),c||d(Date.now())},he=ue=>{u(ye=>ye.filter(W=>W!==ue)),o({message:"A participant has left.",type:"info"})};ie.on("participantConnected",Z),ie.on("participantDisconnected",he)}).catch(ie=>{console.error("Failed to connect to Twilio Room:",ie),o({message:"Error: Failed to connect to video service.",type:"error"})}),se=tu("http://localhost:5000/api",{auth:{token:_}}),L.current=se,se.emit("join-data-room",p),se.on("notepad-update",ie=>l(ie)),()=>{ee?.disconnect(),se?.disconnect()}},[e,p,_,c]),Pe.useEffect(()=>{t&&!j.current&&(j.current=!0,hn.post(`/sessions/${p}/notify-call`).then(()=>{At.success("Other participants have been notified that you've joined the call.")}).catch(ee=>{console.error("Failed to send call notification:",ee),At.error("Could not notify other participants.")}))},[t,s,p]);const $=Pe.useCallback(ee=>{l(ee),L.current?.emit("notepad-change",{roomId:p,content:ee})},[p]),z=()=>{t?.localParticipant.audioTracks.forEach(ee=>{ee.track.isEnabled?ee.track.disable():ee.track.enable(),m(!ee.track.isEnabled)})},ne=()=>{t?.localParticipant.videoTracks.forEach(ee=>{ee.track.isEnabled?ee.track.disable():ee.track.enable(),C(!ee.track.isEnabled)})},oe=async()=>{if(M){const{localParticipant:ee}=t,se=Array.from(ee.videoTracks.values())[0].track;ee.unpublishTrack(se),se.stop();const ie=await Ci.createLocalVideoTrack();ee.publishTrack(ie),D(!1)}else try{const ee=await navigator.mediaDevices.getDisplayMedia({video:!0}),se=new Ci.LocalVideoTrack(ee.getTracks()[0]),{localParticipant:ie}=t;ie.unpublishTrack(Array.from(ie.videoTracks.values())[0].track),ie.publishTrack(se),D(!0),se.mediaStreamTrack.onended=()=>{oe()}}catch(ee){console.error("Screen share failed:",ee),D(!1)}},ve=()=>{if(O)U.current?.stop(),G.current?.close(),x(!1),At.success("Transcription stopped.");else{const ee=new Promise((se,ie)=>{if(!t?.participants.size)return ie("Cannot start transcription without another participant.");const Z=Array.from(t.participants.values())[0],he=Array.from(Z.audioTracks.values())[0]?.track;if(he&&he.mediaStreamTrack){const ue=new MediaStream([he.mediaStreamTrack.clone()]),ye="7183aa14021913883cc5b688c4cdbe1e72952feb",W="wss://api.deepgram.com/v1/listen?encoding=linear16&sample_rate=16000&channels=1&punctuate=true&interim_results=true",K=new WebSocket(W,["token",ye]);K.onopen=()=>{const I=new MediaRecorder(ue);I.ondataavailable=R=>{R.data.size>0&&K.readyState===1&&K.send(R.data)},U.current=I,I.start(250),x(!0),se()},K.onmessage=I=>{const R=JSON.parse(I.data),B=R.channel.alternatives[0].transcript;B&&R.is_final&&q(ae=>ae+B+" ")},K.onerror=()=>{ie("Could not connect to transcription service.")},G.current=K}else ie("The other participant's audio is not available.")});At.promise(ee,{loading:"Starting transcription...",success:"Transcription started!",error:se=>se.toString()})}},le=()=>{if(!E||!p){At.error("No transcript available to generate insights.");return}N(!0);const ee=hn.post("/ai/summarize",{sessionId:p,transcript:E});At.promise(ee,{loading:"Generating AI insights...",success:se=>(w(!0),N(!1),"Insights have been generated and saved!"),error:se=>(N(!1),se.response?.data?.message||"Failed to generate insights.")})},de=ee=>{switch(ee){case"success":return"status-success";case"error":return"status-error";case"connecting":return"status-connecting";default:return"status-info"}};return Se.jsxs("div",{className:`video-call-container ${k}`,children:[Se.jsxs("div",{className:"flex justify-between items-center",children:[Se.jsx("h1",{className:"video-call-header",children:"Video Session"}),c&&Se.jsx(id,{startTime:c})]}),Se.jsx("p",{className:`video-call-status ${de(a.type)}`,children:a.message}),Se.jsxs("div",{className:`video-main-area ${de(a.type)}`,children:[Se.jsxs("div",{className:`video-grid-container grid-size-${v.length+1}`,children:[Se.jsxs("div",{className:"video-participant-container",children:[Se.jsx("div",{ref:S,className:"video-feed"}),Se.jsx("div",{className:"video-label",children:s?.profile?.name||"You"})]}),v.map(ee=>Se.jsx(Y,{participant:ee},ee.sid))]}),Se.jsx(rd,{isOpen:T,onToggle:()=>b(ee=>!ee),content:g,onContentChange:$,theme:k}),O&&Se.jsx(nd,{transcript:E})]}),t&&Se.jsxs("div",{className:"control-bar",children:[Se.jsx("button",{onClick:z,className:`control-button ${f?"inactive":"active"}`,children:f?"Unmute":"Mute"}),Se.jsx("button",{onClick:ne,className:`control-button ${P?"inactive":"active"}`,children:P?"Start Video":"Stop Video"}),Se.jsx("button",{onClick:oe,className:`control-button ${M?"inactive":"active"}`,children:M?"Stop Sharing":"Share Screen"}),Se.jsx("button",{onClick:()=>b(ee=>!ee),className:`control-button ${T?"inactive":"active"}`,children:T?"Close Notepad":"Open Notepad"}),Se.jsx("button",{onClick:ve,className:`control-button ${O?"inactive":"active"}`,children:O?"Stop Transcript":"Start Transcript"}),!O&&E.length>0&&!A&&Se.jsx("button",{onClick:le,disabled:F,className:"control-button active",children:F?"Generating...":"Generate AI Insights"}),A&&Se.jsx(ru,{to:`/session/${p}/insights`,className:"control-button active",children:"View Insights"}),Se.jsx("button",{onClick:()=>{t.disconnect(),i("/my-sessions")},className:"control-button inactive",children:"Leave Session"})]})]})};export{od as default};
