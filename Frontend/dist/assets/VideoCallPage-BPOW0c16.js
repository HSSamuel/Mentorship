import{f as m,u as h,r as i,l as x,j as s}from"./index-D8cSyDI9.js";const j=()=>{const{sessionId:d}=m(),{token:u}=h(),r=i.useRef(null),l=i.useRef(null),a=i.useRef(null),o=i.useRef({});i.useEffect(()=>(u&&(r.current=x("http://localhost:5000/api",{auth:{token:u}}),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(c=>{l.current&&(l.current.srcObject=c),r.current?.emit("join-room",d),r.current?.on("user-joined",e=>{const t=f(e,c);o.current[e]=t,t.createOffer().then(n=>t.setLocalDescription(n)).then(()=>{r.current?.emit("offer",{target:e,offer:t.localDescription})})}),r.current?.on("offer",async e=>{const t=f(e.socketId,c);o.current[e.socketId]=t,await t.setRemoteDescription(new RTCSessionDescription(e.offer));const n=await t.createAnswer();await t.setLocalDescription(n),r.current?.emit("answer",{target:e.socketId,answer:n})}),r.current?.on("answer",e=>{o.current[e.socketId]?.setRemoteDescription(new RTCSessionDescription(e.answer))}),r.current?.on("ice-candidate",e=>{o.current[e.socketId]?.addIceCandidate(new RTCIceCandidate(e.candidate))}),r.current?.on("user-left",e=>{o.current[e]&&(o.current[e].close(),delete o.current[e]),a.current&&(a.current.srcObject=null)})}).catch(c=>{console.error("Error accessing media devices.",c)})),()=>{r.current?.disconnect(),Object.values(o.current).forEach(c=>c.close())}),[d,u]);const f=(c,e)=>{const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return t.onicecandidate=n=>{n.candidate&&r.current?.emit("ice-candidate",{target:c,candidate:n.candidate})},t.ontrack=n=>{a.current&&(a.current.srcObject=n.streams[0])},e.getTracks().forEach(n=>t.addTrack(n,e)),t};return s.jsxs("div",{className:"p-4",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Video Session"}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Your Video"}),s.jsx("video",{ref:l,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-auto bg-gray-200 rounded-md"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Mentor's Video"}),s.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,className:"w-full h-auto bg-gray-200 rounded-md"})]})]})]})};export{j as default};
